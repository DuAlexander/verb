/*! verb 2014-12-28 */
(function(e){"use strict";function r(e){return e instanceof Array?function(){return t.iter(e)}:"function"==typeof e.iterator?n(e,e.iterator):e.iterator}function n(e,r){if(null==r)return null;null==r.__id__&&(r.__id__=l++);var n;return null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[r.__id__],null==n&&(n=function(){return n.method.apply(n.scope,arguments)},n.scope=e,n.method=r,e.hx__closures__[r.__id__]=n),n}e.eval=e.eval||{};var t=function(){};t.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var a=function(){};a.fold=function(e,n,t){for(var a=r(e)();a.hasNext();){var i=a.next();t=n(i,t)}return t};var i=function(){},s={};s.ds={},s.ds.IntMap=function(){this.h={}},s.ds.IntMap.__interfaces__=[i],s.ds.IntMap.prototype={set:function(e,r){this.h[e]=r},get:function(e){return this.h[e]},exists:function(e){return this.h.hasOwnProperty(e)}};var o={};o.BoundingBox=e.BoundingBox=function(e){this.dim=3,this.initialized=!1,this.dim=3,this.min=null,this.max=null,null!=e&&this.addRange(e)},o.BoundingBox.intervalsOverlap=function(e,r,n,t,a){null==a&&(a=-1);var i;i=0>a?o.BoundingBox.TOLERANCE:a;var s=Math.min(e,r)-i,l=Math.max(e,r)+i,v=Math.min(n,t)-i,u=Math.max(n,t)+i;return s>=v&&u>=s||l>=v&&u>=l||v>=s&&l>=v||u>=s&&l>=u},o.BoundingBox.prototype={fromPoint:function(e){var r=new o.BoundingBox(null);return r.add(e),r},add:function(e){if(!this.initialized)return this.dim=e.length,this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this;for(var r=this.dim,n=0;r>n;){var t=n++;e[t]>this.max[t]&&(this.max[t]=e[t])}for(var a=0;r>a;){var i=a++;e[i]<this.min[i]&&(this.min[i]=e[i])}return this},addRange:function(e){for(var r=e.length,n=0;r>n;){var t=n++;this.add(e[t])}return this},contains:function(e,r){return null==r&&(r=-1),this.initialized?this.intersects(new o.BoundingBox([e]),r):!1},intersects:function(e,r){if(null==r&&(r=-1),!this.initialized||!e.initialized)return!1;for(var n=this.min,t=this.max,a=e.min,i=e.max,s=0,l=this.dim;l>s;){var v=s++;if(!o.BoundingBox.intervalsOverlap(n[v],t[v],a[v],i[v],r))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var e=0,r=0,n=0,t=this.dim;t>n;){var a=n++,i=this.getAxisLength(a);i>e&&(e=i,r=a)}return r},getAxisLength:function(e){return 0>e||e>this.dim-1?0:Math.abs(this.min[e]-this.max[e])},intersect:function(e,r){if(!this.initialized)return null;var n=this.min,t=this.max,a=e.min,i=e.max;if(!this.intersects(e,r))return null;for(var s=[],l=[],v=0,u=this.dim;u>v;){var c=v++;s.push(Math.min(t[c],i[c])),l.push(Math.max(n[c],a[c]))}return new o.BoundingBox([l,s])}},o.Init=function(){},o.Init.main=function(){console.log("verb 0.2.0")},o.eval={},o.eval.Analyze=function(){},o.eval.Binomial=function(){},o.eval.Binomial.get=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;if(r>e-r&&(r=e-r),o.eval.Binomial.memo_exists(e,r))return o.eval.Binomial.get_memo(e,r);for(var n=1,t=e,a=1,i=r+1;i>a;){var s=a++;o.eval.Binomial.memo_exists(t,s)?(e--,n=o.eval.Binomial.get_memo(t,s)):(n*=e--,n/=s,o.eval.Binomial.memoize(t,s,n))}return n},o.eval.Binomial.get_no_memo=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;r>e-r&&(r=e-r);for(var n=1,t=1,a=r+1;a>t;){var i=t++;n*=e--,n/=i}return n},o.eval.Binomial.memo_exists=function(e,r){return o.eval.Binomial.memo.exists(e)&&o.eval.Binomial.memo.get(e).exists(r)},o.eval.Binomial.get_memo=function(e,r){return o.eval.Binomial.memo.get(e).get(r)},o.eval.Binomial.memoize=function(e,r,n){o.eval.Binomial.memo.exists(e)||o.eval.Binomial.memo.set(e,new s.ds.IntMap),o.eval.Binomial.memo.get(e).set(r,n)},o.eval.Constants=e.eval.Constants=function(){},o.eval.Create=function(){},o.eval.Intersect=e.Intersect=function(){},o.eval.Mesh=function(){},o.eval.KnotMultiplicity=e.eval.KnotMultiplicity=function(e,r){this.knot=e,this.mult=r},o.eval.KnotMultiplicity.prototype={inc:function(){this.mult++}},o.eval.Modify=e.eval.Modify=function(){},o.eval.Modify.surface_knot_refine=function(e,r,n){var t,a,i,s=[];n?(i=e.controlPoints,t=e.knotsV,a=e.degreeV):(i=o.eval.Vec.transpose(e.controlPoints),t=e.knotsU,a=e.degreeU);for(var l=null,v=0;i.length>v;){var u=i[v];++v,l=o.eval.Modify.curve_knot_refine(new o.eval.types.CurveData(a,t,u),r),s.push(l.controlPoints)}var c=l.knots;return n?new o.eval.types.SurfaceData(e.degreeU,e.degreeV,e.knotsU.slice(),c,s):(s=o.eval.Vec.transpose(s),new o.eval.types.SurfaceData(e.degreeU,e.degreeV,c,e.knotsV.slice(),s))},o.eval.Modify.surface_split=function(e,r,n){null==n&&(n=!1);var t,a,i;n?(i=e.controlPoints,t=e.knotsV,a=e.degreeV):(i=o.eval.Vec.transpose(e.controlPoints),t=e.knotsU,a=e.degreeU);for(var s,l=[],v=0,u=a+1;u>v;)v++,l.push(r);s=l;for(var c=[],h=[],f=o.eval.Nurbs.knot_span(a,r,t),d=null,_=0;i.length>_;){var m=i[_];++_,d=o.eval.Modify.curve_knot_refine(new o.eval.types.CurveData(a,t,m),s),c.push(d.controlPoints.slice(0,f+1)),h.push(d.controlPoints.slice(f+1))}var g=d.knots.slice(0,f+a+2),p=d.knots.slice(f+1);return n?[new o.eval.types.SurfaceData(e.degreeU,a,e.knotsU.slice(),g,c),new o.eval.types.SurfaceData(e.degreeU,a,e.knotsU.slice(),p,h)]:(c=o.eval.Vec.transpose(c),h=o.eval.Vec.transpose(h),[new o.eval.types.SurfaceData(a,e.degreeV,g,e.knotsV.slice(),c),new o.eval.types.SurfaceData(a,e.degreeV,p,e.knotsV.slice(),h)])},o.eval.Modify.curve_bezier_decompose=function(e){for(var r=e.degree,n=e.controlPoints,t=e.knots,a=o.eval.Modify.knot_multiplicities(t),i=r+1,s=0;a.length>s;){var l=a[s];if(++s,i>l.mult){var v=o.eval.Vec.rep(i-l.mult,l.knot),u=o.eval.Modify.curve_knot_refine(new o.eval.types.CurveData(r,t,n),v);t=u.knots,n=u.controlPoints}}t.length/i-1;for(var c=2*i,h=[],f=0;n.length>f;){var d=t.slice(f,f+c),_=n.slice(f,f+i);h.push(new o.eval.types.CurveData(r,d,_)),f+=i}return h},o.eval.Modify.knot_multiplicities=function(e){for(var r=[new o.eval.KnotMultiplicity(e[0],0)],n=r[0],t=0;e.length>t;){var a=e[t];++t,Math.abs(a-n.knot)>o.eval.Constants.EPSILON&&(n=new o.eval.KnotMultiplicity(a,0),r.push(n)),n.inc()}return r},o.eval.Modify.curve_split=function(e,r){var n=e.degree;e.controlPoints;for(var t,a=e.knots,i=[],s=0,l=n+1;l>s;)s++,i.push(r);t=i;var v=o.eval.Modify.curve_knot_refine(e,t),u=o.eval.Nurbs.knot_span(n,r,a),c=v.knots.slice(0,u+n+2),h=v.knots.slice(u+1),f=v.controlPoints.slice(0,u+1),d=v.controlPoints.slice(u+1);return[new o.eval.types.CurveData(n,c,f),new o.eval.types.CurveData(n,h,d)]},o.eval.Modify.curve_knot_refine=function(e,r){for(var n=e.degree,t=e.controlPoints,a=e.knots,i=t.length-1,s=i+n+1,l=r.length-1,v=o.eval.Nurbs.knot_span(n,r[0],a),u=o.eval.Nurbs.knot_span(n,r[l],a),c=[],h=[],f=0,d=v-n+1;d>f;){var _=f++;c[_]=t[_]}for(var m=u-1,g=i+1;g>m;){var p=m++;c[p+l+1]=t[p]}for(var V=0,b=v+1;b>V;){var N=V++;h[N]=a[N]}for(var k=u+n,y=s+1;y>k;){var z=k++;h[z+l+1]=a[z]}for(var w=u+n-1,P=u+n+l,M=l;M>=0;){for(;r[M]<=a[w]&&w>v;)c[P-n-1]=t[w-n-1],h[P]=a[w],P-=1,w-=1;c[P-n-1]=c[P-n];for(var T=1,x=n+1;x>T;){var U=T++,B=P-n+U,D=h[P+U]-r[M];Math.abs(D)<o.eval.Constants.EPSILON?c[B-1]=c[B]:(D/=h[P+U]-a[w-n+U],c[B-1]=o.eval.Vec.add(o.eval.Vec.mul(D,c[B-1]),o.eval.Vec.mul(1-D,c[B])))}h[P]=r[M],P-=1,M--}return new o.eval.types.CurveData(n,h,c)},o.eval.Modify.curve_knot_insert=function(e,r,n){for(var t=e.degree,a=e.controlPoints,i=e.knots,s=0,l=a.length,v=o.eval.Nurbs.knot_span(t,r,i),u=[],c=[],h=[],f=1,d=v+1;d>f;){var _=f++;c[_]=i[_]}for(var m=1,g=n+1;g>m;){var p=m++;c[v+p]=r}for(var V=v+1,b=i.length;b>V;){var N=V++;c[N+n]=i[N]}for(var k=0,y=v-t+1;y>k;){var z=k++;h[z]=a[z]}for(var w=v-s;l>w;){var P=w++;h[P+n]=a[P]}for(var M=0,T=t-s+1;T>M;){var x=M++;u[x]=a[v-t+x]}for(var U=0,B=0,D=1,C=n+1;C>D;){var S=D++;U=v-t+S;for(var I=0,E=t-S-s+1;E>I;){var A=I++;B=(r-i[U+A])/(i[A+v+1]-i[U+A]),u[A]=o.eval.Vec.add(o.eval.Vec.mul(B,u[A+1]),o.eval.Vec.mul(1-B,u[A]))}h[U]=u[0],h[v+n-S-s]=u[t-S-s]}for(var R=U+1,L=v-s;L>R;){var O=R++;h[O]=u[O-U]}return new o.eval.types.CurveData(t,c,h)},o.eval.Nurbs=e.eval.Nurbs=function(){},o.eval.Nurbs.rational_surface_derivs=function(e,r,n,t){for(var a=o.eval.Nurbs.surface_derivs(e,r,n,t),i=o.eval.Nurbs.rational_2d(a),s=o.eval.Nurbs.weight_2d(a),l=[],v=i[0][0].length,u=0,c=r+1;c>u;){var h=u++;l.push([]);for(var f=0,d=r-h+1;d>f;){for(var _=f++,m=i[h][_],g=1,p=_+1;p>g;){var V=g++;m=o.eval.Vec.sub(m,o.eval.Vec.mul(o.eval.Binomial.get(_,V)*s[0][V],l[h][_-V]))}for(var b=1,N=h+1;N>b;){var k=b++;m=o.eval.Vec.sub(m,o.eval.Vec.mul(o.eval.Binomial.get(h,k)*s[k][0],l[h-k][_]));for(var y=o.eval.Vec.zeros1d(v),z=1,w=_+1;w>z;){var P=z++;y=o.eval.Vec.add(y,o.eval.Vec.mul(o.eval.Binomial.get(_,P)*s[k][P],l[h-k][_-P]))}m=o.eval.Vec.sub(m,o.eval.Vec.mul(o.eval.Binomial.get(h,k),y))}l[h].push(o.eval.Vec.mul(1/s[0][0],m))}}return l},o.eval.Nurbs.rational_surface_point=function(e,r,n){return o.eval.Nurbs.dehomogenize(o.eval.Nurbs.surface_point(e,r,n))},o.eval.Nurbs.rational_curve_derivs=function(e,r,n){for(var t=o.eval.Nurbs.curve_derivs(e,r,n),a=o.eval.Nurbs.rational_1d(t),i=o.eval.Nurbs.weight_1d(t),s=[],l=0,v=n+1;v>l;){for(var u=l++,c=a[u],h=1,f=u+1;f>h;){var d=h++;c=o.eval.Vec.sub(c,o.eval.Vec.mul(o.eval.Binomial.get(u,d)*i[d],s[u-d]))}s.push(o.eval.Vec.mul(1/i[0],c))}return s},o.eval.Nurbs.rational_curve_point=function(e,r){return o.eval.Nurbs.dehomogenize(o.eval.Nurbs.curve_point(e,r))},o.eval.Nurbs.dehomogenize=function(e){for(var r=e.length,n=[],t=e[r-1],a=e.length-1,i=0;a>i;){var s=i++;n.push(e[s]/t)}return n},o.eval.Nurbs.rational_1d=function(e){var r=e[0].length-1;return e.map(function(e){return e.slice(0,r)})},o.eval.Nurbs.rational_2d=function(e){return e.map(o.eval.Nurbs.rational_1d)},o.eval.Nurbs.weight_1d=function(e){var r=e[0].length-1;return e.map(function(e){return e[r]})},o.eval.Nurbs.weight_2d=function(e){return e.map(o.eval.Nurbs.weight_1d)},o.eval.Nurbs.dehomogenize_1d=function(e){return e.map(o.eval.Nurbs.dehomogenize)},o.eval.Nurbs.dehomogenize_2d=function(e){return e.map(o.eval.Nurbs.dehomogenize_1d)},o.eval.Nurbs.homogenize_1d=function(e,r){for(var n=e.length,t=e[0].length,a=[],i=0,s=[],o=0;n>o;){var l=o++,v=[];s=e[l],i=r[l];for(var u=0;t>u;){var c=u++;v.push(s[c]*i)}v.push(i),a.push(v)}return a},o.eval.Nurbs.homogenize_2d=function(e,r){for(var n=e.length,t=[],a=0;n>a;){var i=a++;t.push(o.eval.Nurbs.homogenize_1d(e[i],r[i]))}return t},o.eval.Nurbs.surface_derivs=function(e,r,n,t){var a=e.knotsU.length-e.degreeU-2,i=e.knotsV.length-e.degreeV-2;return o.eval.Nurbs.surface_derivs_given_n_m(a,i,e,r,n,t)},o.eval.Nurbs.surface_derivs_given_n_m=function(e,r,n,t,a,i){var s=n.degreeU,l=n.degreeV,v=n.controlPoints,u=n.knotsU,c=n.knotsV;if(!o.eval.Nurbs.are_valid_relations(s,v.length,u.length)||!o.eval.Nurbs.are_valid_relations(l,v[0].length,c.length))throw"Invalid relations between control points, knot vector, and n";var h,f=v[0][0].length;h=s>t?t:s;var d;d=l>t?t:l;for(var _=o.eval.Vec.zeros3d(h+1,d+1,f),m=o.eval.Nurbs.knot_span_given_n(e,s,a,u),g=o.eval.Nurbs.knot_span_given_n(r,l,i,c),p=o.eval.Nurbs.deriv_basis_functions_given_n_i(m,a,s,e,u),V=o.eval.Nurbs.deriv_basis_functions_given_n_i(g,i,l,r,c),b=o.eval.Vec.zeros2d(l+1,f),N=0,k=0,y=h+1;y>k;){for(var z=k++,w=0,P=l+1;P>w;){var M=w++;b[M]=o.eval.Vec.zeros1d(f);for(var T=0,x=s+1;x>T;){var U=T++;b[M]=o.eval.Vec.add(b[M],o.eval.Vec.mul(p[z][U],v[m-s+U][g-l+M]))}}var B=t-z;N=d>B?B:d;for(var D=0,C=N+1;C>D;){var S=D++;_[z][S]=o.eval.Vec.zeros1d(f);for(var I=0,E=l+1;E>I;){var A=I++;_[z][S]=o.eval.Vec.add(_[z][S],o.eval.Vec.mul(V[S][A],b[A]))}}}return _},o.eval.Nurbs.surface_point=function(e,r,n){var t=e.knotsU.length-e.degreeU-2,a=e.knotsV.length-e.degreeV-2;return o.eval.Nurbs.surface_point_given_n_m(t,a,e,r,n)},o.eval.Nurbs.surface_point_given_n_m=function(e,r,n,t,a){var i=n.degreeU,s=n.degreeV,l=n.controlPoints,v=n.knotsU,u=n.knotsV;if(!o.eval.Nurbs.are_valid_relations(i,l.length,v.length)||!o.eval.Nurbs.are_valid_relations(s,l[0].length,u.length))throw"Invalid relations between control points, knot vector, and n";for(var c=l[0][0].length,h=o.eval.Nurbs.knot_span_given_n(e,i,t,v),f=o.eval.Nurbs.knot_span_given_n(r,s,a,u),d=o.eval.Nurbs.basis_functions_given_knot_span_index(h,t,i,v),_=o.eval.Nurbs.basis_functions_given_knot_span_index(f,a,s,u),m=h-i,g=f,p=o.eval.Vec.zeros1d(c),V=o.eval.Vec.zeros1d(c),b=0,N=s+1;N>b;){var k=b++;V=o.eval.Vec.zeros1d(c),g=f-s+k;for(var y=0,z=i+1;z>y;){var w=y++;V=o.eval.Vec.add(V,o.eval.Vec.mul(d[w],l[m+w][g]))}p=o.eval.Vec.add(p,o.eval.Vec.mul(_[k],V))}return p},o.eval.Nurbs.curve_derivs=function(e,r,n){var t=e.knots.length-e.degree-2;return o.eval.Nurbs.curve_derivs_given_n(t,e,r,n)},o.eval.Nurbs.curve_derivs_given_n=function(e,r,n,t){var a=r.degree,i=r.controlPoints,s=r.knots;if(!o.eval.Nurbs.are_valid_relations(a,i.length,s.length))throw"Invalid relations between control points, knot vector, and n";var l,v=i[0].length;l=a>t?t:a;for(var u=o.eval.Vec.zeros2d(l+1,v),c=o.eval.Nurbs.knot_span_given_n(e,a,n,s),h=o.eval.Nurbs.deriv_basis_functions_given_n_i(c,n,a,l,s),f=0,d=l+1;d>f;)for(var _=f++,m=0,g=a+1;g>m;){var p=m++;u[_]=o.eval.Vec.add(u[_],o.eval.Vec.mul(h[_][p],i[c-a+p]))}return u},o.eval.Nurbs.curve_point=function(e,r){var n=e.knots.length-e.degree-2;return o.eval.Nurbs.curve_point_given_n(n,e,r)},o.eval.Nurbs.are_valid_relations=function(e,r,n){return 0==r+e+1-n},o.eval.Nurbs.curve_point_given_n=function(e,r,n){var t=r.degree,a=r.controlPoints,i=r.knots;if(!o.eval.Nurbs.are_valid_relations(t,a.length,i.length))throw"Invalid relations between control points, knot Array, and n";for(var s=o.eval.Nurbs.knot_span_given_n(e,t,n,i),l=o.eval.Nurbs.basis_functions_given_knot_span_index(s,n,t,i),v=o.eval.Vec.zeros1d(a[0].length),u=0,c=t+1;c>u;){var h=u++;v=o.eval.Vec.add(v,o.eval.Vec.mul(l[h],a[s-t+h]))}return v},o.eval.Nurbs.deriv_basis_functions=function(e,r,n){var t=o.eval.Nurbs.knot_span(r,e,n),a=n.length-1,i=a-r-1;return o.eval.Nurbs.deriv_basis_functions_given_n_i(t,e,r,i,n)},o.eval.Nurbs.deriv_basis_functions_given_n_i=function(e,r,n,t,a){var i=o.eval.Vec.zeros2d(n+1,n+1),s=o.eval.Vec.zeros1d(n+1),l=o.eval.Vec.zeros1d(n+1),v=0,u=0;i[0][0]=1;for(var c=1,h=n+1;h>c;){var f=c++;s[f]=r-a[e+1-f],l[f]=a[e+f]-r,v=0;for(var d=0;f>d;){var _=d++;i[f][_]=l[_+1]+s[f-_],u=i[_][f-1]/i[f][_],i[_][f]=v+l[_+1]*u,v=s[f-_]*u}i[f][f]=v}for(var m=o.eval.Vec.zeros2d(t+1,n+1),g=o.eval.Vec.zeros2d(2,n+1),p=0,V=1,b=0,N=0,k=0,y=0,z=0,w=0,P=n+1;P>w;){var M=w++;m[0][M]=i[M][n]}for(var T=0,x=n+1;x>T;){var U=T++;p=0,V=1,g[0][0]=1;for(var B=1,D=t+1;D>B;){var C=B++;b=0,N=U-C,k=n-C,U>=C&&(g[V][0]=g[p][0]/i[k+1][N],b=g[V][0]*i[N][k]),y=N>=-1?1:-N,z=k>=U-1?C-1:n-U;for(var S=y,I=z+1;I>S;){var E=S++;g[V][E]=(g[p][E]-g[p][E-1])/i[k+1][N+E],b+=g[V][E]*i[N+E][k]}k>=U&&(g[V][C]=-g[p][C-1]/i[k+1][U],b+=g[V][C]*i[U][k]),m[C][U]=b;var A=p;p=V,V=A}}for(var R=n,L=1,O=t+1;O>L;){for(var q=L++,F=0,K=n+1;K>F;){var H=F++;m[q][H]*=R}R*=n-q}return m},o.eval.Nurbs.basis_functions=function(e,r,n){var t=o.eval.Nurbs.knot_span(r,e,n);return o.eval.Nurbs.basis_functions_given_knot_span_index(t,e,r,n)},o.eval.Nurbs.basis_functions_given_knot_span_index=function(e,r,n,t){var a=o.eval.Vec.zeros1d(n+1),i=o.eval.Vec.zeros1d(n+1),s=o.eval.Vec.zeros1d(n+1),l=0,v=0;a[0]=1;for(var u=1,c=n+1;c>u;){var h=u++;i[h]=r-t[e+1-h],s[h]=t[e+h]-r,l=0;for(var f=0;h>f;){var d=f++;v=a[d]/(s[d+1]+i[h-d]),a[d]=l+s[d+1]*v,l=i[h-d]*v}a[h]=l}return a},o.eval.Nurbs.knot_span=function(e,r,n){var t=n.length-1,a=t-e-1;return o.eval.Nurbs.knot_span_given_n(a,e,r,n)},o.eval.Nurbs.knot_span_given_n=function(e,r,n,t){if(n>=t[e+1])return e;if(t[r]>n)return r;for(var a=r,i=e+1,s=Math.floor((a+i)/2);t[s]>n||n>=t[s+1];)t[s]>n?i=s:a=s,s=Math.floor((a+i)/2);return s},o.eval.Tess=e.eval.Tess=function(){},o.eval.Tess.rational_curve_regular_sample=function(e,r,n){return o.eval.Tess.rational_curve_regular_sample_range(e,e.knots[0],o.eval.Utils.last(e.knots),r,n)},o.eval.Tess.rational_curve_regular_sample_range=function(e,r,n,t,a){1>t&&(t=2);for(var i=[],s=(n-r)/(t-1),l=0,v=0;t>v;){var u=v++;l=r+s*u,a?i.push([l].concat(o.eval.Nurbs.rational_curve_point(e,l))):i.push(o.eval.Nurbs.rational_curve_point(e,l))}return i},o.eval.Tess.rational_curve_adaptive_sample=function(e,r,n){if(1==e.degree){if(n){for(var t=[],a=0,i=e.controlPoints.length;i>a;){var s=a++;t.push([e.knots[s+1]].concat(o.eval.Nurbs.dehomogenize(e.controlPoints[s])))}return t}return e.controlPoints.map(o.eval.Nurbs.dehomogenize)}return o.eval.Tess.rational_curve_adaptive_sample_range(e,e.knots[0],o.eval.Utils.last(e.knots),r,n)},o.eval.Tess.rational_curve_adaptive_sample_range=function(e,r,n,t,a){var i=o.eval.Nurbs.rational_curve_point(e,r),s=o.eval.Nurbs.rational_curve_point(e,n),l=.5+.2*Math.random(),v=r+(n-r)*l,u=o.eval.Nurbs.rational_curve_point(e,v),c=o.eval.Vec.sub(i,s),h=o.eval.Vec.sub(i,u);if(t>o.eval.Vec.dot(c,c)&&o.eval.Vec.dot(h,h)>t||!o.eval.Trig.three_points_are_flat(i,u,s,t)){var f=r+.5*(n-r),d=o.eval.Tess.rational_curve_adaptive_sample_range(e,r,f,t,a),_=o.eval.Tess.rational_curve_adaptive_sample_range(e,f,n,t,a);return d.slice(0,-1).concat(_)}return a?[[r].concat(i),[n].concat(s)]:[i,s]},o.eval.Tess.tessellate_rational_surface_naive=function(e,r,n){1>r&&(r=1),1>n&&(n=1),e.degreeU,e.degreeV,e.controlPoints;for(var t=e.knotsU,a=e.knotsV,i=o.eval.Utils.last(t)-t[0],s=o.eval.Utils.last(a)-a[0],l=i/r,v=s/n,u=[],c=[],h=[],f=0,d=r+1;d>f;)for(var _=f++,m=0,g=n+1;g>m;){var p=m++,V=_*l,b=p*v;c.push([V,b]);var N=o.eval.Nurbs.rational_surface_derivs(e,1,V,b),k=N[0][0];u.push(k);var y=o.eval.Vec.normalized(o.eval.Vec.cross(N[1][0],N[0][1]));h.push(y)}for(var z=[],w=0;r>w;)for(var P=w++,M=0;n>M;){var T=M++,x=P*(n+1)+T,U=(P+1)*(n+1)+T,B=U+1,D=x+1,C=[x,U,B],S=[x,B,D];z.push(C),z.push(S)}return new o.eval.types.MeshData(z,u,h,c)},o.eval.Tess.divide_rational_surface_adaptive=function(e,r){null==r&&(r=new o.eval.types.AdaptiveRefinementOptions),r.minDivsU=null!=r.minDivsU?r.minDivsU:1,r.minDivsU=null!=r.minDivsV?r.minDivsV:1,r.refine=null!=r.refine?r.refine:!0;var n,t=3*(e.controlPoints.length-1),a=3*(e.controlPoints[0].length-1);n=r.minDivsU=r.minDivsU>t?r.minDivsU:t;var i;i=r.minDivsV=r.minDivsV>a?r.minDivsV:a;for(var s=o.eval.Utils.last(e.knotsU),l=e.knotsU[0],v=o.eval.Utils.last(e.knotsV),u=e.knotsV[0],c=(s-l)/n,h=(v-u)/i,f=[],d=[],_=0,m=i+1;m>_;){for(var g=_++,p=[],V=0,b=n+1;b>V;){var N=V++,k=l+c*N,y=u+h*g,z=o.eval.Nurbs.rational_surface_derivs(e,1,k,y),w=o.eval.Vec.normalized(o.eval.Vec.cross(z[0][1],z[1][0]));p.push(new o.eval.types.SurfacePoint(z[0][0],w,[k,y],-1,o.eval.Vec.isZero(w)))}d.push(p)}for(var P=0;i>P;)for(var M=P++,T=0;n>T;){var x=T++,U=[d[i-M-1][x],d[i-M-1][x+1],d[i-M][x+1],d[i-M][x]];f.push(new o.eval.types.AdaptiveRefinementNode(e,U))}if(!r.refine)return f;for(var B=0;i>B;)for(var D=B++,C=0;n>C;){var S=C++,I=D*n+S,E=o.eval.Tess.north(I,D,S,n,i,f),A=o.eval.Tess.east(I,D,S,n,i,f),R=o.eval.Tess.south(I,D,S,n,i,f),L=o.eval.Tess.west(I,D,S,n,i,f);f[I].neighbors=[R,A,E,L],f[I].divide(r)}return f},o.eval.Tess.north=function(e,r,n,t,a,i){return 0==r?null:i[e-t]},o.eval.Tess.south=function(e,r,n,t,a,i){return r==a-1?null:i[e+t]},o.eval.Tess.east=function(e,r,n,t,a,i){return n==t-1?null:i[e+1]},o.eval.Tess.west=function(e,r,n,t,a,i){return 0==n?null:i[e-1]},o.eval.Tess.triangulate_adaptive_refinement_node_tree=function(e){for(var r=o.eval.types.MeshData.empty(),n=0;e.length>n;){var t=e[n];++n,t.triangulate(r)}return r},o.eval.Tess.tessellate_rational_surface_adaptive=function(e,r){var n=o.eval.Tess.divide_rational_surface_adaptive(e,r);return o.eval.Tess.triangulate_adaptive_refinement_node_tree(n)},o.eval.Trig=e.eval.Trig=function(){},o.eval.Trig.dist_to_seg=function(e,r,n){var t=o.eval.Vec.sub(n,e),a=o.eval.Vec.norm(t),i=o.eval.Vec.sub(r,e);if(o.eval.Constants.TOLERANCE>a)return o.eval.Vec.norm(i);var s=o.eval.Vec.mul(1/a,t),l=o.eval.Vec.dot(i,s),v=o.eval.Vec.add(e,o.eval.Vec.mul(l,s));return o.eval.Vec.dist(v,r)},o.eval.Trig.three_points_are_flat=function(e,r,n,t){var a=o.eval.Vec.sub(r,e),i=o.eval.Vec.sub(n,e),s=o.eval.Vec.cross(a,i),l=o.eval.Vec.dot(s,s);return t>l},o.eval.Utils=function(){},o.eval.Utils.last=function(e){return e[e.length-1]},o.eval.Vec=e.eval.Vec=function(){},o.eval.Vec.normalized=function(e){return o.eval.Vec.div(e,o.eval.Vec.normSquared(e))},o.eval.Vec.cross=function(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]},o.eval.Vec.transpose=function(e){if(0==e.length)return[];for(var r=[],n=0,t=e[0].length;t>n;){var a=n++;r.push(function(){for(var r,n=[],t=0,i=e.length;i>t;){var s=t++;n.push(e[s][a])}return r=n}(this))}return r},o.eval.Vec.dist=function(e,r){return o.eval.Vec.norm(o.eval.Vec.sub(e,r))},o.eval.Vec.distSquared=function(e,r){return o.eval.Vec.normSquared(o.eval.Vec.sub(e,r))},o.eval.Vec.sum=function(e){return a.fold(e,function(e,r){return r+e},0)},o.eval.Vec.norm=function(e){return Math.sqrt(o.eval.Vec.normSquared(e))},o.eval.Vec.normSquared=function(e){return a.fold(e,function(e,r){return r+e*e},0)},o.eval.Vec.rep=function(e,r){for(var n=[],t=0;e>t;)t++,n.push(r);return n},o.eval.Vec.zeros1d=function(e){for(var r=[],n=0;e>n;)n++,r.push(0);return r},o.eval.Vec.zeros2d=function(e,r){for(var n=[],t=0;e>t;)t++,n.push(o.eval.Vec.zeros1d(r));return n},o.eval.Vec.zeros3d=function(e,r,n){for(var t=[],a=0;e>a;)a++,t.push(o.eval.Vec.zeros2d(r,n));return t},o.eval.Vec.dot=function(e,r){for(var n=0,t=0,a=e.length;a>t;){var i=t++;n+=e[i]*r[i]}return n},o.eval.Vec.add=function(e,r){for(var n=[],t=0,a=e.length;a>t;){var i=t++;n.push(e[i]+r[i])}return n},o.eval.Vec.mul=function(e,r){for(var n=[],t=0,a=r.length;a>t;){var i=t++;n.push(e*r[i])}return n},o.eval.Vec.div=function(e,r){for(var n=[],t=0,a=e.length;a>t;){var i=t++;n.push(e[i]/r)}return n},o.eval.Vec.sub=function(e,r){for(var n=[],t=0,a=e.length;a>t;){var i=t++;n.push(e[i]-r[i])}return n},o.eval.Vec.isZero=function(e){for(var r=0,n=e.length;n>r;){var t=r++;if(Math.abs(e[t])>o.eval.Constants.TOLERANCE)return!1}return!0},o.eval.types={},o.eval.types.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.085},o.eval.types.AdaptiveRefinementNode=e.eval.AdaptiveRefinementNode=function(e,r,n){if(this.srf=e,this.neighbors=null==n?[null,null,null,null]:n,this.corners=r,null==this.corners){var t=e.knotsU[0],a=o.eval.Utils.last(e.knotsU),i=e.knotsV[0],s=o.eval.Utils.last(e.knotsV);this.corners=[o.eval.types.SurfacePoint.fromUv(t,i),o.eval.types.SurfacePoint.fromUv(a,i),o.eval.types.SurfacePoint.fromUv(a,s),o.eval.types.SurfacePoint.fromUv(t,s)]}},o.eval.types.AdaptiveRefinementNode.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var e=0;4>e;){var r=e++;if(null==this.corners[r].point){var n=this.corners[r];this.evalSrf(n.uv[0],n.uv[1],n)}}},evalSrf:function(e,r,n){var t=o.eval.Nurbs.rational_surface_derivs(this.srf,1,e,r),a=t[0][0],i=o.eval.Vec.cross(t[0][1],t[1][0]),s=o.eval.Vec.isZero(i);return s||(i=o.eval.Vec.normalized(i)),null!=n?(n.degen=s,n.point=a,n.normal=i,n):new o.eval.types.SurfacePoint(a,i,[e,r],-1,s)},getEdgeCorners:function(e){if(this.isLeaf())return[this.corners[e]];if(this.horizontal)switch(e){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(e){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(e){var r=[this.corners[e]];if(null==this.neighbors[e])return r;var n=this.neighbors[e].getEdgeCorners((e+2)%4),t=e%2,a=o.eval.Constants.EPSILON,i=this,s=[function(e){return e.uv[0]>i.corners[0].uv[0]+a&&e.uv[0]<i.corners[2].uv[0]-a},function(e){return e.uv[1]>i.corners[0].uv[1]+a&&e.uv[1]<i.corners[2].uv[1]-a}],l=n.filter(s[t]);return l.reverse(),r.concat(l)},midpoint:function(e){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[e])return this.midPoints[e];switch(e){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[e]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var e=this.corners.length,r=0;e>r;){var n=r++;if(this.corners[n],this.corners[n].degen){var t=this.corners[(n+1)%e],a=this.corners[(n+3)%e];this.corners[n].normal=t.degen?a.normal:t.normal}}},shouldDivide:function(e,r){if(e.minDepth>r)return!0;if(r>=e.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=o.eval.Vec.normSquared(o.eval.Vec.sub(this.corners[0].normal,this.corners[1].normal))>e.normTol||o.eval.Vec.normSquared(o.eval.Vec.sub(this.corners[2].normal,this.corners[3].normal))>e.normTol,this.splitHoriz=o.eval.Vec.normSquared(o.eval.Vec.sub(this.corners[1].normal,this.corners[2].normal))>e.normTol||o.eval.Vec.normSquared(o.eval.Vec.sub(this.corners[3].normal,this.corners[0].normal))>e.normTol,this.splitVert||this.splitHoriz)return!0;var n=this.center();return o.eval.Vec.normSquared(o.eval.Vec.sub(n.normal,this.corners[0].normal))>e.normTol||o.eval.Vec.normSquared(o.eval.Vec.sub(n.normal,this.corners[1].normal))>e.normTol||o.eval.Vec.normSquared(o.eval.Vec.sub(n.normal,this.corners[2].normal))>e.normTol||o.eval.Vec.normSquared(o.eval.Vec.sub(n.normal,this.corners[3].normal))>e.normTol},divide:function(e){null==e&&(e=new o.eval.types.AdaptiveRefinementOptions),this._divide(e,0,!0)},_divide:function(e,r,n){if(this.evalCorners(),this.shouldDivide(e,r)){if(r++,this.splitVert&&!this.splitHoriz?n=!1:!this.splitVert&&this.splitHoriz&&(n=!0),this.horizontal=n,this.horizontal){var t=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],a=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new o.eval.types.AdaptiveRefinementNode(this.srf,t),new o.eval.types.AdaptiveRefinementNode(this.srf,a)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var i=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],s=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new o.eval.types.AdaptiveRefinementNode(this.srf,i),new o.eval.types.AdaptiveRefinementNode(this.srf,s)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var l=0,v=this.children;v.length>l;){var u=v[l];++l,u._divide(e,r,!n)}}},triangulate:function(e){if(null==e&&(e=o.eval.types.MeshData.empty()),this.isLeaf())return this.triangulateLeaf(e);for(var r=0,n=this.children;n.length>r;){var t=n[r];if(++r,null==t)break;t.triangulate(e)}return e},triangulateLeaf:function(e){for(var r=e.points.length,n=[],t=[],a=0,i=0;4>i;){var s=i++,o=this.getAllCorners(s);2==o.length&&(a=s+1);for(var l=0,v=o.length;v>l;){var u=l++;n.push(o[u])}}for(var c=0;n.length>c;){var h=n[c];++c,-1==h.id?(e.uvs.push(h.uv),e.points.push(h.point),e.normals.push(h.normal),h.id=r,t.push(r),r++):t.push(h.id)}if(4==n.length)return e.faces.push([t[0],t[3],t[1]]),e.faces.push([t[3],t[2],t[1]]),e;if(5==n.length){var f=t.length;return e.faces.push([t[a],t[(a+1)%f],t[(a+2)%f]]),e.faces.push([t[(a+4)%f],t[(a+3)%f],t[a]]),e.faces.push([t[a],t[(a+2)%f],t[(a+3)%f]]),e}var d=this.center();e.uvs.push(d.uv),e.points.push(d.point),e.normals.push(d.normal);for(var _=e.points.length-1,m=0,g=n.length-1;n.length>m;)e.faces.push([_,t[g],t[m]]),g=m++;return e}},o.eval.types.CurveData=e.eval.CurveData=function(e,r,n){this.degree=e,this.controlPoints=n,this.knots=r},o.eval.types.MeshData=e.eval.MeshData=function(e,r,n,t){this.faces=e,this.points=r,this.normals=n,this.uvs=t},o.eval.types.MeshData.empty=function(){return new o.eval.types.MeshData([],[],[],[])},o.eval.types.SurfaceData=e.eval.SurfaceData=function(e,r,n,t,a){this.degreeU=e,this.degreeV=r,this.knotsU=n,this.knotsV=t,this.controlPoints=a},o.eval.types.SurfacePoint=function(e,r,n,t,a){null==a&&(a=!1),null==t&&(t=-1),this.uv=n,this.point=e,this.normal=r,this.id=t,this.degen=a},o.eval.types.SurfacePoint.fromUv=function(e,r){return new o.eval.types.SurfacePoint(null,null,[e,r])};var l=0;Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Math.isFinite=function(e){return isFinite(e)},Math.isNaN=function(e){return isNaN(e)},null==Array.prototype.map&&(Array.prototype.map=function(e){for(var r=[],n=0,t=this.length;t>n;){var a=n++;r[a]=e(this[a])}return r}),null==Array.prototype.filter&&(Array.prototype.filter=function(e){for(var r=[],n=0,t=this.length;t>n;){var a=n++,i=this[a];e(i)&&r.push(i)}return r}),o.BoundingBox.TOLERANCE=1e-4,o.eval.Binomial.memo=new s.ds.IntMap,o.eval.Constants.TOLERANCE=1e-6,o.eval.Constants.EPSILON=1e-10,o.Init.main()})("undefined"!=typeof window?window:exports);