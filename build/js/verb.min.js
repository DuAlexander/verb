/*! verb 2015-09-27 */
if("object"!=typeof exports||void 0===exports)var verb=exports={};else var Worker=require("webworker-threads").Worker;if("object"!=typeof window){var global=this,window=global,lookup=function(e,r){var t=global;return e.split(".").forEach(function(e){t&&(t=t[e])}),t?t[r]:null};onmessage=function(e){var r=lookup(e.data.className,e.data.methodName);return r?(postMessage({result:r.apply(null,e.data.args),id:e.data.id}),void 0):console.error("could not find "+e.data.className+"."+e.data.methodName)}}(function($hx_exports){"use strict";function $extend(e,r){function t(){}t.prototype=e;var o=new t;for(var n in r)o[n]=r[n];return r.toString!==Object.prototype.toString&&(o.toString=r.toString),o}function $iterator(e){return e instanceof Array?function(){return HxOverrides.iter(e)}:"function"==typeof e.iterator?$bind(e,e.iterator):e.iterator}function $bind(e,r){if(null==r)return null;null==r.__id__&&(r.__id__=$fid++);var t;return null==e.hx__closures__?e.hx__closures__={}:t=e.hx__closures__[r.__id__],null==t&&(t=function(){return t.method.apply(t.scope,arguments)},t.scope=e,t.method=r,e.hx__closures__[r.__id__]=t),t}$hx_exports.topo=$hx_exports.topo||{},$hx_exports.geom=$hx_exports.geom||{},$hx_exports.exe=$hx_exports.exe||{},$hx_exports.core=$hx_exports.core||{},$hx_exports.promhx=$hx_exports.promhx||{};var $estr=function(){return js.Boot.__string_rec(this,"")},HxOverrides=function(){};HxOverrides.__name__=["HxOverrides"],HxOverrides.indexOf=function(e,r,t){var o=e.length;for(0>t&&(t+=o,0>t&&(t=0));o>t;){if(e[t]===r)return t;t++}return-1},HxOverrides.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var Lambda=function(){};Lambda.__name__=["Lambda"],Lambda.array=function(e){for(var r=[],t=$iterator(e)();t.hasNext();){var o=t.next();r.push(o)}return r},Lambda.fold=function(e,r,t){for(var o=$iterator(e)();o.hasNext();){var n=o.next();t=r(n,t)}return t};var List=function(){this.length=0};List.__name__=["List"],List.prototype={add:function(e){var r=[e];null==this.h?this.h=r:this.q[1]=r,this.q=r,this.length++},pop:function(){if(null==this.h)return null;var e=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,e},isEmpty:function(){return null==this.h}};var IMap=function(){};IMap.__name__=["IMap"],Math.__name__=["Math"];var Type=function(){};Type.__name__=["Type"],Type.getClassName=function(e){var r=e.__name__;return r.join(".")};var haxe={};haxe.Log=function(){},haxe.Log.__name__=["haxe","Log"],haxe.Log.trace=function(e,r){js.Boot.__trace(e,r)},haxe.ds={},haxe.ds.IntMap=function(){this.h={}},haxe.ds.IntMap.__name__=["haxe","ds","IntMap"],haxe.ds.IntMap.__interfaces__=[IMap],haxe.ds.IntMap.prototype={set:function(e,r){this.h[e]=r},get:function(e){return this.h[e]},exists:function(e){return this.h.hasOwnProperty(e)},remove:function(e){return this.h.hasOwnProperty(e)?(delete this.h[e],!0):!1}},haxe.ds.Option={__ename__:!0,__constructs__:["Some","None"]},haxe.ds.Option.Some=function(e){var r=["Some",0,e];return r.__enum__=haxe.ds.Option,r.toString=$estr,r},haxe.ds.Option.None=["None",1],haxe.ds.Option.None.toString=$estr,haxe.ds.Option.None.__enum__=haxe.ds.Option;var js={};js.Boot=function(){},js.Boot.__name__=["js","Boot"],js.Boot.__unhtml=function(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},js.Boot.__trace=function(e,r){var t;if(t=null!=r?r.fileName+":"+r.lineNumber+": ":"",t+=js.Boot.__string_rec(e,""),null!=r&&null!=r.customParams)for(var o=0,n=r.customParams;n.length>o;){var i=n[o];++o,t+=","+js.Boot.__string_rec(i,"")}var s;"undefined"!=typeof document&&null!=(s=document.getElementById("haxe:trace"))?s.innerHTML+=js.Boot.__unhtml(t)+"<br/>":"undefined"!=typeof console&&null!=console.log&&console.log(t)},js.Boot.__string_rec=function(e,r){if(null==e)return"null";if(r.length>=5)return"<...>";var t=typeof e;switch("function"==t&&(e.__name__||e.__ename__)&&(t="object"),t){case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0];var o=e[0]+"(";r+="	";for(var n=2,i=e.length;i>n;){var s=n++;o+=2!=s?","+js.Boot.__string_rec(e[s],r):js.Boot.__string_rec(e[s],r)}return o+")"}var a=e.length,c="[";r+="	";for(var v=0;a>v;){var u=v++;c+=(u>0?",":"")+js.Boot.__string_rec(e[u],r)}return c+="]"}var l;try{l=e.toString}catch(p){return"???"}if(null!=l&&l!=Object.toString){var b=""+e;if("[object Object]"!=b)return b}var h=null,f="{\n";r+="	";var d=null!=e.hasOwnProperty;for(var h in e)(!d||e.hasOwnProperty(h))&&"prototype"!=h&&"__class__"!=h&&"__super__"!=h&&"__interfaces__"!=h&&"__properties__"!=h&&(2!=f.length&&(f+=", \n"),f+=r+h+" : "+js.Boot.__string_rec(e[h],r));return r=r.substring(1),f+="\n"+r+"}";case"function":return"<function>";case"string":return e;default:return e+""}};var promhx={};promhx.base={},promhx.base.AsyncBase=function(e){this._resolved=!1,this._pending=!1,this._errorPending=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,null!=e&&promhx.base.AsyncBase.link(e,this,function(e){return e})},promhx.base.AsyncBase.__name__=["promhx","base","AsyncBase"],promhx.base.AsyncBase.link=function(e,r,t){e._update.push({async:r,linkf:function(e){r.handleResolve(t(e))}}),promhx.base.AsyncBase.immediateLinkUpdate(e,r,t)},promhx.base.AsyncBase.immediateLinkUpdate=function(e,r,t){if(e._errored&&r.handleError(e._errorVal),e._resolved&&!e._pending)try{r.handleResolve(t(e._val))}catch(o){r.handleError(o)}},promhx.base.AsyncBase.linkAll=function(e,r){for(var t=function(t,o,n){if(0==t.length||promhx.base.AsyncBase.allFulfilled(t)){for(var i,s=[],a=$iterator(e)();a.hasNext();){var c=a.next();s.push(c==o?n:c._val)}i=s,r.handleResolve(i)}return null},o=$iterator(e)();o.hasNext();){var n=o.next();n._update.push({async:r,linkf:function(e,r,t){return function(o){return e(r,t,o)}}(t,function(){for(var r,t=[],o=$iterator(e)();o.hasNext();){var i=o.next();i!=n&&t.push(i)}return r=t}(this),n)})}promhx.base.AsyncBase.allFulfilled(e)&&r.handleResolve(function(){for(var r,t=[],o=$iterator(e)();o.hasNext();){var n=o.next();t.push(n._val)}return r=t}(this))},promhx.base.AsyncBase.pipeLink=function(e,r,t){var o=!1,n=function(e){if(!o){o=!0;var n=t(e);n._update.push({async:r,linkf:$bind(r,r.handleResolve)}),promhx.base.AsyncBase.immediateLinkUpdate(n,r,function(e){return e})}};if(e._update.push({async:r,linkf:n}),e._resolved&&!e._pending)try{n(e._val)}catch(i){r.handleError(i)}},promhx.base.AsyncBase.allResolved=function(e){for(var r=$iterator(e)();r.hasNext();){var t=r.next();if(!t._resolved)return!1}return!0},promhx.base.AsyncBase.allFulfilled=function(e){for(var r=$iterator(e)();r.hasNext();){var t=r.next();if(!t._fulfilled)return!1}return!0},promhx.base.AsyncBase.prototype={catchError:function(e){return this._error.push(e),this},errorThen:function(e){return this._errorMap=e,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(e){this._resolve(e)},_resolve:function(e){var r=this;this._pending?promhx.base.EventLoop.enqueue(function(e,r){return function(){return e(r)}}($bind(this,this._resolve),e)):(this._resolved=!0,this._pending=!0,promhx.base.EventLoop.queue.add(function(){r._val=e;for(var t=0,o=r._update;o.length>t;){var n=o[t];++t;try{n.linkf(e)}catch(i){n.async.handleError(i)}}r._fulfilled=!0,r._pending=!1}),promhx.base.EventLoop.continueOnNextLoop())},handleError:function(e){this._handleError(e)},_handleError:function(e){var r=this,t=function(e){if(r._error.length>0)for(var t=0,o=r._error;o.length>t;){var n=o[t];++t,n(e)}else{if(!(r._update.length>0))throw e;for(var i=0,s=r._update;s.length>i;){var a=s[i];++i,a.async.handleError(e)}}r._errorPending=!1};this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=e,promhx.base.EventLoop.queue.add(function(){if(null!=r._errorMap)try{r._resolve(r._errorMap(e))}catch(o){t(o)}else t(e)}),promhx.base.EventLoop.continueOnNextLoop())},then:function(e){var r=new promhx.base.AsyncBase;return promhx.base.AsyncBase.link(this,r,e),r},unlink:function(e){var r=this;promhx.base.EventLoop.queue.add(function(){r._update=r._update.filter(function(r){return r.async!=e})}),promhx.base.EventLoop.continueOnNextLoop()},isLinked:function(e){for(var r=!1,t=0,o=this._update;o.length>t;){var n=o[t];if(++t,n.async==e)return!0}return r}},promhx.Deferred=$hx_exports.promhx.Deferred=function(){promhx.base.AsyncBase.call(this)},promhx.Deferred.__name__=["promhx","Deferred"],promhx.Deferred.__super__=promhx.base.AsyncBase,promhx.Deferred.prototype=$extend(promhx.base.AsyncBase.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},promise:function(){return new promhx.Promise(this)},stream:function(){return new promhx.Stream(this)},publicStream:function(){return new promhx.PublicStream(this)}}),promhx.Promise=$hx_exports.promhx.Promise=function(e){promhx.base.AsyncBase.call(this,e),this._rejected=!1},promhx.Promise.__name__=["promhx","Promise"],promhx.Promise.whenAll=function(e){var r=new promhx.Promise;return promhx.base.AsyncBase.linkAll(e,r),r},promhx.Promise.promise=function(e){var r=new promhx.Promise;return r.handleResolve(e),r},promhx.Promise.__super__=promhx.base.AsyncBase,promhx.Promise.prototype=$extend(promhx.base.AsyncBase.prototype,{isRejected:function(){return this._rejected},reject:function(e){this._rejected=!0,this.handleError(e)},handleResolve:function(e){if(this._resolved){var r="Promise has already been resolved";throw promhx.error.PromiseError.AlreadyResolved(r)}this._resolve(e)},then:function(e){var r=new promhx.Promise;return promhx.base.AsyncBase.link(this,r,e),r},unlink:function(e){var r=this;promhx.base.EventLoop.queue.add(function(){if(r._fulfilled)r._update=r._update.filter(function(r){return r.async!=e});else{var t="Downstream Promise is not fullfilled";r.handleError(promhx.error.PromiseError.DownstreamNotFullfilled(t))}}),promhx.base.EventLoop.continueOnNextLoop()},handleError:function(e){this._rejected=!0,this._handleError(e)},pipe:function(e){var r=new promhx.Promise;return promhx.base.AsyncBase.pipeLink(this,r,e),r},errorPipe:function(e){var r=new promhx.Promise;return this.catchError(function(t){var o=e(t);o.then($bind(r,r._resolve))}),this.then($bind(r,r._resolve)),r}}),promhx.Stream=$hx_exports.promhx.Stream=function(e){promhx.base.AsyncBase.call(this,e),this._end_deferred=new promhx.Deferred,this._end_promise=this._end_deferred.promise()},promhx.Stream.__name__=["promhx","Stream"],promhx.Stream.foreach=function(e){for(var r=new promhx.Stream,t=$iterator(e)();t.hasNext();){var o=t.next();r.handleResolve(o)}return r.end(),r},promhx.Stream.wheneverAll=function(e){var r=new promhx.Stream;return promhx.base.AsyncBase.linkAll(e,r),r},promhx.Stream.concatAll=function(e){for(var r=new promhx.Stream,t=$iterator(e)();t.hasNext();){var o=t.next();r.concat(o)}return r},promhx.Stream.mergeAll=function(e){for(var r=new promhx.Stream,t=$iterator(e)();t.hasNext();){var o=t.next();r.merge(o)}return r},promhx.Stream.stream=function(e){var r=new promhx.Stream;return r.handleResolve(e),r},promhx.Stream.__super__=promhx.base.AsyncBase,promhx.Stream.prototype=$extend(promhx.base.AsyncBase.prototype,{then:function(e){var r=new promhx.Stream;return promhx.base.AsyncBase.link(this,r,e),this._end_promise.then(function(){r.end()}),r},detachStream:function(e){for(var r=[],t=!1,o=0,n=this._update;n.length>o;){var i=n[o];++o,i.async==e?t=!0:r.push(i)}return this._update=r,t},first:function(){var e=new promhx.Promise;return this.then(function(r){e._resolved||e.handleResolve(r)}),e},handleResolve:function(e){this._end||this._pause||this._resolve(e)},pause:function(e){null==e&&(e=!this._pause),this._pause=e},pipe:function(e){var r=new promhx.Stream;return promhx.base.AsyncBase.pipeLink(this,r,e),this._end_promise.then(function(){r.end()}),r},errorPipe:function(e){var r=new promhx.Stream;return this.catchError(function(t){var o=e(t);o.then($bind(r,r._resolve)),o._end_promise.then(($_=r._end_promise,$bind($_,$_._resolve)))}),this.then($bind(r,r._resolve)),this._end_promise.then(function(){r.end()}),r},handleEnd:function(){if(this._pending)promhx.base.EventLoop.queue.add($bind(this,this.handleEnd)),promhx.base.EventLoop.continueOnNextLoop();else{if(this._end_promise._resolved)return;this._end=!0;var e;e=this._resolved?haxe.ds.Option.Some(this._val):haxe.ds.Option.None,this._end_promise.handleResolve(e),this._update=[],this._error=[]}},end:function(){return promhx.base.EventLoop.queue.add($bind(this,this.handleEnd)),promhx.base.EventLoop.continueOnNextLoop(),this},endThen:function(e){return this._end_promise.then(e)},filter:function(e){var r=new promhx.Stream;return this._update.push({async:r,linkf:function(t){e(t)&&r.handleResolve(t)}}),promhx.base.AsyncBase.immediateLinkUpdate(this,r,function(e){return e}),r},concat:function(e){var r=new promhx.Stream;return this._update.push({async:r,linkf:$bind(r,r.handleResolve)}),promhx.base.AsyncBase.immediateLinkUpdate(this,r,function(e){return e}),this._end_promise.then(function(){e.pipe(function(e){return r.handleResolve(e),r}),e._end_promise.then(function(){r.end()})}),r},merge:function(e){var r=new promhx.Stream;return this._update.push({async:r,linkf:$bind(r,r.handleResolve)}),e._update.push({async:r,linkf:$bind(r,r.handleResolve)}),promhx.base.AsyncBase.immediateLinkUpdate(this,r,function(e){return e}),promhx.base.AsyncBase.immediateLinkUpdate(e,r,function(e){return e}),r}}),promhx.PublicStream=$hx_exports.promhx.PublicStream=function(e){promhx.Stream.call(this,e)},promhx.PublicStream.__name__=["promhx","PublicStream"],promhx.PublicStream.publicstream=function(e){var r=new promhx.PublicStream;return r.handleResolve(e),r},promhx.PublicStream.__super__=promhx.Stream,promhx.PublicStream.prototype=$extend(promhx.Stream.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},update:function(e){this.handleResolve(e)}}),promhx.base.EventLoop=function(){},promhx.base.EventLoop.__name__=["promhx","base","EventLoop"],promhx.base.EventLoop.enqueue=function(e){promhx.base.EventLoop.queue.add(e),promhx.base.EventLoop.continueOnNextLoop()},promhx.base.EventLoop.set_nextLoop=function(e){if(null!=promhx.base.EventLoop.nextLoop)throw"nextLoop has already been set";return promhx.base.EventLoop.nextLoop=e,promhx.base.EventLoop.nextLoop},promhx.base.EventLoop.queueEmpty=function(){return promhx.base.EventLoop.queue.isEmpty()},promhx.base.EventLoop.finish=function(e){null==e&&(e=1e3);for(var r=null;e-->0&&null!=(r=promhx.base.EventLoop.queue.pop());)r();return promhx.base.EventLoop.queue.isEmpty()},promhx.base.EventLoop.clear=function(){promhx.base.EventLoop.queue=new List},promhx.base.EventLoop.f=function(){var e=promhx.base.EventLoop.queue.pop();null!=e&&e(),promhx.base.EventLoop.queue.isEmpty()||promhx.base.EventLoop.continueOnNextLoop()},promhx.base.EventLoop.continueOnNextLoop=function(){null!=promhx.base.EventLoop.nextLoop?promhx.base.EventLoop.nextLoop(promhx.base.EventLoop.f):setImmediate(promhx.base.EventLoop.f)},promhx.error={},promhx.error.PromiseError={__ename__:!0,__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]},promhx.error.PromiseError.AlreadyResolved=function(e){var r=["AlreadyResolved",0,e];return r.__enum__=promhx.error.PromiseError,r.toString=$estr,r},promhx.error.PromiseError.DownstreamNotFullfilled=function(e){var r=["DownstreamNotFullfilled",1,e];return r.__enum__=promhx.error.PromiseError,r.toString=$estr,r};var verb={};verb.Verb=function(){},verb.Verb.__name__=["verb","Verb"],verb.Verb.main=function(){haxe.Log.trace("verb 0.2.0",{fileName:"Verb.hx",lineNumber:56,className:"verb.Verb",methodName:"main"})},verb.core={},verb.core.KnotMultiplicity=$hx_exports.core.KnotMultiplicity=function(e,r){this.knot=e,this.mult=r},verb.core.KnotMultiplicity.__name__=["verb","core","KnotMultiplicity"],verb.core.KnotMultiplicity.prototype={inc:function(){this.mult++}},verb.core.Analyze=$hx_exports.core.Analyze=function(){},verb.core.Analyze.__name__=["verb","core","Analyze"],verb.core.Analyze.knotMultiplicities=function(e){for(var r=[new verb.core.KnotMultiplicity(e[0],0)],t=r[0],o=0;e.length>o;){var n=e[o];++o,Math.abs(n-t.knot)>1e-10&&(t=new verb.core.KnotMultiplicity(n,0),r.push(t)),t.inc()}return r},verb.core.Analyze.isRationalSurfaceClosed=function(e,r){null==r&&(r=!0);var t;t=r?e.controlPoints:verb.core.Mat.transpose(e.controlPoints);for(var o=0,n=t[0].length;n>o;){var i=o++,s=1e-10>verb.core.Vec.dist(t[0][i],t[t.length-1][i]);if(!s)return!1}return!0},verb.core.Analyze.rationalSurfaceClosestPoint=function(e,r){var t=verb.core.Analyze.rationalSurfaceClosestParam(e,r);return verb.core.Eval.rationalSurfacePoint(e,t[0],t[1])},verb.core.Analyze.rationalSurfaceClosestParam=function(e,r){for(var t,o,n,i=5,s=0,a=1e-4,c=5e-4,v=e.knotsU[0],u=verb.core.ArrayExtensions.last(e.knotsU),l=e.knotsV[0],p=verb.core.ArrayExtensions.last(e.knotsV),b=verb.core.Analyze.isRationalSurfaceClosed(e),h=verb.core.Analyze.isRationalSurfaceClosed(e,!1),f=verb.core.Tess.rationalSurfaceAdaptive(e,new verb.core.types.AdaptiveRefinementOptions),d=Math.POSITIVE_INFINITY,m=0,g=f.points.length;g>m;){var x=m++,_=f.points[x],y=verb.core.Vec.normSquared(verb.core.Vec.sub(r,_));d>y&&(d=y,n=f.uvs[x])}for(var S=function(r){return verb.core.Eval.rationalSurfaceDerivatives(e,r[0],r[1],2)},V=function(e,r,t){var o=r[1][0],n=r[0][1],i=r[2][0],s=r[0][2],a=r[1][1],c=r[1][1],v=verb.core.Vec.dot(o,t),u=verb.core.Vec.dot(n,t),l=[-v,-u],p=verb.core.Vec.dot(o,o)+verb.core.Vec.dot(i,t),b=verb.core.Vec.dot(o,n)+verb.core.Vec.dot(a,t),h=verb.core.Vec.dot(o,n)+verb.core.Vec.dot(c,t),f=verb.core.Vec.dot(n,n)+verb.core.Vec.dot(s,t),d=[[p,b],[h,f]],m=verb.core.Mat.solve(d,l);return verb.core.Vec.add(m,e)};i>s;){t=S(n),o=verb.core.Vec.sub(t[0][0],r);var E=verb.core.Vec.norm(o),B=verb.core.Vec.dot(t[1][0],o),w=verb.core.Vec.norm(t[1][0])*E,k=verb.core.Vec.dot(t[0][1],o),P=verb.core.Vec.norm(t[0][1])*E,L=B/w,A=k/P,M=a>E,N=c>L,I=c>A;if(M&&N&&I)return n;var T=V(n,t,o);v>T[0]?T=b?[u-(T[0]-v),T[1]]:[v+1e-10,T[1]]:T[0]>u&&(T=b?[v+(T[0]-u),T[1]]:[u-1e-10,T[1]]),l>T[1]?T=h?[T[0],p-(T[1]-l)]:[T[0],l+1e-10]:T[1]>p&&(T=h?[T[0],l+(T[0]-p)]:[T[0],p-1e-10]);var C=verb.core.Vec.norm(verb.core.Vec.mul(T[0]-n[0],t[1][0])),O=verb.core.Vec.norm(verb.core.Vec.mul(T[1]-n[1],t[0][1]));if(a>C+O)return n;n=T,s++}return n},verb.core.Analyze.rationalCurveClosestPoint=function(e,r){return verb.core.Eval.rationalCurvePoint(e,verb.core.Analyze.rationalCurveClosestParam(e,r))},verb.core.Analyze.rationalCurveClosestParam=function(e,r){for(var t=Math.POSITIVE_INFINITY,o=0,n=verb.core.Tess.rationalCurveRegularSample(e,e.controlPoints.length*e.degree,!0),i=0,s=n.length-1;s>i;){var a=i++,c=n[a][0],v=n[a+1][0],u=n[a].slice(1),l=n[a+1].slice(1),p=verb.core.Trig.segmentClosestPoint(r,u,l,c,v),b=verb.core.Vec.norm(verb.core.Vec.sub(r,p.pt));t>b&&(t=b,o=p.u)}for(var h,f,d=5,m=0,g=1e-4,x=5e-4,_=e.knots[0],y=verb.core.ArrayExtensions.last(e.knots),S=1e-10>verb.core.Vec.normSquared(verb.core.Vec.sub(e.controlPoints[0],verb.core.ArrayExtensions.last(e.controlPoints))),V=o,E=function(r){return verb.core.Eval.rationalCurveDerivatives(e,r,2)},B=function(e,r,t){var o=verb.core.Vec.dot(r[1],t),n=verb.core.Vec.dot(r[2],t),i=verb.core.Vec.dot(r[1],r[1]),s=n+i;return e-o/s};d>m;){h=E(V),f=verb.core.Vec.sub(h[0],r);var w=verb.core.Vec.norm(f),k=verb.core.Vec.dot(h[1],f),P=verb.core.Vec.norm(h[1])*w,L=k/P,A=g>w,M=x>Math.abs(L);if(A&&M)return V;var N=B(V,h,f);_>N?N=S?y-(N-_):_:N>y&&(N=S?_+(N-y):y);var I=verb.core.Vec.norm(verb.core.Vec.mul(N-V,h[1]));if(g>I)return V;V=N,m++}return V},verb.core.Analyze.rationalCurveParamAtArcLength=function(e,r,t,o,n){if(null==t&&(t=.001),1e-10>r)return e.knots[0];var i;i=null!=o?o:verb.core.Modify.decomposeCurveIntoBeziers(e);var s=0;i[s];var a,c=-1e-10;for(a=null!=n?n:[];r>c&&i.length>s;){if(a[s]=a.length>s?a[s]:verb.core.Analyze.rationalBezierCurveArcLength(e),c+=a[s],c+1e-10>r)return verb.core.Analyze.rationalBezierCurveParamAtArcLength(e,r,t,a[s]);s++}return-1},verb.core.Analyze.rationalBezierCurveParamAtArcLength=function(e,r,t,o){if(0>r)return e.knots[0];var n;if(n=null!=o?o:verb.core.Analyze.rationalBezierCurveArcLength(e),r>n)return verb.core.ArrayExtensions.last(e.knots);var i,s=e.knots[0],a=0,c=verb.core.ArrayExtensions.last(e.knots),v=n,u=0,l=0;for(i=null!=t?t:2e-6;v-a>i;)u=(s+c)/2,l=verb.core.Analyze.rationalBezierCurveArcLength(e,u),l>r?(c=u,v=l):(s=u,a=l);return(s+c)/2},verb.core.Analyze.rationalCurveArcLength=function(e,r,t){null==t&&(t=16),r=null==r?verb.core.ArrayExtensions.last(e.knots):r;for(var o=verb.core.Modify.decomposeCurveIntoBeziers(e),n=0,i=o[0],s=0;o.length>n&&r>i.knots[0]+1e-10;){var a=Math.min(verb.core.ArrayExtensions.last(i.knots),r);s+=verb.core.Analyze.rationalBezierCurveArcLength(i,a,t),i=o[++n]}return s},verb.core.Analyze.rationalBezierCurveArcLength=function(e,r,t){null==t&&(t=16);var o;o=null==r?verb.core.ArrayExtensions.last(e.knots):r;for(var n,i,s=(o-e.knots[0])/2,a=0,c=e.degree+t,v=0;c>v;){var u=v++;n=s*verb.core.Analyze.Tvalues[c][u]+s+e.knots[0],i=verb.core.Eval.rationalCurveDerivatives(e,n,1),a+=verb.core.Analyze.Cvalues[c][u]*verb.core.Vec.norm(i[1])}return s*a},verb.core.ArrayExtensions=function(){},verb.core.ArrayExtensions.__name__=["verb","core","ArrayExtensions"],verb.core.ArrayExtensions.alloc=function(e,r){if(!(0>r))for(;r>e.length;)e.push(null)},verb.core.ArrayExtensions.reversed=function(e){var r=e.slice();return r.reverse(),r},verb.core.ArrayExtensions.last=function(e){return e[e.length-1]},verb.core.ArrayExtensions.first=function(e){return e[0]},verb.core.ArrayExtensions.spliceAndInsert=function(e,r,t,o){e.splice(r,t),e.splice(r,0,o)},verb.core.ArrayExtensions.left=function(e){if(0==e.length)return[];var r=Math.ceil(e.length/2);return e.slice(0,r)},verb.core.ArrayExtensions.right=function(e){if(0==e.length)return[];var r=Math.ceil(e.length/2);return e.slice(r)},verb.core.ArrayExtensions.rightWithPivot=function(e){if(0==e.length)return[];var r=Math.ceil(e.length/2);return e.slice(r-1)},verb.core.ArrayExtensions.unique=function(e,r){if(0==e.length)return[];for(var t=[e.pop()];e.length>0;){for(var o=e.pop(),n=!0,i=0;t.length>i;){var s=t[i];if(++i,r(o,s)){n=!1;break}}n&&t.push(o)}return t},verb.core.Binomial=function(){},verb.core.Binomial.__name__=["verb","core","Binomial"],verb.core.Binomial.get=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;if(r>e-r&&(r=e-r),verb.core.Binomial.memo_exists(e,r))return verb.core.Binomial.get_memo(e,r);for(var t=1,o=e,n=1,i=r+1;i>n;){var s=n++;verb.core.Binomial.memo_exists(o,s)?(e--,t=verb.core.Binomial.get_memo(o,s)):(t*=e--,t/=s,verb.core.Binomial.memoize(o,s,t))}return t},verb.core.Binomial.get_no_memo=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;r>e-r&&(r=e-r);for(var t=1,o=1,n=r+1;n>o;){var i=o++;t*=e--,t/=i}return t},verb.core.Binomial.memo_exists=function(e,r){return verb.core.Binomial.memo.exists(e)&&verb.core.Binomial.memo.get(e).exists(r)},verb.core.Binomial.get_memo=function(e,r){return verb.core.Binomial.memo.get(e).get(r)},verb.core.Binomial.memoize=function(e,r,t){verb.core.Binomial.memo.exists(e)||verb.core.Binomial.memo.set(e,new haxe.ds.IntMap),verb.core.Binomial.memo.get(e).set(r,t)},verb.core.Check=$hx_exports.core.Check=function(){},verb.core.Check.__name__=["verb","core","Check"],verb.core.Check.isValidKnotVector=function(e,r){if(0==e.length)return!1;if(2*(r+1)>e.length)return!1;for(var t=e[0],o=0,n=r+1;n>o;){var i=o++;if(Math.abs(e[i]-t)>1e-10)return!1}t=e[e.length-1];for(var s=e.length-r-1,a=e.length;a>s;){var c=s++;if(Math.abs(e[c]-t)>1e-10)return!1}return verb.core.Check.isNonDecreasing(e)},verb.core.Check.isNonDecreasing=function(e){for(var r=e[0],t=0,o=e.length;o>t;){var n=t++;if(r-1e-10>e[n])return!1;r=e[n]}return!0},verb.core.Check.nurbsCurveData=function(e){if(null==e.controlPoints)throw"Control points array cannot be null!";if(null==e.degree)throw"Degree cannot be null!";if(1>e.degree)throw"Degree must be greater than 1!";if(null==e.knots)throw"Knots cannot be null!";if(e.knots.length!=e.controlPoints.length+e.degree+1)throw"controlPoints.length + degree + 1 must equal knots.length!";if(!verb.core.Check.isValidKnotVector(e.knots,e.degree))throw"Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!";return e},verb.core.Check.nurbsSurfaceData=function(e){if(null==e.controlPoints)throw"Control points array cannot be null!";if(null==e.degreeU)throw"DegreeU cannot be null!";if(null==e.degreeV)throw"DegreeV cannot be null!";if(1>e.degreeU)throw"DegreeU must be greater than 1!";if(1>e.degreeV)throw"DegreeV must be greater than 1!";if(null==e.knotsU)throw"KnotsU cannot be null!";if(null==e.knotsV)throw"KnotsV cannot be null!";if(e.knotsU.length!=e.controlPoints.length+e.degreeU+1)throw"controlPointsU.length + degreeU + 1 must equal knotsU.length!";if(e.knotsV.length!=e.controlPoints[0].length+e.degreeV+1)throw"controlPointsV.length + degreeV + 1 must equal knotsV.length!";if(!verb.core.Check.isValidKnotVector(e.knotsU,e.degreeU)||!verb.core.Check.isValidKnotVector(e.knotsV,e.degreeV))throw"Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!";return e},verb.core.Constants=$hx_exports.core.Constants=function(){},verb.core.Constants.__name__=["verb","core","Constants"],verb.core.Divide=$hx_exports.core.Divide=function(){},verb.core.Divide.__name__=["verb","core","Divide"],verb.core.Divide.rationalCurveByEqualArcLength=function(e,r){var t=verb.core.Analyze.rationalCurveArcLength(e),o=t/r;return verb.core.Divide.rationalCurveByArcLength(e,o)},verb.core.Divide.rationalCurveByArcLength=function(e,r){var t=verb.core.Modify.decomposeCurveIntoBeziers(e),o=t.map(function(e){return verb.core.Analyze.rationalBezierCurveArcLength(e)}),n=verb.core.Vec.sum(o),i=[new verb.core.types.CurveLengthSample(e.knots[0],0)];if(r>n)return i;for(var s,a=r,c=0,v=a,u=0,l=0;t.length>c;){for(u+=o[c];u+1e-10>v;)s=verb.core.Analyze.rationalBezierCurveParamAtArcLength(t[c],v-l,1e-6,o[c]),i.push(new verb.core.types.CurveLengthSample(s,v)),v+=a;l+=o[c],c++}return i},verb.core.Eval=$hx_exports.core.Eval=function(){},verb.core.Eval.__name__=["verb","core","Eval"],verb.core.Eval.volumePoint=function(e,r,t,o){var n=e.knotsU.length-e.degreeU-2,i=e.knotsV.length-e.degreeV-2,s=e.knotsW.length-e.degreeW-2;return verb.core.Eval.volumePointGivenNML(e,n,i,s,r,t,o)},verb.core.Eval.volumePointGivenNML=function(e,r,t,o,n,i,s){if(!verb.core.Eval.areValidRelations(e.degreeU,e.controlPoints.length,e.knotsU.length)||!verb.core.Eval.areValidRelations(e.degreeV,e.controlPoints[0].length,e.knotsV.length)||!verb.core.Eval.areValidRelations(e.degreeW,e.controlPoints[0][0].length,e.knotsW.length))throw"Invalid relations between control points and knot vector";for(var a=e.controlPoints,c=e.degreeU,v=e.degreeV,u=e.degreeW,l=e.knotsU,p=e.knotsV,b=e.knotsW,h=a[0][0][0].length,f=verb.core.Eval.knotSpanGivenN(r,c,n,l),d=verb.core.Eval.knotSpanGivenN(t,v,i,p),m=verb.core.Eval.knotSpanGivenN(o,u,s,b),g=verb.core.Eval.basisFunctionsGivenKnotSpanIndex(f,n,c,l),x=verb.core.Eval.basisFunctionsGivenKnotSpanIndex(d,i,v,p),_=verb.core.Eval.basisFunctionsGivenKnotSpanIndex(m,s,u,b),y=f-c,S=verb.core.Vec.zeros1d(h),V=verb.core.Vec.zeros1d(h),E=verb.core.Vec.zeros1d(h),B=0,w=u+1;w>B;){var k=B++;E=verb.core.Vec.zeros1d(h);for(var P=m-u+k,L=0,A=v+1;A>L;){var M=L++;V=verb.core.Vec.zeros1d(h);for(var N=d-v+M,I=0,T=c+1;T>I;){var C=I++;V=verb.core.Vec.add(V,verb.core.Vec.mul(g[C],a[y+C][N][P]))}E=verb.core.Vec.add(E,verb.core.Vec.mul(x[M],V))}S=verb.core.Vec.add(S,verb.core.Vec.mul(_[k],E))}return S},verb.core.Eval.rationalCurveTangent=function(e,r){var t=verb.core.Eval.rationalCurveDerivatives(e,r,1);return t[1]},verb.core.Eval.rationalSurfaceNormal=function(e,r,t){var o=verb.core.Eval.rationalSurfaceDerivatives(e,r,t,1);return verb.core.Vec.cross(o[1][0],o[0][1])},verb.core.Eval.rationalSurfaceDerivatives=function(e,r,t,o){null==o&&(o=1);for(var n=verb.core.Eval.surfaceDerivatives(e,r,t,o),i=verb.core.Eval.rational2d(n),s=verb.core.Eval.weight2d(n),a=[],c=i[0][0].length,v=0,u=o+1;u>v;){var l=v++;a.push([]);for(var p=0,b=o-l+1;b>p;){for(var h=p++,f=i[l][h],d=1,m=h+1;m>d;){var g=d++;f=verb.core.Vec.sub(f,verb.core.Vec.mul(verb.core.Binomial.get(h,g)*s[0][g],a[l][h-g]))}for(var x=1,_=l+1;_>x;){var y=x++;f=verb.core.Vec.sub(f,verb.core.Vec.mul(verb.core.Binomial.get(l,y)*s[y][0],a[l-y][h]));for(var S=verb.core.Vec.zeros1d(c),V=1,E=h+1;E>V;){var B=V++;S=verb.core.Vec.add(S,verb.core.Vec.mul(verb.core.Binomial.get(h,B)*s[y][B],a[l-y][h-B]))}f=verb.core.Vec.sub(f,verb.core.Vec.mul(verb.core.Binomial.get(l,y),S))}a[l].push(verb.core.Vec.mul(1/s[0][0],f))}}return a},verb.core.Eval.rationalSurfacePoint=function(e,r,t){return verb.core.Eval.dehomogenize(verb.core.Eval.surfacePoint(e,r,t))},verb.core.Eval.rationalCurveDerivatives=function(e,r,t){null==t&&(t=1);for(var o=verb.core.Eval.curveDerivatives(e,r,t),n=verb.core.Eval.rational1d(o),i=verb.core.Eval.weight1d(o),s=[],a=0,c=t+1;c>a;){for(var v=a++,u=n[v],l=1,p=v+1;p>l;){var b=l++;u=verb.core.Vec.sub(u,verb.core.Vec.mul(verb.core.Binomial.get(v,b)*i[b],s[v-b]))}s.push(verb.core.Vec.mul(1/i[0],u))}return s},verb.core.Eval.rationalCurvePoint=function(e,r){return verb.core.Eval.dehomogenize(verb.core.Eval.curvePoint(e,r))},verb.core.Eval.dehomogenize=function(e){for(var r=e.length,t=[],o=e[r-1],n=e.length-1,i=0;n>i;){var s=i++;t.push(e[s]/o)}return t},verb.core.Eval.rational1d=function(e){var r=e[0].length-1;return e.map(function(e){return e.slice(0,r)})},verb.core.Eval.rational2d=function(e){return e.map(verb.core.Eval.rational1d)},verb.core.Eval.weight1d=function(e){var r=e[0].length-1;return e.map(function(e){return e[r]})},verb.core.Eval.weight2d=function(e){return e.map(verb.core.Eval.weight1d)},verb.core.Eval.dehomogenize1d=function(e){return e.map(verb.core.Eval.dehomogenize)},verb.core.Eval.dehomogenize2d=function(e){return e.map(verb.core.Eval.dehomogenize1d)},verb.core.Eval.homogenize1d=function(e,r){var t,o=e.length,n=e[0].length,i=[],s=0,a=[];t=null!=r?r:verb.core.Vec.rep(e.length,1);for(var c=0;o>c;){var v=c++,u=[];a=e[v],s=t[v];for(var l=0;n>l;){var p=l++;u.push(a[p]*s)}u.push(s),i.push(u)}return i},verb.core.Eval.homogenize2d=function(e,r){var t,o=e.length,n=[];if(null!=r)t=r;else{for(var i=[],s=0;o>s;)s++,i.push(verb.core.Vec.rep(e[0].length,1));t=i}for(var a=0;o>a;){var c=a++;n.push(verb.core.Eval.homogenize1d(e[c],t[c]))}return n},verb.core.Eval.surfaceDerivatives=function(e,r,t,o){var n=e.knotsU.length-e.degreeU-2,i=e.knotsV.length-e.degreeV-2;return verb.core.Eval.surfaceDerivativesGivenNM(n,i,e,r,t,o)},verb.core.Eval.surfaceDerivativesGivenNM=function(e,r,t,o,n,i){var s=t.degreeU,a=t.degreeV,c=t.controlPoints,v=t.knotsU,u=t.knotsV;if(!verb.core.Eval.areValidRelations(s,c.length,v.length)||!verb.core.Eval.areValidRelations(a,c[0].length,u.length))throw"Invalid relations between control points, knot vector, and n";var l,p=c[0][0].length;l=s>i?i:s;var b;b=a>i?i:a;for(var h=verb.core.Vec.zeros3d(l+1,b+1,p),f=verb.core.Eval.knotSpanGivenN(e,s,o,v),d=verb.core.Eval.knotSpanGivenN(r,a,n,u),m=verb.core.Eval.derivativeBasisFunctionsGivenNI(f,o,s,e,v),g=verb.core.Eval.derivativeBasisFunctionsGivenNI(d,n,a,r,u),x=verb.core.Vec.zeros2d(a+1,p),_=0,y=0,S=l+1;S>y;){for(var V=y++,E=0,B=a+1;B>E;){var w=E++;x[w]=verb.core.Vec.zeros1d(p);for(var k=0,P=s+1;P>k;){var L=k++;x[w]=verb.core.Vec.add(x[w],verb.core.Vec.mul(m[V][L],c[f-s+L][d-a+w]))}}var A=i-V;_=b>A?A:b;for(var M=0,N=_+1;N>M;){var I=M++;h[V][I]=verb.core.Vec.zeros1d(p);for(var T=0,C=a+1;C>T;){var O=T++;h[V][I]=verb.core.Vec.add(h[V][I],verb.core.Vec.mul(g[I][O],x[O]))}}}return h},verb.core.Eval.surfacePoint=function(e,r,t){var o=e.knotsU.length-e.degreeU-2,n=e.knotsV.length-e.degreeV-2;return verb.core.Eval.surfacePointGivenNM(o,n,e,r,t)},verb.core.Eval.surfacePointGivenNM=function(e,r,t,o,n){var i=t.degreeU,s=t.degreeV,a=t.controlPoints,c=t.knotsU,v=t.knotsV;
if(!verb.core.Eval.areValidRelations(i,a.length,c.length)||!verb.core.Eval.areValidRelations(s,a[0].length,v.length))throw"Invalid relations between control points, knot vector, and n";for(var u=a[0][0].length,l=verb.core.Eval.knotSpanGivenN(e,i,o,c),p=verb.core.Eval.knotSpanGivenN(r,s,n,v),b=verb.core.Eval.basisFunctionsGivenKnotSpanIndex(l,o,i,c),h=verb.core.Eval.basisFunctionsGivenKnotSpanIndex(p,n,s,v),f=l-i,d=p,m=verb.core.Vec.zeros1d(u),g=verb.core.Vec.zeros1d(u),x=0,_=s+1;_>x;){var y=x++;g=verb.core.Vec.zeros1d(u),d=p-s+y;for(var S=0,V=i+1;V>S;){var E=S++;g=verb.core.Vec.add(g,verb.core.Vec.mul(b[E],a[f+E][d]))}m=verb.core.Vec.add(m,verb.core.Vec.mul(h[y],g))}return m},verb.core.Eval.curveDerivatives=function(e,r,t){var o=e.knots.length-e.degree-2;return verb.core.Eval.curveDerivativesGivenN(o,e,r,t)},verb.core.Eval.curveDerivativesGivenN=function(e,r,t,o){var n=r.degree,i=r.controlPoints,s=r.knots;if(!verb.core.Eval.areValidRelations(n,i.length,s.length))throw"Invalid relations between control points, knot vector, and n";var a,c=i[0].length;a=n>o?o:n;for(var v=verb.core.Vec.zeros2d(a+1,c),u=verb.core.Eval.knotSpanGivenN(e,n,t,s),l=verb.core.Eval.derivativeBasisFunctionsGivenNI(u,t,n,a,s),p=0,b=a+1;b>p;)for(var h=p++,f=0,d=n+1;d>f;){var m=f++;v[h]=verb.core.Vec.add(v[h],verb.core.Vec.mul(l[h][m],i[u-n+m]))}return v},verb.core.Eval.curvePoint=function(e,r){var t=e.knots.length-e.degree-2;return verb.core.Eval.curvePointGivenN(t,e,r)},verb.core.Eval.areValidRelations=function(e,r,t){return 0==r+e+1-t},verb.core.Eval.curvePointGivenN=function(e,r,t){var o=r.degree,n=r.controlPoints,i=r.knots;if(!verb.core.Eval.areValidRelations(o,n.length,i.length))throw"Invalid relations between control points, knot Array, and n";for(var s=verb.core.Eval.knotSpanGivenN(e,o,t,i),a=verb.core.Eval.basisFunctionsGivenKnotSpanIndex(s,t,o,i),c=verb.core.Vec.zeros1d(n[0].length),v=0,u=o+1;u>v;){var l=v++;c=verb.core.Vec.add(c,verb.core.Vec.mul(a[l],n[s-o+l]))}return c},verb.core.Eval.derivativeBasisFunctions=function(e,r,t){var o=verb.core.Eval.knotSpan(r,e,t),n=t.length-1,i=n-r-1;return verb.core.Eval.derivativeBasisFunctionsGivenNI(o,e,r,i,t)},verb.core.Eval.derivativeBasisFunctionsGivenNI=function(e,r,t,o,n){var i=verb.core.Vec.zeros2d(t+1,t+1),s=verb.core.Vec.zeros1d(t+1),a=verb.core.Vec.zeros1d(t+1),c=0,v=0;i[0][0]=1;for(var u=1,l=t+1;l>u;){var p=u++;s[p]=r-n[e+1-p],a[p]=n[e+p]-r,c=0;for(var b=0;p>b;){var h=b++;i[p][h]=a[h+1]+s[p-h],v=i[h][p-1]/i[p][h],i[h][p]=c+a[h+1]*v,c=s[p-h]*v}i[p][p]=c}for(var f=verb.core.Vec.zeros2d(o+1,t+1),d=verb.core.Vec.zeros2d(2,t+1),m=0,g=1,x=0,_=0,y=0,S=0,V=0,E=0,B=t+1;B>E;){var w=E++;f[0][w]=i[w][t]}for(var k=0,P=t+1;P>k;){var L=k++;m=0,g=1,d[0][0]=1;for(var A=1,M=o+1;M>A;){var N=A++;x=0,_=L-N,y=t-N,L>=N&&(d[g][0]=d[m][0]/i[y+1][_],x=d[g][0]*i[_][y]),S=_>=-1?1:-_,V=y>=L-1?N-1:t-L;for(var I=S,T=V+1;T>I;){var C=I++;d[g][C]=(d[m][C]-d[m][C-1])/i[y+1][_+C],x+=d[g][C]*i[_+C][y]}y>=L&&(d[g][N]=-d[m][N-1]/i[y+1][L],x+=d[g][N]*i[L][y]),f[N][L]=x;var O=m;m=g,g=O}}for(var D=t,z=1,U=o+1;U>z;){for(var R=z++,F=0,$=t+1;$>F;){var G=F++;f[R][G]*=D}D*=t-R}return f},verb.core.Eval.basisFunctions=function(e,r,t){var o=verb.core.Eval.knotSpan(r,e,t);return verb.core.Eval.basisFunctionsGivenKnotSpanIndex(o,e,r,t)},verb.core.Eval.basisFunctionsGivenKnotSpanIndex=function(e,r,t,o){var n=verb.core.Vec.zeros1d(t+1),i=verb.core.Vec.zeros1d(t+1),s=verb.core.Vec.zeros1d(t+1),a=0,c=0;n[0]=1;for(var v=1,u=t+1;u>v;){var l=v++;i[l]=r-o[e+1-l],s[l]=o[e+l]-r,a=0;for(var p=0;l>p;){var b=p++;c=n[b]/(s[b+1]+i[l-b]),n[b]=a+s[b+1]*c,a=i[l-b]*c}n[l]=a}return n},verb.core.Eval.knotSpan=function(e,r,t){return verb.core.Eval.knotSpanGivenN(t.length-e-2,e,r,t)},verb.core.Eval.knotSpanGivenN=function(e,r,t,o){if(t>o[e+1]-1e-10)return e;if(o[r]+1e-10>t)return r;for(var n=r,i=e+1,s=Math.floor((n+i)/2);o[s]>t||t>=o[s+1];)o[s]>t?i=s:n=s,s=Math.floor((n+i)/2);return s},verb.core.MarchStepState={__ename__:!0,__constructs__:["OutOfBounds","InsideDomain","AtBoundary","CompleteLoop","CoincidentStartPoint"]},verb.core.MarchStepState.OutOfBounds=["OutOfBounds",0],verb.core.MarchStepState.OutOfBounds.toString=$estr,verb.core.MarchStepState.OutOfBounds.__enum__=verb.core.MarchStepState,verb.core.MarchStepState.InsideDomain=["InsideDomain",1],verb.core.MarchStepState.InsideDomain.toString=$estr,verb.core.MarchStepState.InsideDomain.__enum__=verb.core.MarchStepState,verb.core.MarchStepState.AtBoundary=["AtBoundary",2],verb.core.MarchStepState.AtBoundary.toString=$estr,verb.core.MarchStepState.AtBoundary.__enum__=verb.core.MarchStepState,verb.core.MarchStepState.CompleteLoop=["CompleteLoop",3],verb.core.MarchStepState.CompleteLoop.toString=$estr,verb.core.MarchStepState.CompleteLoop.__enum__=verb.core.MarchStepState,verb.core.MarchStepState.CoincidentStartPoint=["CoincidentStartPoint",4],verb.core.MarchStepState.CoincidentStartPoint.toString=$estr,verb.core.MarchStepState.CoincidentStartPoint.__enum__=verb.core.MarchStepState,verb.core.MarchStep=function(e,r,t,o,n,i,s,a,c){this.stepCount=0,this.step=e,this.olduv0=r,this.olduv1=t,this.uv0=o,this.uv1=n,this.oldpoint=i,this.point=s,this.state=a,this.stepCount=c},verb.core.MarchStep.__name__=["verb","core","MarchStep"],verb.core.MarchStep.outOfBounds=function(){return new verb.core.MarchStep(null,null,null,null,null,null,null,verb.core.MarchStepState.OutOfBounds,0)},verb.core.MarchStep.init=function(e){return new verb.core.MarchStep(null,null,null,e.uv0,e.uv1,null,e.point,verb.core.MarchStepState.InsideDomain,0)},verb.core.ExpIntersect=$hx_exports.core.ExpIntersect=function(){},verb.core.ExpIntersect.__name__=["verb","core","ExpIntersect"],verb.core.ExpIntersect.outsideDomain=function(e,r){var t=r[0],o=r[1];return e.knotsU[0]>t||e.knotsV[0]>o||t>verb.core.ArrayExtensions.last(e.knotsU)||o>verb.core.ArrayExtensions.last(e.knotsV)},verb.core.ExpIntersect.clampToDomain=function(e,r){var t=r[0],o=r[1];return e.knotsU[0]>t&&(t=e.knotsU[0]),t>verb.core.ArrayExtensions.last(e.knotsU)&&(t=verb.core.ArrayExtensions.last(e.knotsU)),e.knotsV[0]>o&&(o=e.knotsV[0]),o>verb.core.ArrayExtensions.last(e.knotsV)&&(t=verb.core.ArrayExtensions.last(e.knotsV)),[t,o]},verb.core.ExpIntersect.clampStep=function(e,r,t){var o=r[0],n=r[1],i=o+t[0];i>verb.core.ArrayExtensions.last(e.knotsU)+1e-10?t=verb.core.Vec.mul((verb.core.ArrayExtensions.last(e.knotsU)-o)/t[0],t):e.knotsU[0]-1e-10>i&&(t=verb.core.Vec.mul((e.knotsU[0]-o)/t[0],t));var s=n+t[1];return s>verb.core.ArrayExtensions.last(e.knotsV)+1e-10?t=verb.core.Vec.mul((verb.core.ArrayExtensions.last(e.knotsV)-n)/t[1],t):e.knotsV[0]-1e-10>s&&(t=verb.core.Vec.mul((e.knotsV[0]-n)/t[1],t)),t},verb.core.ExpIntersect.march=function(e,r,t,o,n,i){var s=n[o],a=t.uv0,c=t.uv1,v=verb.core.Eval.rationalSurfaceDerivatives(e,a[0],a[1],1),u=verb.core.Eval.rationalSurfaceDerivatives(r,c[0],c[1],1),l=v[0][0],p=u[0][0],b=v[1][0],h=v[0][1],f=u[1][0],d=u[0][1],m=verb.core.Vec.cross(b,h),g=verb.core.Vec.cross(f,d),x=verb.core.Vec.normalized(verb.core.Vec.cross(m,g)),_=verb.core.ExpIntersect.INIT_STEP_LENGTH;if(null!=t.oldpoint){var y=Math.acos(verb.core.Vec.dot(verb.core.Vec.normalized(t.step),x));if(1e-10>Math.abs(y))_=verb.core.ExpIntersect.LINEAR_STEP_LENGTH;else{var S=verb.core.Vec.dist(t.oldpoint,t.point)/Math.acos(verb.core.Vec.dot(verb.core.Vec.normalized(t.step),x)),V=2*Math.acos(1-4*i/S);_=S*Math.tan(V)}}var E=verb.core.Vec.mul(_,x),B=verb.core.Vec.add(t.point,E),w=verb.core.Vec.sub(B,l),k=verb.core.Vec.sub(B,p),P=verb.core.Vec.cross(b,m),L=verb.core.Vec.cross(h,m),A=verb.core.Vec.cross(f,g),M=verb.core.Vec.cross(d,g),N=verb.core.Vec.dot(L,w)/verb.core.Vec.dot(L,b),I=verb.core.Vec.dot(P,w)/verb.core.Vec.dot(P,h),T=verb.core.Vec.dot(M,k)/verb.core.Vec.dot(M,f),C=verb.core.Vec.dot(A,k)/verb.core.Vec.dot(A,d),O=[N,I],D=[T,C],z=verb.core.Vec.add(a,O),U=verb.core.Vec.add(c,D),R=verb.core.MarchStepState.InsideDomain;if(verb.core.ExpIntersect.outsideDomain(e,z)){R=verb.core.MarchStepState.AtBoundary;var F=verb.core.Vec.norm(O);O=verb.core.ExpIntersect.clampStep(e,a,O),D=verb.core.Vec.mul(verb.core.Vec.norm(O)/F,D)}if(verb.core.ExpIntersect.outsideDomain(r,U)){R=verb.core.MarchStepState.AtBoundary;var $=verb.core.Vec.norm(D);D=verb.core.ExpIntersect.clampStep(r,c,D),O=verb.core.Vec.mul(verb.core.Vec.norm(D)/$,O)}z=verb.core.Vec.add(a,O),U=verb.core.Vec.add(c,D);var G=verb.core.Intersect.surfacesAtPointWithEstimate(e,r,z,U,i);return t.stepCount>5&&null!=t.olduv0&&10*i>verb.core.Trig.distToSegment(t.point,s.point,G.point)?new verb.core.MarchStep(E,t.uv0,t.uv1,s.uv0,s.uv1,t.point,s.point,verb.core.MarchStepState.CompleteLoop,t.stepCount+1):(t.stepCount>5&&verb.core.ExpIntersect.isCoincidentWithStartPoint(G.point,o,n,10*i)&&(R=verb.core.MarchStepState.CoincidentStartPoint),new verb.core.MarchStep(E,t.uv0,t.uv1,G.uv0,G.uv1,t.point,G.point,R,t.stepCount+1))},verb.core.ExpIntersect.isCoincidentWithStartPoint=function(e,r,t,o){if(0==r)return!1;for(var n=0;r>n;){var i=n++,s=verb.core.Vec.distSquared(t[i].point,t[r].point);if(o>s)return haxe.Log.trace("Coincident start point!",{fileName:"ExpIntersect.hx",lineNumber:253,className:"verb.core.ExpIntersect",methodName:"isCoincidentWithStartPoint"}),!0}return!1},verb.core.ExpIntersect.completeMarch=function(e,r,t,o,n){var i=o[t],s=verb.core.ExpIntersect.march(e,r,verb.core.MarchStep.init(i),t,o,n);if(s.state==verb.core.MarchStepState.AtBoundary||s.state==verb.core.MarchStepState.CoincidentStartPoint)return null;var a=[];for(a.push(i);s.state!=verb.core.MarchStepState.CoincidentStartPoint&&s.state!=verb.core.MarchStepState.AtBoundary&&s.state!=verb.core.MarchStepState.CompleteLoop;){if(a.push(new verb.core.types.SurfaceSurfaceIntersectionPoint(s.uv0,s.uv1,s.point,-1)),s.state==verb.core.MarchStepState.CoincidentStartPoint)return null;s=verb.core.ExpIntersect.march(e,r,s,t,o,n)}return a.push(new verb.core.types.SurfaceSurfaceIntersectionPoint(s.uv0,s.uv1,s.point,-1)),a},verb.core.ExpIntersect.surfaces=function(e,r,t){for(var o=[],n=verb.core.ExpIntersect.intersectBoundaryCurves(e,r,t),i=verb.core.ExpIntersect.approxInnerCriticalPts(e,r),s=verb.core.ExpIntersect.refineInnerCriticalPts(e,r,i,t),a=!0,c=0;s.length>c;){var v=s[c];++c;var u=verb.core.Intersect.curveAndSurface(verb.core.Make.surfaceIsocurve(e,v.item0[0],!1),r);if(0!=u.length&&a){a=!1;var l=new verb.core.types.SurfaceSurfaceIntersectionPoint([v.item0[0],u[0].u],u[0].uv,u[0].curvePoint,-1);n.push(l)}}for(var p=0;n.length>p;){haxe.Log.trace("starting at",{fileName:"ExpIntersect.hx",lineNumber:326,className:"verb.core.ExpIntersect",methodName:"surfaces",customParams:[n[p].point]});var b=verb.core.ExpIntersect.completeMarch(e,r,p,n,t);null!=b&&(o.push(b),n.splice(p,0,b[b.length-1]),haxe.Log.trace("inserting",{fileName:"ExpIntersect.hx",lineNumber:334,className:"verb.core.ExpIntersect",methodName:"surfaces",customParams:[b[b.length-1].point]}),p+=2),p++}for(var h=[],f=0;o.length>f;){var d=o[f];++f,h.push(verb.core.Make.rationalInterpCurve(d.map(function(e){return e.point})))}return h},verb.core.ExpIntersect.refineInnerCriticalPts=function(e,r,t,o){return t.map(function(t){return verb.core.ExpIntersect.refineCriticalPt(e,r,t,o)})},verb.core.ExpIntersect.refineCriticalPt=function(e,r,t,o){var n=function(t){var o=verb.core.Eval.rationalSurfaceDerivatives(e,t[0],t[1],1),n=verb.core.Eval.rationalSurfaceDerivatives(r,t[2],t[3],1),i=verb.core.Vec.normalized(verb.core.Vec.cross(o[1][0],o[0][1])),s=verb.core.Vec.normalized(verb.core.Vec.cross(n[1][0],n[0][1])),a=verb.core.Vec.sub(o[0][0],n[0][0]),c=verb.core.Vec.normSquared(a),v=verb.core.Vec.dot(a,s),u=verb.core.Vec.dot(i,s);return c-v*v+1-u*u},i=[t.item0[0],t.item0[1],t.item1[0],t.item1[1]],s=verb.core.Numeric.uncmin(n,i,o),a=s.solution;return new verb.core.types.Pair([a[0],a[1]],[a[2],a[3]])},verb.core.ExpIntersect.verifyInnerCriticalPts=function(){return null},verb.core.ExpIntersect.boundingBoxLeaves=function(e){if(e.indivisible(0))return[e.yield()];var r=e.split();return verb.core.ExpIntersect.boundingBoxLeaves(r.item0).concat(verb.core.ExpIntersect.boundingBoxLeaves(r.item1))},verb.core.ExpIntersect.approxInnerCriticalPts=function(e,r){for(var t=new verb.core.types.LazySurfaceBoundingBoxTree(e,!1,.6,.6),o=new verb.core.types.LazySurfaceBoundingBoxTree(r,!1,.6,.6),n=verb.core.Intersect.boundingBoxTrees(t,o,0),i=4,s=[],a=0;n.length>a;){var c=n[a];++a;for(var v=verb.core.ExpIntersect.approxSurfaceDelPhiField(c.item0,c.item1,i,i),u=v.delphi,l=v.uvs0,p=v.uvs1,b=1,h=u.length;h>b;)for(var f=b++,d=1,m=u[f].length;m>d;){var g=d++,x=verb.core.ExpIntersect.approxRotationNumber([u[f][g-1],u[f][g],u[f-1][g],u[f-1][g-1]]);if(0!=x){var _=(l[f][g][1]+l[f][g-1][1])/2,y=(l[f][g][0]+l[f-1][g][0])/2,S=(p[f][g][1]+p[f][g-1][1])/2,V=(p[f][g][0]+p[f-1][g][0])/2;s.push(new verb.core.types.Pair([_,y],[S,V]))}}}return s},verb.core.ExpIntersect.approxRotationNumber=function(e){for(var r=0,t=e.length,o=1,n=t+1;n>o;){var i=o++,s=verb.core.Vec.angleBetweenNormalized2d(e[i-1],e[i%t]);r+=Math.abs(s)}return Math.floor(Math.abs(r/(2*Math.PI)))},verb.core.ExpIntersect.approxSurfaceDelPhiField=function(e,r,t,o){for(var n=verb.core.ExpIntersect.sampleSurfaceRegular(e,t,o),i=verb.core.ExpIntersect.sampleSurfaceRegular(r,t,o),s=[],a=0,c=n.uvs.length;c>a;){var v=a++,u=[];s.push(u);for(var l=0,p=n.uvs[v].length;p>l;){for(var b=l++,h=Math.POSITIVE_INFINITY,f=[Math.POSITIVE_INFINITY,Math.POSITIVE_INFINITY],d=0,m=i.uvs.length;m>d;)for(var g=d++,x=0,_=i.uvs[g].length;_>x;){var y=x++,S=verb.core.Vec.distSquared(n.points[v][b],n.points[g][y]);h>S&&(h=S,f=n.uvs[g][y])}u.push(f)}}for(var V=[],E=0,B=s.length;B>E;){var w=E++,k=[];V.push(k);for(var P=0,L=s[w].length;L>P;){var A=P++,M=n.uvs[w][A],N=s[w][A],I=verb.core.Eval.rationalSurfaceDerivatives(e,M[0],M[1]),T=verb.core.Eval.rationalSurfaceDerivatives(r,N[0],N[1]),C=verb.core.Vec.normalized(verb.core.Vec.cross(T[1][0],T[0][1])),O=I[1][0],D=I[0][1],z=verb.core.Vec.normalized([verb.core.Vec.dot(C,O),verb.core.Vec.dot(C,D)]);k.push(z)}}return{uvs0:n.uvs,uvs1:s,delphi:V}},verb.core.ExpIntersect.sampleSurfaceRegular=function(e,r,t){1>r&&(r=1),1>t&&(t=1),e.degreeU,e.degreeV,e.controlPoints;for(var o=e.knotsU,n=e.knotsV,i=.005,s=o[o.length-1]-o[0]-2*i,a=n[n.length-1]-n[0]-2*i,c=o[0]+i,v=n[0]+i,u=s/r,l=a/t,p=[],b=[],h=0,f=r+1;f>h;){var d=h++,m=[];b.push(m);var g=[];p.push(g);for(var x=c+d*u,_=0,y=t+1;y>_;){var S=_++,V=v+S*l;m.push([x,V]),g.push(verb.core.Eval.rationalSurfacePoint(e,x,V))}}return{uvs:b,points:p}},verb.core.ExpIntersect.intersectBoundaryCurves=function(e,r,t){for(var o=verb.core.Make.surfaceBoundaryCurves(e),n=verb.core.Make.surfaceBoundaryCurves(r),i=[],s=0,a=o.length;a>s;)for(var c=s++,v=o[c],u=verb.core.Intersect.curveAndSurface(v,r,t),l=0;u.length>l;){var p=u[l];++l;var b;switch(c){case 0:b=[e.knotsU[0],p.u];break;case 1:b=[verb.core.ArrayExtensions.last(e.knotsU),p.u];break;case 2:b=[p.u,e.knotsV[0]];break;default:b=[p.u,verb.core.ArrayExtensions.last(e.knotsV)]}var h=verb.core.Vec.dist(p.curvePoint,p.surfacePoint);i.push(new verb.core.types.SurfaceSurfaceIntersectionPoint(b,p.uv,p.curvePoint,h))}for(var f=0,d=n.length;d>f;)for(var m=f++,g=n[m],x=verb.core.Intersect.curveAndSurface(g,e,t),_=0;x.length>_;){var y=x[_];++_;var S;switch(m){case 0:S=[r.knotsU[0],y.u];break;case 1:S=[verb.core.ArrayExtensions.last(r.knotsU),y.u];break;case 2:S=[y.u,r.knotsV[0]];break;default:S=[y.u,verb.core.ArrayExtensions.last(r.knotsV)]}var V=verb.core.Vec.dist(y.curvePoint,y.surfacePoint);i.push(new verb.core.types.SurfaceSurfaceIntersectionPoint(y.uv,S,y.curvePoint,V))}return verb.core.ArrayExtensions.unique(i,function(e,r){return t>Math.abs(e.uv0[0]-r.uv0[0])&&t>Math.abs(e.uv0[1]-r.uv0[1])})},verb.core.Intersect=$hx_exports.core.Intersect=function(){},verb.core.Intersect.__name__=["verb","core","Intersect"],verb.core.Intersect.meshSlices=function(e,r,t,o){for(var n=new verb.core.types.MeshBoundingBoxTree(e),i=n.boundingBox(),s=i.min[0],a=i.min[1],c=i.max[0],v=i.max[1],u=verb.core.Vec.span(r,t,o),l=[],p=0;u.length>p;){var b=u[p];++p;var h=[[s,a,b],[c,a,b],[c,v,b],[s,v,b]],f=[[0,0],[1,0],[1,1],[0,1]],d=[[0,1,2],[0,2,3]],m=new verb.core.types.MeshData(d,h,null,f);l.push(verb.core.Intersect.meshes(e,m,n)),b+=1}return l},verb.core.Intersect.surfaces=function(e,r,t){var o=verb.core.Tess.rationalSurfaceAdaptive(e),n=verb.core.Tess.rationalSurfaceAdaptive(r),i=verb.core.Intersect.meshes(o,n),s=i.map(function(o){return o.map(function(o){return verb.core.Intersect.surfacesAtPointWithEstimate(e,r,o.uv0,o.uv1,t)})});return s.map(function(e){return verb.core.Make.rationalInterpCurve(e.map(function(e){return e.point}),3)})},verb.core.Intersect.surfacesAtPointWithEstimate=function(e,r,t,o,n){var i,s,a,c,v,u,l,p,b,h,f,d,m,g=5,x=0;do{if(i=verb.core.Eval.rationalSurfaceDerivatives(e,t[0],t[1],1),s=i[0][0],c=i[1][0],v=i[0][1],a=verb.core.Vec.normalized(verb.core.Vec.cross(c,v)),u=verb.core.Vec.dot(a,s),l=verb.core.Eval.rationalSurfaceDerivatives(r,o[0],o[1],1),p=l[0][0],h=l[1][0],f=l[0][1],b=verb.core.Vec.normalized(verb.core.Vec.cross(h,f)),d=verb.core.Vec.dot(b,p),m=verb.core.Vec.distSquared(s,p),n*n>m)break;var _=verb.core.Vec.normalized(verb.core.Vec.cross(a,b)),y=verb.core.Vec.dot(_,s),S=verb.core.Intersect.threePlanes(a,u,b,d,_,y);if(null==S)throw"panic!";var V=verb.core.Vec.sub(S,s),E=verb.core.Vec.sub(S,p),B=verb.core.Vec.cross(c,a),w=verb.core.Vec.cross(v,a),k=verb.core.Vec.cross(h,b),P=verb.core.Vec.cross(f,b),L=verb.core.Vec.dot(w,V)/verb.core.Vec.dot(w,c),A=verb.core.Vec.dot(B,V)/verb.core.Vec.dot(B,v),M=verb.core.Vec.dot(P,E)/verb.core.Vec.dot(P,h),N=verb.core.Vec.dot(k,E)/verb.core.Vec.dot(k,f);t=verb.core.Vec.add([L,A],t),o=verb.core.Vec.add([M,N],o),x++}while(g>x);return new verb.core.types.SurfaceSurfaceIntersectionPoint(t,o,s,m)},verb.core.Intersect.meshes=function(e,r,t,o){null==t&&(t=new verb.core.types.LazyMeshBoundingBoxTree(e)),null==o&&(o=new verb.core.types.LazyMeshBoundingBoxTree(r));var n=verb.core.Intersect.boundingBoxTrees(t,o,0),i=verb.core.ArrayExtensions.unique(n.map(function(t){return verb.core.Intersect.triangles(e,t.item0,r,t.item1)}).filter(function(e){return null!=e}).filter(function(e){return verb.core.Vec.distSquared(e.min.point,e.max.point)>1e-10}),function(e,r){var t=verb.core.Vec.sub(e.min.uv0,r.min.uv0),o=verb.core.Vec.dot(t,t),n=verb.core.Vec.sub(e.max.uv0,r.max.uv0),i=verb.core.Vec.dot(n,n),s=verb.core.Vec.sub(e.min.uv0,r.max.uv0),a=verb.core.Vec.dot(s,s),c=verb.core.Vec.sub(e.max.uv0,r.min.uv0),v=verb.core.Vec.dot(c,c);return 1e-10>o&&1e-10>i||1e-10>a&&1e-10>v});return verb.core.Intersect.makeMeshIntersectionPolylines(i)},verb.core.Intersect.makeMeshIntersectionPolylines=function(e){if(0==e.length)return[];for(var r=0;e.length>r;){var t=e[r];++r,t.max.opp=t.min,t.min.opp=t.max}for(var o=verb.core.Intersect.kdTreeFromSegments(e),n=[],i=0;e.length>i;){var s=e[i];++i,n.push(s.min),n.push(s.max)}for(var a=0;n.length>a;){var c=n[a];if(++a,null==c.adj){var v=verb.core.Intersect.lookupAdjacentSegment(c,o,e.length);null!=v&&null==v.adj&&(c.adj=v,v.adj=c)}}var u=n.filter(function(e){return null==e.adj});0==u.length&&(u=n);for(var l=[],p=0,b=!1;0!=u.length;){var h=u.pop();if(!h.visited){for(var f=[],d=h;null!=d&&!d.visited&&(d.visited=!0,d.opp.visited=!0,f.push(d),p+=2,d=d.opp.adj,d!=h););f.length>0&&(f.push(f[f.length-1].opp),l.push(f))}if(0==u.length&&n.length>0&&(b||n.length>p)){b=!0;var m=n.pop();u.push(m)}}return l},verb.core.Intersect.kdTreeFromSegments=function(e){for(var r=[],t=0;e.length>t;){var o=e[t];++t,r.push(new verb.core.KdPoint(o.min.point,o.min)),r.push(new verb.core.KdPoint(o.max.point,o.max))}return new verb.core.KdTree(r,verb.core.Vec.distSquared)},verb.core.Intersect.lookupAdjacentSegment=function(e,r,t){var o=r.nearest(e.point,t,1e-10).filter(function(r){return e!=r.item0.obj}).map(function(e){return e.item0.obj});return 1==o.length?o[0]:null},verb.core.Intersect.curveAndSurface=function(e,r,t,o,n){null==t&&(t=.001),o=null!=o?o:new verb.core.types.LazyCurveBoundingBoxTree(e),n=null!=n?n:new verb.core.types.LazySurfaceBoundingBoxTree(r);var i=verb.core.Intersect.boundingBoxTrees(o,n,t);return verb.core.ArrayExtensions.unique(i.map(function(e){var r=e.item0,o=e.item1,n=r.knots[0],i=verb.core.ArrayExtensions.last(r.knots),s=(n+i)/2,a=o.knotsU[0],c=verb.core.ArrayExtensions.last(o.knotsU),v=o.knotsV[0],u=verb.core.ArrayExtensions.last(o.knotsV),l=[(a+c)/2,(v+u)/2];return verb.core.Intersect.curveAndSurfaceWithEstimate(r,o,[s].concat(l),t)}).filter(function(e){return t*t>verb.core.Vec.distSquared(e.curvePoint,e.surfacePoint)}),function(e,r){return.5*t>Math.abs(e.u-r.u)})},verb.core.Intersect.curveAndSurfaceWithEstimate=function(e,r,t,o){null==o&&(o=.001);var n=function(t){var o=verb.core.Eval.rationalCurvePoint(e,t[0]),n=verb.core.Eval.rationalSurfacePoint(r,t[1],t[2]),i=verb.core.Vec.sub(o,n);return verb.core.Vec.dot(i,i)},i=function(t){var o=verb.core.Eval.rationalCurveDerivatives(e,t[0],1),n=verb.core.Eval.rationalSurfaceDerivatives(r,t[1],t[2],1),i=verb.core.Vec.sub(n[0][0],o[0]),s=verb.core.Vec.mul(-1,o[1]),a=n[1][0],c=n[0][1];return[2*verb.core.Vec.dot(s,i),2*verb.core.Vec.dot(a,i),2*verb.core.Vec.dot(c,i)]},s=verb.core.Numeric.uncmin(n,t,o*o,i),a=s.solution;return new verb.core.types.CurveSurfaceIntersection(a[0],[a[1],a[2]],verb.core.Eval.rationalCurvePoint(e,a[0]),verb.core.Eval.rationalSurfacePoint(r,a[1],a[2]))},verb.core.Intersect.polylineAndMesh=function(e,r,t){for(var o=verb.core.Intersect.boundingBoxTrees(new verb.core.types.LazyPolylineBoundingBoxTree(e),new verb.core.types.LazyMeshBoundingBoxTree(r),t),n=[],i=0;o.length>i;){var s=o[i];++i;var a=s.item0,c=s.item1,v=verb.core.Intersect.segmentWithTriangle(e.points[a],e.points[a+1],r.points,r.faces[c]);if(null!=v){var u=v.point,l=verb.core.Vec.lerp(v.p,[e.params[a]],[e.params[a+1]])[0],p=verb.core.Mesh.triangleUVFromPoint(r,c,u);n.push(new verb.core.types.PolylineMeshIntersection(u,l,p,a,c))}}return n},verb.core.Intersect.boundingBoxTrees=function(e,r,t){null==t&&(t=1e-9);var o=[],n=[];o.push(e),n.push(r);for(var i=[];o.length>0;){var s=o.pop(),a=n.pop();if(!s.empty()&&!a.empty()&&s.boundingBox().intersects(a.boundingBox(),t)){var c=s.indivisible(t),v=a.indivisible(t);if(c&&v)i.push(new verb.core.types.Pair(s.yield(),a.yield()));else if(!c||v)if(c||!v){var u=s.split(),l=a.split();o.push(u.item1),n.push(l.item1),o.push(u.item1),n.push(l.item0),o.push(u.item0),n.push(l.item1),o.push(u.item0),n.push(l.item0)}else{var p=s.split();o.push(p.item1),n.push(a),o.push(p.item0),n.push(a)}else{var b=a.split();o.push(s),n.push(b.item1),o.push(s),n.push(b.item0)}}}return i},verb.core.Intersect.curves=function(e,r,t){var o=verb.core.Intersect.boundingBoxTrees(new verb.core.types.LazyCurveBoundingBoxTree(e),new verb.core.types.LazyCurveBoundingBoxTree(r),0);return verb.core.ArrayExtensions.unique(o.map(function(o){return verb.core.Intersect.curvesWithEstimate(e,r,o.item0.knots[0],o.item1.knots[0],t)}).filter(function(e){return t>verb.core.Vec.distSquared(e.point0,e.point1)}),function(e,r){return 5*t>Math.abs(e.u0-r.u0)})},verb.core.Intersect.curvesWithEstimate=function(e,r,t,o,n){var i=function(t){var o=verb.core.Eval.rationalCurvePoint(e,t[0]),n=verb.core.Eval.rationalCurvePoint(r,t[1]),i=verb.core.Vec.sub(o,n);return verb.core.Vec.dot(i,i)},s=function(t){var o=verb.core.Eval.rationalCurveDerivatives(e,t[0],1),n=verb.core.Eval.rationalCurveDerivatives(r,t[1],1),i=verb.core.Vec.sub(o[0],n[0]),s=o[1],a=verb.core.Vec.mul(-1,n[1]);return[2*verb.core.Vec.dot(s,i),2*verb.core.Vec.dot(a,i)]},a=verb.core.Numeric.uncmin(i,[t,o],n*n,s),c=a.solution[0],v=a.solution[1],u=verb.core.Eval.rationalCurvePoint(e,c),l=verb.core.Eval.rationalCurvePoint(r,v);return new verb.core.types.CurveCurveIntersection(u,l,c,v)},verb.core.Intersect.triangles=function(e,r,t,o){var n=e.faces[r],i=t.faces[o],s=verb.core.Mesh.getTriangleNorm(e.points,n),a=verb.core.Mesh.getTriangleNorm(t.points,i),c=e.points[n[0]],v=t.points[i[0]],u=verb.core.Intersect.planes(c,s,v,a);if(null==u)return null;var l=verb.core.Intersect.clipRayInCoplanarTriangle(u,e,r);if(null==l)return null;var p=verb.core.Intersect.clipRayInCoplanarTriangle(u,t,o);if(null==p)return null;var b=verb.core.Intersect.mergeTriangleClipIntervals(l,p,e,r,t,o);return null==b?null:new verb.core.types.Interval(new verb.core.types.MeshIntersectionPoint(b.min.uv0,b.min.uv1,b.min.point,r,o),new verb.core.types.MeshIntersectionPoint(b.max.uv0,b.max.uv1,b.max.point,r,o))},verb.core.Intersect.clipRayInCoplanarTriangle=function(e,r,t){for(var o=r.faces[t],n=[r.points[o[0]],r.points[o[1]],r.points[o[2]]],i=[r.uvs[o[0]],r.uvs[o[1]],r.uvs[o[2]]],s=[verb.core.Vec.sub(i[1],i[0]),verb.core.Vec.sub(i[2],i[1]),verb.core.Vec.sub(i[0],i[2])],a=[verb.core.Vec.sub(n[1],n[0]),verb.core.Vec.sub(n[2],n[1]),verb.core.Vec.sub(n[0],n[2])],c=a.map(verb.core.Vec.normalized),v=a.map(verb.core.Vec.norm),u=null,l=null,p=0;3>p;){var b=p++,h=n[b],f=c[b],d=verb.core.Intersect.rays(h,f,e.origin,e.dir);if(null!=d){var m=d.u0,g=d.u1;-1e-10>m||m>v[b]+1e-10||((null==u||u.u>g)&&(u=new verb.core.types.CurveTriPoint(g,verb.core.Vec.onRay(e.origin,e.dir,g),verb.core.Vec.onRay(i[b],s[b],m/v[b]))),(null==l||g>l.u)&&(l=new verb.core.types.CurveTriPoint(g,verb.core.Vec.onRay(e.origin,e.dir,g),verb.core.Vec.onRay(i[b],s[b],m/v[b]))))}}return null==l||null==u?null:new verb.core.types.Interval(u,l)},verb.core.Intersect.mergeTriangleClipIntervals=function(e,r,t,o,n,i){if(r.min.u>e.max.u+1e-10||e.min.u>r.max.u+1e-10)return null;var s;s=e.min.u>r.min.u?new verb.core.types.Pair(e.min,0):new verb.core.types.Pair(r.min,1);var a;a=e.max.u<r.max.u?new verb.core.types.Pair(e.max,0):new verb.core.types.Pair(r.max,1);var c=new verb.core.types.Interval(new verb.core.types.MeshIntersectionPoint(null,null,s.item0.point,o,i),new verb.core.types.MeshIntersectionPoint(null,null,a.item0.point,o,i));return 0==s.item1?(c.min.uv0=s.item0.uv,c.min.uv1=verb.core.Mesh.triangleUVFromPoint(n,i,s.item0.point)):(c.min.uv0=verb.core.Mesh.triangleUVFromPoint(t,o,s.item0.point),c.min.uv1=s.item0.uv),0==a.item1?(c.max.uv0=a.item0.uv,c.max.uv1=verb.core.Mesh.triangleUVFromPoint(n,i,a.item0.point)):(c.max.uv0=verb.core.Mesh.triangleUVFromPoint(t,o,a.item0.point),c.max.uv1=a.item0.uv),c},verb.core.Intersect.planes=function(e,r,t,o){var n=verb.core.Vec.cross(r,o);if(1e-10>verb.core.Vec.dot(n,n))return null;var i=0,s=Math.abs(n[0]),a=Math.abs(n[1]),c=Math.abs(n[2]);a>s&&(i=1,s=a),c>s&&(i=2,s=c);var v,u,l,p;0==i?(v=r[1],u=r[2],l=o[1],p=o[2]):1==i?(v=r[0],u=r[2],l=o[0],p=o[2]):(v=r[0],u=r[1],l=o[0],p=o[1]);var b,h=-verb.core.Vec.dot(e,r),f=-verb.core.Vec.dot(t,o),d=v*p-u*l,m=(u*f-h*p)/d,g=(h*l-v*f)/d;return b=0==i?[0,m,g]:1==i?[m,0,g]:[m,g,0],new verb.core.types.Ray(b,verb.core.Vec.normalized(n))},verb.core.Intersect.threePlanes=function(e,r,t,o,n,i){var s=verb.core.Vec.cross(t,n),a=verb.core.Vec.dot(e,s);if(1e-10>Math.abs(a))return null;var c=verb.core.Vec.sub(verb.core.Vec.mul(i,t),verb.core.Vec.mul(o,n)),v=verb.core.Vec.add(verb.core.Vec.mul(r,s),verb.core.Vec.cross(e,c));return verb.core.Vec.mul(1/a,v)},verb.core.Intersect.polylines=function(e,r,t){for(var o=verb.core.Intersect.boundingBoxTrees(new verb.core.types.LazyPolylineBoundingBoxTree(e),new verb.core.types.LazyPolylineBoundingBoxTree(r),t),n=[],i=0;o.length>i;){var s=o[i];++i;var a=s.item0,c=s.item1,v=verb.core.Intersect.segments(e.points[a],e.points[a+1],r.points[c],r.points[c+1],t);null!=v&&(v.u0=verb.core.Vec.lerp(v.u0,[e.params[a]],[e.params[a+1]])[0],v.u1=verb.core.Vec.lerp(v.u1,[r.params[c]],[r.params[c+1]])[0],n.push(v))}return n},verb.core.Intersect.segments=function(e,r,t,o,n){var i=verb.core.Vec.sub(r,e),s=Math.sqrt(verb.core.Vec.dot(i,i)),a=verb.core.Vec.mul(1/s,i),c=verb.core.Vec.sub(o,t),v=Math.sqrt(verb.core.Vec.dot(c,c)),u=verb.core.Vec.mul(1/v,c),l=verb.core.Intersect.rays(e,a,t,u);if(null!=l){var p=Math.min(Math.max(0,l.u0/s),1),b=Math.min(Math.max(0,l.u1/v),1),h=verb.core.Vec.onRay(e,i,p),f=verb.core.Vec.onRay(t,c,b),d=verb.core.Vec.distSquared(h,f);if(n*n>d)return new verb.core.types.CurveCurveIntersection(h,f,p,b)}return null},verb.core.Intersect.rays=function(e,r,t,o){var n=verb.core.Vec.dot(r,o),i=verb.core.Vec.dot(r,t),s=verb.core.Vec.dot(r,e),a=verb.core.Vec.dot(o,t),c=verb.core.Vec.dot(o,e),v=verb.core.Vec.dot(r,r),u=verb.core.Vec.dot(o,o),l=v*u-n*n;if(1e-10>Math.abs(l))return null;var p=n*(i-s)-v*(a-c),b=p/l,h=(i-s+b*n)/v,f=verb.core.Vec.onRay(e,r,h),d=verb.core.Vec.onRay(t,o,b);return new verb.core.types.CurveCurveIntersection(f,d,h,b)},verb.core.Intersect.segmentWithTriangle=function(e,r,t,o){var n=t[o[0]],i=t[o[1]],s=t[o[2]],a=verb.core.Vec.sub(i,n),c=verb.core.Vec.sub(s,n),v=verb.core.Vec.cross(a,c),u=verb.core.Vec.sub(r,e),l=verb.core.Vec.sub(e,n),p=-verb.core.Vec.dot(v,l),b=verb.core.Vec.dot(v,u);if(1e-10>Math.abs(b))return null;var h=p/b;if(0>h||h>1)return null;var f=verb.core.Vec.add(e,verb.core.Vec.mul(h,u)),d=verb.core.Vec.dot(a,c),m=verb.core.Vec.dot(a,a),g=verb.core.Vec.dot(c,c),x=verb.core.Vec.sub(f,n),_=verb.core.Vec.dot(x,a),y=verb.core.Vec.dot(x,c),S=d*d-m*g;if(1e-10>Math.abs(S))return null;var V=(d*y-g*_)/S,E=(d*_-m*y)/S;return V>1.0000000001||E>1.0000000001||-1e-10>E||-1e-10>V||V+E>1.0000000001?null:new verb.core.types.TriSegmentIntersection(f,V,E,h)},verb.core.Intersect.segmentAndPlane=function(e,r,t,o){var n=verb.core.Vec.dot(o,verb.core.Vec.sub(r,e));if(1e-10>Math.abs(n))return null;var i=verb.core.Vec.dot(o,verb.core.Vec.sub(t,e)),s=i/n;return s>1.0000000001||-1e-10>s?null:{p:s}},verb.core.KdPoint=$hx_exports.core.KdPoint=function(e,r){this.point=e,this.obj=r},verb.core.KdPoint.__name__=["verb","core","KdPoint"],verb.core.KdNode=$hx_exports.core.KdNode=function(e,r,t){this.kdPoint=e,this.left=null,this.right=null,this.parent=t,this.dimension=r},verb.core.KdNode.__name__=["verb","core","KdNode"],verb.core.KdTree=$hx_exports.core.KdTree=function(e,r){this.dim=3,this.points=e,this.distanceFunction=r,this.dim=e[0].point.length,this.root=this.buildTree(e,0,null)},verb.core.KdTree.__name__=["verb","core","KdTree"],verb.core.KdTree.prototype={buildTree:function(e,r,t){var o,n,i=r%this.dim;return 0==e.length?null:1==e.length?new verb.core.KdNode(e[0],i,t):(e.sort(function(e,r){var t=e.point[i]-r.point[i];return 0==t?0:t>0?1:-1}),o=Math.floor(e.length/2),n=new verb.core.KdNode(e[o],i,t),n.left=this.buildTree(e.slice(0,o),r+1,n),n.right=this.buildTree(e.slice(o+1),r+1,n),n)},nearest:function(e,r,t){var o,n=this,i=new verb.core.BinaryHeap(function(e){return-e.item1}),s=null;s=function(t){for(var o,a,c=t.dimension,v=n.distanceFunction(e,t.kdPoint.point),u=[],l=0,p=n.dim;p>l;)l++,u.push(0);a=u;for(var b,h,f=function(e,t){i.push(new verb.core.types.Pair(e,t)),i.size()>r&&i.pop()},d=0,m=n.dim;m>d;){var g=d++;a[g]=g==t.dimension?e[g]:t.kdPoint.point[g]}return b=n.distanceFunction(a,t.kdPoint.point),null==t.right&&null==t.left?((r>i.size()||i.peek().item1>v)&&f(t,v),void 0):(o=null==t.right?t.left:null==t.left?t.right:e[c]<t.kdPoint.point[c]?t.left:t.right,s(o),(r>i.size()||i.peek().item1>v)&&f(t,v),(r>i.size()||Math.abs(b)<i.peek().item1)&&(h=o==t.left?t.right:t.left,null!=h&&s(h)),void 0)},o=s;for(var a=0;r>a;)a++,i.push(new verb.core.types.Pair(null,t));o(this.root);for(var c=[],v=0;r>v;){var u=v++;null!=i.content[u].item0&&c.push(new verb.core.types.Pair(i.content[u].item0.kdPoint,i.content[u].item1))}return c}},verb.core.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},verb.core.BinaryHeap.__name__=["verb","core","BinaryHeap"],verb.core.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],r=this.content.pop();return this.content.length>0&&(this.content[0]=r,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var r=this.content.length,t=0;r>t;){var o=t++;if(this.content[o]==e){var n=this.content.pop();return o!=r-1&&(this.content[o]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.bubbleUp(o):this.sinkDown(o)),void 0}}throw"Node not found."},size:function(){return this.content.length},bubbleUp:function(e){for(var r=this.content[e];e>0;){var t=Math.floor((e+1)/2)-1,o=this.content[t];
if(!(this.scoreFunction(r)<this.scoreFunction(o)))break;this.content[t]=r,this.content[e]=o,e=t}},sinkDown:function(e){for(var r=this.content.length,t=this.content[e],o=this.scoreFunction(t);;){var n=2*(e+1),i=n-1,s=-1,a=0;if(r>i){var c=this.content[i];a=this.scoreFunction(c),o>a&&(s=i)}if(r>n){var v=this.content[n],u=this.scoreFunction(v);(-1==s?o:a)>u&&(s=n)}if(-1==s)break;this.content[e]=this.content[s],this.content[s]=t,e=s}}},verb.core.Make=$hx_exports.core.Make=function(){},verb.core.Make.__name__=["verb","core","Make"],verb.core.Make.rationalTranslationalSurface=function(e,r){for(var t=verb.core.Eval.rationalCurvePoint(r,r.knots[0]),o=r.knots[0],n=verb.core.ArrayExtensions.last(r.knots),i=2*r.controlPoints.length,s=(n-o)/(i-1),a=[],c=0;i>c;){var v=c++,u=verb.core.Vec.sub(verb.core.Eval.rationalCurvePoint(r,o+v*s),t),l=verb.core.Modify.rationalCurveTransform(e,[[1,0,0,u[0]],[0,1,0,u[1]],[0,0,1,u[2]],[0,0,0,1]]);a.push(l)}return verb.core.Make.loftedSurface(a)},verb.core.Make.surfaceBoundaryCurves=function(e){var r=verb.core.Make.surfaceIsocurve(e,e.knotsU[0],!1),t=verb.core.Make.surfaceIsocurve(e,verb.core.ArrayExtensions.last(e.knotsU),!1),o=verb.core.Make.surfaceIsocurve(e,e.knotsV[0],!0),n=verb.core.Make.surfaceIsocurve(e,verb.core.ArrayExtensions.last(e.knotsV),!0);return[r,t,o,n]},verb.core.Make.surfaceIsocurve=function(e,r,t){null==t&&(t=!1);var o;o=t?e.knotsV:e.knotsU;var n;n=t?e.degreeV:e.degreeU;for(var i=verb.core.Analyze.knotMultiplicities(o),s=-1,a=0,c=i.length;c>a;){var v=a++;if(1e-10>Math.abs(r-i[v].knot)){s=v;break}}var u=n+1;s>=0&&(u-=i[s].mult);var l;l=u>0?verb.core.Modify.surfaceKnotRefine(e,verb.core.Vec.rep(u,r),t):e;var p=verb.core.Eval.knotSpan(n,r,o);return 1e-10>Math.abs(r-o[0])?p=0:1e-10>Math.abs(r-o[o.length-1])&&(p=(t?l.controlPoints[0].length:l.controlPoints.length)-1),t?new verb.core.types.NurbsCurveData(l.degreeU,l.knotsU,function(){for(var e,r=[],t=0,o=l.controlPoints;o.length>t;){var n=o[t];++t,r.push(n[p])}return e=r}(this)):new verb.core.types.NurbsCurveData(l.degreeV,l.knotsV,l.controlPoints[p])},verb.core.Make.loftedSurface=function(e,r){e=verb.core.Modify.unifyCurveKnotVectors(e);var t=e[0].degree;null==r&&(r=3),r>e.length-1&&(r=e.length-1);for(var o=e[0].knots,n=[],i=[],s=0,a=e[0].controlPoints.length;a>s;){var c=[s++],v=e.map(function(e){return function(r){return r.controlPoints[e[0]]}}(c)),u=verb.core.Make.rationalInterpCurve(v,r,!0);i.push(u.controlPoints),n=u.knots}return new verb.core.types.NurbsSurfaceData(t,r,o,n,i)},verb.core.Make.clonedCurve=function(e){return new verb.core.types.NurbsCurveData(e.degree,e.knots.slice(),e.controlPoints.map(function(e){return e.slice()}))},verb.core.Make.rationalBezierCurve=function(e,r){for(var t=e.length-1,o=[],n=0,i=t+1;i>n;)n++,o.push(0);for(var s=0,a=t+1;a>s;)s++,o.push(1);return null==r&&(r=verb.core.Vec.rep(e.length,1)),new verb.core.types.NurbsCurveData(t,o,verb.core.Eval.homogenize1d(e,r))},verb.core.Make.fourPointSurface=function(e,r,t,o,n){null==n&&(n=3);for(var i=n,s=[],a=0,c=n+1;c>a;){for(var v=a++,u=[],l=0,p=n+1;p>l;){var b=l++,h=1-v/i,f=verb.core.Vec.lerp(h,e,r),d=verb.core.Vec.lerp(h,o,t),m=verb.core.Vec.lerp(1-b/i,f,d);m.push(1),u.push(m)}s.push(u)}var g=verb.core.Vec.rep(n+1,0),x=verb.core.Vec.rep(n+1,1);return new verb.core.types.NurbsSurfaceData(n,n,g.concat(x),g.concat(x),s)},verb.core.Make.ellipseArc=function(e,r,t,o,n){var i=verb.core.Vec.norm(r),s=verb.core.Vec.norm(t);r=verb.core.Vec.normalized(r),t=verb.core.Vec.normalized(t),o>n&&(n=2*Math.PI+o);var a=n-o,c=0;c=Math.PI/2>=a?1:Math.PI>=a?2:3*Math.PI/2>=a?3:4;var v=a/c,u=Math.cos(v/2),l=verb.core.Vec.add(e,verb.core.Vec.add(verb.core.Vec.mul(i*Math.cos(o),r),verb.core.Vec.mul(s*Math.sin(o),t))),p=verb.core.Vec.sub(verb.core.Vec.mul(Math.cos(o),t),verb.core.Vec.mul(Math.sin(o),r)),b=[],h=verb.core.Vec.zeros1d(2*c+3),f=0,d=o,m=verb.core.Vec.zeros1d(2*c);b[0]=l,m[0]=1;for(var g=1,x=c+1;x>g;){var _=g++;d+=v;var y=verb.core.Vec.add(e,verb.core.Vec.add(verb.core.Vec.mul(i*Math.cos(d),r),verb.core.Vec.mul(s*Math.sin(d),t)));m[f+2]=1,b[f+2]=y;var S=verb.core.Vec.sub(verb.core.Vec.mul(Math.cos(d),t),verb.core.Vec.mul(Math.sin(d),r)),V=verb.core.Intersect.rays(l,verb.core.Vec.mul(1/verb.core.Vec.norm(p),p),y,verb.core.Vec.mul(1/verb.core.Vec.norm(S),S)),E=verb.core.Vec.add(l,verb.core.Vec.mul(V.u0,p));m[f+1]=u,b[f+1]=E,f+=2,c>_&&(l=y,p=S)}for(var B=2*c+1,w=0;3>w;){var k=w++;h[k]=0,h[k+B]=1}switch(c){case 2:h[3]=h[4]=.5;break;case 3:h[3]=h[4]=.3333333333333333,h[5]=h[6]=.6666666666666666;break;case 4:h[3]=h[4]=.25,h[5]=h[6]=.5,h[7]=h[8]=.75}return new verb.core.types.NurbsCurveData(2,h,verb.core.Eval.homogenize1d(b,m))},verb.core.Make.arc=function(e,r,t,o,n,i){return verb.core.Make.ellipseArc(e,verb.core.Vec.mul(o,verb.core.Vec.normalized(r)),verb.core.Vec.mul(o,verb.core.Vec.normalized(t)),n,i)},verb.core.Make.polyline=function(e){for(var r=[0,0],t=0,o=0,n=e.length-1;n>o;){var i=o++;t+=verb.core.Vec.dist(e[i],e[i+1]),r.push(t)}r.push(t),r=verb.core.Vec.mul(1/t,r);for(var s,a=[],c=0,v=e.length;v>c;)c++,a.push(1);return s=a,new verb.core.types.NurbsCurveData(1,r,verb.core.Eval.homogenize1d(e.slice(0),s))},verb.core.Make.extrudedSurface=function(e,r,t){for(var o=[[],[],[]],n=[[],[],[]],i=verb.core.Eval.dehomogenize1d(t.controlPoints),s=verb.core.Eval.weight1d(t.controlPoints),a=verb.core.Vec.mul(r,e),c=verb.core.Vec.mul(.5*r,e),v=0,u=i.length;u>v;){var l=v++;o[2][l]=i[l],o[1][l]=verb.core.Vec.add(c,i[l]),o[0][l]=verb.core.Vec.add(a,i[l]),n[0][l]=s[l],n[1][l]=s[l],n[2][l]=s[l]}return new verb.core.types.NurbsSurfaceData(2,t.degree,[0,0,0,1,1,1],t.knots,verb.core.Eval.homogenize2d(o,n))},verb.core.Make.cylindricalSurface=function(e,r,t,o,n){var i=verb.core.Vec.cross(e,r);2*Math.PI;var s=verb.core.Make.arc(t,r,i,n,0,2*Math.PI);return verb.core.Make.extrudedSurface(e,o,s)},verb.core.Make.revolvedSurface=function(e,r,t,o){var n,i,s=verb.core.Eval.dehomogenize1d(e.controlPoints),a=verb.core.Eval.weight1d(e.controlPoints);Math.PI/2>=o?(n=1,i=verb.core.Vec.zeros1d(6+2*(n-1))):Math.PI>=o?(n=2,i=verb.core.Vec.zeros1d(6+2*(n-1)),i[3]=i[4]=.5):3*Math.PI/2>=o?(n=3,i=verb.core.Vec.zeros1d(6+2*(n-1)),i[3]=i[4]=.3333333333333333,i[5]=i[6]=.6666666666666666):(n=4,i=verb.core.Vec.zeros1d(6+2*(n-1)),i[3]=i[4]=.25,i[5]=i[6]=.5,i[7]=i[8]=.75);for(var c=o/n,v=3+2*(n-1),u=0;3>u;){var l=u++;i[l]=0,i[v+l]=1}for(var p=Math.cos(c/2),b=0,h=verb.core.Vec.zeros1d(n+1),f=verb.core.Vec.zeros1d(n+1),d=verb.core.Vec.zeros3d(2*n+1,s.length,3),m=verb.core.Vec.zeros2d(2*n+1,s.length),g=1,x=n+1;x>g;){var _=g++;b+=c,f[_]=Math.cos(b),h[_]=Math.sin(b)}for(var y=0,S=s.length;S>y;){var V=y++,E=verb.core.Trig.rayClosestPoint(s[V],r,t),B=verb.core.Vec.sub(s[V],E),w=verb.core.Vec.norm(B),k=verb.core.Vec.cross(t,B);w>1e-10&&(B=verb.core.Vec.mul(1/w,B),k=verb.core.Vec.mul(1/w,k)),d[0][V]=s[V];var P=s[V];m[0][V]=a[V];for(var L=k,A=0,M=1,N=n+1;N>M;){var I,T=M++;I=0==w?E:verb.core.Vec.add(E,verb.core.Vec.add(verb.core.Vec.mul(w*f[T],B),verb.core.Vec.mul(w*h[T],k))),d[A+2][V]=I,m[A+2][V]=a[V];var C=verb.core.Vec.sub(verb.core.Vec.mul(f[T],k),verb.core.Vec.mul(h[T],B));if(0==w)d[A+1][V]=E;else{var O=verb.core.Intersect.rays(P,verb.core.Vec.mul(1/verb.core.Vec.norm(L),L),I,verb.core.Vec.mul(1/verb.core.Vec.norm(C),C)),D=verb.core.Vec.add(P,verb.core.Vec.mul(O.u0,L));d[A+1][V]=D}m[A+1][V]=p*a[V],A+=2,n>T&&(P=I,L=C)}}return new verb.core.types.NurbsSurfaceData(2,e.degree,i,e.knots,verb.core.Eval.homogenize2d(d,m))},verb.core.Make.sphericalSurface=function(e,r,t,o){var n=verb.core.Make.arc(e,verb.core.Vec.mul(-1,r),t,o,0,Math.PI);return verb.core.Make.revolvedSurface(n,e,r,2*Math.PI)},verb.core.Make.conicalSurface=function(e,r,t,o,n){var i=2*Math.PI,s=1,a=[verb.core.Vec.add(t,verb.core.Vec.mul(o,e)),verb.core.Vec.add(t,verb.core.Vec.mul(n,r))],c=[0,0,1,1],v=[1,1],u=new verb.core.types.NurbsCurveData(s,c,verb.core.Eval.homogenize1d(a,v));return verb.core.Make.revolvedSurface(u,t,e,i)},verb.core.Make.rationalInterpCurve=function(e,r,t,o,n){if(null==t&&(t=!1),null==r&&(r=3),r+1>e.length)throw"You need to supply at least degree + 1 points! You only supplied "+e.length+" points.";for(var i=[0],s=1,a=e.length;a>s;){var c=s++,v=verb.core.Vec.norm(verb.core.Vec.sub(e[c],e[c-1])),u=i[i.length-1];i.push(u+v)}for(var l=i[i.length-1],p=0,b=i.length;b>p;){var h=p++;i[h]=i[h]/l}var f,d=verb.core.Vec.rep(r+1,0),m=null!=o&&null!=n;f=m?0:1;var g;g=m?i.length-r+1:i.length-r;for(var x=f;g>x;){for(var _=x++,y=0,S=0;r>S;){var V=S++;y+=i[_+V]}d.push(1/r*y)}var E,B=d.concat(verb.core.Vec.rep(r+1,1)),w=[];E=m?e.length+1:e.length-1;var k;k=m?1:0;var P;P=m?e.length-(r-1):e.length-(r+1);for(var L=0;i.length>L;){var A=i[L];++L;var M=verb.core.Eval.knotSpanGivenN(E,r,A,B),N=verb.core.Eval.basisFunctionsGivenKnotSpanIndex(M,A,r,B),I=M-r,T=verb.core.Vec.zeros1d(I),C=verb.core.Vec.zeros1d(P-I);w.push(T.concat(N).concat(C))}if(m){var O=w[0].length-2,D=[-1,1].concat(verb.core.Vec.zeros1d(O)),z=verb.core.Vec.zeros1d(O).concat([-1,1]);verb.core.ArrayExtensions.spliceAndInsert(w,1,0,D),verb.core.ArrayExtensions.spliceAndInsert(w,w.length-1,0,z)}for(var U=e[0].length,R=[],F=(1-B[B.length-r-2])/r,$=B[r+1]/r,G=0;U>G;){var q,H=[G++];if(m){q=[e[0][H[0]]],q.push($*o[H[0]]);for(var W=1,j=e.length-1;j>W;){var K=W++;q.push(e[K][H[0]])}q.push(F*n[H[0]]),q.push(e[e.length-1][H[0]])}else q=e.map(function(e){return function(r){return r[e[0]]}}(H));var Q=verb.core.Mat.solve(w,q);R.push(Q)}var Y=verb.core.Mat.transpose(R);if(!t){var J=verb.core.Vec.rep(Y.length,1);Y=verb.core.Eval.homogenize1d(Y,J)}return new verb.core.types.NurbsCurveData(r,B,Y)},verb.core.LUDecomp=function(e,r){this.LU=e,this.P=r},verb.core.LUDecomp.__name__=["verb","core","LUDecomp"],verb.core.Mat=$hx_exports.core.Mat=function(){},verb.core.Mat.__name__=["verb","core","Mat"],verb.core.Mat.mul=function(e,r){for(var t=[],o=0,n=r.length;n>o;){var i=o++;t.push(verb.core.Vec.mul(e,r[i]))}return t},verb.core.Mat.mult=function(e,r){var t,o,n,i,s,a,c,v;t=e.length,o=r.length,n=r[0].length,i=[];for(var u=t-1,l=0,p=0;u>=0;){for(s=[],a=e[u],p=n-1;p>=0;){for(c=a[o-1]*r[o-1][p],l=o-2;l>=1;)v=l-1,c+=a[l]*r[l][p]+a[v]*r[v][p],l-=2;0==l&&(c+=a[0]*r[0][p]),s[p]=c,p--}i[u]=s,u--}return i},verb.core.Mat.add=function(e,r){for(var t=[],o=0,n=e.length;n>o;){var i=o++;t.push(verb.core.Vec.add(e[i],r[i]))}return t},verb.core.Mat.div=function(e,r){for(var t=[],o=0,n=e.length;n>o;){var i=o++;t.push(verb.core.Vec.div(e[i],r))}return t},verb.core.Mat.sub=function(e,r){for(var t=[],o=0,n=e.length;n>o;){var i=o++;t.push(verb.core.Vec.sub(e[i],r[i]))}return t},verb.core.Mat.dot=function(e,r){for(var t=[],o=0,n=e.length;n>o;){var i=o++;t.push(verb.core.Vec.dot(e[i],r))}return t},verb.core.Mat.identity=function(e){for(var r=verb.core.Vec.zeros2d(e,e),t=0;e>t;){var o=t++;r[o][o]=1}return r},verb.core.Mat.transpose=function(e){if(0==e.length)return[];for(var r=[],t=0,o=e[0].length;o>t;){var n=t++;r.push(function(){for(var r,t=[],o=0,i=e.length;i>o;){var s=o++;t.push(e[s][n])}return r=t}(this))}return r},verb.core.Mat.solve=function(e,r){return verb.core.Mat.LUsolve(verb.core.Mat.LU(e),r)},verb.core.Mat.LUsolve=function(e,r){var t,o,n,i,s,a=e.LU,c=a.length,v=r.slice(),u=e.P;for(t=c-1;-1!=t;)v[t]=r[t],--t;for(t=0;c>t;){for(n=u[t],u[t]!=t&&(s=v[t],v[t]=v[n],v[n]=s),i=a[t],o=0;t>o;)v[t]-=v[o]*i[o],++o;++t}for(t=c-1;t>=0;){for(i=a[t],o=t+1;c>o;)v[t]-=v[o]*i[o],++o;v[t]/=i[t],--t}return v},verb.core.Mat.LU=function(e){Math.abs;for(var r,t,o,n,i,s,a,c,v,u=[],l=0,p=e.length;p>l;){var b=l++;u.push(e[b].slice())}e=u;var h=e.length,f=h-1,d=[];for(o=0;h>o;){for(a=o,s=e[o],v=Math.abs(s[o]),t=o+1;h>t;)n=Math.abs(e[t][o]),n>v&&(v=n,a=t),++t;for(d[o]=a,a!=o&&(e[o]=e[a],e[a]=s,s=e[o]),i=s[o],r=o+1;h>r;)e[r][o]/=i,++r;for(r=o+1;h>r;){for(c=e[r],t=o+1;f>t;)c[t]-=c[o]*s[t],++t,c[t]-=c[o]*s[t],++t;t==f&&(c[t]-=c[o]*s[t]),++r}++o}return new verb.core.LUDecomp(e,d)},verb.core.Mesh=$hx_exports.core.Mesh=function(){},verb.core.Mesh.__name__=["verb","core","Mesh"],verb.core.Mesh.getTriangleNorm=function(e,r){var t=e[r[0]],o=e[r[1]],n=e[r[2]],i=verb.core.Vec.sub(o,t),s=verb.core.Vec.sub(n,t),a=verb.core.Vec.cross(i,s);return verb.core.Vec.mul(1/verb.core.Vec.norm(a),a)},verb.core.Mesh.makeMeshAabb=function(e,r){for(var t=new verb.core.types.BoundingBox,o=0;r.length>o;){var n=r[o];++o,t.add(e.points[e.faces[n][0]]),t.add(e.points[e.faces[n][1]]),t.add(e.points[e.faces[n][2]])}return t},verb.core.Mesh.makeMeshAabbTree=function(e,r){var t=verb.core.Mesh.makeMeshAabb(e,r);if(1==r.length)return new verb.core.types.BoundingBoxLeaf(t,r[0]);var o=verb.core.Mesh.sortTrianglesOnLongestAxis(t,e,r),n=verb.core.ArrayExtensions.left(o),i=verb.core.ArrayExtensions.right(o);return new verb.core.types.BoundingBoxInnerNode(t,[verb.core.Mesh.makeMeshAabbTree(e,n),verb.core.Mesh.makeMeshAabbTree(e,i)])},verb.core.Mesh.sortTrianglesOnLongestAxis=function(e,r,t){for(var o=e.getLongestAxis(),n=[],i=0;t.length>i;){var s=t[i];++i;var a=verb.core.Mesh.getMinCoordOnAxis(r.points,r.faces[s],o);n.push(new verb.core.types.Pair(a,s))}n.sort(function(e,r){var t=e.item0,o=r.item0;return t==o?0:t>o?1:-1});for(var c=[],v=0,u=n.length;u>v;){var l=v++;c.push(n[l].item1)}return c},verb.core.Mesh.getMinCoordOnAxis=function(e,r,t){for(var o=Math.POSITIVE_INFINITY,n=0;3>n;){var i=n++,s=e[r[i]][t];o>s&&(o=s)}return o},verb.core.Mesh.getTriangleCentroid=function(e,r){for(var t=[0,0,0],o=0;3>o;)for(var n=o++,i=0;3>i;){var s=i++;t[s]+=e[r[n]][s]}for(var a=0;3>a;){var c=a++;t[c]/=3}return t},verb.core.Mesh.triangleUVFromPoint=function(e,r,t){var o=e.faces[r],n=e.points[o[0]],i=e.points[o[1]],s=e.points[o[2]],a=e.uvs[o[0]],c=e.uvs[o[1]],v=e.uvs[o[2]],u=verb.core.Vec.sub(n,t),l=verb.core.Vec.sub(i,t),p=verb.core.Vec.sub(s,t),b=verb.core.Vec.norm(verb.core.Vec.cross(verb.core.Vec.sub(n,i),verb.core.Vec.sub(n,s))),h=verb.core.Vec.norm(verb.core.Vec.cross(l,p))/b,f=verb.core.Vec.norm(verb.core.Vec.cross(p,u))/b,d=verb.core.Vec.norm(verb.core.Vec.cross(u,l))/b;return verb.core.Vec.add(verb.core.Vec.mul(h,a),verb.core.Vec.add(verb.core.Vec.mul(f,c),verb.core.Vec.mul(d,v)))},verb.core.Modify=$hx_exports.core.Modify=function(){},verb.core.Modify.__name__=["verb","core","Modify"],verb.core.Modify.curveReverse=function(e){return new verb.core.types.NurbsCurveData(e.degree,verb.core.Modify.knotsReverse(e.knots),verb.core.ArrayExtensions.reversed(e.controlPoints))},verb.core.Modify.surfaceReverse=function(e,r){return null==r&&(r=!1),r?new verb.core.types.NurbsSurfaceData(e.degreeU,e.degreeV,e.knotsU,verb.core.Modify.knotsReverse(e.knotsV),function(){for(var r,t=[],o=0,n=e.controlPoints;n.length>o;){var i=n[o];++o,t.push(verb.core.ArrayExtensions.reversed(i))}return r=t}(this)):new verb.core.types.NurbsSurfaceData(e.degreeU,e.degreeV,verb.core.Modify.knotsReverse(e.knotsU),e.knotsV,verb.core.ArrayExtensions.reversed(e.controlPoints))},verb.core.Modify.knotsReverse=function(e){var r=e[0];e[e.length-1];for(var t=[r],o=e.length,n=1;o>n;){var i=n++;t.push(t[i-1]+(e[o-i]-e[o-i-1]))}return t},verb.core.Modify.unifyCurveKnotVectors=function(e){e=e.map(verb.core.Make.clonedCurve);for(var r=Lambda.fold(e,function(e,r){return verb.core.Modify.imax(e.degree,r)},0),t=0,o=e.length;o>t;){var n=t++;r>e[n].degree&&(e[n]=verb.core.Modify.curveElevateDegree(e[n],r))}for(var i,s=[],a=0;e.length>a;){var c=e[a];++a,s.push(new verb.core.types.Interval(c.knots[0],verb.core.ArrayExtensions.last(c.knots)))}i=s;for(var v=0,u=e.length;u>v;){var l=v++,p=[i[l].min];e[l].knots=e[l].knots.map(function(e){return function(r){return r-e[0]}}(p))}for(var b=i.map(function(e){return e.max-e.min}),h=Lambda.fold(b,function(e,r){return Math.max(e,r)},0),f=0,d=e.length;d>f;){var m=f++,g=[h/b[m]];e[m].knots=e[m].knots.map(function(e){return function(r){return r*e[0]}}(g))}for(var x=Lambda.fold(e,function(e,r){return verb.core.Vec.sortedSetUnion(e.knots,r)},[]),_=0,y=e.length;y>_;){var S=_++,V=verb.core.Vec.sortedSetSub(x,e[S].knots);0==V.length&&(e[S]=e[S]),e[S]=verb.core.Modify.curveKnotRefine(e[S],V)}return e},verb.core.Modify.imin=function(e,r){return r>e?e:r},verb.core.Modify.imax=function(e,r){return e>r?e:r},verb.core.Modify.curveElevateDegree=function(e,r){if(e.degree>=r)return e;var t,o=e.knots.length-e.degree-2,n=e.degree,i=e.knots,s=e.controlPoints,a=r-e.degree,c=e.controlPoints[0].length,v=verb.core.Vec.zeros2d(n+a+1,n+1),u=[],l=[],p=[],b=o+n+1,h=r,f=Math.floor(h/2),d=[],m=[];v[0][0]=1,v[h][n]=1;for(var g=1,x=f+1;x>g;){var _,y=g++,S=1/verb.core.Binomial.get(h,y);_=y>n?n:y;for(var V=verb.core.Modify.imax(0,y-a),E=_+1;E>V;){var B=V++;v[y][B]=S*verb.core.Binomial.get(n,B)*verb.core.Binomial.get(a,y-B)}}for(var w=f+1;h>w;){var k,P=w++;k=P>n?n:P;for(var L=verb.core.Modify.imax(0,P-a),A=k+1;A>L;){var M=L++;v[P][M]=v[h-P][n-M]}}var N=h,I=h+1,T=-1,C=n,O=n+1,D=1,z=i[0];d[0]=s[0];for(var U=0,R=h+1;R>U;){var F=U++;m[F]=z}for(var $=0,G=n+1;G>$;){var q=$++;u[q]=s[q]}for(;b>O;){for(var H=O;b>O&&i[O]==i[O+1];)O+=1;var W=O-H+1,j=i[O],K=T;T=n-W;var Q;Q=K>0?Math.floor((K+2)/2):1;var Y;if(Y=T>0?Math.floor(h-(T+1)/2):h,T>0){for(var J=j-z,Z=[],X=n;X>W;)Z[X-W-1]=J/(i[C+X]-z),X--;for(var er=1,rr=T+1;rr>er;){for(var tr=er++,or=T-tr,nr=W+tr,ir=n;ir>=nr;)u[ir]=verb.core.Vec.add(verb.core.Vec.mul(Z[ir-nr],u[ir]),verb.core.Vec.mul(1-Z[ir-nr],u[ir-1])),ir--;p[or]=u[n]}}for(var sr=Q,ar=h+1;ar>sr;){var cr=sr++;l[cr]=verb.core.Vec.zeros1d(c);var vr;vr=cr>n?n:cr;for(var ur=verb.core.Modify.imax(0,cr-a),lr=vr+1;lr>ur;){var pr=ur++;l[cr]=verb.core.Vec.add(l[cr],verb.core.Vec.mul(v[cr][pr],u[pr]))}}if(K>1)for(var br=I-2,hr=I,fr=j-z,dr=(j-m[I-1])/fr,mr=1;K>mr;){for(var gr=mr++,xr=br,_r=hr,yr=_r-I+1;_r-xr>gr;){if(D>xr){var Sr=(j-m[xr])/(z-m[xr]);d[xr]=verb.core.Vec.lerp(Sr,d[xr],d[xr-1])}if(_r>=Q){if(I-h+K>=_r-gr){var Vr=(j-m[_r-gr])/fr;l[yr]=verb.core.Vec.lerp(Vr,l[yr],l[yr+1])}}else l[yr]=verb.core.Vec.lerp(dr,l[yr],l[yr+1]);xr+=1,_r-=1,yr-=1}br-=1,hr+=1}if(C!=n)for(var Er=0,Br=h-K;Br>Er;)Er++,m[I]=z,I+=1;for(var wr=Q,kr=Y+1;kr>wr;){var Pr=wr++;d[D]=l[Pr],D+=1}if(b>O){for(var Lr=0;T>Lr;){var Ar=Lr++;u[Ar]=p[Ar]}for(var Mr=T,Nr=n+1;Nr>Mr;){var Ir=Mr++;u[Ir]=s[O-n+Ir]}C=O,O+=1,z=j}else for(var Tr=0,Cr=h+1;Cr>Tr;){var Or=Tr++;m[I+Or]=j}}return t=N-h-1,new verb.core.types.NurbsCurveData(r,m,d)},verb.core.Modify.rationalSurfaceTransform=function(e,r){for(var t=verb.core.Eval.dehomogenize2d(e.controlPoints),o=0,n=t.length;n>o;)for(var i=o++,s=0,a=t[i].length;a>s;){var c=s++,v=t[i][c];v.push(1),t[i][c]=verb.core.Mat.dot(r,v).slice(0,v.length-1)}return new verb.core.types.NurbsSurfaceData(e.degreeU,e.degreeV,e.knotsU.slice(),e.knotsV.slice(),verb.core.Eval.homogenize2d(t,verb.core.Eval.weight2d(e.controlPoints)))},verb.core.Modify.rationalCurveTransform=function(e,r){for(var t=verb.core.Eval.dehomogenize1d(e.controlPoints),o=0,n=t.length;n>o;){var i=o++,s=t[i];s.push(1),t[i]=verb.core.Mat.dot(r,s).slice(0,s.length-1)}return new verb.core.types.NurbsCurveData(e.degree,e.knots.slice(),verb.core.Eval.homogenize1d(t,verb.core.Eval.weight1d(e.controlPoints)))},verb.core.Modify.surfaceKnotRefine=function(e,r,t){var o,n,i,s=[];t?(i=e.controlPoints,o=e.knotsV,n=e.degreeV):(i=verb.core.Mat.transpose(e.controlPoints),o=e.knotsU,n=e.degreeU);for(var a=null,c=0;i.length>c;){var v=i[c];++c,a=verb.core.Modify.curveKnotRefine(new verb.core.types.NurbsCurveData(n,o,v),r),s.push(a.controlPoints)}var u=a.knots;return t?new verb.core.types.NurbsSurfaceData(e.degreeU,e.degreeV,e.knotsU.slice(),u,s):(s=verb.core.Mat.transpose(s),new verb.core.types.NurbsSurfaceData(e.degreeU,e.degreeV,u,e.knotsV.slice(),s))},verb.core.Modify.surfaceSplit=function(e,r,t){null==t&&(t=!1);var o,n,i;t?(i=e.controlPoints,o=e.knotsV,n=e.degreeV):(i=verb.core.Mat.transpose(e.controlPoints),o=e.knotsU,n=e.degreeU);for(var s,a=[],c=0,v=n+1;v>c;)c++,a.push(r);s=a;for(var u=[],l=[],p=verb.core.Eval.knotSpan(n,r,o),b=null,h=0;i.length>h;){var f=i[h];++h,b=verb.core.Modify.curveKnotRefine(new verb.core.types.NurbsCurveData(n,o,f),s),u.push(b.controlPoints.slice(0,p+1)),l.push(b.controlPoints.slice(p+1))}var d=b.knots.slice(0,p+n+2),m=b.knots.slice(p+1);return t?[new verb.core.types.NurbsSurfaceData(e.degreeU,n,e.knotsU.slice(),d,u),new verb.core.types.NurbsSurfaceData(e.degreeU,n,e.knotsU.slice(),m,l)]:(u=verb.core.Mat.transpose(u),l=verb.core.Mat.transpose(l),[new verb.core.types.NurbsSurfaceData(n,e.degreeV,d,e.knotsV.slice(),u),new verb.core.types.NurbsSurfaceData(n,e.degreeV,m,e.knotsV.slice(),l)])},verb.core.Modify.decomposeCurveIntoBeziers=function(e){for(var r=e.degree,t=e.controlPoints,o=e.knots,n=verb.core.Analyze.knotMultiplicities(o),i=r+1,s=0;n.length>s;){var a=n[s];if(++s,i>a.mult){var c=verb.core.Vec.rep(i-a.mult,a.knot),v=verb.core.Modify.curveKnotRefine(new verb.core.types.NurbsCurveData(r,o,t),c);o=v.knots,t=v.controlPoints}}o.length/i-1;for(var u=2*i,l=[],p=0;t.length>p;){var b=o.slice(p,p+u),h=t.slice(p,p+i);l.push(new verb.core.types.NurbsCurveData(r,b,h)),p+=i}return l},verb.core.Modify.curveSplit=function(e,r){var t=e.degree;e.controlPoints;for(var o,n=e.knots,i=[],s=0,a=t+1;a>s;)s++,i.push(r);o=i;var c=verb.core.Modify.curveKnotRefine(e,o),v=verb.core.Eval.knotSpan(t,r,n),u=c.knots.slice(0,v+t+2),l=c.knots.slice(v+1),p=c.controlPoints.slice(0,v+1),b=c.controlPoints.slice(v+1);return[new verb.core.types.NurbsCurveData(t,u,p),new verb.core.types.NurbsCurveData(t,l,b)]},verb.core.Modify.curveKnotRefine=function(e,r){if(0==r.length)return verb.core.Make.clonedCurve(e);for(var t=e.degree,o=e.controlPoints,n=e.knots,i=o.length-1,s=i+t+1,a=r.length-1,c=verb.core.Eval.knotSpan(t,r[0],n),v=verb.core.Eval.knotSpan(t,r[a],n),u=[],l=[],p=0,b=c-t+1;b>p;){var h=p++;u[h]=o[h]}for(var f=v-1,d=i+1;d>f;){var m=f++;u[m+a+1]=o[m]}for(var g=0,x=c+1;x>g;){var _=g++;l[_]=n[_]}for(var y=v+t,S=s+1;S>y;){var V=y++;l[V+a+1]=n[V]}for(var E=v+t-1,B=v+t+a,w=a;w>=0;){for(;r[w]<=n[E]&&E>c;)u[B-t-1]=o[E-t-1],l[B]=n[E],B-=1,E-=1;u[B-t-1]=u[B-t];for(var k=1,P=t+1;P>k;){var L=k++,A=B-t+L,M=l[B+L]-r[w];1e-10>Math.abs(M)?u[A-1]=u[A]:(M/=l[B+L]-n[E-t+L],u[A-1]=verb.core.Vec.add(verb.core.Vec.mul(M,u[A-1]),verb.core.Vec.mul(1-M,u[A])))}l[B]=r[w],B-=1,w--}return new verb.core.types.NurbsCurveData(t,l,u)},verb.core.Modify.curveKnotInsert=function(e,r,t){for(var o=e.degree,n=e.controlPoints,i=e.knots,s=0,a=n.length,c=verb.core.Eval.knotSpan(o,r,i),v=[],u=[],l=[],p=1,b=c+1;b>p;){var h=p++;u[h]=i[h]}for(var f=1,d=t+1;d>f;){var m=f++;u[c+m]=r}for(var g=c+1,x=i.length;x>g;){var _=g++;u[_+t]=i[_]}for(var y=0,S=c-o+1;S>y;){var V=y++;l[V]=n[V]}for(var E=c-s;a>E;){var B=E++;l[B+t]=n[B]}for(var w=0,k=o-s+1;k>w;){var P=w++;v[P]=n[c-o+P]}for(var L=0,A=0,M=1,N=t+1;N>M;){var I=M++;L=c-o+I;for(var T=0,C=o-I-s+1;C>T;){var O=T++;A=(r-i[L+O])/(i[O+c+1]-i[L+O]),v[O]=verb.core.Vec.add(verb.core.Vec.mul(A,v[O+1]),verb.core.Vec.mul(1-A,v[O]))}l[L]=v[0],l[c+t-I-s]=v[o-I-s]}for(var D=L+1,z=c-s;z>D;){var U=D++;l[U]=v[U-L]}return new verb.core.types.NurbsCurveData(o,u,l)},verb.core.MinimizationResult=function(e,r,t,o,n,i){this.solution=e,this.value=r,this.gradient=t,this.invHessian=o,this.iterations=n,this.message=i},verb.core.MinimizationResult.__name__=["verb","core","MinimizationResult"],verb.core.Numeric=function(){},verb.core.Numeric.__name__=["verb","core","Numeric"],verb.core.Numeric.numericalGradient=function(e,r){var t=r.length,o=e(r);if(o==Math.NaN)throw"gradient: f(x) is a NaN!";for(var n,i,s,a,c,v,u,l,p,b=r.slice(0),h=[],f=.001,d=0,m=0;t>m;)for(var g=m++,x=Math.max(1e-6*o,1e-8);;){if(++d,d>20)throw"Numerical gradient fails";if(b[g]=r[g]+x,n=e(b),b[g]=r[g]-x,i=e(b),b[g]=r[g],Math.isNaN(n)||Math.isNaN(i))x/=16;else{if(h[g]=(n-i)/(2*x),a=r[g]-x,c=r[g],v=r[g]+x,u=(n-o)/x,l=(o-i)/x,p=verb.core.Vec.max([Math.abs(h[g]),Math.abs(o),Math.abs(n),Math.abs(i),Math.abs(a),Math.abs(c),Math.abs(v),1e-8]),s=Math.min(verb.core.Vec.max([Math.abs(u-h[g]),Math.abs(l-h[g]),Math.abs(u-l)])/p,x/p),!(s>f))break;x/=16}}return h},verb.core.Numeric.uncmin=function(e,r,t,o,n){null==t&&(t=1e-8),null==o&&(o=function(r){return verb.core.Numeric.numericalGradient(e,r)}),null==n&&(n=1e3),r=r.slice(0);var i,s=r.length,a=e(r),c=a;if(Math.isNaN(a))throw"uncmin: f(x0) is a NaN!";t=Math.max(t,1e-10);var v,u,l,p,b,h,f,d,m,g=verb.core.Mat.identity(s),x=0,_=[],y="";for(u=o(r);n>x;){if(!verb.core.Vec.all(verb.core.Vec.finite(u))){y="Gradient has Infinity or NaN";break}if(v=verb.core.Vec.neg(verb.core.Mat.dot(g,u)),!verb.core.Vec.all(verb.core.Vec.finite(v))){y="Search direction has Infinity or NaN";break}if(m=verb.core.Vec.norm(v),t>m){y="Newton step smaller than tol";break}for(d=1,i=verb.core.Vec.dot(u,v),p=r;n>x&&!(t>d*m)&&(_=verb.core.Vec.mul(d,v),p=verb.core.Vec.add(r,_),c=e(p),c-a>=.1*d*i||Math.isNaN(c));)d*=.5,++x;if(t>d*m){y="Line search step size smaller than tol";break}if(x==n){y="maxit reached during line search";break}l=o(p),b=verb.core.Vec.sub(l,u),f=verb.core.Vec.dot(b,_),h=verb.core.Mat.dot(g,b),g=verb.core.Mat.sub(verb.core.Mat.add(g,verb.core.Mat.mul((f+verb.core.Vec.dot(b,h))/(f*f),verb.core.Numeric.tensor(_,_))),verb.core.Mat.div(verb.core.Mat.add(verb.core.Numeric.tensor(h,_),verb.core.Numeric.tensor(_,h)),f)),r=p,a=c,u=l,++x}return new verb.core.MinimizationResult(r,a,u,g,x,y)},verb.core.Numeric.tensor=function(e,r){for(var t,o,n=e.length,i=r.length,s=[],a=n-1;a>=0;){t=[],o=e[a];for(var c=i-1;c>=3;)t[c]=o*r[c],--c,t[c]=o*r[c],--c,t[c]=o*r[c],--c,t[c]=o*r[c],--c;for(;c>=0;)t[c]=o*r[c],--c;s[a]=t,a--}return s},verb.core.Tess=$hx_exports.core.Tess=function(){},verb.core.Tess.__name__=["verb","core","Tess"],verb.core.Tess.rationalCurveRegularSample=function(e,r,t){return verb.core.Tess.rationalCurveRegularSampleRange(e,e.knots[0],verb.core.ArrayExtensions.last(e.knots),r,t)},verb.core.Tess.rationalCurveRegularSampleRange=function(e,r,t,o,n){1>o&&(o=2);for(var i=[],s=(t-r)/(o-1),a=0,c=0;o>c;){var v=c++;a=r+s*v,n?i.push([a].concat(verb.core.Eval.rationalCurvePoint(e,a))):i.push(verb.core.Eval.rationalCurvePoint(e,a))}return i},verb.core.Tess.rationalCurveAdaptiveSample=function(e,r,t){if(null==t&&(t=!1),null==r&&(r=1e-6),1==e.degree){if(t){for(var o=[],n=0,i=e.controlPoints.length;i>n;){var s=n++;o.push([e.knots[s+1]].concat(verb.core.Eval.dehomogenize(e.controlPoints[s])))}return o}return e.controlPoints.map(verb.core.Eval.dehomogenize)}return verb.core.Tess.rationalCurveAdaptiveSampleRange(e,e.knots[0],verb.core.ArrayExtensions.last(e.knots),r,t)},verb.core.Tess.rationalCurveAdaptiveSampleRange=function(e,r,t,o,n){var i=verb.core.Eval.rationalCurvePoint(e,r),s=verb.core.Eval.rationalCurvePoint(e,t),a=.5+.2*Math.random(),c=r+(t-r)*a,v=verb.core.Eval.rationalCurvePoint(e,c),u=verb.core.Vec.sub(i,s),l=verb.core.Vec.sub(i,v);if(o>verb.core.Vec.dot(u,u)&&verb.core.Vec.dot(l,l)>o||!verb.core.Trig.threePointsAreFlat(i,v,s,o)){var p=r+.5*(t-r),b=verb.core.Tess.rationalCurveAdaptiveSampleRange(e,r,p,o,n),h=verb.core.Tess.rationalCurveAdaptiveSampleRange(e,p,t,o,n);return b.slice(0,-1).concat(h)}return n?[[r].concat(i),[t].concat(s)]:[i,s]},verb.core.Tess.rationalSurfaceNaive=function(e,r,t){1>r&&(r=1),1>t&&(t=1),e.degreeU,e.degreeV,e.controlPoints;for(var o=e.knotsU,n=e.knotsV,i=o[o.length-1]-o[0],s=n[n.length-1]-n[0],a=i/r,c=s/t,v=[],u=[],l=[],p=0,b=r+1;b>p;)for(var h=p++,f=0,d=t+1;d>f;){var m=f++,g=h*a,x=m*c;u.push([g,x]);var _=verb.core.Eval.rationalSurfaceDerivatives(e,g,x,1),y=_[0][0];v.push(y);var S=verb.core.Vec.normalized(verb.core.Vec.cross(_[1][0],_[0][1]));l.push(S)}for(var V=[],E=0;r>E;)for(var B=E++,w=0;t>w;){var k=w++,P=B*(t+1)+k,L=(B+1)*(t+1)+k,A=L+1,M=P+1,N=[P,L,A],I=[P,A,M];V.push(N),V.push(I)}return new verb.core.types.MeshData(V,v,l,u)},verb.core.Tess.divideRationalSurfaceAdaptive=function(e,r){null==r&&(r=new verb.core.types.AdaptiveRefinementOptions),r.minDivsU=null!=r.minDivsU?r.minDivsU:1,r.minDivsU=null!=r.minDivsV?r.minDivsV:1,r.refine=null!=r.refine?r.refine:!0;var t,o=2*(e.controlPoints.length-1),n=2*(e.controlPoints[0].length-1);t=r.minDivsU=r.minDivsU>o?r.minDivsU:o;var i;i=r.minDivsV=r.minDivsV>n?r.minDivsV:n;for(var s=verb.core.ArrayExtensions.last(e.knotsU),a=e.knotsU[0],c=verb.core.ArrayExtensions.last(e.knotsV),v=e.knotsV[0],u=(s-a)/t,l=(c-v)/i,p=[],b=[],h=0,f=i+1;f>h;){for(var d=h++,m=[],g=0,x=t+1;x>g;){var _=g++,y=a+u*_,S=v+l*d,V=verb.core.Eval.rationalSurfaceDerivatives(e,y,S,1),E=verb.core.Vec.normalized(verb.core.Vec.cross(V[0][1],V[1][0]));m.push(new verb.core.types.SurfacePoint(V[0][0],E,[y,S],-1,verb.core.Vec.isZero(E)))}b.push(m)}for(var B=0;i>B;)for(var w=B++,k=0;t>k;){var P=k++,L=[b[i-w-1][P],b[i-w-1][P+1],b[i-w][P+1],b[i-w][P]];p.push(new verb.core.types.AdaptiveRefinementNode(e,L))}if(!r.refine)return p;for(var A=0;i>A;)for(var M=A++,N=0;t>N;){var I=N++,T=M*t+I,C=verb.core.Tess.north(T,M,I,t,i,p),O=verb.core.Tess.east(T,M,I,t,i,p),D=verb.core.Tess.south(T,M,I,t,i,p),z=verb.core.Tess.west(T,M,I,t,i,p);p[T].neighbors=[D,O,C,z],p[T].divide(r)}return p},verb.core.Tess.north=function(e,r,t,o,n,i){return 0==r?null:i[e-o]},verb.core.Tess.south=function(e,r,t,o,n,i){return r==n-1?null:i[e+o]},verb.core.Tess.east=function(e,r,t,o,n,i){return t==o-1?null:i[e+1]},verb.core.Tess.west=function(e,r,t,o,n,i){return 0==t?null:i[e-1]},verb.core.Tess.triangulateAdaptiveRefinementNodeTree=function(e){for(var r=verb.core.types.MeshData.empty(),t=0;e.length>t;){var o=e[t];++t,o.triangulate(r)}return r},verb.core.Tess.rationalSurfaceAdaptive=function(e,r){r=null!=r?r:new verb.core.types.AdaptiveRefinementOptions;var t=verb.core.Tess.divideRationalSurfaceAdaptive(e,r);return verb.core.Tess.triangulateAdaptiveRefinementNodeTree(t)},verb.core.Trig=$hx_exports.core.Trig=function(){},verb.core.Trig.__name__=["verb","core","Trig"],verb.core.Trig.isPointInPlane=function(e,r,t){return t>Math.abs(verb.core.Vec.dot(verb.core.Vec.sub(e,r.o),r.n))},verb.core.Trig.distToSegment=function(e,r,t){var o=verb.core.Trig.segmentClosestPoint(r,e,t,0,1);return verb.core.Vec.dist(r,o.pt)},verb.core.Trig.rayClosestPoint=function(e,r,t){var o=verb.core.Vec.sub(e,r),n=verb.core.Vec.dot(o,t),i=verb.core.Vec.add(r,verb.core.Vec.mul(n,t));return i},verb.core.Trig.distToRay=function(e,r,t){var o=verb.core.Trig.rayClosestPoint(e,r,t),n=verb.core.Vec.sub(o,e);return verb.core.Vec.norm(n)},verb.core.Trig.threePointsAreFlat=function(e,r,t,o){var n=verb.core.Vec.sub(r,e),i=verb.core.Vec.sub(t,e),s=verb.core.Vec.cross(n,i),a=verb.core.Vec.dot(s,s);return o>a},verb.core.Trig.segmentClosestPoint=function(e,r,t,o,n){var i=verb.core.Vec.sub(t,r),s=verb.core.Vec.norm(i);if(1e-10>s)return{u:o,pt:r};var a=r,c=verb.core.Vec.mul(1/s,i),v=verb.core.Vec.sub(e,a),u=verb.core.Vec.dot(v,c);return 0>u?{u:o,pt:r}:u>s?{u:n,pt:t}:{u:o+(n-o)*u/s,pt:verb.core.Vec.add(a,verb.core.Vec.mul(u,c))}},verb.core.Vec=$hx_exports.core.Vec=function(){},verb.core.Vec.__name__=["verb","core","Vec"],verb.core.Vec.angleBetween=function(e,r){return Math.acos(verb.core.Vec.dot(e,r)/(verb.core.Vec.norm(e)*verb.core.Vec.norm(r)))},verb.core.Vec.positiveAngleBetween=function(e,r,t){var o=verb.core.Vec.cross(e,r),n=verb.core.Vec.norm(e),i=verb.core.Vec.norm(r),s=n*i,a=verb.core.Vec.dot(e,r),c=verb.core.Vec.norm(o)/s,v=a/s,u=Math.atan2(c,v),l=verb.core.Vec.dot(t,o);return 1e-10>Math.abs(l)?u:l>0?u:-u},verb.core.Vec.signedAngleBetween=function(e,r,t){var o=verb.core.Vec.cross(e,r),n=verb.core.Vec.norm(e),i=verb.core.Vec.norm(r),s=n*i,a=verb.core.Vec.dot(e,r),c=verb.core.Vec.norm(o)/s,v=a/s,u=Math.atan2(c,v),l=verb.core.Vec.dot(t,o);return l>0?u:2*Math.PI-u},verb.core.Vec.angleBetweenNormalized2d=function(e,r){var t=e[0]*r[1]-e[1]*r[0];return Math.atan2(t,verb.core.Vec.dot(e,r))},verb.core.Vec.domain=function(e){return e[e.length-1]-e[0]},verb.core.Vec.range=function(e){for(var r=[],t=0,o=0;e>o;)o++,r.push(t),t+=1;return r},verb.core.Vec.span=function(e,r,t){if(null==t)return[];if(1e-10>t)return[];if(e>r&&t>0)return[];if(r>e&&0>t)return[];for(var o=[],n=e;r>=n;)o.push(n),n+=t;return o},verb.core.Vec.neg=function(e){return e.map(function(e){return-e})},verb.core.Vec.min=function(e){return Lambda.fold(e,function(e,r){return Math.min(e,r)},Math.POSITIVE_INFINITY)},verb.core.Vec.max=function(e){return Lambda.fold(e,function(e,r){return Math.max(e,r)
},Math.NEGATIVE_INFINITY)},verb.core.Vec.all=function(e){return Lambda.fold(e,function(e,r){return r&&e},!0)},verb.core.Vec.finite=function(e){return e.map(function(e){return Math.isFinite(e)})},verb.core.Vec.onRay=function(e,r,t){return verb.core.Vec.add(e,verb.core.Vec.mul(t,r))},verb.core.Vec.lerp=function(e,r,t){return verb.core.Vec.add(verb.core.Vec.mul(e,r),verb.core.Vec.mul(1-e,t))},verb.core.Vec.normalized=function(e){return verb.core.Vec.div(e,verb.core.Vec.norm(e))},verb.core.Vec.cross=function(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]},verb.core.Vec.dist=function(e,r){return verb.core.Vec.norm(verb.core.Vec.sub(e,r))},verb.core.Vec.distSquared=function(e,r){return verb.core.Vec.normSquared(verb.core.Vec.sub(e,r))},verb.core.Vec.sum=function(e){return Lambda.fold(e,function(e,r){return r+e},0)},verb.core.Vec.addAll=function(e){var r=$iterator(e)();if(!r.hasNext())return null;var t=r.next().length;return Lambda.fold(e,function(e,r){return verb.core.Vec.add(r,e)},verb.core.Vec.rep(t,0))},verb.core.Vec.norm=function(e){var r=verb.core.Vec.normSquared(e);return 0!=r?Math.sqrt(r):r},verb.core.Vec.normSquared=function(e){return Lambda.fold(e,function(e,r){return r+e*e},0)},verb.core.Vec.rep=function(e,r){for(var t=[],o=0;e>o;)o++,t.push(r);return t},verb.core.Vec.zeros1d=function(e){for(var r=[],t=0;e>t;)t++,r.push(0);return r},verb.core.Vec.zeros2d=function(e,r){for(var t=[],o=0;e>o;)o++,t.push(verb.core.Vec.zeros1d(r));return t},verb.core.Vec.zeros3d=function(e,r,t){for(var o=[],n=0;e>n;)n++,o.push(verb.core.Vec.zeros2d(r,t));return o},verb.core.Vec.dot=function(e,r){for(var t=0,o=0,n=e.length;n>o;){var i=o++;t+=e[i]*r[i]}return t},verb.core.Vec.add=function(e,r){for(var t=[],o=0,n=e.length;n>o;){var i=o++;t.push(e[i]+r[i])}return t},verb.core.Vec.mul=function(e,r){for(var t=[],o=0,n=r.length;n>o;){var i=o++;t.push(e*r[i])}return t},verb.core.Vec.div=function(e,r){for(var t=[],o=0,n=e.length;n>o;){var i=o++;t.push(e[i]/r)}return t},verb.core.Vec.sub=function(e,r){for(var t=[],o=0,n=e.length;n>o;){var i=o++;t.push(e[i]-r[i])}return t},verb.core.Vec.isZero=function(e){for(var r=0,t=e.length;t>r;){var o=r++;if(Math.abs(e[o])>1e-6)return!1}return!0},verb.core.Vec.sortedSetUnion=function(e,r){for(var t=[],o=0,n=0;e.length>o||r.length>n;)if(o>=e.length)t.push(r[n]),n++;else if(n>=r.length)t.push(e[o]),o++;else{var i=e[o]-r[n];1e-10>Math.abs(i)?(t.push(e[o]),o++,n++):i>0?(t.push(r[n]),n++):(t.push(e[o]),o++)}return t},verb.core.Vec.sortedSetSub=function(e,r){for(var t=[],o=0,n=0;e.length>o;)n>=r.length?(t.push(e[o]),o++):1e-10>Math.abs(e[o]-r[n])?(o++,n++):(t.push(e[o]),o++);return t},verb.core.types={},verb.core.types.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025},verb.core.types.AdaptiveRefinementOptions.__name__=["verb","core","types","AdaptiveRefinementOptions"],verb.core.types.AdaptiveRefinementNode=$hx_exports.core.AdaptiveRefinementNode=function(e,r,t){if(this.srf=e,this.neighbors=null==t?[null,null,null,null]:t,this.corners=r,null==this.corners){var o=e.knotsU[0],n=verb.core.ArrayExtensions.last(e.knotsU),i=e.knotsV[0],s=verb.core.ArrayExtensions.last(e.knotsV);this.corners=[verb.core.types.SurfacePoint.fromUv(o,i),verb.core.types.SurfacePoint.fromUv(n,i),verb.core.types.SurfacePoint.fromUv(n,s),verb.core.types.SurfacePoint.fromUv(o,s)]}},verb.core.types.AdaptiveRefinementNode.__name__=["verb","core","types","AdaptiveRefinementNode"],verb.core.types.AdaptiveRefinementNode.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var e=0;4>e;){var r=e++;if(null==this.corners[r].point){var t=this.corners[r];this.evalSrf(t.uv[0],t.uv[1],t)}}},evalSrf:function(e,r,t){var o=verb.core.Eval.rationalSurfaceDerivatives(this.srf,e,r,1),n=o[0][0],i=verb.core.Vec.cross(o[0][1],o[1][0]),s=verb.core.Vec.isZero(i);return s||(i=verb.core.Vec.normalized(i)),null!=t?(t.degen=s,t.point=n,t.normal=i,t):new verb.core.types.SurfacePoint(n,i,[e,r],-1,s)},getEdgeCorners:function(e){if(this.isLeaf())return[this.corners[e]];if(this.horizontal)switch(e){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(e){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(e){var r=[this.corners[e]];if(null==this.neighbors[e])return r;var t=this.neighbors[e].getEdgeCorners((e+2)%4),o=e%2,n=1e-10,i=this,s=[function(e){return e.uv[0]>i.corners[0].uv[0]+n&&e.uv[0]<i.corners[2].uv[0]-n},function(e){return e.uv[1]>i.corners[0].uv[1]+n&&e.uv[1]<i.corners[2].uv[1]-n}],a=t.filter(s[o]);return a.reverse(),r.concat(a)},midpoint:function(e){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[e])return this.midPoints[e];switch(e){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[e]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var e=this.corners.length,r=0;e>r;){var t=r++;if(this.corners[t],this.corners[t].degen){var o=this.corners[(t+1)%e],n=this.corners[(t+3)%e];this.corners[t].normal=o.degen?n.normal:o.normal}}},shouldDivide:function(e,r){if(e.minDepth>r)return!0;if(r>=e.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=verb.core.Vec.normSquared(verb.core.Vec.sub(this.corners[0].normal,this.corners[1].normal))>e.normTol||verb.core.Vec.normSquared(verb.core.Vec.sub(this.corners[2].normal,this.corners[3].normal))>e.normTol,this.splitHoriz=verb.core.Vec.normSquared(verb.core.Vec.sub(this.corners[1].normal,this.corners[2].normal))>e.normTol||verb.core.Vec.normSquared(verb.core.Vec.sub(this.corners[3].normal,this.corners[0].normal))>e.normTol,this.splitVert||this.splitHoriz)return!0;var t=this.center();return verb.core.Vec.normSquared(verb.core.Vec.sub(t.normal,this.corners[0].normal))>e.normTol||verb.core.Vec.normSquared(verb.core.Vec.sub(t.normal,this.corners[1].normal))>e.normTol||verb.core.Vec.normSquared(verb.core.Vec.sub(t.normal,this.corners[2].normal))>e.normTol||verb.core.Vec.normSquared(verb.core.Vec.sub(t.normal,this.corners[3].normal))>e.normTol},divide:function(e){null==e&&(e=new verb.core.types.AdaptiveRefinementOptions),null==e.normTol&&(e.normTol=.085),null==e.minDepth&&(e.minDepth=0),null==e.maxDepth&&(e.maxDepth=10),this._divide(e,0,!0)},_divide:function(e,r,t){if(this.evalCorners(),this.shouldDivide(e,r)){if(r++,this.splitVert&&!this.splitHoriz?t=!1:!this.splitVert&&this.splitHoriz&&(t=!0),this.horizontal=t,this.horizontal){var o=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],n=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new verb.core.types.AdaptiveRefinementNode(this.srf,o),new verb.core.types.AdaptiveRefinementNode(this.srf,n)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var i=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],s=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new verb.core.types.AdaptiveRefinementNode(this.srf,i),new verb.core.types.AdaptiveRefinementNode(this.srf,s)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var a=0,c=this.children;c.length>a;){var v=c[a];++a,v._divide(e,r,!t)}}},triangulate:function(e){if(null==e&&(e=verb.core.types.MeshData.empty()),this.isLeaf())return this.triangulateLeaf(e);for(var r=0,t=this.children;t.length>r;){var o=t[r];if(++r,null==o)break;o.triangulate(e)}return e},triangulateLeaf:function(e){for(var r=e.points.length,t=[],o=[],n=0,i=0;4>i;){var s=i++,a=this.getAllCorners(s);2==a.length&&(n=s+1);for(var c=0,v=a.length;v>c;){var u=c++;t.push(a[u])}}for(var l=0;t.length>l;){var p=t[l];++l,-1==p.id?(e.uvs.push(p.uv),e.points.push(p.point),e.normals.push(p.normal),p.id=r,o.push(r),r++):o.push(p.id)}if(4==t.length)return e.faces.push([o[0],o[3],o[1]]),e.faces.push([o[3],o[2],o[1]]),e;if(5==t.length){var b=o.length;return e.faces.push([o[n],o[(n+2)%b],o[(n+1)%b]]),e.faces.push([o[(n+4)%b],o[(n+3)%b],o[n]]),e.faces.push([o[n],o[(n+3)%b],o[(n+2)%b]]),e}var h=this.center();e.uvs.push(h.uv),e.points.push(h.point),e.normals.push(h.normal);for(var f=e.points.length-1,d=0,m=t.length-1;t.length>d;)e.faces.push([f,o[d],o[m]]),m=d++;return e}},verb.core.types.BoundingBox=$hx_exports.core.BoundingBox=function(e){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=e&&this.addRange(e)},verb.core.types.BoundingBox.__name__=["verb","core","types","BoundingBox"],verb.core.types.BoundingBox.intervalsOverlap=function(e,r,t,o,n){null==n&&(n=-1);var i;i=-.5>n?verb.core.types.BoundingBox.TOLERANCE:n;var s=Math.min(e,r)-i,a=Math.max(e,r)+i,c=Math.min(t,o)-i,v=Math.max(t,o)+i;return s>=c&&v>=s||a>=c&&v>=a||c>=s&&a>=c||v>=s&&a>=v},verb.core.types.BoundingBox.prototype={fromPoint:function(e){return new verb.core.types.BoundingBox([e])},add:function(e){if(!this.initialized)return this.dim=e.length,this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this;for(var r=0,t=this.dim;t>r;){var o=r++;e[o]>this.max[o]&&(this.max[o]=e[o]),e[o]<this.min[o]&&(this.min[o]=e[o])}return this},addRange:function(e){for(var r=e.length,t=0;r>t;){var o=t++;this.add(e[o])}return this},contains:function(e,r){return null==r&&(r=-1),this.initialized?this.intersects(new verb.core.types.BoundingBox([e]),r):!1},intersects:function(e,r){if(null==r&&(r=-1),!this.initialized||!e.initialized)return!1;for(var t=this.min,o=this.max,n=e.min,i=e.max,s=0,a=this.dim;a>s;){var c=s++;if(!verb.core.types.BoundingBox.intervalsOverlap(t[c],o[c],n[c],i[c],r))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var e=0,r=0,t=0,o=this.dim;o>t;){var n=t++,i=this.getAxisLength(n);i>e&&(e=i,r=n)}return r},getAxisLength:function(e){return 0>e||e>this.dim-1?0:Math.abs(this.min[e]-this.max[e])},intersect:function(e,r){if(!this.initialized)return null;var t=this.min,o=this.max,n=e.min,i=e.max;if(!this.intersects(e,r))return null;for(var s=[],a=[],c=0,v=this.dim;v>c;){var u=c++;s.push(Math.min(o[u],i[u])),a.push(Math.max(t[u],n[u]))}return new verb.core.types.BoundingBox([a,s])}},verb.core.types.BoundingBoxNode=$hx_exports.core.BoundingBoxNode=function(e){this.boundingBox=e},verb.core.types.BoundingBoxNode.__name__=["verb","core","types","BoundingBoxNode"],verb.core.types.BoundingBoxInnerNode=$hx_exports.core.BoundingBoxInnerNode=function(e,r){verb.core.types.BoundingBoxNode.call(this,e),this.children=r},verb.core.types.BoundingBoxInnerNode.__name__=["verb","core","types","BoundingBoxInnerNode"],verb.core.types.BoundingBoxInnerNode.__super__=verb.core.types.BoundingBoxNode,verb.core.types.BoundingBoxInnerNode.prototype=$extend(verb.core.types.BoundingBoxNode.prototype,{}),verb.core.types.BoundingBoxLeaf=$hx_exports.core.BoundingBoxLeaf=function(e,r){verb.core.types.BoundingBoxNode.call(this,e),this.item=r},verb.core.types.BoundingBoxLeaf.__name__=["verb","core","types","BoundingBoxLeaf"],verb.core.types.BoundingBoxLeaf.__super__=verb.core.types.BoundingBoxNode,verb.core.types.BoundingBoxLeaf.prototype=$extend(verb.core.types.BoundingBoxNode.prototype,{}),verb.core.types.CurveCurveIntersection=$hx_exports.core.CurveCurveIntersection=function(e,r,t,o){this.point0=e,this.point1=r,this.u0=t,this.u1=o},verb.core.types.CurveCurveIntersection.__name__=["verb","core","types","CurveCurveIntersection"],verb.core.types.CurveLengthSample=$hx_exports.core.CurveLengthSample=function(e,r){this.u=e,this.len=r},verb.core.types.CurveLengthSample.__name__=["verb","core","types","CurveLengthSample"],verb.core.types.CurveSurfaceIntersection=$hx_exports.core.CurveSurfaceIntersection=function(e,r,t,o){this.u=e,this.uv=r,this.curvePoint=t,this.surfacePoint=o},verb.core.types.CurveSurfaceIntersection.__name__=["verb","core","types","CurveSurfaceIntersection"],verb.core.types.CurveTriPoint=$hx_exports.core.CurveTriPoint=function(e,r,t){this.u=e,this.point=r,this.uv=t},verb.core.types.CurveTriPoint.__name__=["verb","core","types","CurveTriPoint"],verb.core.types.DoublyLinkedListExtensions=function(){},verb.core.types.DoublyLinkedListExtensions.__name__=["verb","core","types","DoublyLinkedListExtensions"],verb.core.types.DoublyLinkedListExtensions.iter=function(e){return new verb.core.types.DoublyLinkedListIterator(e)},verb.core.types.DoublyLinkedListExtensions.push=function(e,r){return null==e?verb.core.types.DoublyLinkedListExtensions.make(r):(e.prv.nxt=r,r.prv=e.prv,e.prv=r,r.nxt=e,r)},verb.core.types.DoublyLinkedListExtensions.kill=function(e,r){return null==e?null:e.nxt==e?null:(r.prv.nxt=r.nxt,r.nxt.prv=r.prv,e==r&&(e=e.nxt),r.nxt=null,r.prv=null,e)},verb.core.types.DoublyLinkedListExtensions.make=function(e){return e.nxt=e,e.prv=e,e},verb.core.types.DoublyLinkedListIterator=function(e){this.t=e,this.c=e},verb.core.types.DoublyLinkedListIterator.__name__=["verb","core","types","DoublyLinkedListIterator"],verb.core.types.DoublyLinkedListIterator.prototype={iterator:function(){return this},next:function(){var e=this.c;return this.c=this.c.nxt==this.t?null:this.c.nxt,e},hasNext:function(){return null!=this.c}},verb.core.types.Exception=function(e){this.message=e},verb.core.types.Exception.__name__=["verb","core","types","Exception"],verb.core.types.IBoundingBoxTree=function(){},verb.core.types.IBoundingBoxTree.__name__=["verb","core","types","IBoundingBoxTree"],verb.core.types.IDoublyLinkedList=function(){},verb.core.types.IDoublyLinkedList.__name__=["verb","core","types","IDoublyLinkedList"],verb.core.types.Interval=$hx_exports.core.Interval=function(e,r){this.min=e,this.max=r},verb.core.types.Interval.__name__=["verb","core","types","Interval"],verb.core.types.LazyCurveBoundingBoxTree=function(e,r){this._boundingBox=null,this._curve=e,null==r&&(r=verb.core.Vec.domain(this._curve.knots)/64),this._knotTol=r},verb.core.types.LazyCurveBoundingBoxTree.__name__=["verb","core","types","LazyCurveBoundingBoxTree"],verb.core.types.LazyCurveBoundingBoxTree.__interfaces__=[verb.core.types.IBoundingBoxTree],verb.core.types.LazyCurveBoundingBoxTree.prototype={split:function(){var e=this._curve.knots[0],r=verb.core.ArrayExtensions.last(this._curve.knots),t=r-e,o=verb.core.Modify.curveSplit(this._curve,(r+e)/2+.1*t*Math.random());return new verb.core.types.Pair(new verb.core.types.LazyCurveBoundingBoxTree(o[0],this._knotTol),new verb.core.types.LazyCurveBoundingBoxTree(o[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new verb.core.types.BoundingBox(verb.core.Eval.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(){return verb.core.Vec.domain(this._curve.knots)<this._knotTol},empty:function(){return!1}},verb.core.types.LazyMeshBoundingBoxTree=function(e,r){if(this._boundingBox=null,this._mesh=e,null==r){for(var t=[],o=0,n=e.faces.length;n>o;){var i=o++;t.push(i)}r=t}this._faceIndices=r},verb.core.types.LazyMeshBoundingBoxTree.__name__=["verb","core","types","LazyMeshBoundingBoxTree"],verb.core.types.LazyMeshBoundingBoxTree.__interfaces__=[verb.core.types.IBoundingBoxTree],verb.core.types.LazyMeshBoundingBoxTree.prototype={split:function(){var e=verb.core.Mesh.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),r=verb.core.ArrayExtensions.left(e),t=verb.core.ArrayExtensions.right(e);return new verb.core.types.Pair(new verb.core.types.LazyMeshBoundingBoxTree(this._mesh,r),new verb.core.types.LazyMeshBoundingBoxTree(this._mesh,t))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=verb.core.Mesh.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length}},verb.core.types.LazyPolylineBoundingBoxTree=function(e,r){this._boundingBox=null,this._polyline=e,null==r&&(r=new verb.core.types.Interval(0,0!=e.points.length?e.points.length-1:0)),this._interval=r},verb.core.types.LazyPolylineBoundingBoxTree.__name__=["verb","core","types","LazyPolylineBoundingBoxTree"],verb.core.types.LazyPolylineBoundingBoxTree.__interfaces__=[verb.core.types.IBoundingBoxTree],verb.core.types.LazyPolylineBoundingBoxTree.prototype={split:function(){var e=this._interval.min,r=this._interval.max,t=e+Math.ceil((r-e)/2),o=new verb.core.types.Interval(e,t),n=new verb.core.types.Interval(t,r);return new verb.core.types.Pair(new verb.core.types.LazyPolylineBoundingBoxTree(this._polyline,o),new verb.core.types.LazyPolylineBoundingBoxTree(this._polyline,n))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new verb.core.types.BoundingBox(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(){return 1==this._interval.max-this._interval.min},empty:function(){return 0==this._interval.max-this._interval.min}},verb.core.types.LazySurfaceBoundingBoxTree=$hx_exports.core.LazySurfaceBoundingBoxTree=function(e,r,t,o){null==r&&(r=!1),this._boundingBox=null,this._surface=e,this._splitV=r,null==t&&(t=verb.core.Vec.domain(e.knotsU)/16),null==o&&(o=verb.core.Vec.domain(e.knotsV)/16),this._knotTolU=t,this._knotTolV=o},verb.core.types.LazySurfaceBoundingBoxTree.__name__=["verb","core","types","LazySurfaceBoundingBoxTree"],verb.core.types.LazySurfaceBoundingBoxTree.__interfaces__=[verb.core.types.IBoundingBoxTree],verb.core.types.LazySurfaceBoundingBoxTree.prototype={split:function(){var e,r;this._splitV?(e=this._surface.knotsV[0],r=verb.core.ArrayExtensions.last(this._surface.knotsV)):(e=this._surface.knotsU[0],r=verb.core.ArrayExtensions.last(this._surface.knotsU));var t=(e+r)/2,o=verb.core.Modify.surfaceSplit(this._surface,t,this._splitV);return new verb.core.types.Pair(new verb.core.types.LazySurfaceBoundingBoxTree(o[0],!this._splitV,this._knotTolU,this._knotTolV),new verb.core.types.LazySurfaceBoundingBoxTree(o[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new verb.core.types.BoundingBox;for(var e=0,r=this._surface.controlPoints;r.length>e;){var t=r[e];++e,this._boundingBox.addRange(verb.core.Eval.dehomogenize1d(t))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(){return verb.core.Vec.domain(this._surface.knotsV)<this._knotTolV&&verb.core.Vec.domain(this._surface.knotsU)<this._knotTolU},empty:function(){return!1}},verb.core.types.MeshBoundingBoxTree=function(e,r){if(this._empty=!1,this._face=-1,null==r){for(var t=[],o=0,n=e.faces.length;n>o;){var i=o++;t.push(i)}r=t}if(this._boundingBox=verb.core.Mesh.makeMeshAabb(e,r),1>r.length)return this._empty=!0,void 0;if(2>r.length)return this._face=r[0],void 0;var s=verb.core.Mesh.sortTrianglesOnLongestAxis(this._boundingBox,e,r),a=verb.core.ArrayExtensions.left(s),c=verb.core.ArrayExtensions.right(s);this._children=new verb.core.types.Pair(new verb.core.types.MeshBoundingBoxTree(e,a),new verb.core.types.MeshBoundingBoxTree(e,c))},verb.core.types.MeshBoundingBoxTree.__name__=["verb","core","types","MeshBoundingBoxTree"],verb.core.types.MeshBoundingBoxTree.__interfaces__=[verb.core.types.IBoundingBoxTree],verb.core.types.MeshBoundingBoxTree.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},yield:function(){return this._face},indivisible:function(){return null==this._children},empty:function(){return this._empty}},verb.core.types.MeshData=$hx_exports.core.MeshData=function(e,r,t,o){this.faces=e,this.points=r,this.normals=t,this.uvs=o},verb.core.types.MeshData.__name__=["verb","core","types","MeshData"],verb.core.types.MeshData.empty=function(){return new verb.core.types.MeshData([],[],[],[])},verb.core.types.MeshIntersectionPoint=$hx_exports.core.MeshIntersectionPoint=function(e,r,t){this.visited=!1,this.adj=null,this.opp=null,this.uv0=e,this.uv1=r,this.point=t,this.faceIndex0,this.faceIndex1},verb.core.types.MeshIntersectionPoint.__name__=["verb","core","types","MeshIntersectionPoint"],verb.core.types.NurbsCurveData=$hx_exports.core.NurbsCurveData=function(e,r,t,o){null==o&&(o=!1),this.degree=e,this.controlPoints=t,this.knots=r,this.closed=o},verb.core.types.NurbsCurveData.__name__=["verb","core","types","NurbsCurveData"],verb.core.types.NurbsSurfaceData=$hx_exports.core.NurbsSurfaceData=function(e,r,t,o,n,i,s){null==s&&(s=!1),null==i&&(i=!1),this.degreeU=e,this.degreeV=r,this.knotsU=t,this.knotsV=o,this.controlPoints=n,this.closedU=i,this.closedV=s},verb.core.types.NurbsSurfaceData.__name__=["verb","core","types","NurbsSurfaceData"],verb.core.types.Pair=$hx_exports.core.Pair=function(e,r){this.item0=e,this.item1=r},verb.core.types.Pair.__name__=["verb","core","types","Pair"],verb.core.types.PolylineData=$hx_exports.core.PolylineData=function(e,r){this.points=e,this.params=r},verb.core.types.PolylineData.__name__=["verb","core","types","PolylineData"],verb.core.types.PolylineMeshIntersection=$hx_exports.core.PolylineMeshIntersection=function(e,r,t,o,n){this.point=e,this.u=r,this.uv=t,this.polylineIndex=o,this.faceIndex=n},verb.core.types.PolylineMeshIntersection.__name__=["verb","core","types","PolylineMeshIntersection"],verb.core.types.Ray=$hx_exports.core.Ray=function(e,r){this.origin=e,this.dir=r},verb.core.types.Ray.__name__=["verb","core","types","Ray"],verb.core.types.SurfaceBoundingBoxTree=function(e,r,t,o){null==r&&(r=!1),this._boundingBox=null,this._surface=e,null==t&&(t=verb.core.Vec.domain(e.knotsU)/16),null==o&&(o=verb.core.Vec.domain(e.knotsV)/16);var n=!1;if(n=r?verb.core.Vec.domain(this._surface.knotsV)>o:verb.core.Vec.domain(this._surface.knotsU)>t){var i,s;r?(i=this._surface.knotsV[0],s=verb.core.ArrayExtensions.last(this._surface.knotsV)):(i=this._surface.knotsU[0],s=verb.core.ArrayExtensions.last(this._surface.knotsU));var a=s-i,c=(i+s)/2+.1*a*Math.random(),v=verb.core.Modify.surfaceSplit(this._surface,c,r);this._children=new verb.core.types.Pair(new verb.core.types.SurfaceBoundingBoxTree(v[0],!r,t,o),new verb.core.types.SurfaceBoundingBoxTree(v[1],!r,t,o))}},verb.core.types.SurfaceBoundingBoxTree.__name__=["verb","core","types","SurfaceBoundingBoxTree"],verb.core.types.SurfaceBoundingBoxTree.__interfaces__=[verb.core.types.IBoundingBoxTree],verb.core.types.SurfaceBoundingBoxTree.prototype={split:function(){return this._children},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new verb.core.types.BoundingBox;for(var e=0,r=this._surface.controlPoints;r.length>e;){var t=r[e];++e,this._boundingBox.addRange(verb.core.Eval.dehomogenize1d(t))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(){return null==this._children},empty:function(){return!1}},verb.core.types.SurfacePoint=function(e,r,t,o,n){null==n&&(n=!1),null==o&&(o=-1),this.uv=t,this.point=e,this.normal=r,this.id=o,this.degen=n},verb.core.types.SurfacePoint.__name__=["verb","core","types","SurfacePoint"],verb.core.types.SurfacePoint.fromUv=function(e,r){return new verb.core.types.SurfacePoint(null,null,[e,r])},verb.core.types.SurfaceSurfaceIntersectionPoint=$hx_exports.core.SurfaceSurfaceIntersectionPoint=function(e,r,t,o){this.uv0=e,this.uv1=r,this.point=t,this.dist=o},verb.core.types.SurfaceSurfaceIntersectionPoint.__name__=["verb","core","types","SurfaceSurfaceIntersectionPoint"],verb.core.types.TriSegmentIntersection=$hx_exports.core.TriSegmentIntersection=function(e,r,t,o){this.point=e,this.s=r,this.t=t,this.p=o},verb.core.types.TriSegmentIntersection.__name__=["verb","core","types","TriSegmentIntersection"],verb.core.types.VolumeData=$hx_exports.core.VolumeData=function(e,r,t,o,n,i,s){this.degreeU=e,this.degreeV=r,this.degreeW=t,this.knotsU=o,this.knotsV=n,this.knotsW=i,this.controlPoints=s},verb.core.types.VolumeData.__name__=["verb","core","types","VolumeData"],verb.exe={},verb.exe.AsyncObject=function(){},verb.exe.AsyncObject.__name__=["verb","exe","AsyncObject"],verb.exe.AsyncObject.prototype={defer:function(e,r,t){return verb.exe.Dispatcher.dispatchMethod(e,r,t)}},verb.exe.Dispatcher=function(){},verb.exe.Dispatcher.__name__=["verb","exe","Dispatcher"],verb.exe.Dispatcher.init=function(){verb.exe.Dispatcher._init||(verb.exe.Dispatcher._workerPool=new verb.exe.WorkerPool(verb.exe.Dispatcher.THREADS),verb.exe.Dispatcher._init=!0)},verb.exe.Dispatcher.dispatchMethod=function(e,r,t){verb.exe.Dispatcher.init();var o=new promhx.Deferred,n=function(e){o.resolve(e)};return verb.exe.Dispatcher._workerPool.addWork(Type.getClassName(e),r,t,n),new promhx.Promise(o)},verb.exe.Work=function(e,r,t){this.className=e,this.methodName=r,this.args=t,this.id=verb.exe.Work.uuid++},verb.exe.Work.__name__=["verb","exe","Work"],verb.exe.WorkerPool=$hx_exports.exe.WorkerPool=function(e,r){null==r&&(r="verb.js"),this._callbacks=new haxe.ds.IntMap,this._working=new haxe.ds.IntMap,this._pool=[],this._queue=[];for(var t=0;e>t;)t++,this._pool.push(new Worker(verb.exe.WorkerPool.basePath+r))},verb.exe.WorkerPool.__name__=["verb","exe","WorkerPool"],verb.exe.WorkerPool.prototype={addWork:function(e,r,t,o){var n=new verb.exe.Work(e,r,t);this._callbacks.set(n.id,o),this._queue.push(n),this.processQueue()},processQueue:function(){for(var e=this;this._queue.length>0&&this._pool.length>0;){var r=this._queue.shift(),t=[r.id],o=[this._pool.shift()];this._working.set(t[0],o[0]),o[0].onmessage=function(r,t){return function(o){e._working.remove(t[0]),e._pool.push(r[0]);try{e._callbacks.exists(t[0])&&(e._callbacks.get(t[0])(o.data.result),e._callbacks.remove(t[0]))}catch(n){haxe.Log.trace(n,{fileName:"WorkerPool.hx",lineNumber:77,className:"verb.exe.WorkerPool",methodName:"processQueue"})}e.processQueue()}}(o,t),o[0].postMessage(r)}}},verb.geom={},verb.geom.ICurve=function(){},verb.geom.ICurve.__name__=["verb","geom","ICurve"],verb.geom.NurbsCurve=$hx_exports.geom.NurbsCurve=function(e){this._data=verb.core.Check.nurbsCurveData(e)},verb.geom.NurbsCurve.__name__=["verb","geom","NurbsCurve"],verb.geom.NurbsCurve.__interfaces__=[verb.geom.ICurve],verb.geom.NurbsCurve.byKnotsControlPointsWeights=function(e,r,t,o){return new verb.geom.NurbsCurve(new verb.core.types.NurbsCurveData(e,r.slice(),verb.core.Eval.homogenize1d(t,o)))},verb.geom.NurbsCurve.byPoints=function(e,r){return null==r&&(r=3),new verb.geom.NurbsCurve(verb.core.Make.rationalInterpCurve(e,r))},verb.geom.NurbsCurve.__super__=verb.exe.AsyncObject,verb.geom.NurbsCurve.prototype=$extend(verb.exe.AsyncObject.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return verb.core.Eval.dehomogenize1d(this._data.controlPoints)},weights:function(){return verb.core.Eval.weight1d(this._data.controlPoints)},asNurbs:function(){return new verb.core.types.NurbsCurveData(this.degree(),this.knots(),verb.core.Eval.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new verb.geom.NurbsCurve(this._data)},domain:function(){return new verb.core.types.Interval(this._data.knots[0],verb.core.ArrayExtensions.last(this._data.knots))},transform:function(e){return new verb.geom.NurbsCurve(verb.core.Modify.rationalCurveTransform(this._data,e))},transformAsync:function(e){return this.defer(verb.core.Modify,"rationalCurveTransform",[this._data,e]).then(function(e){return new verb.geom.NurbsCurve(e)})},point:function(e){return verb.core.Eval.rationalCurvePoint(this._data,e)},pointAsync:function(e){return this.defer(verb.core.Eval,"rationalCurvePoint",[this._data,e])},tangent:function(e){return verb.core.Eval.rationalCurveTangent(this._data,e)},tangentAsync:function(e){return this.defer(verb.core.Eval,"rationalCurveTangent",[this._data,e])},derivatives:function(e,r){return null==r&&(r=1),verb.core.Eval.rationalCurveDerivatives(this._data,e,r)},derivativesAsync:function(e,r){return null==r&&(r=1),this.defer(verb.core.Eval,"rationalCurveDerivatives",[this._data,e,r])},closestPoint:function(e){return verb.core.Analyze.rationalCurveClosestPoint(this._data,e)},closestPointAsync:function(e){return this.defer(verb.core.Analyze,"rationalCurveClosestPoint",[this._data,e])},closestParam:function(e){return verb.core.Analyze.rationalCurveClosestParam(this._data,e)},closestParamAsync:function(e){return this.defer(verb.core.Analyze,"rationalCurveClosestParam",[this._data,e])},length:function(){return verb.core.Analyze.rationalCurveArcLength(this._data)},lengthAsync:function(){return this.defer(verb.core.Analyze,"rationalCurveArcLength",[this._data])},lengthAtParam:function(e){return verb.core.Analyze.rationalCurveArcLength(this._data,e)},lengthAtParamAsync:function(){return this.defer(verb.core.Analyze,"rationalCurveArcLength",[this._data])},paramAtLength:function(e,r){return verb.core.Analyze.rationalCurveParamAtArcLength(this._data,e,r)},paramAtLengthAsync:function(e,r){return this.defer(verb.core.Analyze,"rationalCurveParamAtArcLength",[this._data,e,r])},divideByEqualArcLength:function(e){return verb.core.Divide.rationalCurveByEqualArcLength(this._data,e)},divideByEqualArcLengthAsync:function(e){return this.defer(verb.core.Divide,"rationalCurveByEqualArcLength",[this._data,e])},divideByArcLength:function(e){return verb.core.Divide.rationalCurveByArcLength(this._data,e)},divideByArcLengthAsync:function(e){return this.defer(verb.core.Divide,"rationalCurveByArcLength",[this._data,e])},split:function(e){return verb.core.Modify.curveSplit(this._data,e).map(function(e){return new verb.geom.NurbsCurve(e)})},splitAsync:function(e){return this.defer(verb.core.Modify,"curveSplit",[this._data,e]).then(function(e){return e.map(function(e){return new verb.geom.NurbsCurve(e)})})},reverse:function(){return new verb.geom.NurbsCurve(verb.core.Modify.curveReverse(this._data))},reverseAsync:function(){return this.defer(verb.core.Modify,"curveReverse",[this._data]).then(function(e){return new verb.geom.NurbsCurve(e)})},tessellate:function(e){return verb.core.Tess.rationalCurveAdaptiveSample(this._data,e,!1)},tessellateAsync:function(e){return this.defer(verb.core.Tess,"rationalCurveAdaptiveSample",[this._data,e,!1])}}),verb.geom.Arc=$hx_exports.geom.Arc=function(e,r,t,o,n,i){verb.geom.NurbsCurve.call(this,verb.core.Make.arc(e,r,t,o,n,i)),this._center=e,this._xaxis=r,this._yaxis=t,this._radius=o,this._minAngle=n,this._maxAngle=i},verb.geom.Arc.__name__=["verb","geom","Arc"],verb.geom.Arc.__super__=verb.geom.NurbsCurve,verb.geom.Arc.prototype=$extend(verb.geom.NurbsCurve.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle}}),verb.geom.BezierCurve=$hx_exports.geom.BezierCurve=function(e,r){verb.geom.NurbsCurve.call(this,verb.core.Make.rationalBezierCurve(e,r))
},verb.geom.BezierCurve.__name__=["verb","geom","BezierCurve"],verb.geom.BezierCurve.__super__=verb.geom.NurbsCurve,verb.geom.BezierCurve.prototype=$extend(verb.geom.NurbsCurve.prototype,{}),verb.geom.Circle=$hx_exports.geom.Circle=function(e,r,t,o){verb.geom.Arc.call(this,e,r,t,o,0,2*Math.PI)},verb.geom.Circle.__name__=["verb","geom","Circle"],verb.geom.Circle.__super__=verb.geom.Arc,verb.geom.Circle.prototype=$extend(verb.geom.Arc.prototype,{}),verb.geom.ISurface=function(){},verb.geom.ISurface.__name__=["verb","geom","ISurface"],verb.geom.NurbsSurface=$hx_exports.geom.NurbsSurface=function(e){this._data=verb.core.Check.nurbsSurfaceData(e)},verb.geom.NurbsSurface.__name__=["verb","geom","NurbsSurface"],verb.geom.NurbsSurface.__interfaces__=[verb.geom.ISurface],verb.geom.NurbsSurface.byKnotsControlPointsWeights=function(e,r,t,o,n,i){return new verb.geom.NurbsSurface(new verb.core.types.NurbsSurfaceData(e,r,t,o,verb.core.Eval.homogenize2d(n,i)))},verb.geom.NurbsSurface.byCorners=function(e,r,t,o){return new verb.geom.NurbsSurface(verb.core.Make.fourPointSurface(e,r,t,o))},verb.geom.NurbsSurface.byLoftingCurves=function(e,r){return new verb.geom.NurbsSurface(verb.core.Make.loftedSurface(function(){for(var r,t=[],o=0;e.length>o;){var n=e[o];++o,t.push(n.asNurbs())}return r=t}(this),r))},verb.geom.NurbsSurface.__super__=verb.exe.AsyncObject,verb.geom.NurbsSurface.prototype=$extend(verb.exe.AsyncObject.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return verb.core.Eval.dehomogenize2d(this._data.controlPoints)},weights:function(){return verb.core.Eval.weight2d(this._data.controlPoints)},asNurbs:function(){return new verb.core.types.NurbsSurfaceData(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),verb.core.Eval.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new verb.geom.NurbsSurface(this.asNurbs())},domainU:function(){return new verb.core.types.Interval(this._data.knotsU[0],verb.core.ArrayExtensions.last(this._data.knotsU))},domainV:function(){return new verb.core.types.Interval(this._data.knotsV[0],verb.core.ArrayExtensions.last(this._data.knotsV))},point:function(e,r){return verb.core.Eval.rationalSurfacePoint(this._data,e,r)},pointAsync:function(e,r){return this.defer(verb.core.Eval,"rationalSurfacePoint",[this._data,e,r])},normal:function(e,r){return verb.core.Eval.rationalSurfaceNormal(this._data,e,r)},normalAsync:function(e,r){return this.defer(verb.core.Eval,"rationalSurfaceNormal",[this._data,e,r])},derivatives:function(e,r,t){return null==t&&(t=1),verb.core.Eval.rationalSurfaceDerivatives(this._data,e,r,t)},derivativesAsync:function(e,r,t){return null==t&&(t=1),this.defer(verb.core.Eval,"rationalSurfaceDerivatives",[this._data,e,r,t])},closestParam:function(e){return verb.core.Analyze.rationalSurfaceClosestParam(this._data,e)},closestParamAsync:function(e){return this.defer(verb.core.Analyze,"rationalSurfaceClosestParam",[this._data,e])},closestPoint:function(e){return verb.core.Analyze.rationalSurfaceClosestPoint(this._data,e)},closestPointAsync:function(e){return this.defer(verb.core.Analyze,"rationalSurfaceClosestPoint",[this._data,e])},split:function(e,r){return null==r&&(r=!1),verb.core.Modify.surfaceSplit(this._data,e,r).map(function(e){return new verb.geom.NurbsSurface(e)})},splitAsync:function(e,r){return null==r&&(r=!1),this.defer(verb.core.Modify,"surfaceSplit",[this._data,e,r]).then(function(e){return e.map(function(e){return new verb.geom.NurbsSurface(e)})})},reverse:function(e){return null==e&&(e=!1),new verb.geom.NurbsSurface(verb.core.Modify.surfaceReverse(this._data,e))},reverseAsync:function(e){return null==e&&(e=!1),this.defer(verb.core.Modify,"surfaceReverse",[this._data,e]).then(function(e){return new verb.geom.NurbsSurface(e)})},isocurve:function(e,r){return null==r&&(r=!1),new verb.geom.NurbsCurve(verb.core.Make.surfaceIsocurve(this._data,e,r))},isocurveAsync:function(e,r){return null==r&&(r=!1),this.defer(verb.core.Make,"surfaceIsocurve",[this._data,e,r]).then(function(e){return new verb.geom.NurbsCurve(e)})},boundaries:function(){return verb.core.Make.surfaceBoundaryCurves(this._data).map(function(e){return new verb.geom.NurbsCurve(e)})},boundariesAsync:function(){return this.defer(verb.core.Make,"surfaceBoundaryCurves",[this._data]).then(function(e){return e.map(function(e){return new verb.geom.NurbsCurve(e)})})},tessellate:function(e){return verb.core.Tess.rationalSurfaceAdaptive(this._data,e)},tessellateAsync:function(e){return this.defer(verb.core.Tess,"rationalSurfaceAdaptive",[this._data,e])},transform:function(e){return new verb.geom.NurbsSurface(verb.core.Modify.rationalSurfaceTransform(this._data,e))},transformAsync:function(e){return this.defer(verb.core.Modify,"rationalSurfaceTransform",[this._data,e]).then(function(e){return new verb.geom.NurbsSurface(e)})}}),verb.geom.ConicalSurface=$hx_exports.geom.ConicalSurface=function(e,r,t,o,n){verb.geom.NurbsSurface.call(this,verb.core.Make.conicalSurface(e,r,t,o,n)),this._axis=e,this._xaxis=r,this._base=t,this._height=o,this._radius=n},verb.geom.ConicalSurface.__name__=["verb","geom","ConicalSurface"],verb.geom.ConicalSurface.__super__=verb.geom.NurbsSurface,verb.geom.ConicalSurface.prototype=$extend(verb.geom.NurbsSurface.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius}}),verb.geom.CylindricalSurface=$hx_exports.geom.CylindricalSurface=function(e,r,t,o,n){verb.geom.NurbsSurface.call(this,verb.core.Make.cylindricalSurface(e,r,t,o,n)),this._axis=e,this._xaxis=r,this._base=t,this._height=o,this._radius=n},verb.geom.CylindricalSurface.__name__=["verb","geom","CylindricalSurface"],verb.geom.CylindricalSurface.__super__=verb.geom.NurbsSurface,verb.geom.CylindricalSurface.prototype=$extend(verb.geom.NurbsSurface.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius}}),verb.geom.EllipseArc=$hx_exports.geom.EllipseArc=function(e,r,t,o,n){verb.geom.NurbsCurve.call(this,verb.core.Make.ellipseArc(e,r,t,o,n)),this._center=e,this._xaxis=r,this._yaxis=t,this._minAngle=o,this._maxAngle=n},verb.geom.EllipseArc.__name__=["verb","geom","EllipseArc"],verb.geom.EllipseArc.__super__=verb.geom.NurbsCurve,verb.geom.EllipseArc.prototype=$extend(verb.geom.NurbsCurve.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle}}),verb.geom.Ellipse=$hx_exports.geom.Ellipse=function(e,r,t){verb.geom.EllipseArc.call(this,e,r,t,0,2*Math.PI)},verb.geom.Ellipse.__name__=["verb","geom","Ellipse"],verb.geom.Ellipse.__super__=verb.geom.EllipseArc,verb.geom.Ellipse.prototype=$extend(verb.geom.EllipseArc.prototype,{}),verb.geom.ExtrudedSurface=$hx_exports.geom.ExtrudedSurface=function(e,r){verb.geom.NurbsSurface.call(this,verb.core.Make.extrudedSurface(verb.core.Vec.normalized(r),verb.core.Vec.norm(r),e.asNurbs())),this._profile=e,this._direction=r},verb.geom.ExtrudedSurface.__name__=["verb","geom","ExtrudedSurface"],verb.geom.ExtrudedSurface.__super__=verb.geom.NurbsSurface,verb.geom.ExtrudedSurface.prototype=$extend(verb.geom.NurbsSurface.prototype,{profile:function(){return this._profile},direction:function(){return this._direction}}),verb.geom.Intersect=$hx_exports.geom.Intersect=function(){},verb.geom.Intersect.__name__=["verb","geom","Intersect"],verb.geom.Intersect.curves=function(e,r,t){return null==t&&(t=.001),verb.core.Intersect.curves(e.asNurbs(),r.asNurbs(),t)},verb.geom.Intersect.curvesAsync=function(e,r,t){return null==t&&(t=.001),verb.exe.Dispatcher.dispatchMethod(verb.core.Intersect,"curves",[e.asNurbs(),r.asNurbs(),t])},verb.geom.Intersect.curveAndSurface=function(e,r,t){return null==t&&(t=.001),verb.core.Intersect.curveAndSurface(e.asNurbs(),r.asNurbs(),t)},verb.geom.Intersect.curveAndSurfaceAsync=function(e,r,t){return null==t&&(t=.001),verb.exe.Dispatcher.dispatchMethod(verb.core.Intersect,"curveAndSurface",[e.asNurbs(),r.asNurbs(),t])},verb.geom.Intersect.surfaces=function(e,r,t){return null==t&&(t=.001),verb.core.Intersect.surfaces(e.asNurbs(),r.asNurbs(),t).map(function(e){return new verb.geom.NurbsCurve(e)})},verb.geom.Intersect.surfacesAsync=function(e,r,t){return null==t&&(t=.001),verb.exe.Dispatcher.dispatchMethod(verb.core.Intersect,"surfaces",[e.asNurbs(),r.asNurbs(),t]).then(function(e){return e.map(function(e){return new verb.geom.NurbsCurve(e)})})},verb.geom.Line=$hx_exports.geom.Line=function(e,r){verb.geom.NurbsCurve.call(this,verb.core.Make.polyline([e,r])),this._start=e,this._end=r},verb.geom.Line.__name__=["verb","geom","Line"],verb.geom.Line.__super__=verb.geom.NurbsCurve,verb.geom.Line.prototype=$extend(verb.geom.NurbsCurve.prototype,{start:function(){return this._start},end:function(){return this._end}}),verb.geom.RevolvedSurface=$hx_exports.geom.RevolvedSurface=function(e,r,t,o){verb.geom.NurbsSurface.call(this,verb.core.Make.revolvedSurface(e.asNurbs(),r,t,o)),this._profile=e,this._center=r,this._axis=t,this._angle=o},verb.geom.RevolvedSurface.__name__=["verb","geom","RevolvedSurface"],verb.geom.RevolvedSurface.__super__=verb.geom.NurbsSurface,verb.geom.RevolvedSurface.prototype=$extend(verb.geom.NurbsSurface.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle}}),verb.geom.SphericalSurface=$hx_exports.geom.SphericalSurface=function(e,r){verb.geom.NurbsSurface.call(this,verb.core.Make.sphericalSurface(e,[0,0,1],[1,0,0],r)),this._center=e,this._radius=r},verb.geom.SphericalSurface.__name__=["verb","geom","SphericalSurface"],verb.geom.SphericalSurface.__super__=verb.geom.NurbsSurface,verb.geom.SphericalSurface.prototype=$extend(verb.geom.NurbsSurface.prototype,{center:function(){return this._center},radius:function(){return this._radius}}),verb.geom.SweptSurface=$hx_exports.geom.SweptSurface=function(e,r){verb.geom.NurbsSurface.call(this,verb.core.Make.rationalTranslationalSurface(e.asNurbs(),r.asNurbs())),this._profile=e,this._rail=r},verb.geom.SweptSurface.__name__=["verb","geom","SweptSurface"],verb.geom.SweptSurface.__super__=verb.geom.NurbsSurface,verb.geom.SweptSurface.prototype=$extend(verb.geom.NurbsSurface.prototype,{profile:function(){return this._profile},rail:function(){return this._rail}}),verb.topo={},verb.topo.Analyze=$hx_exports.topo.Analyze=function(){},verb.topo.Analyze.__name__=["verb","topo","Analyze"],verb.topo.Analyze.volume=function(e,r){null==r&&(r=[0,0,0]);for(var t=0,o=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(e.f))();o.hasNext();)for(var n=o.next(),i=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(n.l))();i.hasNext();){var s=i.next(),a=s.e,c=a.nxt;do t+=verb.topo.Analyze.tetravol(a.v.pt,c.v.pt,c.nxt.v.pt,r),c=c.nxt;while(c.nxt!=a)}return t/6},verb.topo.Analyze.tetravol=function(e,r,t,o){return verb.core.Vec.dot(verb.core.Vec.sub(e,o),verb.core.Vec.cross(verb.core.Vec.sub(r,o),verb.core.Vec.sub(t,o)))},verb.topo.Analyze.area=function(e){return Lambda.fold(verb.core.types.DoublyLinkedListExtensions.iter(e.f),function(e,r){return r+verb.topo.Analyze.faceArea(e)},0)},verb.topo.Analyze.faceArea=function(e){var r=e.normal();return Lambda.fold(verb.core.types.DoublyLinkedListExtensions.iter(e.l),function(e,t){return t+verb.topo.Analyze.loopArea(e,r)},0)},verb.topo.Analyze.loopArea=function(e,r){var t=e.e;if(t==t.nxt||t==t.nxt.nxt)return 0;var o=0;null==r&&(r=e.f.normal());var n=e.e,i=e.e.v.pt,s=n.nxt;do{var a=s.v.pt,c=s.nxt.v.pt;o+=verb.core.Vec.dot(r,verb.core.Vec.cross(verb.core.Vec.sub(a,i),verb.core.Vec.sub(c,i))),s=s.nxt}while(s.nxt!=n);return o/2},verb.topo.FacePosition={__ename__:!0,__constructs__:["On","AonBp","AonBm","BonAp","BonAm","AoutB","AinB","BoutA","BinA"]},verb.topo.FacePosition.On=["On",0],verb.topo.FacePosition.On.toString=$estr,verb.topo.FacePosition.On.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.AonBp=["AonBp",1],verb.topo.FacePosition.AonBp.toString=$estr,verb.topo.FacePosition.AonBp.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.AonBm=["AonBm",2],verb.topo.FacePosition.AonBm.toString=$estr,verb.topo.FacePosition.AonBm.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.BonAp=["BonAp",3],verb.topo.FacePosition.BonAp.toString=$estr,verb.topo.FacePosition.BonAp.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.BonAm=["BonAm",4],verb.topo.FacePosition.BonAm.toString=$estr,verb.topo.FacePosition.BonAm.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.AoutB=["AoutB",5],verb.topo.FacePosition.AoutB.toString=$estr,verb.topo.FacePosition.AoutB.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.AinB=["AinB",6],verb.topo.FacePosition.AinB.toString=$estr,verb.topo.FacePosition.AinB.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.BoutA=["BoutA",7],verb.topo.FacePosition.BoutA.toString=$estr,verb.topo.FacePosition.BoutA.__enum__=verb.topo.FacePosition,verb.topo.FacePosition.BinA=["BinA",8],verb.topo.FacePosition.BinA.toString=$estr,verb.topo.FacePosition.BinA.__enum__=verb.topo.FacePosition,verb.topo.BoolOp={__ename__:!0,__constructs__:["Union","Subtract","Intersect"]},verb.topo.BoolOp.Union=["Union",0],verb.topo.BoolOp.Union.toString=$estr,verb.topo.BoolOp.Union.__enum__=verb.topo.BoolOp,verb.topo.BoolOp.Subtract=["Subtract",1],verb.topo.BoolOp.Subtract.toString=$estr,verb.topo.BoolOp.Subtract.__enum__=verb.topo.BoolOp,verb.topo.BoolOp.Intersect=["Intersect",2],verb.topo.BoolOp.Intersect.toString=$estr,verb.topo.BoolOp.Intersect.__enum__=verb.topo.BoolOp,verb.topo.SectorIntersection=function(){this.intersect=!0},verb.topo.SectorIntersection.__name__=["verb","topo","SectorIntersection"],verb.topo.SectorDescription=function(e,r){this.i=e,this.list=r},verb.topo.SectorDescription.__name__=["verb","topo","SectorDescription"],verb.topo.SectorDescription.prototype={nxt:function(){var e=(this.i+1)%this.list.length;return this.list[e]},prv:function(){var e;return e=0==this.i?this.list.length-1:this.i-1,this.list[e]},updateNormal:function(){this.ref12=verb.core.Vec.cross(this.ref1,this.ref2)}},verb.topo.Boolean=$hx_exports.topo.Boolean=function(){},verb.topo.Boolean.__name__=["verb","topo","Boolean"],verb.topo.Boolean.union=function(e,r,t){var o=verb.topo.BoolOp.Union,n=verb.topo.Boolean.intersect(e,r,t),i=verb.topo.Boolean.classifyAllVertexFaceEvents(n.coplanarVerticesOfA,o,!0),s=verb.topo.Boolean.classifyAllVertexFaceEvents(n.coplanarVerticesOfB,o,!1),a=verb.topo.Boolean.classifyAllVertexVertexEvents(n.coincidentVertices,o),c=[],v=[];verb.topo.Boolean.insertAllVertexFaceEventNullEdges(n.coplanarVerticesOfA,i,o,!0,c,v),verb.topo.Boolean.insertAllVertexFaceEventNullEdges(n.coplanarVerticesOfB,s,o,!1,c,v),verb.topo.Boolean.insertAllVertexVertexEventNullEdges(a,c,v);var u=[],l=[];verb.topo.Boolean.connect(c,v,u,l)},verb.topo.Boolean.connect=function(e,r,t,o){verb.topo.Split.lexicographicalSort(e),verb.topo.Split.lexicographicalSort(r);for(var n,i,s=[],a=[],c=0,v=e.length;v>c;){var u=c++,l=e[u],p=r[u];if(null!=(n=verb.topo.Boolean.canJoin(l,p.opp,s,a))){haxe.Log.trace("joining 1!",{fileName:"Boolean.hx",lineNumber:165,className:"verb.topo.Boolean",methodName:"connect"});var b=n.item0,h=n.item1;haxe.Log.trace("connecting:",{fileName:"Boolean.hx",lineNumber:170,className:"verb.topo.Boolean",methodName:"connect",customParams:[b.id,l.id]}),verb.topo.Split.join(b,l),verb.topo.Split.isLoose(b.opp,s)||verb.topo.Split.cut(b,t),verb.topo.Split.join(h,p.opp),verb.topo.Split.isLoose(h.opp,a)||verb.topo.Split.cut(h,o)}if(null!=(i=verb.topo.Boolean.canJoin(l.opp,p,s,a))){haxe.Log.trace("joining 2!",{fileName:"Boolean.hx",lineNumber:186,className:"verb.topo.Boolean",methodName:"connect"});var f=i.item0,d=i.item1;haxe.Log.trace("connecting:",{fileName:"Boolean.hx",lineNumber:191,className:"verb.topo.Boolean",methodName:"connect",customParams:[f.id,d.id,p.id,l.opp.id]}),verb.topo.Split.join(f,l.opp),verb.topo.Split.isLoose(f.opp,s)||verb.topo.Split.cut(f,t),haxe.Log.trace("alright",{fileName:"Boolean.hx",lineNumber:198,className:"verb.topo.Boolean",methodName:"connect"}),verb.topo.Split.join(d,p),verb.topo.Split.isLoose(d.opp,a)||verb.topo.Split.cut(d,o)}null!=n&&null!=i&&(haxe.Log.trace("cutting",{fileName:"Boolean.hx",lineNumber:206,className:"verb.topo.Boolean",methodName:"connect"}),verb.topo.Split.cut(l,t),verb.topo.Split.cut(p,o))}},verb.topo.Boolean.canJoin=function(e,r,t,o){if(null!=e&&null!=r)for(var n=0,i=t.length;i>n;){var s=n++,a=verb.topo.Split.neighbor(e,t[s]),c=verb.topo.Split.neighbor(r,o[s]);if(a&&c){var v=t[s],u=o[s];return t.splice(s,1),o.splice(s,1),new verb.core.types.Pair(v,u)}}return null!=e&&t.push(e),null!=r&&o.push(r),null},verb.topo.Boolean.insertAllVertexFaceEventNullEdges=function(e,r,t,o,n,i){for(var s=0,a=e.length;a>s;){var c=s++;verb.topo.Boolean.insertVertexFaceEventNullEdges(e[c].item0,e[c].item1,r[c],t,o,n,i)}},verb.topo.Boolean.insertVertexFaceEventNullEdges=function(e,r,t,o,n,i,s){verb.topo.Boolean.insertVertexFaceEventNullEdgesCore(e,r,t,n,n?i:s),verb.topo.Boolean.insertNullEdgeIntoFace(e.pt.slice(),r,n?s:i)},verb.topo.Boolean.insertVertexFaceEventNullEdgesCore=function(e,r,t,o,n){var i=e.e.l.f.s,s=verb.topo.Boolean.nextOfClass(verb.topo.Boolean.above(o),t,0);if(-1!=s&&-1!=verb.topo.Boolean.nextOfClass(verb.topo.Boolean.below(o),t,0))for(var a=t[s].edge,c=a,v=a,u=t.length;;){for(;t[s].pos==verb.topo.Boolean.above(o);)v=t[s].edge,s=(s+1)%u;if(i.lmev(c,v.opp.nxt,c.v.pt.slice()),n.push(c.prv),s=verb.topo.Boolean.nextOfClass(verb.topo.Boolean.above(o),t,s),-1==s)break;if(c=t[s].edge,c==a)break}},verb.topo.Boolean.nextOfClass=function(e,r,t){for(var o=t,n=null;r.length>o;){if(r[o].pos==e){n=r[o];break}o++}return null!=n?o:-1},verb.topo.Boolean.insertNullEdgeIntoFace=function(e,r,t){var o=r.s.lmev(r.ol.e,r.ol.e,e);r.s.lkemr(o.e.prv),t.push(o.e)},verb.topo.Boolean.insertAllVertexVertexEventNullEdges=function(e,r,t){for(var o=0;e.length>o;){var n=e[o];++o,verb.topo.Boolean.insertVertexVertexEventNullEdges(n,r,t)}},verb.topo.Boolean.classifyAllVertexVertexEvents=function(e,r){for(var t=[],o=0;e.length>o;){var n=e[o];++o,t.push(verb.topo.Boolean.classifyVertexVertexEvent(n.item0,n.item1,r))}return t},verb.topo.Boolean.classifyVertexVertexEvent=function(e,r,t){var o=verb.topo.Boolean.classifyVertexVertexCore(e,r);return verb.topo.Boolean.reclassifyCoplanarSectorPairs(o,t),verb.topo.Boolean.reclassifyCoplanarSectorEdge(o,t),o},verb.topo.Boolean.insertVertexVertexEventNullEdges=function(e,r,t){for(var o=0,n=e.length;;){for(;!e[o].intersect;)if(++o==n)return;var i=null,s=null,a=null,c=null;for(e[o].s1a==verb.topo.Boolean.OUT?i=e[o].SectorA.edge:s=e[o].SectorA.edge,e[o].s1b==verb.topo.Boolean.IN?a=e[o++].SectorB.edge:c=e[o++].SectorB.edge;!e[o].intersect;)if(++o==n)return;if(e[o].s1a==verb.topo.Boolean.OUT?i=e[o].SectorA.edge:s=e[o].SectorA.edge,e[o].s1b==verb.topo.Boolean.IN?a=e[o++].SectorB.edge:c=e[o++].SectorB.edge,i==s?(verb.topo.Boolean.insertNullEdge(i,i,0,r,t),verb.topo.Boolean.insertNullEdge(a,c,1,r,t)):a==c?(verb.topo.Boolean.insertNullEdge(a,a,1,r,t),verb.topo.Boolean.insertNullEdge(s,i,0,r,t)):(verb.topo.Boolean.insertNullEdge(s,i,0,r,t),verb.topo.Boolean.insertNullEdge(a,c,1,r,t)),o==n)return}},verb.topo.Boolean.insertNullEdge=function(e,r,t,o,n){e.l.f.s.lmev(r,e,r.v.pt.slice()),0==t?o.push(r.prv):n.push(r.prv)},verb.topo.Boolean.classifyAllVertexFaceEvents=function(e,r,t){for(var o=[],n=0;e.length>n;){var i=e[n];++n,o.push(verb.topo.Boolean.classifyVertexFaceEvent(i.item0,i.item1,r,t))}return o},verb.topo.Boolean.classifyVertexFaceEvent=function(e,r,t,o){for(var n=verb.topo.Boolean.planeFromFace(r),i=[],s=0,a=e.halfEdges();a.length>s;){var c=a[s];++s,i.push({edge:c,pos:verb.topo.Boolean.asFacePosition(verb.topo.Split.classify(c,n),o)}),verb.topo.Split.wideSector(c)&&i.push({edge:c,pos:verb.topo.Boolean.asFacePosition(verb.topo.Split.classifyBisector(c,n),o)})}for(var v=i.length,u=0;v>u;){var l=u++,p=i[l];if(p.pos==verb.topo.FacePosition.On){var b=verb.topo.Boolean.reclassifyCoplanarEdge(p.edge,n,o);i[l].pos=b,i[(l+1)%v].pos=b}}for(var h=0;v>h;){var f=h++,d=i[f],m=d.pos[1];m>0&&5>m&&(d.pos=verb.topo.Boolean.reclassifyOnSector(d.pos,t))}for(var g=0;v>g;){var x=g++,_=i[x];if(_.pos==verb.topo.FacePosition.On){var y;y=0==x?v-1:x-1;var S=(x+1)%v,V=i[y].pos,E=i[S].pos;if(verb.topo.Boolean.isAbove(V)&&verb.topo.Boolean.isAbove(E))_.pos=verb.topo.Boolean.below(o);else if(verb.topo.Boolean.isBelow(V)&&verb.topo.Boolean.isAbove(E))_.pos=verb.topo.Boolean.below(o);else if(verb.topo.Boolean.isAbove(V)&&verb.topo.Boolean.isBelow(E))_.pos=verb.topo.Boolean.below(o);else{if(!verb.topo.Boolean.isBelow(V)||!verb.topo.Boolean.isBelow(E))throw new verb.core.types.Exception("Double On edge encountered!");_.pos=verb.topo.Boolean.above(o)}}}return i},verb.topo.Boolean.reclassifyCoplanarSectorEdge=function(e){for(var r=0;e.length>r;){var t=e[r];if(++r,0==t.s1a||0==t.s1b||0==t.s2a||0==t.s2b)throw new verb.core.types.Exception("Coplanar sector edge classification not yet implemented!")}},verb.topo.Boolean.reclassifyCoplanarSectorPairs=function(e,r){for(var t=0;e.length>t;){var o=e[t];if(++t,0==o.s1a&&0==o.s1b&&0==o.s2a&&0==o.s2b){var n=o.SectorA,i=o.SectorB,s=n.prv(),a=n.nxt(),c=i.prv();i.nxt();var v=n.edge,u=i.edge,l=0,p=0,b=1e-10>verb.core.Vec.norm(verb.core.Vec.sub(v.l.f.normal(),u.l.f.normal()));b?(l=r==verb.topo.BoolOp.Union?-1:1,p=r==verb.topo.BoolOp.Union?1:-1):(l=r==verb.topo.BoolOp.Union?1:-1,p=r==verb.topo.BoolOp.Union?1:-1);for(var h=0;e.length>h;){var f=e[h];++h,f.SectorA==s&&f.SectorB==i&&0!=f.s1a&&(f.s2a=l),f.SectorA==a&&f.SectorB==i&&0!=f.s2a&&(f.s1a=l),f.SectorA==n&&f.SectorB==c&&0!=f.s1b&&(f.s2b=p),f.s1a==f.s2a&&0!=f.s1a&&(f.intersect=!1),f.s1b==f.s2b&&0!=f.s1b&&(f.intersect=!1)}o.s1a=o.s2a=l,o.s1b=o.s2b=p,o.intersect=!1}}},verb.topo.Boolean.classifyVertexVertexCore=function(e,r){for(var t=[],o=verb.topo.Boolean.preprocessVertexSectors(e),n=verb.topo.Boolean.preprocessVertexSectors(r),i=0;o.length>i;){var s=o[i];++i;for(var a=0;n.length>a;){var c=n[a];if(++a,verb.topo.Boolean.sectorsIntersect(s,c)){var v=new verb.topo.SectorIntersection;t.push(v),v.SectorA=s,v.SectorB=c;var u=s.edge.l.f.normal(),l=c.edge.l.f.normal();v.s1a=verb.topo.Boolean.comp(verb.core.Vec.dot(l,s.ref1),0,1e-10),v.s2a=verb.topo.Boolean.comp(verb.core.Vec.dot(l,s.ref2),0,1e-10),v.s1b=verb.topo.Boolean.comp(verb.core.Vec.dot(u,c.ref1),0,1e-10),v.s2b=verb.topo.Boolean.comp(verb.core.Vec.dot(u,c.ref2),0,1e-10)}}}return t},verb.topo.Boolean.sectorsIntersect=function(e,r){var t=e.edge.l.f.normal(),o=r.edge.l.f.normal(),n=verb.core.Vec.cross(t,o);return 1e-10>verb.core.Vec.norm(n)?verb.topo.Boolean.sectorsOverlap(e,r):verb.topo.Boolean.withinSector(n,e)&&verb.topo.Boolean.withinSector(n,r)?!0:(n=verb.core.Vec.neg(n),verb.topo.Boolean.withinSector(n,e)&&verb.topo.Boolean.withinSector(n,r))},verb.topo.Boolean.sectorsOverlap=function(){throw new verb.core.types.Exception("sectorsOverlap not implemented!")},verb.topo.Boolean.withinSector=function(e,r){return verb.core.Vec.positiveAngleBetween(e,r.ref1,r.ref12)<verb.core.Vec.positiveAngleBetween(r.ref1,r.ref2,r.ref12)},verb.topo.Boolean.comp=function(e,r,t){return t>Math.abs(e-r)?0:e>r?1:-1},verb.topo.Boolean.preprocessVertexSectors=function(e,r){null==r&&(r=.001);for(var t=[],o=0,n=0,i=e.halfEdges();i.length>n;){var s=i[n];++n;var a=new verb.topo.SectorDescription(o++,t);if(t.push(a),a.edge=s,a.ref1=verb.core.Vec.sub(s.prv.v.pt,s.v.pt),a.ref2=verb.core.Vec.sub(s.nxt.v.pt,s.v.pt),a.updateNormal(),r>verb.core.Vec.norm(a.ref12)||verb.core.Vec.dot(s.l.f.normal(),a.ref12)>0){var c;if(r>verb.core.Vec.norm(a.ref12))throw new verb.core.types.Exception("Coincident consecutive edges encountered!");c=verb.core.Vec.neg(verb.core.Vec.add(a.ref1,a.ref2));var v=new verb.topo.SectorDescription(o++,t);t.push(v),v.edge=s,v.ref2=a.ref2.slice(),v.ref1=c,a.ref2=c,a.updateNormal(),v.updateNormal()}}return t},verb.topo.Boolean.above=function(e){return e?verb.topo.FacePosition.AoutB:verb.topo.FacePosition.BoutA},verb.topo.Boolean.below=function(e){return e?verb.topo.FacePosition.AinB:verb.topo.FacePosition.BinA},verb.topo.Boolean.isAbove=function(e){return e==verb.topo.FacePosition.AoutB||e==verb.topo.FacePosition.BoutA},verb.topo.Boolean.isBelow=function(e){return e==verb.topo.FacePosition.AinB||e==verb.topo.FacePosition.BinA},verb.topo.Boolean.planeFromFace=function(e){return{o:e.l.e.v.pt,n:e.normal()}},verb.topo.Boolean.reclassifyCoplanarEdge=function(e,r,t){var o=e.l.f.normal(),n=verb.core.Vec.dot(o,r.n),i=1.0000000000000001e-20;return i>Math.abs(n-1)?t?verb.topo.FacePosition.AonBp:verb.topo.FacePosition.BonAp:i>Math.abs(n+1)?t?verb.topo.FacePosition.AonBm:verb.topo.FacePosition.BonAm:verb.topo.FacePosition.On},verb.topo.Boolean.asFacePosition=function(e,r){return e==verb.topo.PlanePosition.Above?r?verb.topo.FacePosition.AoutB:verb.topo.FacePosition.BoutA:e==verb.topo.PlanePosition.Below?r?verb.topo.FacePosition.AinB:verb.topo.FacePosition.BinA:verb.topo.FacePosition.On},verb.topo.Boolean.reclassifyOnSector=function(e,r){return verb.topo.Boolean.boolOnSectorMap[r[1]][e[1]]},verb.topo.Boolean.intersect=function(e,r,t){var o=verb.topo.Boolean.splitAllEdges(e,r,t),n=verb.topo.Boolean.splitEdgesByVertices(e,r,t),i=verb.topo.Boolean.splitEdgesByVertices(r,e,t),s=verb.topo.Boolean.splitEdgesWithFaces(e,r,t),a=verb.topo.Boolean.splitEdgesWithFaces(r,e,t);return{coincidentVertices:verb.topo.Boolean.getCoincidentVertices(e,r,o.concat(n).concat(i),t),coplanarVerticesOfA:verb.topo.Boolean.getCoplanarVertices(e,r,s,t),coplanarVerticesOfB:verb.topo.Boolean.getCoplanarVertices(r,e,a,t)}},verb.topo.Boolean.splitAllEdges=function(e,r,t){for(var o=[],n=0,i=e.edges();i.length>n;){var s=i[n];++n;for(var a=0,c=r.edges();c.length>a;){var v=c[a];++a;var u=verb.topo.Boolean.splitEdges(s.item0,v.item0,t);null!=u&&o.push(u)}}return o},verb.topo.Boolean.splitEdges=function(e,r,t){var o=verb.core.Intersect.segments(e.v.pt,e.nxt.v.pt,r.v.pt,r.nxt.v.pt,t);return null==o?null:o.u0>.9999999999||1e-10>o.u0||o.u1>.9999999999||1e-10>o.u1?null:new verb.core.types.Pair(verb.topo.Boolean.splitEdge(e,o.point0),verb.topo.Boolean.splitEdge(r,o.point1))},verb.topo.Boolean.splitEdgeByVertex=function(e,r,t){var o=verb.core.Trig.segmentClosestPoint(r.pt,e.v.pt,e.nxt.v.pt,0,1),n=verb.core.Vec.distSquared(r.pt,o.pt);return n>t*t?null:o.u>.9999999999||1e-10>o.u?null:verb.topo.Boolean.splitEdge(e,o.pt)},verb.topo.Boolean.splitEdge=function(e,r){var t=e.l.f.s;return t.lmev(e,e.opp.nxt,r)},verb.topo.Boolean.isPointInFace=function(e,r,t){var o=r.normal(),n=r.l.e.v.pt;if(!verb.core.Trig.isPointInPlane(e,{n:o,o:n},t))return!1;var i=verb.topo.Boolean.isPointInPolygon(e,r.ol.points(),o);if(!i)return i;for(var s=0,a=r.rings();a.length>s;){var c=a[s];if(++s,verb.topo.Boolean.isPointInPolygon(e,c.points(),o))return!1}return!0},verb.topo.Boolean.isPointInPolygon=function(e,r,t){for(var o=r.length,n=0,i=0;o>i;){var s=i++,a=verb.core.Vec.sub(r[s],e),c=verb.core.Vec.sub(r[(s+1)%o],e);n+=verb.core.Vec.positiveAngleBetween(a,c,t)}return Math.abs(n)>Math.PI},verb.topo.Boolean.splitEdgesByVertices=function(e,r,t){for(var o=[],n=0,i=e.edges();i.length>n;){var s=i[n];++n;for(var a=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(r.v))();a.hasNext();){var c=a.next(),v=verb.topo.Boolean.splitEdgeByVertex(s.item0,c,t);null!=v&&o.push(new verb.core.types.Pair(v,c))}}return o},verb.topo.Boolean.getCoincidentVertices=function(e,r,t,o){for(var n=new haxe.ds.IntMap,i=0;t.length>i;){var s=t[i];++i,n.set(s.item0.id,s.item0),n.set(s.item1.id,s.item1)}for(var a=o*o,c=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(e.v))();c.hasNext();){var v=c.next();if(!n.exists(v.id))for(var u=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(r.v))();u.hasNext();){var l=u.next();n.exists(l.id)||a>verb.core.Vec.distSquared(v.pt,l.pt)&&t.push(new verb.core.types.Pair(v,l))}}return t},verb.topo.Boolean.splitEdgesWithFaces=function(e,r,t){for(var o=[],n=0,i=e.edges();i.length>n;){var s=i[n];++n;for(var a=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(r.f))();a.hasNext();){var c=a.next(),v=verb.topo.Boolean.splitEdgeWithFace(s.item0,c,t);null!=v&&o.push(new verb.core.types.Pair(v,c))}}return o},verb.topo.Boolean.splitEdgeWithFace=function(e,r,t){var o=r.normal(),n=r.ol.e.v.pt,i=verb.core.Intersect.segmentAndPlane(e.v.pt,e.nxt.v.pt,n,o);if(null==i)return null;if(i.p>.9999999999||1e-10>i.p)return null;var s=verb.core.Vec.lerp(i.p,e.nxt.v.pt,e.v.pt);return verb.topo.Boolean.isPointInFace(s,r,t)?verb.topo.Boolean.splitEdge(e,s):null},verb.topo.Boolean.getCoplanarVertices=function(e,r,t,o){for(var n=new haxe.ds.IntMap,i=0;t.length>i;){var s=t[i];++i,n.set(s.item0.id,s.item0)}for(var a=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(e.v))();a.hasNext();){var c=a.next();if(!n.exists(c.id))for(var v=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(r.f))();v.hasNext();){var u=v.next();verb.topo.Boolean.isPointInFace(c.pt,u,o)&&t.push(new verb.core.types.Pair(c,u))}}return t},verb.topo.Topo=function(){this.id=verb.topo.Topo.counter++},verb.topo.Topo.__name__=["verb","topo","Topo"],verb.topo.Face=$hx_exports.topo.Face=function(e){verb.topo.Topo.call(this),this.s=e},verb.topo.Face.__name__=["verb","topo","Face"],verb.topo.Face.__interfaces__=[verb.core.types.IDoublyLinkedList],verb.topo.Face.__super__=verb.topo.Topo,verb.topo.Face.prototype=$extend(verb.topo.Topo.prototype,{loops:function(){return Lambda.array(verb.core.types.DoublyLinkedListExtensions.iter(this.l))},rings:function(){for(var e=[],r=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(this.l))();r.hasNext();){var t=r.next();t!=this.ol&&e.push(t)}return e},addLoop:function(e){return null==e&&(e=new verb.topo.Loop(this)),null==this.ol&&(this.ol=e),this.l=verb.core.types.DoublyLinkedListExtensions.push(this.l,e)},delLoop:function(e){if(e==this.ol)throw new verb.core.types.Exception("Cannot delete outer loop!");this.l=verb.core.types.DoublyLinkedListExtensions.kill(this.l,e)},neighbors:function(){var e=new haxe.ds.IntMap;e.set(this.id,this);for(var r=[],t=this.halfEdges(),o=0;t.length>o;){var n=t[o];if(++o,null!=n.opp){var i=n.opp.l.f;e.exists(i.id)||(e.set(i.id,i),r.push(i))}}return r},halfEdges:function(){return Lambda.fold(this.loops(),function(e,r){return r.concat(e.halfEdges())},[])},tessellate:function(){var e=new verb.topo.Tess2Options;return e.contours=this.loops().map(function(e){return e.coords()}).filter(function(e){return e.length>3}),e.windingRule=verb.topo.Tess2.WINDING_POSITIVE,e.elementType=verb.topo.Tess2.POLYGONS,e.polySize=3,e.normal=this.normal(),e.vertexSize=3,verb.topo.Tess2.tessellate(e)},normal:function(){for(var e=[0,0,0],r=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(this.ol.e))();r.hasNext();){var t=r.next(),o=t.v.pt,n=t.nxt.v.pt,i=t.nxt.nxt.v.pt,s=verb.core.Vec.sub(o,n),a=verb.core.Vec.sub(i,n),c=verb.core.Vec.cross(a,s);verb.core.Vec.normSquared(c)>1e-10&&(e=verb.core.Vec.add(e,c))}return verb.core.Vec.normalized(e)}}),verb.topo.HalfEdge=$hx_exports.topo.HalfEdge=function(e,r){verb.topo.Topo.call(this),this.v=r,this.v.e=this,this.l=e},verb.topo.HalfEdge.__name__=["verb","topo","HalfEdge"],verb.topo.HalfEdge.__interfaces__=[verb.core.types.IDoublyLinkedList],verb.topo.HalfEdge.__super__=verb.topo.Topo,verb.topo.HalfEdge.prototype=$extend(verb.topo.Topo.prototype,{mate:function(e){return null==e?this:(this.opp=e,e.opp=this,this)}}),verb.topo.Loop=$hx_exports.topo.Loop=function(e){verb.topo.Topo.call(this),this.f=e},verb.topo.Loop.__name__=["verb","topo","Loop"],verb.topo.Loop.__interfaces__=[verb.core.types.IDoublyLinkedList],verb.topo.Loop.__super__=verb.topo.Topo,verb.topo.Loop.prototype=$extend(verb.topo.Topo.prototype,{halfEdges:function(){return Lambda.array(verb.core.types.DoublyLinkedListExtensions.iter(this.e))
},vertices:function(){return this.halfEdges().map(function(e){return e.v})},coords:function(){return Lambda.fold(this.vertices(),function(e,r){return r.concat(e.pt)},[])},points:function(){return this.vertices().map(function(e){return e.pt})},addHalfEdge:function(e,r,t){if(null!=r&&r.l!=this)throw new verb.core.types.Exception("Next HalfEdge is not part of same Loop!");if(null!=r&&null==r.opp&&null==t)return e.e=r,r.v=e,r;null!=r&&(this.e=r);var o=new verb.topo.HalfEdge(this,e);return o.mate(t),this.e=verb.core.types.DoublyLinkedListExtensions.push(this.e,o)},delHalfEdge:function(e){if(e.l!=this)throw new verb.core.types.Exception("HalfEdge is not part of this Loop!");return e.nxt==e?(e.opp=null,this.e=e,e.v.e=e,this):(null!=e.opp.nxt&&(e.v.e=e.opp.nxt),this.e=verb.core.types.DoublyLinkedListExtensions.kill(this.e,e),this)}}),verb.topo.Make=$hx_exports.topo.Make=function(){},verb.topo.Make.__name__=["verb","topo","Make"],verb.topo.Make.lamina=function(e){for(var r=verb.topo.Solid.mvfs(e[0]),t=e[0],o=r.f.l.e,n=r.f.l.e,i=0;e.length>i;){var s=e[i];if(++i,s!=t){var a=r.lmev(n,n,s);n=a.e}}return r.lmef(o.nxt,n),r},verb.topo.Make.extrusion=function(e,r){if(3>e.length)throw new verb.core.types.Exception("More than three points are required to define a polygon!");var t=verb.topo.Make.lamina(e),o=t.f.l.halfEdges().map(function(e){return t.lmev(e,e,verb.core.Vec.add(e.v.pt,r))});return o.map(function(e){return e.e}).map(function(e){var r=t.lmef(e,e.nxt.nxt.nxt);return r}),t},verb.topo.Solid=$hx_exports.topo.Solid=function(){verb.topo.Topo.call(this)},verb.topo.Solid.__name__=["verb","topo","Solid"],verb.topo.Solid.mvfs=function(e){var r=new verb.topo.Solid,t=r.addFace(),o=t.addLoop();return o.addHalfEdge(r.addVertex(e)),r},verb.topo.Solid.__super__=verb.topo.Topo,verb.topo.Solid.prototype=$extend(verb.topo.Topo.prototype,{lmev:function(e,r,t){for(var o=this.addVertex(t),n=e.v,i=e;i!=r;)i.v=o,i=i.opp.nxt;var s=r.l.addHalfEdge(o,r);return e.l.addHalfEdge(n,e==r?s:e,s),o},lmef:function(e,r){if(e.l!=r.l)throw new verb.core.types.Exception("Both HalfEdge's must be part of the same loop!");for(var t=this.addFace(),o=t.addLoop(),n=r.l,i=e;i!=r;)i.l=o,i=i.nxt;r.prv.nxt=e,e.prv.nxt=r;var s=r.prv;r.prv=e.prv,e.prv=s;var a=o.addHalfEdge(r.v,e);return n.addHalfEdge(e.v,r,a),t},lkemr:function(e){var r=e.opp,t=e.l,o=t.f.addLoop(),n=e.nxt,i=r.nxt;i.v.e=i,n.v.e=n,e.prv.nxt=r.nxt,r.nxt.prv=e.prv,t.e=r.nxt,r.nxt=e,e.prv=r;var s=e;do s.l=o,s=s.nxt;while(s!=e);return o.e=r,o.delHalfEdge(e),o.delHalfEdge(r),o},lkvfs:function(e){var r=e.v;return this.delVertex(r),this.delFace(e.l.f),this},lkev:function(e){if(e.nxt==e)throw new verb.core.types.Exception("Cannot lkev the base case!");var r=e.nxt.v,t=e.nxt;do t.v=e.v;while((t.opp.nxt=t)!=e.nxt);var o=e.opp;return e.l.delHalfEdge(e),o.l.delHalfEdge(o),this.delVertex(r)},lkef:function(e){if(null==e.opp)throw new verb.core.types.Exception("Cannot kill base case!");if(e.opp.l.f==e.l.f)throw new verb.core.types.Exception("Edge does not traverse two distinct faces!");e.l;var r=e.l.f,t=e.opp,o=t.l,n=t.l.f,i=e;do i.l=o;while((i=i.nxt)!=e);var s=e.prv,a=e.nxt,c=t.prv,v=t.nxt;s.nxt=v,v.prv=s,c.nxt=a,a.prv=c,e.v.e=v,t.v.e=a,o.e==t&&(o.e=c);for(var u=0,l=r.rings();l.length>u;){var p=l[u];++u,p.f=n,verb.core.types.DoublyLinkedListExtensions.push(n.l,p)}return this.delFace(r),this},lmekr:function(e,r){if(e.l==r.l)throw new verb.core.types.Exception("HalfEdges are not from different loops!");if(e.l.f!=r.l.f)throw new verb.core.types.Exception("HalfEdges must be part of the same face!");var t=r.l;t.f.delLoop(t);for(var o=e.l,n=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(r))();n.hasNext();){var i=n.next();i.l=o}var s;s=e.nxt==e?e:new verb.topo.HalfEdge(o,e.v);var a;return a=r.nxt==r?r:new verb.topo.HalfEdge(o,r.v),s.mate(a),e.prv.nxt=s,r.prv.nxt=a,s.prv=e.prv,a.prv=r.prv,r.prv=s,e.prv=a,s.nxt=r,a.nxt=e,s},lkfmrh:function(e,r){if(e.rings().length>0)throw new verb.core.types.Exception("Cannot insert a face with rings as a ring of another face!");return this.delFace(e),e.ol.f=r,verb.core.types.DoublyLinkedListExtensions.push(r.l,e.ol),e.ol},lmfkrh:function(e){var r=e.f;r.delLoop(e);var t=this.addFace();return t.addLoop(e),e.f=t,t},addFace:function(){return this.f=verb.core.types.DoublyLinkedListExtensions.push(this.f,new verb.topo.Face(this))},delFace:function(e){if(e.s!=this)throw new verb.core.types.Exception("Face is not part of this Solid!");return this.f=verb.core.types.DoublyLinkedListExtensions.kill(this.f,e),this},addVertex:function(e){return this.v=verb.core.types.DoublyLinkedListExtensions.push(this.v,new verb.topo.Vertex(e))},delVertex:function(e){if(e.e.l.f.s!=this)throw new verb.core.types.Exception("Face is not part of this Solid!");return this.v=verb.core.types.DoublyLinkedListExtensions.kill(this.v,e),this},vertices:function(){return Lambda.array(verb.core.types.DoublyLinkedListExtensions.iter(this.v))},faces:function(){return Lambda.array(verb.core.types.DoublyLinkedListExtensions.iter(this.f))},loops:function(){return Lambda.fold(this.faces(),function(e,r){return r.concat(e.loops())},[])},halfEdges:function(){return Lambda.fold(this.loops(),function(e,r){return r.concat(e.halfEdges())},[])},edges:function(){for(var e=new haxe.ds.IntMap,r=[],t=0,o=this.halfEdges();o.length>t;){var n=o[t];++t,null==n.opp||e.exists(n.id)||e.exists(n.opp.id)||(e.set(n.id,n),e.set(n.opp.id,n.opp),r.push(new verb.core.types.Pair(n,n.opp)))}return r},print:function(){return"Solid ("+this.vertices().length+" Vertices, "+this.faces().length+" Faces, "+this.loops().length+" Loops, "+this.halfEdges().length+" HalfEdges"+")"}}),verb.topo.PlanePosition={__ename__:!0,__constructs__:["On","Above","Below"]},verb.topo.PlanePosition.On=["On",0],verb.topo.PlanePosition.On.toString=$estr,verb.topo.PlanePosition.On.__enum__=verb.topo.PlanePosition,verb.topo.PlanePosition.Above=["Above",1],verb.topo.PlanePosition.Above.toString=$estr,verb.topo.PlanePosition.Above.__enum__=verb.topo.PlanePosition,verb.topo.PlanePosition.Below=["Below",2],verb.topo.PlanePosition.Below.toString=$estr,verb.topo.PlanePosition.Below.__enum__=verb.topo.PlanePosition,verb.topo.Split=$hx_exports.topo.Split=function(){},verb.topo.Split.__name__=["verb","topo","Split"],verb.topo.Split.solidByPlane=function(e,r){for(var t,o=verb.topo.Split.intersect(e,r),n=[],i=0;o.length>i;){var s=o[i];++i,n.push(verb.topo.Split.isCrossingEdge(s.item1)?verb.topo.Split.splitEdge(s.item0,s.item1).v:s.item0.v)}t=n;for(var a=[],c=0;t.length>c;){var v=t[c];++c,verb.topo.Split.insertNullEdges(v,verb.topo.Split.classifyVertex(v,r),a)}if(0==a.length)return null;var u=[];verb.topo.Split.connect(a,u);var l=new verb.topo.Solid,p=new verb.topo.Solid;return verb.topo.Split.close(u,l,p),new verb.core.types.Pair(p,l)},verb.topo.Split.close=function(e,r,t){for(var o,n=e[0].s,i=[],s=0;e.length>s;){var a=e[s];++s,i.push(n.lmfkrh(a.l))}o=i;for(var c=0;e.length>c;){var v=e[c];++c,verb.topo.Split.moveFace(v,r)}for(var u=0;o.length>u;){var l=o[u];++u,verb.topo.Split.moveFace(l,t)}verb.topo.Split.cleanup(r,n),verb.topo.Split.cleanup(t,n)},verb.topo.Split.connect=function(e,r){verb.topo.Split.lexicographicalSort(e);for(var t,o,n=[],i=0;e.length>i;){var s=e[i];++i,null!=(t=verb.topo.Split.canJoin(s,n))&&(verb.topo.Split.join(t,s),verb.topo.Split.isLoose(t.opp,n)||verb.topo.Split.cut(t,r)),null!=(o=verb.topo.Split.canJoin(s.opp,n))&&(verb.topo.Split.join(o,s.opp),verb.topo.Split.isLoose(o.opp,n)||verb.topo.Split.cut(o,r)),null!=t&&null!=o&&verb.topo.Split.cut(s,r)}},verb.topo.Split.insertNullEdges=function(e,r,t){var o=e.e.l.f.s,n=verb.topo.Split.nextOfClass(verb.topo.PlanePosition.Above,r,0);if(-1!=n&&-1!=verb.topo.Split.nextOfClass(verb.topo.PlanePosition.Below,r,0))for(var i=r[n].edge,s=i,a=i,c=r.length;;){for(;r[n].pos==verb.topo.PlanePosition.Above;)a=r[n].edge,n=(n+1)%c;if(o.lmev(s,a.opp.nxt,s.v.pt.slice()),t.push(s.prv),n=verb.topo.Split.nextOfClass(verb.topo.PlanePosition.Above,r,n),-1==n)break;if(s=r[n].edge,s==i)break}},verb.topo.Split.classifyVertex=function(e,r){for(var t=[],o=0,n=e.halfEdges();n.length>o;){var i=n[o];++o,t.push({edge:i,pos:verb.topo.Split.classify(i,r)}),verb.topo.Split.wideSector(i)&&t.push({edge:i,pos:verb.topo.Split.classifyBisector(i,r)})}for(var s=t.length,a=0;s>a;){var c=a++,v=t[c];if(v.pos==verb.topo.PlanePosition.On){var u=verb.topo.Split.reclassifyCoplanarSector(v.edge,r);t[c].pos=u,t[(c+1)%s].pos=u}}for(var l=0;s>l;){var p=l++,b=t[p];if(b.pos==verb.topo.PlanePosition.On){var h;h=0==p?s-1:p-1;var f=(p+1)%s,d=t[h].pos,m=t[f].pos;if(d==verb.topo.PlanePosition.Above&&m==verb.topo.PlanePosition.Above)b.pos=verb.topo.PlanePosition.Below;else if(d==verb.topo.PlanePosition.Below&&m==verb.topo.PlanePosition.Above)b.pos=verb.topo.PlanePosition.Below;else if(d==verb.topo.PlanePosition.Above&&m==verb.topo.PlanePosition.Below)b.pos=verb.topo.PlanePosition.Below;else{if(d!=verb.topo.PlanePosition.Below||m!=verb.topo.PlanePosition.Below)throw new verb.core.types.Exception("Double On edge encountered!");b.pos=verb.topo.PlanePosition.Above}}}return t},verb.topo.Split.moveFace=function(e,r){if(e.s!=r){e.s.f=verb.core.types.DoublyLinkedListExtensions.kill(e.s.f,e),r.f=verb.core.types.DoublyLinkedListExtensions.push(r.f,e),e.s=r;for(var t=0,o=e.neighbors();o.length>t;){var n=o[t];++t,verb.topo.Split.moveFace(n,r)}}},verb.topo.Split.cleanup=function(e,r){for(var t=new haxe.ds.IntMap,o=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(e.f))();o.hasNext();)for(var n=o.next(),i=$iterator(verb.core.types.DoublyLinkedListExtensions.iter(n.l))();i.hasNext();)for(var s=i.next(),a=0,c=s.vertices();c.length>a;){var v=c[a];++a,t.exists(v.id)||(t.set(v.id,v),r.v=verb.core.types.DoublyLinkedListExtensions.kill(r.v,v),e.v=verb.core.types.DoublyLinkedListExtensions.push(e.v,v))}},verb.topo.Split.canJoin=function(e,r){for(var t=0,o=r.length;o>t;){var n=t++;if(verb.topo.Split.neighbor(e,r[n])){var i=r[n];return r.splice(n,1),i}}return r.push(e),null},verb.topo.Split.neighbor=function(e,r){return e.l.f==r.l.f},verb.topo.Split.isLoose=function(e,r){return-1!=HxOverrides.indexOf(r,e,0)},verb.topo.Split.join=function(e,r){var t=e.l.f,o=null,n=e.l.f.s;e.l==r.l?e.prv.prv!=r&&(o=n.lmef(e,r.nxt)):n.lmekr(e,r.nxt),e.nxt.nxt!=r&&(n.lmef(r,e.nxt),null!=o&&t.l.nxt!=t.l&&haxe.Log.trace("PANIC!",{fileName:"Split.hx",lineNumber:285,className:"verb.topo.Split",methodName:"join"}))},verb.topo.Split.cut=function(e,r){e.l==e.opp.l?(r.push(e.l.f),e.l.f.s.lkemr(e)):e.l.f.s.lkef(e)},verb.topo.Split.lexicographicalSort=function(e){e.sort(function(e,r){var t=e.v.pt,o=r.v.pt;return t[0]<o[0]?-1:t[0]>o[0]?1:t[1]<o[1]?-1:t[1]>o[1]?1:t[2]<o[2]?-1:t[2]>o[2]?1:0})},verb.topo.Split.nextOfClass=function(e,r,t){for(var o=t,n=null;r.length>o;){if(r[o].pos==e){n=r[o];break}o++}return null!=n?o:-1},verb.topo.Split.wideSector=function(e){var r=e.l.f.normal(),t=verb.core.Vec.normalized(verb.core.Vec.sub(e.nxt.v.pt,e.v.pt)),o=verb.core.Vec.normalized(verb.core.Vec.sub(e.prv.v.pt,e.v.pt));return verb.core.Vec.signedAngleBetween(t,o,r)>Math.PI},verb.topo.Split.classifyBisector=function(e,r){return verb.topo.Split.classifyPoint(verb.core.Vec.mul(.5,verb.core.Vec.add(e.nxt.v.pt,e.prv.v.pt)),r)},verb.topo.Split.reclassifyCoplanarSector=function(e,r){var t=e.l.f.normal(),o=e.opp.l.f.normal(),n=verb.core.Vec.dot(t,r.n),i=verb.core.Vec.dot(o,r.n),s=1.0000000000000001e-20;return s>Math.abs(n-1)||s>Math.abs(i-1)?verb.topo.PlanePosition.Below:s>Math.abs(n+1)||s>Math.abs(i+1)?verb.topo.PlanePosition.Above:verb.topo.PlanePosition.On},verb.topo.Split.classify=function(e,r){return verb.topo.Split.classifyPoint(e.nxt.v.pt,r)},verb.topo.Split.classifyPoint=function(e,r){var t=verb.core.Vec.dot(verb.core.Vec.sub(e,r.o),r.n);return 1e-10>Math.abs(t)?verb.topo.PlanePosition.On:t>0?verb.topo.PlanePosition.Above:verb.topo.PlanePosition.Below},verb.topo.Split.intersect=function(e,r){for(var t=[],o=0,n=e.edges();n.length>o;){var i=n[o];++o;var s=i.item0,a=verb.core.Intersect.segmentAndPlane(s.v.pt,s.nxt.v.pt,r.o,r.n);null!=a&&(a.p>.9999999999&&(a.p=0,s=s.nxt),t.push(new verb.core.types.Pair(s,a.p)))}return t},verb.topo.Split.splitEdge=function(e,r){var t=e.l.f.s,o=verb.topo.Split.pointOnHalfEdge(e,r),n=o.slice(),i=t.lmev(e,e.opp.nxt,n);return i.e},verb.topo.Split.isCrossingEdge=function(e){return.9999999999>e&&e>1e-10},verb.topo.Split.pointOnHalfEdge=function(e,r){return verb.core.Vec.lerp(r,e.nxt.v.pt,e.v.pt)},verb.topo.Split.intersectionPoints=function(e,r){for(var t=[],o=0,n=verb.topo.Split.intersect(e,r);n.length>o;){var i=n[o];++o,t.push(verb.topo.Split.pointOnHalfEdge(i.item0,i.item1))}return t},verb.topo.Tess2Options=$hx_exports.topo.Tess2Options=function(){this.contours=[],this.debug=!1,this.normal=[0,0,1],this.vertexSize=2,this.polySize=3,this.elementType=verb.topo.Tess2.POLYGONS,this.windingRule=verb.topo.Tess2.WINDING_ODD},verb.topo.Tess2Options.__name__=["verb","topo","Tess2Options"],verb.topo.Tess2Result=$hx_exports.topo.Tess2Result=function(e,r,t,o,n,i){this.vertices=e,this.vertexIndices=r,this.vertexCount=t,this.elements=o,this.elementCount=n,this.mesh=i},verb.topo.Tess2Result.__name__=["verb","topo","Tess2Result"],verb.topo.Tess2=$hx_exports.topo.Tess2=function(){},verb.topo.Tess2.__name__=["verb","topo","Tess2"],verb.topo.Tess2.tessellate=function(e){for(var r=new verb.topo.Tessellator,t=0,o=e.contours.length;o>t;){var n=t++;r.addContour(e.vertexSize,e.contours[n])}return r.tessellate(e.windingRule,e.elementType,e.polySize,e.vertexSize,e.normal),new verb.topo.Tess2Result(r.vertices,r.vertexIndices,r.vertexCount,r.elements,r.elementCount,e.debug?r.mesh:null)},verb.topo.Tess2.assert=function(e){if(!e)throw"Assertion Failed!"},verb.topo.TESSvertex=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},verb.topo.TESSvertex.__name__=["verb","topo","TESSvertex"],verb.topo.TESSface=function(){this.next=null,this.prev=null,this.anEdge=null,this.n=0,this.marked=!1,this.inside=!1},verb.topo.TESSface.__name__=["verb","topo","TESSface"],verb.topo.TESShalfEdge=function(e){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=e},verb.topo.TESShalfEdge.__name__=["verb","topo","TESShalfEdge"],verb.topo.TESShalfEdge.prototype={getRface:function(){return this.Sym.Lface},setRface:function(e){this.Sym.Lface=e},getDst:function(){return this.Sym.Org},setDst:function(e){this.Sym.Org=e},getOprev:function(){return this.Sym.Lnext},setOprev:function(e){this.Sym.Lnext=e},getLprev:function(){return this.Onext.Sym},setLprev:function(e){this.Onext.Sym=e},getDprev:function(){return this.Lnext.Sym},setDprev:function(e){this.Lnext.Sym=e},getRprev:function(){return this.Sym.Onext},setRprev:function(e){this.Sym.Onext=e},getDnext:function(){return this.Sym.Onext.Sym},setDnext:function(e){this.Sym.Onext.Sym=e},getRnext:function(){return this.Sym.Lnext.Sym},setRnext:function(e){this.Sym.Lnext.Sym=e}},verb.topo.TESSmesh=function(){var e=new verb.topo.TESSvertex,r=new verb.topo.TESSface,t=new verb.topo.TESShalfEdge(0),o=new verb.topo.TESShalfEdge(1);e.next=e.prev=e,e.anEdge=null,r.next=r.prev=r,r.anEdge=null,r.marked=!1,r.inside=!1,t.next=t,t.Sym=o,t.Onext=null,t.Lnext=null,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,o.next=o,o.Sym=t,o.Onext=null,o.Lnext=null,o.Org=null,o.Lface=null,o.winding=0,o.activeRegion=null,this.vHead=e,this.fHead=r,this.eHead=t,this.eHeadSym=o},verb.topo.TESSmesh.__name__=["verb","topo","TESSmesh"],verb.topo.TESSmesh.prototype={makeEdge_:function(e){var r=new verb.topo.TESShalfEdge(0),t=new verb.topo.TESShalfEdge(1);e.Sym.side<e.side&&(e=e.Sym);var o=e.Sym.next;return t.next=o,o.Sym.next=r,r.next=e,e.Sym.next=t,r.Sym=t,r.Onext=r,r.Lnext=t,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,t.Sym=r,t.Onext=t,t.Lnext=r,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,r},splice_:function(e,r){var t=e.Onext,o=r.Onext;t.Sym.Lnext=r,o.Sym.Lnext=e,e.Onext=o,r.Onext=t},makeVertex_:function(e,r,t){var o=e;verb.topo.Tess2.assert(null!=o);var n=t.prev;o.prev=n,n.next=o,o.next=t,t.prev=o,o.anEdge=r;var i=r;do i.Org=o,i=i.Onext;while(i!=r)},makeFace_:function(e,r,t){var o=e;verb.topo.Tess2.assert(null!=o);var n=t.prev;o.prev=n,n.next=o,o.next=t,t.prev=o,o.anEdge=r,o.marked=!1,o.inside=t.inside;var i=r;do i.Lface=o,i=i.Lnext;while(i!=r)},killEdge_:function(e){e.Sym.side<e.side&&(e=e.Sym);var r=e.next,t=e.Sym.next;r.Sym.next=t,t.Sym.next=r},killVertex_:function(e,r){var t=e.anEdge,o=t;do o.Org=r,o=o.Onext;while(o!=t);var n=e.prev,i=e.next;i.prev=n,n.next=i},killFace_:function(e,r){var t=e.anEdge,o=t;do o.Lface=r,o=o.Lnext;while(o!=t);var n=e.prev,i=e.next;i.prev=n,n.next=i},makeEdge:function(){var e=new verb.topo.TESSvertex,r=new verb.topo.TESSvertex,t=new verb.topo.TESSface,o=this.makeEdge_(this.eHead);return this.makeVertex_(e,o,this.vHead),this.makeVertex_(r,o.Sym,this.vHead),this.makeFace_(t,o,this.fHead),o},splice:function(e,r){var t=!1,o=!1;if(e!=r){if(r.Org!=e.Org&&(o=!0,this.killVertex_(r.Org,e.Org)),r.Lface!=e.Lface&&(t=!0,this.killFace_(r.Lface,e.Lface)),this.splice_(r,e),!o){var n=new verb.topo.TESSvertex;this.makeVertex_(n,r,e.Org),e.Org.anEdge=e}if(!t){var i=new verb.topo.TESSface;this.makeFace_(i,r,e.Lface),e.Lface.anEdge=e}}},"delete":function(e){var r=e.Sym,t=!1;if(e.Lface!=e.getRface()&&(t=!0,this.killFace_(e.Lface,e.getRface())),e.Onext==e)this.killVertex_(e.Org,null);else if(e.getRface().anEdge=e.getOprev(),e.Org.anEdge=e.Onext,this.splice_(e,e.getOprev()),!t){var o=new verb.topo.TESSface;this.makeFace_(o,e,e.Lface)}r.Onext==r?(this.killVertex_(r.Org,null),this.killFace_(r.Lface,null)):(e.Lface.anEdge=r.getOprev(),r.Org.anEdge=r.Onext,this.splice_(r,r.getOprev())),this.killEdge_(e)},addEdgeVertex:function(e){var r=this.makeEdge_(e),t=r.Sym;this.splice_(r,e.Lnext),r.Org=e.getDst();var o=new verb.topo.TESSvertex;return this.makeVertex_(o,t,r.Org),r.Lface=t.Lface=e.Lface,r},splitEdge:function(e){var r=this.addEdgeVertex(e),t=r.Sym;return this.splice_(e.Sym,e.Sym.getOprev()),this.splice_(e.Sym,t),e.setDst(t.Org),t.getDst().anEdge=t.Sym,t.setRface(e.getRface()),t.winding=e.winding,t.Sym.winding=e.Sym.winding,t},connect:function(e,r){var t=!1,o=this.makeEdge_(e),n=o.Sym;if(r.Lface!=e.Lface&&(t=!0,this.killFace_(r.Lface,e.Lface)),this.splice_(o,e.Lnext),this.splice_(n,r),o.Org=e.getDst(),n.Org=r.Org,o.Lface=n.Lface=e.Lface,e.Lface.anEdge=n,!t){var i=new verb.topo.TESSface;this.makeFace_(i,o,e.Lface)}return o},zapFace:function(e){var r,t,o,n,i,s=e.anEdge;t=s.Lnext;do r=t,t=r.Lnext,r.Lface=null,null==r.getRface()&&(r.Onext==r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.getOprev())),o=r.Sym,o.Onext==o?this.killVertex_(o.Org,null):(o.Org.anEdge=o.Onext,this.splice_(o,o.getOprev())),this.killEdge_(r));while(r!=s);n=e.prev,i=e.next,i.prev=n,n.next=i},countFaceVerts_:function(e){var r=e.anEdge,t=0;do t++,r=r.Lnext;while(r!=e.anEdge);return t},mergeConvexFaces:function(e){for(var r,t,o,n,i,s,a=this.fHead.next;a!=this.fHead;)if(a.inside){for(r=a.anEdge,n=r.Org;;){if(t=r.Lnext,o=r.Sym,null!=o&&null!=o.Lface&&o.Lface.inside&&(i=this.countFaceVerts_(a),s=this.countFaceVerts_(o.Lface),e>=i+s-2&&verb.topo.Geom.vertCCW(r.getLprev().Org,r.Org,o.Lnext.Lnext.Org)&&verb.topo.Geom.vertCCW(o.getLprev().Org,o.Org,r.Lnext.Lnext.Org)&&(t=o.Lnext,this["delete"](o),r=null,o=null)),null!=r&&r.Lnext.Org==n)break;r=t}a=a.next}else a=a.next;return!0},check:function(){for(var e,r,t,o,n,i=this.fHead,s=this.vHead,a=this.eHead,c=i;(e=c.next)!=i;){verb.topo.Tess2.assert(e.prev==c),o=e.anEdge;do verb.topo.Tess2.assert(o.Sym!=o),verb.topo.Tess2.assert(o.Sym.Sym==o),verb.topo.Tess2.assert(o.Lnext.Onext.Sym==o),verb.topo.Tess2.assert(o.Onext.Sym.Lnext==o),verb.topo.Tess2.assert(o.Lface==e),o=o.Lnext;while(o!=e.anEdge);c=e}for(verb.topo.Tess2.assert(e.prev==c&&null==e.anEdge),t=s;(r=t.next)!=s;){verb.topo.Tess2.assert(r.prev==t),o=r.anEdge;do verb.topo.Tess2.assert(o.Sym!=o),verb.topo.Tess2.assert(o.Sym.Sym==o),verb.topo.Tess2.assert(o.Lnext.Onext.Sym==o),verb.topo.Tess2.assert(o.Onext.Sym.Lnext==o),verb.topo.Tess2.assert(o.Org==r),o=o.Onext;while(o!=r.anEdge);t=r}for(verb.topo.Tess2.assert(r.prev==t&&null==r.anEdge),n=a;(o=n.next)!=a;)verb.topo.Tess2.assert(o.Sym.next==n.Sym),verb.topo.Tess2.assert(o.Sym!=o),verb.topo.Tess2.assert(o.Sym.Sym==o),verb.topo.Tess2.assert(null!=o.Org),verb.topo.Tess2.assert(null!=o.getDst()),verb.topo.Tess2.assert(o.Lnext.Onext.Sym==o),verb.topo.Tess2.assert(o.Onext.Sym.Lnext==o),n=o;verb.topo.Tess2.assert(o.Sym.next==n.Sym&&o.Sym==this.eHeadSym&&o.Sym.Sym==o&&null==o.Org&&null==o.getDst()&&null==o.Lface&&null==o.getRface())}},verb.topo.Geom=function(){},verb.topo.Geom.__name__=["verb","topo","Geom"],verb.topo.Geom.vertEq=function(e,r){return e.s==r.s&&e.t==r.t},verb.topo.Geom.vertLeq=function(e,r){return e.s<r.s||e.s==r.s&&e.t<=r.t},verb.topo.Geom.transLeq=function(e,r){return e.t<r.t||e.t==r.t&&e.s<=r.s},verb.topo.Geom.edgeGoesLeft=function(e){return verb.topo.Geom.vertLeq(e.getDst(),e.Org)},verb.topo.Geom.edgeGoesRight=function(e){return verb.topo.Geom.vertLeq(e.Org,e.getDst())},verb.topo.Geom.vertL1dist=function(e,r){return Math.abs(e.s-r.s)+Math.abs(e.t-r.t)},verb.topo.Geom.edgeEval=function(e,r,t){verb.topo.Tess2.assert(verb.topo.Geom.vertLeq(e,r)&&verb.topo.Geom.vertLeq(r,t));var o=r.s-e.s,n=t.s-r.s;return o+n>0?n>o?r.t-e.t+(e.t-t.t)*(o/(o+n)):r.t-t.t+(t.t-e.t)*(n/(o+n)):0},verb.topo.Geom.edgeSign=function(e,r,t){verb.topo.Tess2.assert(verb.topo.Geom.vertLeq(e,r)&&verb.topo.Geom.vertLeq(r,t));var o=r.s-e.s,n=t.s-r.s;return o+n>0?(r.t-t.t)*o+(r.t-e.t)*n:0},verb.topo.Geom.transEval=function(e,r,t){verb.topo.Tess2.assert(verb.topo.Geom.transLeq(e,r)&&verb.topo.Geom.transLeq(r,t));var o=r.t-e.t,n=t.t-r.t;return o+n>0?n>o?r.s-e.s+(e.s-t.s)*(o/(o+n)):r.s-t.s+(t.s-e.s)*(n/(o+n)):0},verb.topo.Geom.transSign=function(e,r,t){verb.topo.Tess2.assert(verb.topo.Geom.transLeq(e,r)&&verb.topo.Geom.transLeq(r,t));var o=r.t-e.t,n=t.t-r.t;return o+n>0?(r.s-t.s)*o+(r.s-e.s)*n:0},verb.topo.Geom.vertCCW=function(e,r,t){return e.s*(r.t-t.t)+r.s*(t.t-e.t)+t.s*(e.t-r.t)>=0},verb.topo.Geom.interpolate=function(e,r,t,o){var n;n=0>e?0:e;var i;return i=0>t?0:t,i>=n?0==i?(r+o)/2:r+(o-r)*(n/(n+i)):o+(r-o)*(i/(n+i))},verb.topo.Geom.intersect=function(e,r,t,o,n){var i,s,a;verb.topo.Geom.vertLeq(e,r)||(a=e,e=r,r=a),verb.topo.Geom.vertLeq(t,o)||(a=t,t=o,o=a),verb.topo.Geom.vertLeq(e,t)||(a=e,e=t,t=a,a=r,r=o,o=a),verb.topo.Geom.vertLeq(t,r)?verb.topo.Geom.vertLeq(r,o)?(i=verb.topo.Geom.edgeEval(e,t,r),s=verb.topo.Geom.edgeEval(t,r,o),0>i+s&&(i=-i,s=-s),n.s=verb.topo.Geom.interpolate(i,t.s,s,r.s)):(i=verb.topo.Geom.edgeSign(e,t,r),s=-verb.topo.Geom.edgeSign(e,o,r),0>i+s&&(i=-i,s=-s),n.s=verb.topo.Geom.interpolate(i,t.s,s,o.s)):n.s=(t.s+r.s)/2,verb.topo.Geom.transLeq(e,r)||(a=e,e=r,r=a),verb.topo.Geom.transLeq(t,o)||(a=t,t=o,o=a),verb.topo.Geom.transLeq(e,t)||(a=e,e=t,t=a,a=r,r=o,o=a),verb.topo.Geom.transLeq(t,r)?verb.topo.Geom.transLeq(r,o)?(i=verb.topo.Geom.transEval(e,t,r),s=verb.topo.Geom.transEval(t,r,o),0>i+s&&(i=-i,s=-s),n.t=verb.topo.Geom.interpolate(i,t.t,s,r.t)):(i=verb.topo.Geom.transSign(e,t,r),s=-verb.topo.Geom.transSign(e,o,r),0>i+s&&(i=-i,s=-s),n.t=verb.topo.Geom.interpolate(i,t.t,s,o.t)):n.t=(t.t+r.t)/2},verb.topo.DictNode=function(){this.key=null,this.next=null,this.prev=null},verb.topo.DictNode.__name__=["verb","topo","DictNode"],verb.topo.Dict=function(e,r){this.head=new verb.topo.DictNode,this.head.next=this.head,this.head.prev=this.head,this.frame=e,this.leq=r},verb.topo.Dict.__name__=["verb","topo","Dict"],verb.topo.Dict.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(e){return this.insertBefore(this.head,e)},search:function(e){var r=this.head;do r=r.next;while(null!=r.key&&!this.leq(this.frame,e,r.key));return r},insertBefore:function(e,r){do e=e.prev;while(null!=e.key&&!this.leq(this.frame,e.key,r));var t=new verb.topo.DictNode;return t.key=r,t.next=e.next,e.next.prev=t,t.prev=e,e.next=t,t},"delete":function(e){e.next.prev=e.prev,e.prev.next=e.next}},verb.topo.PQnode=function(){this.handle=null},verb.topo.PQnode.__name__=["verb","topo","PQnode"],verb.topo.PQhandleElem=function(){this.key=null,this.node=null},verb.topo.PQhandleElem.__name__=["verb","topo","PQhandleElem"],verb.topo.PriorityQ=function(e,r){this.size=0,this.max=e,this.nodes=[],verb.core.ArrayExtensions.alloc(this.nodes,e+1);for(var t=0,o=this.nodes.length;o>t;){var n=t++;this.nodes[n]=new verb.topo.PQnode}this.handles=[],verb.core.ArrayExtensions.alloc(this.handles,e+1);for(var i=0,s=this.handles.length;s>i;){var a=i++;this.handles[a]=new verb.topo.PQhandleElem}this.initialized=!1,this.freeList=0,this.leq=r,this.nodes[1].handle=1,this.handles[1].key=null},verb.topo.PriorityQ.__name__=["verb","topo","PriorityQ"],verb.topo.PriorityQ.prototype={floatDown_:function(e){var r,t,o,n=this.nodes,i=this.handles;for(r=n[e].handle;;){if(o=e<<1,this.size>o&&this.leq(i[n[o+1].handle].key,i[n[o].handle].key)&&++o,verb.topo.Tess2.assert(this.max>=o),t=n[o].handle,o>this.size||this.leq(i[r].key,i[t].key)){n[e].handle=r,i[r].node=e;break}n[e].handle=t,i[t].node=e,e=o}},floatUp_:function(e){var r,t,o,n=this.nodes,i=this.handles;for(r=n[e].handle;;){if(o=e>>1,t=n[o].handle,0==o||this.leq(i[t].key,i[r].key)){n[e].handle=r,i[r].node=e;break}n[e].handle=t,i[t].node=e,e=o}},init:function(){for(var e=this.size;e>=1;)this.floatDown_(e),--e;this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){0==this.size},insert:function(e){var r,t;if(r=++this.size,2*r>this.max){this.max*=2;var o;o=this.nodes.length,verb.core.ArrayExtensions.alloc(this.nodes,this.max+1);for(var n=o,i=this.nodes.length;i>n;){var s=n++;this.nodes[s]=new verb.topo.PQnode}o=this.handles.length,verb.core.ArrayExtensions.alloc(this.handles,this.max+1);for(var a=o,c=this.handles.length;c>a;){var v=a++;this.handles[v]=new verb.topo.PQhandleElem}}return 0==this.freeList?t=r:(t=this.freeList,this.freeList=this.handles[t].node),this.nodes[r].handle=t,this.handles[t].node=r,this.handles[t].key=e,this.initialized&&this.floatUp_(r),t},extractMin:function(){var e=this.nodes,r=this.handles,t=e[1].handle,o=r[t].key;return this.size>0&&(e[1].handle=e[this.size].handle,r[e[1].handle].node=1,r[t].key=null,r[t].node=this.freeList,this.freeList=t,--this.size,this.size>0&&this.floatDown_(1)),o},"delete":function(e){var r,t=this.nodes,o=this.handles;verb.topo.Tess2.assert(e>=1&&this.max>=e&&null!=o[e].key),r=o[e].node,t[r].handle=t[this.size].handle,o[t[r].handle].node=r,--this.size,this.size>=r&&(1>=r||this.leq(o[t[r>>1].handle].key,o[t[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),o[e].key=null,o[e].node=this.freeList,this.freeList=e}},verb.topo.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},verb.topo.ActiveRegion.__name__=["verb","topo","ActiveRegion"],verb.topo.Sweep=function(){},verb.topo.Sweep.__name__=["verb","topo","Sweep"],verb.topo.Sweep.regionBelow=function(e){return e.nodeUp.prev.key},verb.topo.Sweep.regionAbove=function(e){return e.nodeUp.next.key},verb.topo.Sweep.debugEvent=function(){},verb.topo.Sweep.addWinding=function(e,r){e.winding+=r.winding,e.Sym.winding+=r.Sym.winding},verb.topo.Sweep.edgeLeq=function(e,r,t){var o=e.event,n=r.eUp,i=t.eUp;if(n.getDst()==o)return i.getDst()==o?verb.topo.Geom.vertLeq(n.Org,i.Org)?0>=verb.topo.Geom.edgeSign(i.getDst(),n.Org,i.Org):verb.topo.Geom.edgeSign(n.getDst(),i.Org,n.Org)>=0:0>=verb.topo.Geom.edgeSign(i.getDst(),o,i.Org);if(i.getDst()==o)return verb.topo.Geom.edgeSign(n.getDst(),o,n.Org)>=0;var s=verb.topo.Geom.edgeEval(n.getDst(),o,n.Org),a=verb.topo.Geom.edgeEval(i.getDst(),o,i.Org);return s>=a},verb.topo.Sweep.deleteRegion=function(e,r){r.fixUpperEdge&&verb.topo.Tess2.assert(0==r.eUp.winding),r.eUp.activeRegion=null,e.dict["delete"](r.nodeUp)},verb.topo.Sweep.fixUpperEdge=function(e,r,t){verb.topo.Tess2.assert(r.fixUpperEdge),e.mesh["delete"](r.eUp),r.fixUpperEdge=!1,r.eUp=t,t.activeRegion=r},verb.topo.Sweep.topLeftRegion=function(e,r){var t,o=r.eUp.Org;do r=verb.topo.Sweep.regionAbove(r);while(r.eUp.Org==o);if(r.fixUpperEdge){if(t=e.mesh.connect(verb.topo.Sweep.regionBelow(r).eUp.Sym,r.eUp.Lnext),null==t)return null;verb.topo.Sweep.fixUpperEdge(e,r,t),r=verb.topo.Sweep.regionAbove(r)}return r},verb.topo.Sweep.topRightRegion=function(e){var r=e.eUp.getDst(),t=null;do t=verb.topo.Sweep.regionAbove(t);while(t.eUp.getDst()==r);return t},verb.topo.Sweep.addRegionBelow=function(e,r,t){var o=new verb.topo.ActiveRegion;return o.eUp=t,o.nodeUp=e.dict.insertBefore(r.nodeUp,o),o.fixUpperEdge=!1,o.sentinel=!1,o.dirty=!1,t.activeRegion=o,o},verb.topo.Sweep.isWindingInside=function(e,r){var t=e.windingRule;switch(t){case verb.topo.Tess2.WINDING_ODD:return 0!=(1&r);case verb.topo.Tess2.WINDING_NONZERO:return 0!=r;case verb.topo.Tess2.WINDING_POSITIVE:return r>0;case verb.topo.Tess2.WINDING_NEGATIVE:return 0>r;case verb.topo.Tess2.WINDING_ABS_GEQ_TWO:return r>=2||-2>=r}return verb.topo.Tess2.assert(!1),!1},verb.topo.Sweep.computeWinding=function(e,r){r.windingNumber=verb.topo.Sweep.regionAbove(r).windingNumber+r.eUp.winding,r.inside=verb.topo.Sweep.isWindingInside(e,r.windingNumber)},verb.topo.Sweep.finishRegion=function(e,r){var t=r.eUp,o=t.Lface;o.inside=r.inside,o.anEdge=t,verb.topo.Sweep.deleteRegion(e,r)},verb.topo.Sweep.finishLeftRegions=function(e,r,t){for(var o,n=null,i=r,s=r.eUp;i!=t;){if(i.fixUpperEdge=!1,n=verb.topo.Sweep.regionBelow(i),o=n.eUp,o.Org!=s.Org){if(!n.fixUpperEdge){verb.topo.Sweep.finishRegion(e,i);break}o=e.mesh.connect(s.getLprev(),o.Sym),verb.topo.Sweep.fixUpperEdge(e,n,o)}s.Onext!=o&&(e.mesh.splice(o.getOprev(),o),e.mesh.splice(s,o)),verb.topo.Sweep.finishRegion(e,i),s=n.eUp,i=n}return s},verb.topo.Sweep.addRightEdges=function(e,r,t,o,n,i){var s,a,c,v=null,u=!0;a=t;do verb.topo.Tess2.assert(verb.topo.Geom.vertLeq(a.Org,a.getDst())),verb.topo.Sweep.addRegionBelow(e,r,a.Sym),a=a.Onext;while(a!=o);for(null==n&&(n=verb.topo.Sweep.regionBelow(r).eUp.getRprev()),s=r,c=n;;){if(v=verb.topo.Sweep.regionBelow(s),a=v.eUp.Sym,a.Org!=c.Org)break;a.Onext!=c&&(e.mesh.splice(a.getOprev(),a),e.mesh.splice(c.getOprev(),a)),v.windingNumber=s.windingNumber-a.winding,v.inside=verb.topo.Sweep.isWindingInside(e,v.windingNumber),s.dirty=!0,!u&&verb.topo.Sweep.checkForRightSplice(e,s)&&(verb.topo.Sweep.addWinding(a,c),verb.topo.Sweep.deleteRegion(e,s),e.mesh["delete"](c)),u=!1,s=v,c=a}s.dirty=!0,verb.topo.Tess2.assert(s.windingNumber-a.winding==v.windingNumber),i&&verb.topo.Sweep.walkDirtyRegions(e,s)},verb.topo.Sweep.spliceMergeVertices=function(e,r,t){e.mesh.splice(r,t)},verb.topo.Sweep.vertexWeights=function(e,r,t){var o=verb.topo.Geom.vertL1dist(r,e),n=verb.topo.Geom.vertL1dist(t,e),i=.5*n/(o+n),s=.5*o/(o+n);e.coords[0]+=i*r.coords[0]+s*t.coords[0],e.coords[1]+=i*r.coords[1]+s*t.coords[1],e.coords[2]+=i*r.coords[2]+s*t.coords[2]},verb.topo.Sweep.getIntersectData=function(e,r,t,o,n,i){r.coords[0]=r.coords[1]=r.coords[2]=0,r.idx=-1,verb.topo.Sweep.vertexWeights(r,t,o),verb.topo.Sweep.vertexWeights(r,n,i)},verb.topo.Sweep.checkForRightSplice=function(e,r){var t=verb.topo.Sweep.regionBelow(r),o=r.eUp,n=t.eUp;if(verb.topo.Geom.vertLeq(o.Org,n.Org)){if(verb.topo.Geom.edgeSign(n.getDst(),o.Org,n.Org)>0)return!1;verb.topo.Geom.vertEq(o.Org,n.Org)?o.Org!=n.Org&&(e.pq["delete"](o.Org.pqHandle),verb.topo.Sweep.spliceMergeVertices(e,n.getOprev(),o)):(e.mesh.splitEdge(n.Sym),e.mesh.splice(o,n.getOprev()),r.dirty=t.dirty=!0)}else{if(0>verb.topo.Geom.edgeSign(o.getDst(),n.Org,o.Org))return!1;verb.topo.Sweep.regionAbove(r).dirty=r.dirty=!0,e.mesh.splitEdge(o.Sym),e.mesh.splice(n.getOprev(),o)}return!0},verb.topo.Sweep.checkForLeftSplice=function(e,r){var t,o=verb.topo.Sweep.regionBelow(r),n=r.eUp,i=o.eUp;if(verb.topo.Tess2.assert(!verb.topo.Geom.vertEq(n.getDst(),i.getDst())),verb.topo.Geom.vertLeq(n.getDst(),i.getDst())){if(0>verb.topo.Geom.edgeSign(n.getDst(),i.getDst(),n.Org))return!1;
verb.topo.Sweep.regionAbove(r).dirty=r.dirty=!0,t=e.mesh.splitEdge(n),e.mesh.splice(i.Sym,t),t.Lface.inside=r.inside}else{if(verb.topo.Geom.edgeSign(i.getDst(),n.getDst(),i.Org)>0)return!1;r.dirty=o.dirty=!0,t=e.mesh.splitEdge(i),e.mesh.splice(n.Lnext,i.Sym),t.getRface().inside=r.inside}return!0},verb.topo.Sweep.checkForIntersect=function(e,r){var t,o,n,i,s=verb.topo.Sweep.regionBelow(r),a=r.eUp,c=s.eUp,v=a.Org,u=c.Org,l=a.getDst(),p=c.getDst(),b=new verb.topo.TESSvertex;if(verb.topo.Tess2.assert(!verb.topo.Geom.vertEq(p,l)),verb.topo.Tess2.assert(0>=verb.topo.Geom.edgeSign(l,e.event,v)),verb.topo.Tess2.assert(verb.topo.Geom.edgeSign(p,e.event,u)>=0),verb.topo.Tess2.assert(v!=e.event&&u!=e.event),verb.topo.Tess2.assert(!r.fixUpperEdge&&!s.fixUpperEdge),v==u)return!1;if(t=Math.min(v.t,l.t),o=Math.max(u.t,p.t),t>o)return!1;if(verb.topo.Geom.vertLeq(v,u)){if(verb.topo.Geom.edgeSign(p,v,u)>0)return!1}else if(0>verb.topo.Geom.edgeSign(l,u,v))return!1;return verb.topo.Sweep.debugEvent(e),verb.topo.Geom.intersect(l,v,p,u,b),verb.topo.Tess2.assert(Math.min(v.t,l.t)<=b.t),verb.topo.Tess2.assert(b.t<=Math.max(u.t,p.t)),verb.topo.Tess2.assert(Math.min(p.s,l.s)<=b.s),verb.topo.Tess2.assert(b.s<=Math.max(u.s,v.s)),verb.topo.Geom.vertLeq(b,e.event)&&(b.s=e.event.s,b.t=e.event.t),n=verb.topo.Geom.vertLeq(v,u)?v:u,verb.topo.Geom.vertLeq(n,b)&&(b.s=n.s,b.t=n.t),verb.topo.Geom.vertEq(b,v)||verb.topo.Geom.vertEq(b,u)?(verb.topo.Sweep.checkForRightSplice(e,r),!1):!verb.topo.Geom.vertEq(l,e.event)&&verb.topo.Geom.edgeSign(l,e.event,b)>=0||!verb.topo.Geom.vertEq(p,e.event)&&0>=verb.topo.Geom.edgeSign(p,e.event,b)?p==e.event?(e.mesh.splitEdge(a.Sym),e.mesh.splice(c.Sym,a),r=verb.topo.Sweep.topLeftRegion(e,r),a=verb.topo.Sweep.regionBelow(r).eUp,verb.topo.Sweep.finishLeftRegions(e,verb.topo.Sweep.regionBelow(r),s),verb.topo.Sweep.addRightEdges(e,r,a.getOprev(),a,a,!0),!0):l==e.event?(e.mesh.splitEdge(c.Sym),e.mesh.splice(a.Lnext,c.getOprev()),s=r,r=verb.topo.Sweep.topRightRegion(r),i=verb.topo.Sweep.regionBelow(r).eUp.getRprev(),s.eUp=c.getOprev(),c=verb.topo.Sweep.finishLeftRegions(e,s,null),verb.topo.Sweep.addRightEdges(e,r,c.Onext,a.getRprev(),i,!0),!0):(verb.topo.Geom.edgeSign(l,e.event,b)>=0&&(verb.topo.Sweep.regionAbove(r).dirty=r.dirty=!0,e.mesh.splitEdge(a.Sym),a.Org.s=e.event.s,a.Org.t=e.event.t),0>=verb.topo.Geom.edgeSign(p,e.event,b)&&(r.dirty=s.dirty=!0,e.mesh.splitEdge(c.Sym),c.Org.s=e.event.s,c.Org.t=e.event.t),!1):(e.mesh.splitEdge(a.Sym),e.mesh.splitEdge(c.Sym),e.mesh.splice(c.getOprev(),a),a.Org.s=b.s,a.Org.t=b.t,a.Org.pqHandle=e.pq.insert(a.Org),verb.topo.Sweep.getIntersectData(e,a.Org,v,l,u,p),verb.topo.Sweep.regionAbove(r).dirty=r.dirty=s.dirty=!0,!1)},verb.topo.Sweep.walkDirtyRegions=function(e,r){for(var t,o,n=verb.topo.Sweep.regionBelow(r);;){for(;n.dirty;)r=n,n=verb.topo.Sweep.regionBelow(n);if(!r.dirty&&(n=r,r=verb.topo.Sweep.regionAbove(r),null==r||!r.dirty))return;if(r.dirty=!1,t=r.eUp,o=n.eUp,t.getDst()!=o.getDst()&&verb.topo.Sweep.checkForLeftSplice(e,r)&&(n.fixUpperEdge?(verb.topo.Sweep.deleteRegion(e,n),e.mesh["delete"](o),n=verb.topo.Sweep.regionBelow(r),o=n.eUp):r.fixUpperEdge&&(verb.topo.Sweep.deleteRegion(e,r),e.mesh["delete"](t),r=verb.topo.Sweep.regionAbove(n),t=r.eUp)),t.Org!=o.Org)if(t.getDst()==o.getDst()||r.fixUpperEdge||n.fixUpperEdge||t.getDst()!=e.event&&o.getDst()!=e.event)verb.topo.Sweep.checkForRightSplice(e,r);else if(verb.topo.Sweep.checkForIntersect(e,r))return;t.Org==o.Org&&t.getDst()==o.getDst()&&(verb.topo.Sweep.addWinding(o,t),verb.topo.Sweep.deleteRegion(e,r),e.mesh["delete"](t),r=verb.topo.Sweep.regionAbove(n))}},verb.topo.Sweep.connectRightVertex=function(e,r,t){var o,n=t.Onext,i=verb.topo.Sweep.regionBelow(r),s=r.eUp,a=i.eUp,c=!1;return s.getDst()!=a.getDst()&&verb.topo.Sweep.checkForIntersect(e,r),verb.topo.Geom.vertEq(s.Org,e.event)&&(e.mesh.splice(n.getOprev(),s),r=verb.topo.Sweep.topLeftRegion(e,r),n=verb.topo.Sweep.regionBelow(r).eUp,verb.topo.Sweep.finishLeftRegions(e,verb.topo.Sweep.regionBelow(r),i),c=!0),verb.topo.Geom.vertEq(a.Org,e.event)&&(e.mesh.splice(t,a.getOprev()),t=verb.topo.Sweep.finishLeftRegions(e,i,null),c=!0),c?(verb.topo.Sweep.addRightEdges(e,r,t.Onext,n,n,!0),void 0):(o=verb.topo.Geom.vertLeq(a.Org,s.Org)?a.getOprev():s,o=e.mesh.connect(t.getLprev(),o),verb.topo.Sweep.addRightEdges(e,r,o,o.Onext,o.Onext,!1),o.Sym.activeRegion.fixUpperEdge=!0,verb.topo.Sweep.walkDirtyRegions(e,r),void 0)},verb.topo.Sweep.connectLeftDegenerate=function(e,r,t){var o,n,i,s,a;return o=r.eUp,verb.topo.Geom.vertEq(o.Org,t)?(verb.topo.Tess2.assert(!1),verb.topo.Sweep.spliceMergeVertices(e,o,t.anEdge),void 0):verb.topo.Geom.vertEq(o.getDst(),t)?(verb.topo.Tess2.assert(!1),r=verb.topo.Sweep.topRightRegion(r),a=verb.topo.Sweep.regionBelow(r),i=a.eUp.Sym,n=s=i.Onext,a.fixUpperEdge&&(verb.topo.Tess2.assert(n!=i),verb.topo.Sweep.deleteRegion(e,a),e.mesh["delete"](i),i=n.getOprev()),e.mesh.splice(t.anEdge,i),verb.topo.Geom.edgeGoesLeft(n)||(n=null),verb.topo.Sweep.addRightEdges(e,r,i.Onext,s,n,!0),void 0):(e.mesh.splitEdge(o.Sym),r.fixUpperEdge&&(e.mesh["delete"](o.Onext),r.fixUpperEdge=!1),e.mesh.splice(t.anEdge,o),verb.topo.Sweep.sweepEvent(e,t),void 0)},verb.topo.Sweep.connectLeftVertex=function(e,r){var t,o,n,i,s,a,c=new verb.topo.ActiveRegion;if(c.eUp=r.anEdge.Sym,t=e.dict.search(c).key,o=verb.topo.Sweep.regionBelow(t),null!=o){if(i=t.eUp,s=o.eUp,0==verb.topo.Geom.edgeSign(i.getDst(),r,i.Org))return verb.topo.Sweep.connectLeftDegenerate(e,t,r),void 0;if(n=verb.topo.Geom.vertLeq(s.getDst(),i.getDst())?t:o,t.inside||n.fixUpperEdge){if(n==t)a=e.mesh.connect(r.anEdge.Sym,i.Lnext);else{var v=e.mesh.connect(s.getDnext(),r.anEdge);a=v.Sym}n.fixUpperEdge?verb.topo.Sweep.fixUpperEdge(e,n,a):verb.topo.Sweep.computeWinding(e,verb.topo.Sweep.addRegionBelow(e,t,a)),verb.topo.Sweep.sweepEvent(e,r)}else verb.topo.Sweep.addRightEdges(e,t,r.anEdge,r.anEdge,null,!0)}},verb.topo.Sweep.sweepEvent=function(e,r){e.event=r,verb.topo.Sweep.debugEvent(e);for(var t=r.anEdge;null==t.activeRegion;)if(t=t.Onext,t==r.anEdge)return verb.topo.Sweep.connectLeftVertex(e,r),void 0;var o=verb.topo.Sweep.topLeftRegion(e,t.activeRegion);verb.topo.Tess2.assert(null!=o);var n=verb.topo.Sweep.regionBelow(o),i=n.eUp,s=verb.topo.Sweep.finishLeftRegions(e,n,null);s.Onext==i?verb.topo.Sweep.connectRightVertex(e,o,s):verb.topo.Sweep.addRightEdges(e,o,s.Onext,i,i,!0)},verb.topo.Sweep.addSentinel=function(e,r,t,o){var n=new verb.topo.ActiveRegion,i=e.mesh.makeEdge();i.Org.s=t,i.Org.t=o,i.getDst().s=r,i.getDst().t=o,e.event=i.getDst(),n.eUp=i,n.windingNumber=0,n.inside=!1,n.fixUpperEdge=!1,n.sentinel=!0,n.dirty=!1,n.nodeUp=e.dict.insert(n)},verb.topo.Sweep.initEdgeDict=function(e){e.dict=new verb.topo.Dict(e,verb.topo.Sweep.edgeLeq);var r=e.bmax[0]-e.bmin[0],t=e.bmax[1]-e.bmin[1],o=e.bmin[0]-r,n=e.bmax[0]+r,i=e.bmin[1]-t,s=e.bmax[1]+t;verb.topo.Sweep.addSentinel(e,o,n,i),verb.topo.Sweep.addSentinel(e,o,n,s)},verb.topo.Sweep.doneEdgeDict=function(e){for(var r,t=0;null!=(r=e.dict.min().key);)r.sentinel||(verb.topo.Tess2.assert(r.fixUpperEdge),verb.topo.Tess2.assert(1==++t)),verb.topo.Tess2.assert(0==r.windingNumber),verb.topo.Sweep.deleteRegion(e,r)},verb.topo.Sweep.removeDegenerateEdges=function(e){for(var r,t,o=e.mesh.eHead,n=o.next;n!=o;)r=n.next,t=n.Lnext,verb.topo.Geom.vertEq(n.Org,n.getDst())&&n.Lnext.Lnext!=n&&(verb.topo.Sweep.spliceMergeVertices(e,t,n),e.mesh["delete"](n),n=t,t=n.Lnext),t.Lnext==n&&(t!=n&&((t==r||t==r.Sym)&&(r=r.next),e.mesh["delete"](t)),(n==r||n==r.Sym)&&(r=r.next),e.mesh["delete"](n)),n=r},verb.topo.Sweep.initPriorityQ=function(e){var r,t,o=0;t=e.mesh.vHead;for(var n=t.next;n!=t;)o++,n=n.next;for(o+=8,r=e.pq=new verb.topo.PriorityQ(o,verb.topo.Geom.vertLeq),t=e.mesh.vHead,n=t.next;n!=t;)n.pqHandle=r.insert(n),n=n.next;return n!=t?!1:(r.init(),!0)},verb.topo.Sweep.donePriorityQ=function(e){e.pq=null},verb.topo.Sweep.removeDegenerateFaces=function(e,r){for(var t,o,n=r.fHead.next;n!=r.fHead;)t=n.next,o=n.anEdge,verb.topo.Tess2.assert(o.Lnext!=o),o.Lnext.Lnext==o&&(verb.topo.Sweep.addWinding(o.Onext,o),e.mesh["delete"](o)),n=t;return!0},verb.topo.Sweep.computeInterior=function(e){var r,t;if(verb.topo.Sweep.removeDegenerateEdges(e),!verb.topo.Sweep.initPriorityQ(e))return!1;for(verb.topo.Sweep.initEdgeDict(e);null!=(r=e.pq.extractMin());){for(;;){if(t=e.pq.min(),null==t||!verb.topo.Geom.vertEq(t,r))break;t=e.pq.extractMin(),verb.topo.Sweep.spliceMergeVertices(e,r.anEdge,t.anEdge)}verb.topo.Sweep.sweepEvent(e,r)}return e.event=e.dict.min().key.eUp.Org,verb.topo.Sweep.debugEvent(e),verb.topo.Sweep.doneEdgeDict(e),verb.topo.Sweep.donePriorityQ(e),verb.topo.Sweep.removeDegenerateFaces(e,e.mesh)?(e.mesh.check(),!0):!1},verb.topo.Tessellator=function(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=verb.topo.Tess2.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0},verb.topo.Tessellator.__name__=["verb","topo","Tessellator"],verb.topo.Tessellator.prototype={dot_:function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]},normalize_:function(e){var r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];verb.topo.Tess2.assert(r>0),r=Math.sqrt(r),e[0]/=r,e[1]/=r,e[2]/=r},longAxis_:function(e){var r=0;return Math.abs(e[1])>Math.abs(e[0])&&(r=1),Math.abs(e[2])>Math.abs(e[r])&&(r=2),r},computeNormal_:function(e){var r,t,o,n,i,s,a=[0,0,0],c=[0,0,0],v=[0,0,0],u=0,l=0,p=0,b=0,h=0,f=0,d=[null,null,null],m=[null,null,null],g=this.mesh.vHead;r=g.next;for(var x=0;3>x;){var _=x++;n=r.coords[_],c[_]=n,m[_]=r,a[_]=n,d[_]=r}for(r=g.next;r!=g;){for(var y=0;3>y;){var S=y++;n=r.coords[S],c[S]>n&&(c[S]=n,m[S]=r),n>a[S]&&(a[S]=n,d[S]=r)}r=r.next}var V=0;if(a[1]-c[1]>a[0]-c[0]&&(V=1),a[2]-c[2]>a[V]-c[V]&&(V=2),c[V]>=a[V])return e[0]=0,e[1]=0,e[2]=1,void 0;for(s=0,t=m[V],o=d[V],v[0]=t.coords[0]-o.coords[0],v[1]=t.coords[1]-o.coords[1],v[2]=t.coords[2]-o.coords[2],r=g.next;r!=g;)u=r.coords[0]-o.coords[0],l=r.coords[1]-o.coords[1],p=r.coords[2]-o.coords[2],b=v[1]*p-v[2]*l,h=v[2]*u-v[0]*p,f=v[0]*l-v[1]*u,i=b*b+h*h+f*f,i>s&&(s=i,e[0]=b,e[1]=h,e[2]=f),r=r.next;0>=s&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(v)]=1)},checkOrientation_:function(){var e,r,t,o,n=this.mesh.fHead,i=this.mesh.vHead;for(e=0,r=n.next;r!=n;)if(o=r.anEdge,!(0>=o.winding)){do e+=(o.Org.s-o.getDst().s)*(o.Org.t+o.getDst().t),o=o.Lnext;while(o!=r.anEdge);r=r.next}if(0>e){for(t=i.next;t!=i;)t.t=-t.t,t=t.next;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var e,r,t,o,n,i=this.mesh.vHead,s=[0,0,0],a=!1;for(s[0]=this.normal[0],s[1]=this.normal[1],s[2]=this.normal[2],0==s[0]&&0==s[1]&&0==s[2]&&(this.computeNormal_(s),a=!0),r=this.sUnit,t=this.tUnit,o=this.longAxis_(s),r[o]=0,r[(o+1)%3]=1,r[(o+2)%3]=0,t[o]=0,t[(o+1)%3]=0,t[(o+2)%3]=s[o]>0?1:-1,e=i.next;e!=i;)e.s=this.dot_(e.coords,r),e.t=this.dot_(e.coords,t),e=e.next;for(a&&this.checkOrientation_(),n=!0,e=i.next;e!=i;)n?(this.bmin[0]=this.bmax[0]=e.s,this.bmin[1]=this.bmax[1]=e.t,n=!1):(e.s<this.bmin[0]&&(this.bmin[0]=e.s),e.s>this.bmax[0]&&(this.bmax[0]=e.s),e.t<this.bmin[1]&&(this.bmin[1]=e.t),e.t>this.bmax[1]&&(this.bmax[1]=e.t)),e=e.next},addWinding_:function(e,r){e.winding+=r.winding,e.Sym.winding+=r.Sym.winding},tessellateMonoRegion_:function(e,r){var t,o;for(t=r.anEdge,verb.topo.Tess2.assert(t.Lnext!=t&&t.Lnext.Lnext!=t);verb.topo.Geom.vertLeq(t.getDst(),t.Org);)t=t.getLprev();for(;verb.topo.Geom.vertLeq(t.Org,t.getDst());)t=t.Lnext;for(o=t.getLprev();t.Lnext!=o;)if(verb.topo.Geom.vertLeq(t.getDst(),o.Org)){for(;o.Lnext!=t&&(verb.topo.Geom.edgeGoesLeft(o.Lnext)||0>=verb.topo.Geom.edgeSign(o.Org,o.getDst(),o.Lnext.getDst()));){var n=e.connect(o.Lnext,o);o=n.Sym}o=o.getLprev()}else{for(;o.Lnext!=t&&(verb.topo.Geom.edgeGoesRight(t.getLprev())||verb.topo.Geom.edgeSign(t.getDst(),t.Org,t.getLprev().Org)>=0);){var i=e.connect(t,t.getLprev());t=i.Sym}t=t.Lnext}for(verb.topo.Tess2.assert(o.Lnext!=t);o.Lnext.Lnext!=t;){var s=e.connect(o.Lnext,o);o=s.Sym}return!0},tessellateInterior_:function(e){for(var r,t=e.fHead.next;t!=e.fHead;){if(r=t.next,t.inside&&!this.tessellateMonoRegion_(e,t))return!1;t=r}return!0},discardExterior_:function(e){for(var r,t=e.fHead.next;t!=e.fHead;)r=t.next,t.inside||e.zapFace(t),t=r},setWindingNumber_:function(e,r,t){for(var o,n=e.eHead.next;n!=e.eHead;)o=n.next,n.getRface().inside!=n.Lface.inside?n.winding=n.Lface.inside?r:-r:t?e["delete"](n):n.winding=0,n=o},getNeighbourFace_:function(e){return null==e.getRface()?-1:e.getRface().inside?e.getRface().n:-1},outputPolymesh_:function(e,r,t,o){var n,i,s,a,c=0,v=0;for(t>3&&e.mergeConvexFaces(t),n=e.vHead.next;n!=e.vHead;)n.n=-1,n=n.next;for(i=e.fHead.next;i!=e.fHead;)if(i.n=-1,i.inside){s=i.anEdge,a=0;do n=s.Org,-1==n.n&&(n.n=v,v++),a++,s=s.Lnext;while(s!=i.anEdge);verb.topo.Tess2.assert(t>=a),i.n=c,++c,i=i.next}else i=i.next;for(this.elementCount=c,r==verb.topo.Tess2.CONNECTED_POLYGONS&&(c*=2),this.elements=[],verb.core.ArrayExtensions.alloc(this.elements,c*t),this.vertexCount=v,this.vertices=[],verb.core.ArrayExtensions.alloc(this.vertices,v*o),this.vertexIndices=[],verb.core.ArrayExtensions.alloc(this.vertexIndices,v),n=e.vHead.next;n!=e.vHead;){if(-1!=n.n){var u=n.n*o;this.vertices[u]=n.coords[0],this.vertices[u+1]=n.coords[1],o>2&&(this.vertices[u+2]=n.coords[2]),this.vertexIndices[n.n]=n.idx}n=n.next}var l=0;for(i=e.fHead.next;i!=e.fHead;)if(i.inside){s=i.anEdge,a=0;do n=s.Org,this.elements[l++]=n.n,a++,s=s.Lnext;while(s!=i.anEdge);for(var p=a;t>p;)p++,this.elements[l++]=-1;if(r==verb.topo.Tess2.CONNECTED_POLYGONS){s=i.anEdge;do this.elements[l++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!=i.anEdge);for(var b=a;t>b;)b++,this.elements[l++]=-1}i=i.next}else i=i.next},outputContours_:function(e,r){var t,o,n,i=0,s=0;for(this.vertexCount=0,this.elementCount=0,t=e.fHead.next;t!=e.fHead;)if(t.inside){n=o=t.anEdge;do this.vertexCount++,o=o.Lnext;while(o!=n);this.elementCount++,t=t.next}else t=t.next;this.elements=[],verb.core.ArrayExtensions.alloc(this.elements,2*this.elementCount),this.vertices=[],verb.core.ArrayExtensions.alloc(this.vertices,this.vertexCount*r),this.vertexIndices=[],verb.core.ArrayExtensions.alloc(this.vertexIndices,this.vertexCount);var a=0,c=0,v=0;for(i=0,t=e.fHead.next;t!=e.fHead;)if(t.inside){s=0,n=o=t.anEdge;do this.vertices[a++]=o.Org.coords[0],this.vertices[a++]=o.Org.coords[1],r>2&&(this.vertices[a++]=o.Org.coords[2]),this.vertexIndices[c++]=o.Org.idx,s++,o=o.Lnext;while(o!=n);this.elements[v++]=i,this.elements[v++]=s,i+=s,t=t.next}else t=t.next},addContour:function(e,r){var t,o;for(null==this.mesh&&(this.mesh=new verb.topo.TESSmesh),2>e&&(e=2),e>3&&(e=3),t=null,o=0;r.length>o;)null==t?(t=this.mesh.makeEdge(),this.mesh.splice(t,t.Sym)):(this.mesh.splitEdge(t),t=t.Lnext),t.Org.coords[0]=r[o],t.Org.coords[1]=r[o+1],t.Org.coords[2]=e>2?r[o+2]:0,t.Org.idx=this.vertexIndexCounter++,t.winding=1,t.Sym.winding=-1,o+=e},tessellate:function(e,r,t,o,n){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,null!=n&&(this.normal[0]=n[0],this.normal[1]=n[1],this.normal[2]=n[2]),this.windingRule=e,2>o&&(o=2),o>3&&(o=3),null==this.mesh)return!1;this.projectPolygon_(),verb.topo.Sweep.computeInterior(this);var i=this.mesh;return r==verb.topo.Tess2.BOUNDARY_CONTOURS?this.setWindingNumber_(i,1,!0):this.tessellateInterior_(i),i.check(),r==verb.topo.Tess2.BOUNDARY_CONTOURS?this.outputContours_(i,o):this.outputPolymesh_(i,r,t,o),!0}},verb.topo.Vertex=$hx_exports.topo.Vertex=function(e){verb.topo.Topo.call(this),this.pt=e},verb.topo.Vertex.__name__=["verb","topo","Vertex"],verb.topo.Vertex.__interfaces__=[verb.core.types.IDoublyLinkedList],verb.topo.Vertex.__super__=verb.topo.Topo,verb.topo.Vertex.prototype=$extend(verb.topo.Topo.prototype,{neighbors:function(){var e=new haxe.ds.IntMap;e.set(this.id,this);var r=[];this.e;for(var t=0,o=this.halfEdges();o.length>t;){var n=o[t];++t;var i=n.nxt.v;e.exists(i.id)||r.push(i)}return r},halfEdges:function(){var e=[],r=this.e;do{if(e.push(r),null==r.opp)break;r=r.opp.nxt}while(r!=this.e);return e}});var $_,$fid=0;Array.prototype.indexOf&&(HxOverrides.indexOf=function(e,r,t){return Array.prototype.indexOf.call(e,r,t)}),Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Math.isFinite=function(e){return isFinite(e)},Math.isNaN=function(e){return isNaN(e)},String.__name__=["String"],Array.__name__=["Array"],null==Array.prototype.map&&(Array.prototype.map=function(e){for(var r=[],t=0,o=this.length;o>t;){var n=t++;r[n]=e(this[n])}return r}),null==Array.prototype.filter&&(Array.prototype.filter=function(e){for(var r=[],t=0,o=this.length;o>t;){var n=t++,i=this[n];e(i)&&r.push(i)}return r});var global=window;(function(global,undefined){function canUseNextTick(){return"object"==typeof process&&"[object process]"===Object.prototype.toString.call(process)}function canUseMessageChannel(){return!!global.MessageChannel}function canUsePostMessage(){if(!global.postMessage||global.importScripts)return!1;var e=!0,r=global.onmessage;return global.onmessage=function(){e=!1},global.postMessage("","*"),global.onmessage=r,e}function canUseReadyStateChange(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")}function installNextTickImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return process.nextTick(function(){tasks.runIfPresent(e)}),e}}function installMessageChannelImplementation(e){var r=new global.MessageChannel;r.port1.onmessage=function(e){var r=e.data;tasks.runIfPresent(r)},e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return r.port2.postMessage(e),e}}function installPostMessageImplementation(e){function r(e,r){return"string"==typeof e&&e.substring(0,r.length)===r}function t(e){if(e.source===global&&r(e.data,o)){var t=e.data.substring(o.length);tasks.runIfPresent(t)}}var o="com.bn.NobleJS.setImmediate"+Math.random();global.addEventListener?global.addEventListener("message",t,!1):global.attachEvent("onmessage",t),e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return global.postMessage(o+e,"*"),e}}function installReadyStateChangeImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments),r=global.document.createElement("script");return r.onreadystatechange=function(){tasks.runIfPresent(e),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},global.document.documentElement.appendChild(r),e}}function installSetTimeoutImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return global.setTimeout(function(){tasks.runIfPresent(e)},0),e}}var tasks=function(){function Task(e,r){this.handler=e,this.args=r}Task.prototype.run=function(){if("function"==typeof this.handler)this.handler.apply(undefined,this.args);else{var scriptSource=""+this.handler;eval(scriptSource)}};var nextHandle=1,tasksByHandle={},currentlyRunningATask=!1;return{addFromSetImmediateArguments:function(e){var r=e[0],t=Array.prototype.slice.call(e,1),o=new Task(r,t),n=nextHandle++;return tasksByHandle[n]=o,n},runIfPresent:function(e){if(currentlyRunningATask)global.setTimeout(function(){tasks.runIfPresent(e)},0);else{var r=tasksByHandle[e];if(r){currentlyRunningATask=!0;try{r.run()}finally{delete tasksByHandle[e],currentlyRunningATask=!1}}}},remove:function(e){delete tasksByHandle[e]}}}();if(!global.setImmediate){var attachTo="function"==typeof Object.getPrototypeOf&&"setTimeout"in Object.getPrototypeOf(global)?Object.getPrototypeOf(global):global;canUseNextTick()?installNextTickImplementation(attachTo):canUsePostMessage()?installPostMessageImplementation(attachTo):canUseMessageChannel()?installMessageChannelImplementation(attachTo):canUseReadyStateChange()?installReadyStateChangeImplementation(attachTo):installSetTimeoutImplementation(attachTo),attachTo.clearImmediate=tasks.remove}})("object"==typeof global&&global?global:this),promhx.base.EventLoop.queue=new List,verb.core.Analyze.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],verb.core.Analyze.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],verb.core.Binomial.memo=new haxe.ds.IntMap,verb.core.Constants.TOLERANCE=1e-6,verb.core.Constants.EPSILON=1e-10,verb.core.ExpIntersect.INIT_STEP_LENGTH=.001,verb.core.ExpIntersect.LINEAR_STEP_LENGTH=.1,verb.core.types.BoundingBox.TOLERANCE=1e-4,verb.exe.Dispatcher.THREADS=1,verb.exe.Dispatcher._init=!1,verb.exe.Work.uuid=0,verb.exe.WorkerPool.basePath="",verb.topo.Boolean.IN=1,verb.topo.Boolean.ON=0,verb.topo.Boolean.OUT=-1,verb.topo.Boolean.boolOnSectorMap=[[verb.topo.FacePosition.AoutB,verb.topo.FacePosition.AinB,verb.topo.FacePosition.BinA,verb.topo.FacePosition.BinA],[verb.topo.FacePosition.AinB,verb.topo.FacePosition.AoutB,verb.topo.FacePosition.BoutA,verb.topo.FacePosition.BoutA],[verb.topo.FacePosition.AinB,verb.topo.FacePosition.AoutB,verb.topo.FacePosition.BoutA,verb.topo.FacePosition.BoutA]],verb.topo.Topo.counter=0,verb.topo.Tess2.WINDING_ODD=0,verb.topo.Tess2.WINDING_NONZERO=1,verb.topo.Tess2.WINDING_POSITIVE=2,verb.topo.Tess2.WINDING_NEGATIVE=3,verb.topo.Tess2.WINDING_ABS_GEQ_TWO=4,verb.topo.Tess2.POLYGONS=0,verb.topo.Tess2.CONNECTED_POLYGONS=1,verb.topo.Tess2.BOUNDARY_CONTOURS=2,verb.Verb.main()
})(verb!==void 0?verb:exports);