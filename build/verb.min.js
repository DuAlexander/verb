/*! verb 2013-09-01 */
if("object"!=typeof exports||void 0===exports)var VERB={},numeric=window.numeric,binomial=window.binomial,labor=window.labor,_=window.underscore;else var VERB=module.exports={},numeric=require("numeric"),binomial=require("binomial"),labor=require("labor"),_=require("underscore");VERB.geom={},VERB.core={},VERB.eval={},VERB.eval.nurbs=VERB.eval.nurbs||{},VERB.eval.mesh=VERB.eval.mesh||{},VERB.EPSILON=1e-8,VERB.init=function(){VERB.nurbs_engine=new VERB.core.Engine(VERB.eval.nurbs),VERB.geom.NURBSGeometry.prototype.nurbs_engine=VERB.nurbs_engine},"function"!=typeof Object.create&&(Object.create=function(n){function e(){}return e.prototype=n,new e}),Function.prototype.method=function(n,e){return this.prototype[n]=e,this},Function.method("inherits",function(n){return this.prototype=new n,this.prototype,this.prototype.constructor=n,this}),VERB.core.Engine=function(n){var e="function"==typeof Worker&&(n.use_pool||void 0===n.use_pool),t=n.num_workers||2,r=n.tolerance||1e-4,i=n.url||"verb_nurbs_eval.js";n.library||VERB.eval.nurbs;var o=n.error_handler||function(n){console.warn(n)},u=void 0,s=function(){try{u=new labor.Pool(i,t),u.start()}catch(n){return o("Failed to initialize labor.Pool."),!1}return!0};this.start=function(){e&&s()},this.eval=function(n,t,r){if(e&&(u||void 0===u&&s()))u.addWork(n,t,r);else{var i=this;_.defer(function(){r(i.eval_sync(n,t))})}},this.eval_sync=function(n,e){return _library[n].apply(null,e)},this.set_tolerance=function(n){r=n},this.set_use_pool=function(n){return n&&void 0===u&&s()?(e=n,!0):n?!1:(u=null,delete u,!0)},this.set_error_handler=function(n){o=n},this.set_num_threads=function(n){t=n}},VERB.core.uid=function(){var n=0;return function(){return n++}}(),VERB.geom.BoundingBox=function(){this.initialized=!1,this.min=[0,0,0],this.max=[0,0,0];var n=Array.prototype.slice.call(arguments,0);this.add_elements_sync(n)},VERB.geom.BoundingBox.prototype.add_elements=function(n,e){var t=this;_.defer(function(){_.each(n,function(n){t.add(n)}),e(t)})},VERB.geom.BoundingBox.prototype.add_elements_sync=function(n){var e=this;return _.each(n,function(n){e.add(n)}),this},VERB.geom.BoundingBox.prototype.add=function(n){return this.initialized?(n[0]>this.max[0]&&(this.max[0]=n[0]),n[1]>this.max[1]&&(this.max[1]=n[1]),n[2]>this.max[2]&&(this.max[2]=n[2]),n[0]<this.min[0]&&(this.min[0]=n[0]),n[1]<this.min[1]&&(this.min[1]=n[1]),n[2]<this.min[2]&&(this.min[2]=n[2]),this):(this.min=n.slice(0),this.max=n.slice(0),this.initialized=!0,this)},VERB.geom.BoundingBox.prototype.contains=function(n){return this.initialized?this.intersects(new VERB.geom.BoundingBox(n)):!1},VERB.geom.BoundingBox.prototype.TOLERANCE=1e-4,VERB.geom.BoundingBox.prototype.intervals_overlap=function(n,e,t,r){var i=VERB.geom.BoundingBox.prototype.TOLERANCE,o=Math.min(n,e)-i,u=Math.max(n,e)+i,s=Math.min(t,r)-i,a=Math.max(t,r)+i;return o>=s&&a>=o||u>=s&&a>=u||s>=o&&u>=s||a>=o&&u>=a?!0:!1},VERB.geom.BoundingBox.prototype.intersects=function(n){if(!this.initialized||!n.initialized)return!1;var e=this.min,t=this.max,r=n.min,i=n.max;return this.intervals_overlap(e[0],t[0],r[0],i[0])&&this.intervals_overlap(e[1],t[1],r[1],i[1])&&this.intervals_overlap(e[2],t[2],r[2],i[2])?!0:!1},VERB.geom.BoundingBox.prototype.clear=function(){return this.initialized=!1,this},VERB.geom.BoundingBox.prototype.get_longest_axis=function(){var n=[this.get_axis_length[0],this.get_axis_length[1],this.get_axis_length[2]];return Math.max.apply(Math,n)},VERB.geom.BoundingBox.prototype.get_axis_length=function(n){return 0>n||n>2?0:Math.abs(this.min[n]-this.max[n])},VERB.geom.BoundingBox.prototype.intersect=function(n){if(!this.initialized)return null;var e=this.min,t=this.max,r=n.min,i=n.max;if(!this.intersects(n))return null;var o=Math.min(t[0],i[0]),u=Math.max(e[0],r[0]),s=Math.min(t[1],i[1]),a=Math.max(e[1],r[1]),l=Math.min(t[2],i[2]),c=Math.max(e[2],r[2]),_=[o,s,l],v=[u,a,c];return new VERB.geom.BoundingBox(v,_)},VERB.geom.Geometry=function(){var n=VERB.core.uid();this.uid=function(){return n}},function(){function n(n,e,t){this.obj=n,this.left=null,this.right=null,this.parent=t,this.dimension=e}function e(e,r,i){function o(e,t,r){var u,s,a=t%i.length;return 0===e.length?null:1===e.length?new n(e[0],a,r):(e.sort(function(n,e){return n[i[a]]-e[i[a]]}),u=Math.floor(e.length/2),s=new n(e[u],a,r),s.left=o(e.slice(0,u),t+1,s),s.right=o(e.slice(u+1),t+1,s),s)}var u=this;this.root=o(e,0,null),this.insert=function(e){function t(n,r){if(null===n)return r;var o=i[n.dimension];return e[o]<n.obj[o]?t(n.left,n):t(n.right,n)}var r,o,u=t(this.root,null);return null===u?(this.root=new n(e,0,null),void 0):(r=new n(e,(u.dimension+1)%i.length,u),o=i[u.dimension],e[o]<u.obj[o]?u.left=r:u.right=r,void 0)},this.remove=function(n){function e(t){if(null===t)return null;if(t.obj===n)return t;var r=i[t.dimension];return n[r]<t.obj[r]?e(t.left,t):e(t.right,t)}function t(n){function e(n,t){var r,o,u,s,a;return null===n?null:(r=i[t],n.dimension===t?null!==n.right?e(n.right,t):n:(o=n.obj[r],u=e(n.left,t),s=e(n.right,t),a=n,null!==u&&u.obj[r]>o&&(a=u),null!==s&&s.obj[r]>a.obj[r]&&(a=s),a))}function r(n,e){var t,o,u,s,a;return null===n?null:(t=i[e],n.dimension===e?null!==n.left?r(n.left,e):n:(o=n.obj[t],u=r(n.left,e),s=r(n.right,e),a=n,null!==u&&o>u.obj[t]&&(a=u),null!==s&&s.obj[t]<a.obj[t]&&(a=s),a))}var o,s,a;return null===n.left&&null===n.right?null===n.parent?(u.root=null,void 0):(a=i[n.parent.dimension],n.obj[a]<n.parent.obj[a]?n.parent.left=null:n.parent.right=null,void 0):(o=null!==n.left?e(n.left,n.dimension):r(n.right,n.dimension),s=o.obj,t(o),n.obj=s,void 0)}var r;r=e(u.root),null!==r&&t(r)},this.nearest=function(n,e,o){function s(t){function o(n,t){c.push([n,t]),c.size()>e&&c.pop()}var u,a,l,_,v=i[t.dimension],h=r(n,t.obj),m={};for(_=0;i.length>_;_+=1)m[i[_]]=_===t.dimension?n[i[_]]:t.obj[i[_]];return a=r(m,t.obj),null===t.right&&null===t.left?((e>c.size()||c.peek()[1]>h)&&o(t,h),void 0):(u=null===t.right?t.left:null===t.left?t.right:n[v]<t.obj[v]?t.left:t.right,s(u),(e>c.size()||c.peek()[1]>h)&&o(t,h),(e>c.size()||Math.abs(a)<c.peek()[1])&&(l=u===t.left?t.right:t.left,null!==l&&s(l)),void 0)}var a,l,c;if(c=new t(function(n){return-n[1]}),o)for(a=0;e>a;a+=1)c.push([null,o]);for(s(u.root),l=[],a=0;e>a;a+=1)c.content[a][0]&&l.push([c.content[a][0].obj,c.content[a][1]]);return l},this.balanceFactor=function(){function n(e){return null===e?0:Math.max(n(e.left),n(e.right))+1}function e(n){return null===n?0:e(n.left)+e(n.right)+1}return n(u.root)/(Math.log(e(u.root))/Math.log(2))}}function t(n){this.content=[],this.scoreFunction=n}t.prototype={push:function(n){this.content.push(n),this.bubbleUp(this.content.length-1)},pop:function(){var n=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),n},peek:function(){return this.content[0]},remove:function(n){for(var e=this.content.length,t=0;e>t;t++)if(this.content[t]==n){var r=this.content.pop();return t!=e-1&&(this.content[t]=r,this.scoreFunction(r)<this.scoreFunction(n)?this.bubbleUp(t):this.sinkDown(t)),void 0}throw Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(n){for(var e=this.content[n];n>0;){var t=Math.floor((n+1)/2)-1,r=this.content[t];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[t]=e,this.content[n]=r,n=t}},sinkDown:function(n){for(var e=this.content.length,t=this.content[n],r=this.scoreFunction(t);;){var i=2*(n+1),o=i-1,u=null;if(e>o){var s=this.content[o],a=this.scoreFunction(s);r>a&&(u=o)}if(e>i){var l=this.content[i],c=this.scoreFunction(l);(null==u?r:a)>c&&(u=i)}if(null==u)break;this.content[n]=this.content[u],this.content[u]=t,n=u}}},VERB.geom.KDTree=e}(VERB),VERB.geom.NurbsCurve=function(n,e,t,r){if(VERB.geom.NURBSGeometry.call(this),VERB.eval.nurbs.are_valid_relations(n,e.length,r.length))var i=e.slice(0),o=VERB.eval.nurbs.homogenize_1d(e,t),u=r.slice(0),s=t.slice(0),a=n;else{console.warn("Invalid relations were used to instantiate a NurbsCurve - using defaults.");var i=[],o=[],u=[],s=[],a=2}this.set_control_point=function(n,e){return i[n]=e,o[n]=e*s[n],this},this.set_weight=function(n,e){return s[n]=e,set_control_point(n,i[n]),this},this.set_knot=function(n,e){return u[n]=e,this},this.point_sync=function(n){return this.nurbs_engine.eval_sync("rational_curve_point",[a,_knot_vector,o,n])},this.derivs_sync=function(n,e){return this.nurbs_engine.eval_sync("rational_curve_derivs",[a,_knot_vector,o,n,e])},this.point=function(n,e){nurbs_engine.eval("rational_curve_point",[a,_knot_vector,o,n],e)},this.derivs=function(n,e,t){this.nurbs_engine.eval("rational_curve_derivs",[a,_knot_vector,o,n,e],t)}},VERB.geom.NURBSGeometry=function(){VERB.geom.Geometry.call(this)}.inherits(VERB.geom.Geometry),VERB.geom.NurbsSurface=function(n,e,t,r){VERB.geom.NURBSGeometry.call(this),e.slice(0),r.slice(0),t.slice(0),this.set_control_point=function(){},this.set_weight=function(){},this.set_control_point=function(){},this.point=function(){},this.derivs=function(){}}.inherits(VERB.geom.NURBSGeometry),VERB.geom.Vector=function(n,e,t){3==arguments.length?(this.x=n,this.y=e,this.z=t):"x"in n?(this.x=n.x,this.y=n.y,this.z=n.z):(this.x=n[0],this.y=n[1],this.z=n[2])},VERB.geom.Vector.prototype={clone:function(){return new VERB.geom.Vector(this.x,this.y,this.z)},negated:function(){return new VERB.geom.Vector(-this.x,-this.y,-this.z)},plus:function(n){return new VERB.geom.Vector(this.x+n.x,this.y+n.y,this.z+n.z)},minus:function(n){return new VERB.geom.Vector(this.x-n.x,this.y-n.y,this.z-n.z)},times:function(n){return new VERB.geom.Vector(this.x*n,this.y*n,this.z*n)},dividedBy:function(n){return new VERB.geom.Vector(this.x/n,this.y/n,this.z/n)},dot:function(n){return this.x*n.x+this.y*n.y+this.z*n.z},lerp:function(n,e){return this.plus(n.minus(this).times(e))},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.dividedBy(this.length())},cross:function(n){return new VERB.geom.Vector(this.y*n.z-this.z*n.y,this.z*n.x-this.x*n.z,this.x*n.y-this.y*n.x)}},VERB.eval.nurbs.rational_surface_surface_intersect=function(){},VERB.eval.mesh.mesh_mesh_intersect=function(){},VERB.eval.mesh.mesh_mesh_intersect_aabb=function(){},VERB.eval.mesh.make_mesh_aabb=function(){},VERB.eval.mesh.make_mesh_aabb=function(n,e,t){for(var r={bounding_box:new VERB.geom.BoundingBox,children:[]},i=t.length-1;i>=0;i--){var o=t[i];r.bounding_box.add(n[e[o][0]]),r.bounding_box.add(n[e[o][1]]),r.bounding_box.add(n[e[o][2]])}return 1===t.length?(r.elements=t,r):(r.children=[VERB.eval.mesh.make_mesh_aabb(n,e,tri_indices_a),VERB.eval.mesh.make_mesh_aabb(n,e,tri_indices_b)],r)},VERB.eval.mesh.make_mesh_aabb=function(){},VERB.eval.mesh.rational_surface_tesselate_naive=function(n,e,t,r,i,o,u){1>o&&(o=1),1>u&&(u=1);for(var s=1/o,a=1/u,l=[],c=[],_=0;o+1>_;_++)for(var v=0;u+1>v;v++){var h=_*s,m=v*a;c.push([h,m]),l.push(VERB.eval.nurbs.rational_surface_point(n,e,t,r,i,h,m))}for(var f=[],_=0;o>_;_++)for(var v=0;u>v;v++){var b=_*(u+1)+v,g=(_+1)*(u+1)+v,B=g+1,p=b+1,d=[b,g,B],V=[b,B,p];f.push(d),f.push(V)}return{points:l,faces:f,uvs:c}},VERB.eval.nurbs.rational_curve_curve_bb_intersect_refine=function(n,e,t,r,i,o,u){var s=function(u){var s=VERB.eval.nurbs.rational_curve_point(n,e,t,u[0]),a=VERB.eval.nurbs.rational_curve_point(r,i,o,u[1]);return numeric.sub(s,a),numeric.dot(p1_p2norm,p1_p2norm)},a=numeric.uncmin(s,u);return[a.f].concat(a.solution)},VERB.eval.nurbs.rational_curve_curve_bb_intersect=function(n,e,t,r,i,o,u,s){var a=VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(n,e,t,u),l=VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(n,e,t,u),c=_.map(a,function(n){return n[0]}),v=_.map(l,function(n){return n[0]}),h=_.map(a,function(n){return n.slice(1)}),m=_.map(l,function(n){return n.slice(1)});return VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(h,m,c,v,s)},VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect=function(n,e,t,r,i){var o=new VERB.geom.BoundingBox(n),u=new VERB.geom.BoundingBox(e);if(o.intersects(u)){if(2!==n.length||2!==e.length){if(2===n.length){var s=Math.ceil(e.length/2),a=e.slice(0,s),l=r.slice(0,s),c=e.slice(s-1);return b=e.slice(s-1),VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(n,a,t,l,i).concat(VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(n,c,t,b,i))}if(2===e.length){var _=Math.ceil(n.length/2),v=n.slice(0,_),h=t.slice(0,_),m=n.slice(_-1);return f=n.slice(_-1),VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(e,v,r,v,i).concat(VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(e,m,r,f,i))}var _=Math.ceil(n.length/2),v=n.slice(0,_),h=t.slice(0,_),m=n.slice(_-1),f=n.slice(_-1),s=Math.ceil(e.length/2),a=e.slice(0,s),l=r.slice(0,s),c=e.slice(s-1),b=e.slice(s-1);return VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(v,a,h,a,i).concat(VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(v,c,h,b,i)).concat(VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(m,a,f,l,i)).concat(VERB.eval.nurbs.parametric_polyline_polyline_bb_intersect(m,c,f,b,i))}var g=VERB.eval.geom.segment_segment_intersect(n[0],n[1],e[0],e[1],i);return null!=g?(g[0][0]=g[0][0]*(t[1]-t[0])+t[0],g[1][0]=g[1][0]*(r[1]-r[0])+r[0],g):[]}},VERB.eval.geom.segment_segment_intersect=function(n,e,t,r){var i=numeric.sub(e,n),o=Math.sqrt(numeric.dot(i,i)),u=numeric.mul(1/o,i);if(b1mb0=numeric.sub(r,t),bN=Math.sqrt(numeric.dot(b1mb0,b1mb0)),u=numeric.mul(1/bN,i),int_params=ray_ray_intersect(n,u,t,b),null!=int_params){var s=Math.min(Math.max(0,int_params[0]/u),1),a=Math.min(Math.max(0,int_params[1]/b),1),l=numeric.add(numeric.mul(s,i),n),c=numeric.add(numeric.mul(a,b1mb0),t),_=numeric.norm2Squared(numeric.sub(l,c));if(tolerance*tolerance>_)return[[s].concat(l),[a].concat(c)]}return null},VERB.eval.geom.ray_ray_intersect=function(n,e,t,r){var i=numeric.dot(e,r),o=numeric.dot(e,t),u=numeric.dot(e,n),s=numeric.dot(r,t),a=numeric.dot(r,n),l=numeric.dot(e,e),c=numeric.dot(r,r),_=l*c-i*i;if(EPSILON>abs(_))return null;var v=i*(o-u)-l*(s-a),h=v/_,m=(o-u+h*i)/l;return[m,h]},VERB.eval.nurbs.rational_curve_regular_sample=function(n,e,t,r){return VERB.eval.nurbs.rational_curve_regular_sample_range(n,e,t,0,1,r)},VERB.eval.nurbs.rational_curve_regular_sample_range=function(n,e,t,r,i,o){1>o&&(o=2);for(var u=[],s=(i-r)/(o-1),a=0,l=0;o>l;l++)a=r+s*l,u.push([a].concat(VERB.eval.nurbs.rational_curve_point(n,e,t,a)));return u},VERB.eval.nurbs.rational_curve_adaptive_sample=function(n,e,t,r){return VERB.eval.nurbs.rational_curve_adaptive_sample_range(n,e,t,0,1,r)},VERB.eval.nurbs.rational_curve_adaptive_sample_range=function(n,e,t,r,i,o){var u=VERB.eval.nurbs.rational_curve_point(n,e,t,r),s=VERB.eval.nurbs.rational_curve_point(n,e,t,i),a=.45+.1*Math.random(),l=r+(i-r)*a,c=VERB.eval.nurbs.rational_curve_point(n,e,t,l);if(VERB.eval.nurbs.three_points_are_flat(u,c,s,o))return[[r,u[0],u[1],u[2]],[i,s[0],s[1],s[2]]];var _=VERB.eval.nurbs.rational_curve_adaptive_sample_range(n,e,t,r,l,o),v=VERB.eval.nurbs.rational_curve_adaptive_sample_range(n,e,t,l,i,o);return _.slice(0,-1).concat(v)},VERB.eval.nurbs.three_points_are_flat=function(n,e,t,r){var i=new VERB.geom.Vector(n),o=new VERB.geom.Vector(e),u=new VERB.geom.Vector(t),s=o.minus(i).cross(u.minus(i)),a=s.dot(s);return r>a},VERB.eval.nurbs.curve_knot_insert=function(n,e,t,r,i,o){var u=(t[0].length,e.length-n-2),s=t.length,a=VERB.eval.nurbs.knot_span(n,r,e),l=u+n+1,c=s+o,_=Array(n+1),v=Array(e.length+o),h=Array(c),m=0;for(m=0;a>=m;m++)v[m]=e[m];for(m=1;o>=m;m++)v[a+m]=r;for(m=a+1;l>=m;m++)v[m+o]=e[m];for(m=0;a-n>=m;m++)h[m]=t[m];for(m=a-i;u>=m;m++)h[m+o]=t[m];for(m=0;n-i>=m;m++)_[m]=t[a-n+1];for(var f=0,b=0,g=1;o>=g;g++){for(f=a-n+g,m=0;n-g-i>=m;m++)b=(r-e[f+m])/(e[m+a+1]-e[f+m]),_[m]=numeric.add(numeric.mul(b,_[m+1]),numeric.mul(1-b,_[m]));h[f]=_[0],h[a+o-g-i]=_[n-g-i]}for(m=f+1;a-i>m;m++)h[m]=_[m-f];return[v,h]},VERB.eval.nurbs.rational_surface_derivs=function(n,e,t,r,i,o,u,s){var a=VERB.eval.nurbs.surface_derivs(n,e,t,r,i,o,u,s),l=VERB.eval.nurbs.separate_homo_derivs_2d(a),c=l[0],_=l[1],v=0,h=0,m=0,f=0,b=[],g=c[0][0].length;for(v=0;o>=v;v++)for(b.push([]),f=0;o-v>=f;f++){var s=c[v][f];for(m=1;f>=m;m++)s=numeric.sub(s,numeric.mul(numeric.mul(binomial.get(f,m),_[0][m]),b[v][f-m]));for(h=1;v>=h;h++){s=numeric.sub(s,numeric.mul(numeric.mul(binomial.get(v,h),_[h][0]),b[v-h][f]));var B=VERB.eval.nurbs.zeros_1d(g);for(m=1;f>=m;m++)B=numeric.add(B,numeric.mul(numeric.mul(binomial.get(f,m),_[h][m]),b[v-h][f-m]));s=numeric.sub(s,numeric.mul(binomial.get(v,h),B))}b[v].push(numeric.mul(1/_[0][0],s))}return b},VERB.eval.nurbs.rational_surface_point=function(n,e,t,r,i,o,u){return VERB.eval.nurbs.dehomogenize(VERB.eval.nurbs.surface_point(n,e,t,r,i,o,u))},VERB.eval.nurbs.rational_curve_derivs=function(n,e,t,r,i){var o=VERB.eval.nurbs.separate_homo_derivs_1d(VERB.eval.nurbs.curve_derivs(n,e,t,r,i)),u=o[0],s=o[1],a=0,l=0,c=[];for(a=0;i>=a;a++){var _=u[a];for(l=1;a>=l;l++)_=numeric.sub(_,numeric.mul(numeric.mul(binomial.get(a,l),s[l]),c[a-l]));c.push(numeric.mul(1/s[0],_))}return c},VERB.eval.nurbs.separate_homo_derivs_1d=function(n){for(var e=n[0].length,t=e-1,r=[],i=[],o=0,u=n.length;u>o;o++)r.push(n[o].slice(0,t)),i.push(n[o][t]);return[r,i]},VERB.eval.nurbs.separate_homo_derivs_2d=function(n){for(var e=[],t=[],r=0,i=n.length;i>r;r++){var o=VERB.eval.nurbs.separate_homo_derivs_1d(n[r]);e.push(o[0]),t.push(o[1])}return[e,t]},VERB.eval.nurbs.rational_curve_point=function(n,e,t,r){return VERB.eval.nurbs.dehomogenize(VERB.eval.nurbs.curve_point(n,e,t,r))},VERB.eval.nurbs.dehomogenize=function(n){for(var e=n.length,t=[],r=n[e-1],i=0;n.length-1>i;i++)t.push(n[i]/r);return t},VERB.eval.nurbs.homogenize_1d=function(n,e){for(var t=n.length,r=n[0].length,i=0,o=[],u=0,s=[],a=0;t>a;a++){var l=[];for(s=n[a],u=e[a],i=0;r>i;i++)l.push(s[i]*u);l.push(u),o.push(l)}return o},VERB.eval.nurbs.homogenize_2d=function(n,e){for(var t=n.length,r=(n[0].length,n[0][0].length,[]),i=0;t>i;i++)r.push(VERB.eval.nurbs.homogenize_1d(n[i],e[i]));return r},VERB.eval.nurbs.surface_derivs=function(n,e,t,r,i,o,u,s){var a=e.length-n-2,l=r.length-t-2;return VERB.eval.nurbs.surface_derivs_given_n_m(a,n,e,l,t,r,i,o,u,s)},VERB.eval.nurbs.surface_derivs_given_n_m=function(n,e,t,r,i,o,u,s,a,l){if(VERB.eval.nurbs.are_valid_relations(e,u.length,t.length)===!1||VERB.eval.nurbs.are_valid_relations(i,u[0].length,o.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var c=u[0][0].length,_=Math.min(s,e),v=Math.min(s,i),h=VERB.eval.nurbs.zeros_3d(_+1,v+1,c),m=VERB.eval.nurbs.knot_span_given_n(n,e,a,t),f=VERB.eval.nurbs.knot_span_given_n(r,i,l,o),b=VERB.eval.nurbs.deriv_basis_functions_given_n_i(m,a,e,n,t),g=VERB.eval.nurbs.deriv_basis_functions_given_n_i(f,l,i,r,o),B=VERB.eval.nurbs.zeros_2d(i+1,c),p=0,d=0,V=0,E=0,R=0;for(p=0;_>=p;p++){for(d=0;i>=d;d++)for(B[d]=VERB.eval.nurbs.zeros_1d(c),V=0;e>=V;V++)B[d]=numeric.add(B[d],numeric.mul(b[p][V],u[m-e+V][f-i+d]));for(R=Math.min(s-p,v),E=0;R>=E;E++)for(h[p][E]=VERB.eval.nurbs.zeros_1d(c),d=0;i>=d;d++)h[p][E]=numeric.add(h[p][E],numeric.mul(g[E][d],B[d]))}return h},VERB.eval.nurbs.surface_point=function(n,e,t,r,i,o,u){var s=e.length-n-2,a=r.length-t-2;return VERB.eval.nurbs.surface_point_given_n_m(s,n,e,a,t,r,i,o,u)},VERB.eval.nurbs.surface_point_given_n_m=function(n,e,t,r,i,o,u,s,a){if(VERB.eval.nurbs.are_valid_relations(e,u.length,t.length)===!1||VERB.eval.nurbs.are_valid_relations(i,u[0].length,o.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var l=(u[0][0].length,VERB.eval.nurbs.knot_span_given_n(n,e,s,t)),c=VERB.eval.nurbs.knot_span_given_n(r,i,a,o),_=VERB.eval.nurbs.basis_functions_given_knot_span_index(l,s,e,t),v=VERB.eval.nurbs.basis_functions_given_knot_span_index(c,a,i,o),h=l-e,m=c,f=VERB.eval.nurbs.zeros_1d(u[0][0].length),b=VERB.eval.nurbs.zeros_1d(u[0][0].length),g=0,B=0;for(g=0;i>=g;g++){for(b=VERB.eval.nurbs.zeros_1d(u[0][0].length),m=c-i+g,B=0;e>=B;B++)b=numeric.add(b,numeric.mul(_[B],u[h+B][m]));f=numeric.add(f,numeric.mul(v[g],b))}return f},VERB.eval.nurbs.curve_derivs=function(n,e,t,r,i){var o=e.length-n-2;return VERB.eval.nurbs.curve_derivs_given_n(o,n,e,t,r,i)},VERB.eval.nurbs.curve_derivs_given_n=function(n,e,t,r,i,o){if(VERB.eval.nurbs.are_valid_relations(e,r.length,t.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var u=r[0].length,s=Math.min(o,e),a=VERB.eval.nurbs.zeros_2d(s+1,u),l=VERB.eval.nurbs.knot_span_given_n(n,e,i,t),c=VERB.eval.nurbs.deriv_basis_functions_given_n_i(l,i,e,s,t),_=0,v=0;for(_=0;s>=_;_++)for(v=0;e>=v;v++)a[_]=numeric.add(a[_],numeric.mul(c[_][v],r[l-e+v]));return a},VERB.eval.nurbs.are_valid_relations=function(n,e,t){return 0===e+n+1-t?!0:!1},VERB.eval.nurbs.curve_point=function(n,e,t,r){var i=e.length-n-2;return VERB.eval.nurbs.curve_point_given_n(i,n,e,t,r)},VERB.eval.nurbs.curve_point_given_n=function(n,e,t,r,i){if(VERB.eval.nurbs.are_valid_relations(e,r.length,t.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;for(var o=VERB.eval.nurbs.knot_span_given_n(n,e,i,t),u=VERB.eval.nurbs.basis_functions_given_knot_span_index(o,i,e,t),s=VERB.eval.nurbs.zeros_1d(r[0].length),a=0;e>=a;a++)s=numeric.add(s,numeric.mul(u[a],r[o-e+a]));return s},VERB.eval.nurbs.zeros_1d=function(n){n=n>0?n:0;for(var e=[];n--;)e.push(0);return e},VERB.eval.nurbs.zeros_2d=function(n,e){e=e>0?e:0,n=n>0?n:0;for(var t=[],r=e,i=n;n--;){for(t.push([]);r--;)t[i-n-1].push(0);r=e}return t},VERB.eval.nurbs.zeros_3d=function(n,e,t){e=e>0?e:0,n=n>0?n:0;for(var r=[],i=e,o=n;n--;){for(r.push([]);i--;)r[o-n-1].push(VERB.eval.nurbs.zeros_1d(t));i=e}return r},VERB.eval.nurbs.deriv_basis_functions=function(n,e,t){var r=VERB.eval.nurbs.knot_span(e,n,t),i=t.length-1,o=i-e-1;return VERB.eval.nurbs.deriv_basis_functions_given_n_i(r,n,e,o,t)},VERB.eval.nurbs.deriv_basis_functions_given_n_i=function(n,e,t,r,i){var o=VERB.eval.nurbs.zeros_2d(t+1,t+1),u=Array(t+1),s=Array(t+1),a=0,l=0,c=1,_=0;for(o[0][0]=1,c=1;t>=c;c++){for(u[c]=e-i[n+1-c],s[c]=i[n+c]-e,a=0,_=0;c>_;_++)o[c][_]=s[_+1]+u[c-_],l=o[_][c-1]/o[c][_],o[_][c]=a+s[_+1]*l,a=u[c-_]*l;o[c][c]=a}var v=VERB.eval.nurbs.zeros_2d(r+1,t+1),h=VERB.eval.nurbs.zeros_2d(2,t+1),m=1,f=0,b=1,g=0,B=0,p=0,d=0,V=0;for(c=0;t>=c;c++)v[0][c]=o[c][t];for(_=0;t>=_;_++)for(f=0,b=1,h[0][0]=1,m=1;r>=m;m++){for(g=0,B=_-m,p=t-m,_>=m&&(h[b][0]=h[f][0]/o[p+1][B],g=h[b][0]*o[B][p]),d=B>=-1?1:-B,V=p>=_-1?m-1:t-_,c=d;V>=c;c++)h[b][c]=(h[f][c]-h[f][c-1])/o[p+1][B+c],g+=h[b][c]*o[B+c][p];p>=_&&(h[b][m]=-h[f][m-1]/o[p+1][_],g+=h[b][m]*o[_][p]),v[m][_]=g,c=f,f=b,b=c}for(_=t,m=1;r>=m;m++){for(c=0;t>=c;c++)v[m][c]*=_;_*=t-m}return v},VERB.eval.nurbs.basis_functions=function(n,e,t){var r=VERB.eval.nurbs.knot_span(n,e,t);return VERB.eval.nurbs.basis_functions_given_knot_span_index(r,n,e,t)},VERB.eval.nurbs.basis_functions_given_knot_span_index=function(n,e,t,r){var i=Array(t+1),o=Array(t+1),u=Array(t+1),s=0,a=0;i[0]=1;for(var l=1;t>=l;l++){o[l]=e-r[n+1-l],u[l]=r[n+l]-e,s=0;for(var c=0;l>c;c++)a=i[c]/(u[c+1]+o[l-c]),i[c]=s+u[c+1]*a,s=o[l-c]*a;i[l]=s}return i},VERB.eval.nurbs.knot_span=function(n,e,t){var r=t.length-1,i=r-n-1;return VERB.eval.nurbs.knot_span_given_n(i,n,e,t)},VERB.eval.nurbs.knot_span_given_n=function(n,e,t,r){if(t>=r[n+1])return n;if(r[e]>t)return e;for(var i=e,o=n+1,u=Math.floor((i+o)/2);r[u]>t||t>=r[u+1];)r[u]>t?o=u:i=u,u=Math.floor((i+o)/2);return u};