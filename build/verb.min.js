/*! verb 2014-01-21 */
function crossprod(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]}if("object"!=typeof exports||void 0===exports)var verb={},numeric=window.numeric,binomial=window.binomial,labor=window.labor,_=window.underscore;else var verb=module.exports={},numeric=require("numeric"),binomial=require("binomial"),labor=require("labor"),_=require("underscore");verb.geom=verb.geom||{},verb.core=verb.core||{},verb.eval=verb.eval||{},verb.intersect=verb.intersect||{},verb.eval.nurbs=verb.eval.nurbs||{},verb.eval.geom=verb.eval.geom||{},verb.eval.mesh=verb.eval.mesh||{},verb.EPSILON=1e-8,verb.TOLERANCE=.001,verb.init=function(){verb.nurbsEngine=new verb.core.Engine(verb.eval.nurbs),verb.geom.NurbsGeometry.prototype.nurbsEngine=verb.nurbsEngine},Function.prototype.method=function(e,r){return this.prototype[e]=r,this},Function.method("inherits",function(e){return this.prototype=new e,this.prototype,this.prototype.constructor=e,this}),Array.prototype.flatten=function(){if(0==this.length)return[];for(var e=[],r=0;this.length>r;r++)e=this[r]instanceof Array?e.concat(this[r].flatten()):e.concat(this[r]);return e},numeric.normalized=function(e){return numeric.div(e,numeric.norm2(e))},numeric.cross=function(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]},verb.left=function(e){if(0===e.length)return[];var r=Math.ceil(e.length/2);return e.slice(0,r)},verb.right=function(e){if(0===e.length)return[];var r=Math.ceil(e.length/2);return e.slice(r)},verb.rightWithPivot=function(e){if(0===e.length)return[];var r=Math.ceil(e.length/2);return e.slice(r-1)},verb.unique=function(e,r){if(0===e.length)return[];for(var n=[e.pop()],t=0;e.length>t;t++){for(var i=e.pop(),s=!0,a=0;n.length>a;a++)if(r(i,n[t])){s=!1;break}s&&n.push(i)}return n},verb.range=function(e,r,n){1>=arguments.length&&(r=e||0,e=0),n=arguments[2]||1;for(var t=Math.max(Math.ceil((r-e)/n),0),i=0,s=Array(t);t>i;)s[i++]=e,e+=n;return s},verb.core.Engine=function(e){var r="function"==typeof Worker&&(e.use_pool||void 0===e.use_pool),n=e.num_workers||2,t=e.tolerance||1e-4,i=e.url||"js/verbEval.js",s=e.library||verb.eval.nurbs,a=e.error_handler||function(e){console.warn(e)},o=void 0,u=function(){try{o=new labor.Pool(i,n),o.start()}catch(e){return a("Failed to initialize labor.Pool: "+e),!1}return!0},v=function(e,r){return s[e].apply(null,r)};this.start=function(){r&&u()},this.eval=function(e,n,t){return t?(r&&(o||void 0===o&&u())?o.addWork(e,n,t):setTimeout(function(){t(v(e,n))},0),void 0):v(e,n)},this.setTolerance=function(e){t=e},this.setUsePool=function(e){return e&&void 0===o&&u()?(r=e,!0):e?!1:(o=null,delete o,!0)},this.setErrorHandler=function(e){a=e},this.setNumThreads=function(e){n=e}},verb.core.WatchObject=function(){var e={change:{}},r={},t=0,i=this,s=function(r,t){if("string"==typeof r){for(ele in e[r])e[r][ele](t);for(ele in e.change)e.change[ele](t)}else for(n in r)s(n,t)};this.get=function(e){return r[e]},this.set=function(n,t){var a=r[n];r[n]=t,e[n]=e[n]||{},s(n,{name:n,old:a,"new":t,target:i,type:"full"})},this.setAll=function(n){var t={};for(propName in n)t[propName]=r[propName],r[propName]=n[propName],e[propName]=e[propName]||{};s(n,{old:t,"new":n,target:i,type:"multi"})},this.setAt=function(e,n,t){var a=r[e];if(!(void 0===a||a.length>=n||0>n)){var o=r[e][n];r[e][n]=t,s(e,{name:e,index:n,old:o,"new":t,target:i,type:"index"})}},this.watch=function(n,i){return void 0!==r[n]&&i?(t++,e[n][t]=i,t++):void 0},this.watchAll=function(e,r){for(var n=[],t=0;e.length>t;t++)n.push(this.watch(e[t],r));return n},this.ignore=function(r,n){void 0!==e[r]&&void 0!==e[r][n]&&(e[r][n]=void 0)}},verb.core.uid=function(){var e=0;return function(){return e++}}(),verb.geom.Geometry=function(){verb.core.WatchObject.call(this);var e=verb.core.uid();this.uniqueId=function(){return e}}.inherits(verb.core.WatchObject),verb.geom.NurbsGeometry=function(){verb.geom.Geometry.call(this)}.inherits(verb.geom.Geometry),verb.geom.NurbsCurve=function(e,r,n,t){verb.geom.NurbsGeometry.call(this),this.setAll({controlPoints:r,weights:n,knots:t?t.slice(0):[],degree:e})}.inherits(verb.geom.NurbsGeometry),verb.geom.NurbsCurve.prototype.point=function(e,r){return this.nurbsEngine.eval("rational_curve_point",[this.get("degree"),this.get("knots"),this.homogenize(),e],r)},verb.geom.NurbsCurve.prototype.derivatives=function(e,r,n){return this.nurbsEngine.eval("rational_curve_derivs",[this.get("degree"),this.get("knots"),this.homogenize(),e,r],n)},verb.geom.NurbsCurve.prototype.tesselate=function(e,r){var e=e||{};return e.tolerance=e.tolerance||verb.EPSILON,this.nurbsEngine.eval("rational_curve_adaptive_sample",[this.get("degree"),this.get("knots"),this.homogenize(),e.tolerance],r)},verb.geom.NurbsCurve.prototype.transform=function(e){for(var r=this.get("controlPoints"),n=0;r.length>n;n++){var t=r[1].push(1);r[n]=numeric.mul(e,t).slice(0,t.length-2)}return this.set("controlPoints",r),this},verb.geom.NurbsCurve.prototype.clone=function(){for(var e=this.get("controlPoints"),r=[],n=0;e.length>n;n++)r.push(e[n].slice(0));return new verb.geom.NurbsCurve(this.get("degree"),r,this.get("weights").slice(0),this.get("knots").slice)},verb.geom.NurbsCurve.prototype.homogenize=function(){return verb.eval.nurbs.homogenize_1d(this.get("controlPoints"),this.get("weights"))},verb.geom.NurbsCurve.prototype.update=function(){if(this.nurbsRep){var e=this.nurbsRep();this.setAll({controlPoints:e.control_points,weights:e.weights,knots:e.knots,degree:e.degree})}},verb.geom.NurbsSurface=function(e,r,n,t,i,s){verb.geom.NurbsGeometry.call(this),this.setAll({controlPoints:i,weights:s,knotsU:r?r.slice(0):[],knotsV:t?t.slice(0):[],degreeU:e,degreeV:n})}.inherits(verb.geom.NurbsGeometry),verb.geom.NurbsSurface.prototype.point=function(e,r,n){return this.nurbsEngine.eval("rational_surface_point",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),e,r],n)},verb.geom.NurbsSurface.prototype.derivatives=function(e,r,n,t){return this.nurbsEngine.eval("rational_surface_derivs",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),n,e,r],t)},verb.geom.NurbsSurface.prototype.tesselate=function(e,r){var n=20,t=20;return e&&(n=e.minDivsV||n,t=e.minDivsU||t),this.nurbsEngine.eval("tesselate_rational_surface_naive",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),t,n],r)},verb.geom.NurbsSurface.prototype.transform=function(e){for(var r=this.get("controlPoints"),n=0;r.length>n;n++)for(var t=0;r[n].length>t;t++){var i=r[1].push(1);r[n]=numeric.mul(e,i).slice(0,i.length-2)}return this.set("controlPoints",r),this},verb.geom.NurbsSurface.prototype.clone=function(){for(var e=this.get("controlPoints"),r=[],n=0;e.length>n;n++){r.push([]);for(var t=0;e[n].length>t;t++)r[n].push(e[n][t].slice(0))}for(var i=this.get("weights"),s=[],n=0;i.length>n;n++)s.push(i[n].slice(0));return new verb.geom.NurbsSurface(this.get("degreeU"),this.get("knotsU").slice(0),this.get("degreeV"),this.get("knotsV").slice(0),r,s)},verb.geom.NurbsSurface.prototype.homogenize=function(){return verb.eval.nurbs.homogenize_2d(this.get("controlPoints"),this.get("weights"))},verb.geom.NurbsSurface.prototype.update=function(){if(this.nurbsRep){var e=this.nurbsRep();this.setAll({controlPoints:e.control_points,weights:e.weights,knotsU:e.knots_u,knotsV:e.knots_v,degreeU:e.degree_u,degreeV:e.degree_v})}},verb.geom.Arc=function(e,r,n,t,i){verb.geom.NurbsCurve.call(this),this.setAll({center:e,xaxis:r,yaxis:n,radius:t,interval:i}),this.update(),this.watchAll(["center","xaxis","yaxis","radius","interval"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Arc.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("radius"),this.get("interval").get("min"),this.get("interval").get("max")])},verb.geom.BezierCurve=function(e,r){verb.geom.NurbsCurve.call(this),this.setAll({controlPoints:e?e.slice(0):[],weights:r?r.slice(0):void 0}),this.update()}.inherits(verb.geom.NurbsCurve),verb.geom.BezierCurve.prototype.nurbsRep=function(){for(var e=this.get("controlPoints"),r=this.get("weights"),n=e.length-1,t=[],i=0;n+1>i;i++)t.push(0);for(var i=0;n+1>i;i++)t.push(1);if(void 0===r){r=[];for(var i=0;e.length>i;i++)r.push(1)}return{degree:n,knots:t,control_points:e,weights:r}},verb.geom.BoundingBox=function(){this.initialized=!1,this.min=[0,0,0],this.max=[0,0,0];var e=Array.prototype.slice.call(arguments,0);1===e.length&&e[0]instanceof Array&&e[0][0]instanceof Array?this.add_elements_sync(e[0]):this.add_elements_sync(e)},verb.geom.BoundingBox.prototype.add_elements=function(e,r){var n=this;setTimeout(function(){e.forEach(function(e){n.add(e)}),r(n)},0)},verb.geom.BoundingBox.prototype.add_elements_sync=function(e){var r=this;return e.forEach(function(e){r.add(e)}),this},verb.geom.BoundingBox.prototype.add=function(e){return this.initialized?(e[0]>this.max[0]&&(this.max[0]=e[0]),e[1]>this.max[1]&&(this.max[1]=e[1]),e[2]>this.max[2]&&(this.max[2]=e[2]),e[0]<this.min[0]&&(this.min[0]=e[0]),e[1]<this.min[1]&&(this.min[1]=e[1]),e[2]<this.min[2]&&(this.min[2]=e[2]),this):(this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this)},verb.geom.BoundingBox.prototype.contains=function(e,r){return this.initialized?this.intersects(new verb.geom.BoundingBox(e),r):!1},verb.geom.BoundingBox.prototype.TOLERANCE=1e-4,verb.geom.BoundingBox.prototype.intervals_overlap=function(e,r,n,t,i){var i=i||verb.geom.BoundingBox.prototype.TOLERANCE,s=Math.min(e,r)-i,a=Math.max(e,r)+i,o=Math.min(n,t)-i,u=Math.max(n,t)+i;return s>=o&&u>=s||a>=o&&u>=a||o>=s&&a>=o||u>=s&&a>=u?!0:!1},verb.geom.BoundingBox.prototype.intersects=function(e,r){if(!this.initialized||!e.initialized)return!1;var n=this.min,t=this.max,i=e.min,s=e.max;return this.intervals_overlap(n[0],t[0],i[0],s[0],r)&&this.intervals_overlap(n[1],t[1],i[1],s[1],r)&&this.intervals_overlap(n[2],t[2],i[2],s[2],r)?!0:!1},verb.geom.BoundingBox.prototype.clear=function(){return this.initialized=!1,this},verb.geom.BoundingBox.prototype.get_longest_axis=function(){var e=[this.get_axis_length(0),this.get_axis_length(1),this.get_axis_length(2)];return e.indexOf(Math.max.apply(Math,e))},verb.geom.BoundingBox.prototype.get_axis_length=function(e){return 0>e||e>2?0:Math.abs(this.min[e]-this.max[e])},verb.geom.BoundingBox.prototype.intersect=function(e,r){if(!this.initialized)return null;var n=this.min,t=this.max,i=e.min,s=e.max;if(!this.intersects(e,r))return null;var a=Math.min(t[0],s[0]),o=Math.max(n[0],i[0]),u=Math.min(t[1],s[1]),v=Math.max(n[1],i[1]),l=Math.min(t[2],s[2]),b=Math.max(n[2],i[2]),c=[a,u,l],h=[o,v,b];return new verb.geom.BoundingBox(h,c)},verb.geom.Circle=function(e,r,n,t){verb.geom.NurbsCurve.call(this),this.setAll({center:e,xaxis:r,yaxis:n,radius:t}),this.update(),this.watchAll(["center","xaxis","yaxis","radius"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Circle.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("radius"),0,2*Math.PI])},verb.geom.Cone=function(e,r,n,t,i){verb.geom.NurbsSurface.call(this),this.setAll({axis:e,xaxis:r,base:n,height:t,radius:i});var s=this.nurbsRep();verb.geom.NurbsSurface.call(this,s.degree_u,s.knots_u,s.degree_v,s.knots_v,s.control_points,s.weights),this.watchAll(["axis","xaxis","base","height","radius"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Cone.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_cone_surface",[this.get("axis"),this.get("xaxis"),this.get("base"),this.get("height"),this.get("radius")])},verb.geom.Cylinder=function(e,r,n,t,i){this.setAll({axis:e,xaxis:r,base:n,height:t,radius:i});var s=this.nurbsRep();verb.geom.NurbsSurface.call(this,s.degree_u,s.knots_u,s.degree_v,s.knots_v,s.control_points,s.weights),this.watchAll(["axis","xaxis","base","height","radius"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Cylinder.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_cylinder_surface",[this.get("axis"),this.get("xaxis"),this.get("base"),this.get("height"),this.get("radius")])},verb.geom.Ellipse=function(e,r,n,t,i){verb.geom.NurbsCurve.call(this),this.setAll({center:e,xaxis:r,yaxis:n,xradius:t,yradius:i}),this.update(),this.watchAll(["center","xaxis","yaxis","xradius","yradius"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Ellipse.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_ellipse_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("xradius"),this.get("yradius"),0,2*Math.PI])},verb.geom.EllipseArc=function(e,r,n,t,i,s){verb.geom.NurbsCurve.call(this),this.setAll({center:e,xaxis:r,yaxis:n,xradius:t,yradius:i,interval:s}),this.update(),this.watchAll(["center","xaxis","yaxis","xradius","yradius","interval"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.EllipseArc.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_ellipse_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("xradius"),this.get("yradius"),this.get("interval").get("min"),this.get("interval").get("max")])},verb.geom.Extrusion=function(e,r,n){verb.geom.NurbsSurface.call(this),this.setAll({profile:e,axis:r,length:n}),this.update(),this.watchAll(["axis","length"],this.update),e.watchAll(["knots","degree","controlPoints","weights"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Extrusion.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_extruded_surface",[this.get("axis"),this.get("length"),this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights")])},verb.geom.FourPointSurface=function(e,r,n,t){verb.geom.NurbsSurface.call(this),this.setAll({p1:e,p2:r,p3:n,p4:t}),this.update(),this.watchAll(["p1","p2","p3","p4"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.FourPointSurface.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_4pt_surface",[this.get("p1"),this.get("p2"),this.get("p3"),this.get("p4")])},verb.geom.Interval=function(e,r){verb.core.WatchObject.call(this),this.setAll({min:e,max:r})}.inherits(verb.core.WatchObject),verb.geom.Interval2=function(e,r,n,t){verb.core.WatchObject.call(this),this.setAll({uinterval:new verb.geom.Interval(e,r),vinterval:new verb.geom.Interval(n,t)})}.inherits(verb.core.WatchObject),verb.geom.Line=function(e,r){verb.geom.NurbsCurve.call(this),this.setAll({start:e,end:r}),this.update(),this.watchAll(["start","end"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Line.prototype.nurbsRep=function(){return{knots:[0,0,1,1],control_points:[this.get("start"),this.get("end")],weights:[1,1],degree:1}},verb.geom.PlanarSurface=function(e,r,n,t,i){verb.geom.NurbsSurface.call(this),this.setAll({base:e,uaxis:r,vaxis:n,ulength:t,vlength:i}),this.update(),this.watchAll(["base","uaxis","vaxis","ulength","vlength"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.PlanarSurface.prototype.nurbsRep=function(){var e=this.get("base"),r=numeric.mul(this.get("uaxis"),this.get("ulength")),n=numeric.mul(this.get("vaxis"),this.get("vlength")),t=numeric.add(e,r),i=numeric.add(e,n,r),s=numeric.add(e,n);return this.nurbsEngine.eval("get_4pt_surface",[e,t,i,s])},verb.geom.PolyLine=function(e){verb.geom.NurbsCurve.call(this),this.setAll({control_points:e?e.slice(0):[]}),this.update()}.inherits(verb.geom.NurbsCurve),verb.geom.PolyLine.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_polyline_curve",[this.get("control_points")])},verb.geom.RevolvedSurface=function(e,r,n,t){verb.geom.NurbsSurface.call(this),this.setAll({center:e,axis:r,angle:n,profile:t}),this.update(),this.watchAll(["center","axis","angle","profile"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.RevolvedSurface.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_revolved_surface",[this.get("center"),this.get("axis"),this.get("angle"),this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights")])},verb.geom.Sphere=function(e,r){verb.geom.NurbsSurface.call(this),this.setAll({center:e,radius:r}),this.update(),this.watchAll(["center","radius"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Sphere.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_sphere_surface",[this.get("center"),[0,0,1],[1,0,0],this.get("radius")])},verb.geom.SweepOneRail=function(e,r){verb.geom.NurbsSurface.call(this),this.setAll({rail:e,profile:r}),this.update(),this.watchAll(["rail","profile"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.SweepOneRail.prototype.nurbsRep=function(){return this.nurbsEngine.eval("get_sweep1_surface",[this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights"),this.get("rail").get("knots"),this.get("rail").get("degree"),this.get("rail").get("controlPoints"),this.get("rail").get("weights")])},verb.intersect.curveCurve=function(e,r,n){return verb.nurbsEngine.eval("intersect_rational_curves_by_aabb_refine",[e.get("degree"),e.get("knots"),e.homogenize(),r.get("degree"),r.get("knots"),r.homogenize(),verb.TOLERANCE,verb.TOLERANCE],n)},verb.intersect.curveSurface=function(e,r,n,t){return n=n||{tolerance:verb.TOLERANCE,sampleTolerance:verb.TOLERANCE,uDivs:20,vDivs:20},verb.nurbsEngine.eval("intersect_rational_curve_surface_by_aabb_refine",[r.get("degreeU"),r.get("knotsU"),r.get("degreeV"),r.get("knotsV"),r.homogenize(),e.get("degree"),e.get("knots"),e.homogenize(),n.sampleTolerance,n.tolerance,n.uDivs,n.vDivs],t)},verb.eval.nurbs.intersect_rational_curve_surface_by_aabb_refine=function(e,r,n,t,i,s,a,o,u,v,l,b){var c=verb.eval.nurbs.intersect_rational_curve_surface_by_aabb(e,r,n,t,i,s,a,o,u,v,l,b);return c.map(function(u){var v=[u.p,u.uv[0],u.uv[1]],l=verb.eval.nurbs.refine_rational_curve_surface_intersection(e,r,n,t,i,s,a,o,v);return u.p=l[0],u.uv[0]=l[1],u.uv[1]=l[2],u.distance=l[3],delete u.face,u})},verb.eval.nurbs.refine_rational_curve_surface_intersection=function(e,r,n,t,i,s,a,o,u){var v=function(u){var v=verb.eval.nurbs.rational_curve_point(s,a,o,u[0]),l=verb.eval.nurbs.rational_surface_point(e,r,n,t,i,u[1],u[2]),b=numeric.sub(v,l);return numeric.dot(b,b)},l=numeric.uncmin(v,u);return l.solution.concat(l.f)},verb.eval.nurbs.intersect_rational_curve_surface_by_aabb=function(e,r,n,t,i,s,a,o,u,v,l,b){var c=verb.eval.nurbs.rational_curve_adaptive_sample(s,a,o,u,!0),h=verb.eval.nurbs.tesselate_rational_surface_naive(e,r,n,t,i,l,b),_=c.map(function(e){return e[0]}),g=c.map(function(e){return e.slice(1)}),m=verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(g,_,h,verb.range(h.faces.length),v);return verb.unique(m,function(e,r){return v>numeric.norm2(numeric.sub(e.point,r.point))&&v>Math.abs(e.p-r.p)&&v>numeric.norm2(numeric.sub(e.uv,r.uv))})},verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb=function(e,r,n,t,i){var s=new verb.geom.BoundingBox(e),a=verb.eval.mesh.make_mesh_aabb(n.points,n.faces,t);if(!s.intersects(a,i))return[];if(2!==e.length||1!==t.length){if(1===t.length){var o=verb.left(e),u=verb.rightWithPivot(e),v=verb.left(r),l=verb.rightWithPivot(r);return verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(o,v,n,t,i).concat(verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(u,l,n,t,i))}if(2===e.length){var b=verb.eval.mesh.sort_tris_on_longest_axis(a,n.points,n.faces,t),c=verb.left(b),h=verb.right(b);return verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(e,r,n,c,i).concat(verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(e,r,n,h,i))}var b=verb.eval.mesh.sort_tris_on_longest_axis(a,n.points,n.faces,t),c=verb.left(b),h=verb.right(b),o=verb.left(e),u=verb.rightWithPivot(e),v=verb.left(r),l=verb.rightWithPivot(r);return verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(o,v,n,c,i).concat(verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(o,v,n,h,i)).concat(verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(u,l,n,c,i)).concat(verb.eval.nurbs.intersect_parametric_polyline_mesh_by_aabb(u,l,n,h,i))}var _=verb.eval.geom.intersect_segment_with_tri(e[0],e[1],n.points,n.faces[t[0]]);if(null!=_){var g=_.p*(r[1]-r[0])+r[0],m=n.faces[t][0],f=n.faces[t][1],p=n.faces[t][2],d=n.uvs[m],y=n.uvs[f],x=n.uvs[p],k=numeric.sub(y,d),w=numeric.sub(x,d),N=numeric.add(d,numeric.mul(_.s,k),numeric.mul(_.t,w));return[{point:_.point,p:g,uv:N,face:t[0]}]}return[]},verb.eval.geom.intersect_segment_with_tri=function(e,r,n,t){var i=n[t[0]],s=n[t[1]],a=n[t[2]],o=numeric.sub(s,i),u=numeric.sub(a,i),v=numeric.cross(o,u),l=numeric.sub(r,e),b=numeric.sub(e,i),c=-numeric.dot(v,b),h=numeric.dot(v,l);if(Math.abs(h)<verb.EPSILON)return null;var _=c/h;if(0>_||_>1)return null;var g=numeric.add(e,numeric.mul(_,l)),m=numeric.dot(o,u),f=numeric.dot(o,o),p=numeric.dot(u,u),d=numeric.sub(g,i),y=numeric.dot(d,o),x=numeric.dot(d,u),k=m*m-f*p,w=(m*x-p*y)/k,N=(m*y-f*x)/k;return w>1+verb.EPSILON||N>1+verb.EPSILON||-verb.EPSILON>N||-verb.EPSILON>w||w+N>1+verb.EPSILON?null:{point:g,s:w,t:N,p:_}},verb.eval.geom.intersect_segment_with_plane=function(e,r,n,t){var i=numeric.dot(t,numeric.sub(e,r));if(EPSILON>abs(i))return null;var s=numeric.dot(t,numeric.sub(n,e));return{p:s/i}},verb.eval.geom.intersect_aabb_trees=function(e,r,n,t,i,s){var a=i.bounding_box.intersects(s.bounding_box);return a?0===i.children.length&&0===s.children.length?[[i.triangle,s.triangle]]:0===i.children.length&&0!=s.children.length?verb.eval.geom.intersect_aabb_trees(e,r,n,t,i,s.children[0]).concat(verb.eval.geom.intersect_aabb_trees(e,r,n,t,i,s.children[1])):0!=i.children.length&&0===s.children.length?verb.eval.geom.intersect_aabb_trees(e,r,n,t,i.children[0],s).concat(verb.eval.geom.intersect_aabb_trees(e,r,n,t,i.children[1],s)):0!=i.children.length&&0!=s.children.length?verb.eval.geom.intersect_aabb_trees(e,r,n,t,i.children[0],s.children[0]).concat(verb.eval.geom.intersect_aabb_trees(e,r,n,t,i.children[0],s.children[1])).concat(verb.eval.geom.intersect_aabb_trees(e,r,n,t,i.children[1],s.children[0])).concat(verb.eval.geom.intersect_aabb_trees(e,r,n,t,i.children[1],s.children[1])):void 0:[]},verb.eval.mesh.make_mesh_aabb_tree=function(e,r,n){var t={bounding_box:verb.eval.mesh.make_mesh_aabb(e,r,n),children:[]};if(1===n.length)return t.triangle=n[0],t;var i=verb.eval.mesh.sort_tris_on_longest_axis(t.bounding_box,e,r,n),s=i.slice(0,Math.floor(i.length/2)),a=i.slice(Math.floor(i.length/2),i.length);return t.children=[verb.eval.mesh.make_mesh_aabb_tree(e,r,s),verb.eval.mesh.make_mesh_aabb_tree(e,r,a)],t},verb.eval.mesh.make_mesh_aabb=function(e,r,n){var t=new verb.geom.BoundingBox;return n.forEach(function(n){t.add(e[r[n][0]]),t.add(e[r[n][1]]),t.add(e[r[n][2]])}),t},verb.eval.mesh.sort_tris_on_longest_axis=function(e,r,n,t){for(var i=e.get_longest_axis(),s=[],a=t.length-1;a>=0;a--){var o=t[a],u=verb.eval.mesh.get_min_coordinate_on_axis(r,n[o],i);s.push([u,o])}s.sort(function(e,r){return e[0]>r[0]});for(var v=[],a=0,l=s.length;l>a;a++)v.push(s[a][1]);return v},verb.eval.mesh.get_min_coordinate_on_axis=function(e,r,n){for(var t=[],i=0;3>i;i++)t.push(e[r[i]][n]);return Math.min.apply(Math,t)},verb.eval.geom.get_tri_centroid=function(e,r){for(var n=[0,0,0],t=0;3>t;t++)for(var i=0;3>i;i++)n[i]+=e[r[t]][i];for(var t=0;3>t;t++)n[t]/=3;return n},verb.eval.geom.get_tri_norm=function(e,r){var n=e[r[0]],t=e[r[1]],i=e[r[2]],s=numeric.sub(t,n),a=numeric.sub(i,n),o=numeric.cross(s,a);return numeric.mul(1/numeric.norm2(o),o)},verb.eval.nurbs.intersect_rational_curves_by_aabb_refine=function(e,r,n,t,i,s,a,o){var u=verb.eval.nurbs.intersect_rational_curves_by_aabb(e,r,n,t,i,s,a,o);return u.map(function(a){return verb.eval.nurbs.refine_rational_curve_intersection(e,r,n,t,i,s,a)})},verb.eval.nurbs.refine_rational_curve_intersection=function(e,r,n,t,i,s,a){var o=function(a){var o=verb.eval.nurbs.rational_curve_point(e,r,n,a[0]),u=verb.eval.nurbs.rational_curve_point(t,i,s,a[1]),v=numeric.sub(o,u);return numeric.dot(v,v)},u=numeric.uncmin(o,a);return u.solution.concat(u.f)},verb.eval.nurbs.intersect_rational_curves_by_aabb=function(e,r,n,t,i,s,a,o){var u=verb.eval.nurbs.rational_curve_adaptive_sample(e,r,n,a,!0),v=verb.eval.nurbs.rational_curve_adaptive_sample(t,i,s,a,!0),l=u.map(function(e){return e[0]}),b=v.map(function(e){return e[0]}),c=u.map(function(e){return e.slice(1)}),h=v.map(function(e){return e.slice(1)});return verb.eval.nurbs.intersect_parametric_polylines_by_aabb(c,h,l,b,o)},verb.eval.nurbs.intersect_parametric_polylines_by_aabb=function(e,r,n,t,i){var s=new verb.geom.BoundingBox(e),a=new verb.geom.BoundingBox(r);if(!s.intersects(a,i))return[];if(2!==e.length||2!==r.length){if(2===e.length){var o=Math.ceil(r.length/2),u=r.slice(0,o),v=r.slice(o-1),l=t.slice(0,o),b=t.slice(o-1);return verb.eval.nurbs.intersect_parametric_polylines_by_aabb(e,u,n,l,i).concat(verb.eval.nurbs.intersect_parametric_polylines_by_aabb(e,v,n,b,i))}if(2===r.length){var c=Math.ceil(e.length/2),h=e.slice(0,c),_=e.slice(c-1),g=n.slice(0,c),m=n.slice(c-1);return verb.eval.nurbs.intersect_parametric_polylines_by_aabb(h,r,g,t,i).concat(verb.eval.nurbs.intersect_parametric_polylines_by_aabb(_,r,m,t,i))}var c=Math.ceil(e.length/2),h=e.slice(0,c),_=e.slice(c-1),g=n.slice(0,c),m=n.slice(c-1),o=Math.ceil(r.length/2),u=r.slice(0,o),v=r.slice(o-1),l=t.slice(0,o),b=t.slice(o-1);return verb.eval.nurbs.intersect_parametric_polylines_by_aabb(h,u,g,l,i).concat(verb.eval.nurbs.intersect_parametric_polylines_by_aabb(h,v,g,b,i)).concat(verb.eval.nurbs.intersect_parametric_polylines_by_aabb(_,u,m,l,i)).concat(verb.eval.nurbs.intersect_parametric_polylines_by_aabb(_,v,m,b,i))}var f=verb.eval.geom.intersect_segments(e[0],e[1],r[0],r[1],i);return null!=f?(f[0][0]=f[0][0]*(n[1]-n[0])+n[0],f[1][0]=f[1][0]*(t[1]-t[0])+t[0],[[f[0][0],f[1][0]]]):[]},verb.eval.geom.intersect_segments=function(e,r,n,t,i){var s=numeric.sub(r,e),a=Math.sqrt(numeric.dot(s,s)),o=numeric.mul(1/a,s),u=numeric.sub(t,n),v=Math.sqrt(numeric.dot(u,u)),l=numeric.mul(1/v,u),b=verb.eval.geom.intersect_rays(e,o,n,l);if(null!=b){var c=Math.min(Math.max(0,b[0]/a),1),h=Math.min(Math.max(0,b[1]/v),1),_=numeric.add(numeric.mul(c,s),e),g=numeric.add(numeric.mul(h,u),n),m=numeric.norm2Squared(numeric.sub(_,g));if(i*i>m)return[[c].concat(_),[h].concat(g)]}return null},verb.eval.geom.closest_point_on_ray=function(e,r,n){var t=numeric.sub(e,r),i=numeric.dot(t,n),s=numeric.add(r,numeric.mul(i,n));return s},verb.eval.geom.intersect_rays=function(e,r,n,t){var i=numeric.dot(r,t),s=numeric.dot(r,n),a=numeric.dot(r,e),o=numeric.dot(t,n),u=numeric.dot(t,e),v=numeric.dot(r,r),l=numeric.dot(t,t),b=v*l-i*i;if(Math.abs(b)<verb.EPSILON)return null;var c=i*(s-a)-v*(o-u),h=c/b,_=(s-a+h*i)/v;return[_,h]},verb.eval.mesh.intersect_meshes_by_aabb=function(e,r,n,t,i){var s=verb.range(r.length),a=verb.range(i.length),o=verb.eval.mesh.make_mesh_aabb_tree(e,r,s),u=verb.eval.mesh.make_mesh_aabb_tree(t,i,a);verb.eval.mesh.intersect_aabb_tree(e,r,t,i,o,u)},verb.eval.geom.intersect_tris=function(e,r,n,t,i){for(var s=[e[tr1[0]],e[tr1[1]]],a=[e[tr1[1]],e[tr1[2]]],o=[e[tr1[2]],e[tr1[0]]],u=[t[tr2[0]],t[tr2[1]]],v=[t[tr2[1]],t[tr2[2]]],l=[t[tr2[2]],t[tr2[0]]],b=[s,a,o],c=[u,v,l],h=[],_=verb.eval.geom.get_tri_norm(t,i),g=t[tr2[0]],m=0;3>m;m++){var f=verb.eval.geom.intersect_segment_with_plane(b[m][0],c[m][1],g,_);f.intersects&&h.push(f)}if(2!==h.length)return null;for(var p=[h[0].point,h[1].point],d=[],m=0;3>m;m++){var y=verb.eval.geom.intersect_segments(p[0],p[1],p,b1,tol);y&&d.push(y)}0===d.length||1===d.length||2===d.length},verb.eval.nurbs.tesselate_rational_surface_naive=function(e,r,n,t,i,s,a){1>s&&(s=1),1>a&&(a=1);for(var o=1/s,u=1/a,v=[],l=[],b=[],c=0;s+1>c;c++)for(var h=0;a+1>h;h++){var _=c*o,g=h*u;l.push([_,g]);var m=verb.eval.nurbs.rational_surface_derivs(e,r,n,t,i,1,_,g),f=m[0][0];v.push(f);var p=numeric.cross(m[0][1],m[1][0]);b.push(p)}for(var d=[],c=0;s>c;c++)for(var h=0;a>h;h++){var y=c*(a+1)+h,x=(c+1)*(a+1)+h,k=x+1,w=y+1,N=[y,x,k],z=[y,k,w];d.push(N),d.push(z)}return{points:v,faces:d,uvs:l,normals:b}},verb.eval.nurbs.rational_curve_regular_sample=function(e,r,n,t,i){return verb.eval.nurbs.rational_curve_regular_sample_range(e,r,n,0,1,t,i)},verb.eval.nurbs.rational_curve_regular_sample_range=function(e,r,n,t,i,s,a){1>s&&(s=2);for(var o=[],u=(i-t)/(s-1),v=0,l=0;s>l;l++)v=t+u*l,a?o.push([v].concat(verb.eval.nurbs.rational_curve_point(e,r,n,v))):o.push(verb.eval.nurbs.rational_curve_point(e,r,n,v));return o},verb.eval.nurbs.rational_curve_adaptive_sample=function(e,r,n,t,i){return 1===e?i?n.map(function(e,n){return[r[n+1]].concat(verb.eval.nurbs.dehomogenize(e))}):n.map(verb.eval.nurbs.dehomogenize):verb.eval.nurbs.rational_curve_adaptive_sample_range(e,r,n,0,1,t,i)},verb.eval.nurbs.rational_curve_adaptive_sample_range=function(e,r,n,t,i,s,a){var o=verb.eval.nurbs.rational_curve_point(e,r,n,t),u=verb.eval.nurbs.rational_curve_point(e,r,n,i),v=.5+.2*Math.random(),l=t+(i-t)*v,b=verb.eval.nurbs.rational_curve_point(e,r,n,l),c=numeric.sub(o,u),h=numeric.sub(o,b);if(s>numeric.dot(c,c)&&numeric.dot(h,h)>s||!verb.eval.nurbs.three_points_are_flat(o,b,u,s)){var _=t+.5*(i-t),g=verb.eval.nurbs.rational_curve_adaptive_sample_range(e,r,n,t,_,s,a),m=verb.eval.nurbs.rational_curve_adaptive_sample_range(e,r,n,_,i,s,a);return g.slice(0,-1).concat(m)}return a?[[t].concat(o),[i].concat(u)]:[o,u]},verb.eval.nurbs.three_points_are_flat=function(e,r,n,t){var i=numeric.sub(r,e),s=numeric.sub(n,e),a=crossprod(i,s),o=numeric.dot(a,a);return t>o},verb.eval.nurbs.get_sweep1_surface=function(e,r,n,t,i,s,a,o){for(var u=verb.eval.nurbs.homogenize_1d(a,o),v=verb.eval.nurbs.rational_curve_point(s,i,u,0),l=1/a.length,b=[],c=[],h=0;a.length>h;h++){for(var _=verb.eval.nurbs.rational_curve_point(s,i,u,h*l),g=numeric.sub(_,v),m=[],f=[],p=0;n.length>p;p++)m.push(numeric.add(g,n[p])),f.push(t[p]*o[h]);b.push(m),c.push(f)}return{knots_u:i,knots_v:e,control_points:b,degree_u:s,degree_v:r,weights:c}},verb.eval.nurbs.get_ellipse_arc=function(e,r,n,t,i,s,a){s>a&&(a=2*Math.PI+s);var o=a-s,u=0;u=Math.PI/2>=o?1:Math.PI>=o?2:3*Math.PI/2>=o?3:4;var v=o/u,l=Math.cos(v/2),b=numeric.add(e,numeric.mul(t,Math.cos(s),r),numeric.mul(i,Math.sin(s),n)),c=numeric.sub(numeric.mul(Math.cos(s),n),numeric.mul(Math.sin(s),r)),h=verb.eval.nurbs.zeros_1d(2*u),_=verb.eval.nurbs.zeros_1d(2*u+3),g=0,m=s,f=verb.eval.nurbs.zeros_1d(2*u);h[0]=b,f[0]=1;for(var p=1;u>=p;p++){m+=v;var d=numeric.add(e,numeric.mul(t,Math.cos(m),r),numeric.mul(i,Math.sin(m),n));f[g+2]=1,h[g+2]=d;var y=numeric.sub(numeric.mul(Math.cos(m),n),numeric.mul(Math.sin(m),r)),x=verb.eval.geom.intersect_rays(b,numeric.mul(1/numeric.norm2(c),c),d,numeric.mul(1/numeric.norm2(y),y)),k=numeric.add(b,numeric.mul(c,x[0]));f[g+1]=l,h[g+1]=k,g+=2,u>p&&(b=d,c=y)}for(var w=2*u+1,p=0;3>p;p++)_[p]=0,_[p+w]=1;switch(u){case 1:break;case 2:_[3]=_[4]=.5;break;case 3:_[3]=_[4]=1/3,_[5]=_[6]=2/3;break;case 4:_[3]=_[4]=.25,_[5]=_[6]=.5,_[7]=_[8]=.75}return{knots:_,control_points:h,degree:2,weights:f}},verb.eval.nurbs.get_sphere_surface=function(e,r,n,t){var i=verb.eval.nurbs.get_arc(e,numeric.mul(r,-1),n,t,0,Math.PI);return verb.eval.nurbs.get_revolved_surface(e,r,2*Math.PI,i.knots,i.degree,i.control_points,i.weights)},verb.eval.nurbs.get_polyline_curve=function(e){for(var r=e.length-1,n=1/r,t=[0,0],i=1;r>i;i++)t.push(i*n);t.push(1),t.push(1);for(var s=[],i=0;e.length>i;i++)s.push(1);return{knots:t,control_points:e.slice(0),degree:1,weights:s}},verb.eval.nurbs.get_4pt_surface=function(e,r,n,t){return{knots_u:[0,0,1,1],knots_v:[0,0,1,1],control_points:[[e,t],[r,n]],degree_u:1,degree_v:1,weights:[[1,1],[1,1]]}},verb.eval.nurbs.get_cylinder_surface=function(e,r,n,t,i){var s=crossprod(e,r),a=(2*Math.PI,verb.eval.nurbs.get_arc(n,r,s,i,0,2*Math.PI));return verb.eval.nurbs.get_extruded_surface(e,t,a.knots,a.degree,a.control_points,a.weights)},verb.eval.nurbs.get_cone_surface=function(e,r,n,t,i){var s=2*Math.PI,a=1,o=[numeric.add(n,numeric.mul(t,e)),numeric.add(n,numeric.mul(i,r))],u=[0,0,1,1],v=[1,1];
return verb.eval.nurbs.get_revolved_surface(n,e,s,u,a,o,v)},verb.eval.nurbs.get_extruded_surface=function(e,r,n,t,i,s){for(var a=verb.eval.nurbs.zeros_2d(2,i.length),o=verb.eval.nurbs.zeros_2d(2,i.length),u=0;i.length>u;u++)a[0][u]=i[u],o[0][u]=s[u];for(var v=numeric.mul(e,r),u=0;i.length>u;u++)a[1][u]=numeric.add(v,i[u]),o[1][u]=s[u];return{knots_u:[0,0,1,1],knots_v:n,control_points:a,degree_u:1,degree_v:t,weights:o}},verb.eval.nurbs.get_revolved_surface=function(e,r,n,t,i,s,a){var o,u,v,l;Math.PI/2>=n?(o=1,u=verb.eval.nurbs.zeros_1d(6+2*(o-1))):Math.PI>=n?(o=2,u=verb.eval.nurbs.zeros_1d(6+2*(o-1)),u[3]=u[4]=.5):3*Math.PI/2>=n?(o=3,u=verb.eval.nurbs.zeros_1d(6+2*(o-1)),u[3]=u[4]=1/3,u[5]=u[6]=2/3):(o=4,u=verb.eval.nurbs.zeros_1d(6+2*(o-1)),u[3]=u[4]=.25,u[5]=u[6]=.5,u[7]=u[8]=.75);for(var b=n/o,c=3+2*(o-1),h=0;3>h;c++,h++)u[h]=0,u[c]=1;for(var _=Math.cos(b/2),g=0,m=verb.eval.nurbs.zeros_1d(o+1),f=verb.eval.nurbs.zeros_1d(o+1),v=verb.eval.nurbs.zeros_2d(2*o+1,s.length),l=verb.eval.nurbs.zeros_2d(2*o+1,s.length),h=1;o>=h;h++)g+=b,f[h]=Math.cos(g),m[h]=Math.sin(g);for(c=0;s.length>c;c++){var p=verb.eval.geom.closest_point_on_ray(s[c],e,r),d=numeric.sub(s[c],p),y=numeric.norm2(d),x=crossprod(r,d);y>verb.EPSILON&&(d=numeric.mul(1/y,d),x=numeric.mul(1/y,x)),v[0][c]=s[c];var k=s[c];l[0][c]=a[c];for(var w=x,N=0,g=0,h=1;o>=h;h++){var z=0==y?p:numeric.add(p,numeric.mul(y,f[h],d),numeric.mul(y,m[h],x));v[N+2][c]=z,l[N+2][c]=a[c];var M=numeric.sub(numeric.mul(f[h],x),numeric.mul(m[h],d));if(0==y)v[N+1][c]=p;else{var A=verb.eval.geom.intersect_rays(k,numeric.mul(1/numeric.norm2(w),w),z,numeric.mul(1/numeric.norm2(M),M)),E=numeric.add(k,numeric.mul(w,A[0]));v[N+1][c]=E}l[N+1][c]=_*a[c],N+=2,o>h&&(k=z,w=M)}}return{knots_u:u,knots_v:t,control_points:v,degree_u:2,degree_v:i,weights:l}},verb.eval.nurbs.get_arc=function(e,r,n,t,i,s){return verb.eval.nurbs.get_ellipse_arc(e,r,n,t,t,i,s)},verb.eval.nurbs.curve_knot_insert=function(e,r,n,t,i,s){var a=(n[0].length,r.length-e-2),o=n.length,u=verb.eval.nurbs.knot_span(e,t,r),v=a+e+1,l=o+s,b=Array(e+1),c=Array(r.length+s),h=Array(l),_=0;for(_=0;u>=_;_++)c[_]=r[_];for(_=1;s>=_;_++)c[u+_]=t;for(_=u+1;v>=_;_++)c[_+s]=r[_];for(_=0;u-e>=_;_++)h[_]=n[_];for(_=u-i;a>=_;_++)h[_+s]=n[_];for(_=0;e-i>=_;_++)b[_]=n[u-e+1];for(var g=0,m=0,f=1;s>=f;f++){for(g=u-e+f,_=0;e-f-i>=_;_++)m=(t-r[g+_])/(r[_+u+1]-r[g+_]),b[_]=numeric.add(numeric.mul(m,b[_+1]),numeric.mul(1-m,b[_]));h[g]=b[0],h[u+s-f-i]=b[e-f-i]}for(_=g+1;u-i>_;_++)h[_]=b[_-g];return[c,h]},verb.eval.nurbs.rational_surface_derivs=function(e,r,n,t,i,s,a,o){var u=verb.eval.nurbs.surface_derivs(e,r,n,t,i,s,a,o),v=verb.eval.nurbs.separate_homo_derivs_2d(u),l=v[0],b=v[1],c=0,h=0,_=0,g=0,m=[],f=l[0][0].length;for(c=0;s>=c;c++)for(m.push([]),g=0;s-c>=g;g++){var o=l[c][g];for(_=1;g>=_;_++)o=numeric.sub(o,numeric.mul(numeric.mul(binomial.get(g,_),b[0][_]),m[c][g-_]));for(h=1;c>=h;h++){o=numeric.sub(o,numeric.mul(numeric.mul(binomial.get(c,h),b[h][0]),m[c-h][g]));var p=verb.eval.nurbs.zeros_1d(f);for(_=1;g>=_;_++)p=numeric.add(p,numeric.mul(numeric.mul(binomial.get(g,_),b[h][_]),m[c-h][g-_]));o=numeric.sub(o,numeric.mul(binomial.get(c,h),p))}m[c].push(numeric.mul(1/b[0][0],o))}return m},verb.eval.nurbs.rational_surface_point=function(e,r,n,t,i,s,a){return verb.eval.nurbs.dehomogenize(verb.eval.nurbs.surface_point(e,r,n,t,i,s,a))},verb.eval.nurbs.rational_curve_derivs=function(e,r,n,t,i){var s=verb.eval.nurbs.separate_homo_derivs_1d(verb.eval.nurbs.curve_derivs(e,r,n,t,i)),a=s[0],o=s[1],u=0,v=0,l=[];for(u=0;i>=u;u++){var b=a[u];for(v=1;u>=v;v++)b=numeric.sub(b,numeric.mul(numeric.mul(binomial.get(u,v),o[v]),l[u-v]));l.push(numeric.mul(1/o[0],b))}return l},verb.eval.nurbs.separate_homo_derivs_1d=function(e){for(var r=e[0].length,n=r-1,t=[],i=[],s=0,a=e.length;a>s;s++)t.push(e[s].slice(0,n)),i.push(e[s][n]);return[t,i]},verb.eval.nurbs.separate_homo_derivs_2d=function(e){for(var r=[],n=[],t=0,i=e.length;i>t;t++){var s=verb.eval.nurbs.separate_homo_derivs_1d(e[t]);r.push(s[0]),n.push(s[1])}return[r,n]},verb.eval.nurbs.rational_curve_point=function(e,r,n,t){return verb.eval.nurbs.dehomogenize(verb.eval.nurbs.curve_point(e,r,n,t))},verb.eval.nurbs.dehomogenize=function(e){for(var r=e.length,n=[],t=e[r-1],i=0;e.length-1>i;i++)n.push(e[i]/t);return n},verb.eval.nurbs.homogenize_1d=function(e,r){for(var n=e.length,t=e[0].length,i=0,s=[],a=0,o=[],u=0;n>u;u++){var v=[];for(o=e[u],a=r[u],i=0;t>i;i++)v.push(o[i]*a);v.push(a),s.push(v)}return s},verb.eval.nurbs.homogenize_2d=function(e,r){for(var n=e.length,t=(e[0].length,e[0][0].length,[]),i=0;n>i;i++)t.push(verb.eval.nurbs.homogenize_1d(e[i],r[i]));return t},verb.eval.nurbs.surface_derivs=function(e,r,n,t,i,s,a,o){var u=r.length-e-2,v=t.length-n-2;return verb.eval.nurbs.surface_derivs_given_n_m(u,e,r,v,n,t,i,s,a,o)},verb.eval.nurbs.surface_derivs_given_n_m=function(e,r,n,t,i,s,a,o,u,v){if(verb.eval.nurbs.are_valid_relations(r,a.length,n.length)===!1||verb.eval.nurbs.are_valid_relations(i,a[0].length,s.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var l=a[0][0].length,b=Math.min(o,r),c=Math.min(o,i),h=verb.eval.nurbs.zeros_3d(b+1,c+1,l),_=verb.eval.nurbs.knot_span_given_n(e,r,u,n),g=verb.eval.nurbs.knot_span_given_n(t,i,v,s),m=verb.eval.nurbs.deriv_basis_functions_given_n_i(_,u,r,e,n),f=verb.eval.nurbs.deriv_basis_functions_given_n_i(g,v,i,t,s),p=verb.eval.nurbs.zeros_2d(i+1,l),d=0,y=0,x=0,k=0,w=0;for(d=0;b>=d;d++){for(y=0;i>=y;y++)for(p[y]=verb.eval.nurbs.zeros_1d(l),x=0;r>=x;x++)p[y]=numeric.add(p[y],numeric.mul(m[d][x],a[_-r+x][g-i+y]));for(w=Math.min(o-d,c),k=0;w>=k;k++)for(h[d][k]=verb.eval.nurbs.zeros_1d(l),y=0;i>=y;y++)h[d][k]=numeric.add(h[d][k],numeric.mul(f[k][y],p[y]))}return h},verb.eval.nurbs.surface_point=function(e,r,n,t,i,s,a){var o=r.length-e-2,u=t.length-n-2;return verb.eval.nurbs.surface_point_given_n_m(o,e,r,u,n,t,i,s,a)},verb.eval.nurbs.volume_point=function(e,r,n,t,i,s,a,o,u,v){var l=r.length-e-2,b=t.length-n-2,c=s.length-i-2;return verb.eval.nurbs.volume_point_given_n_m_l(l,e,r,b,n,t,c,i,s,a,o,u,v)},verb.eval.nurbs.volume_point_given_n_m_l=function(e,r,n,t,i,s,a,o,u,v,l,b,c){if(!verb.eval.nurbs.are_valid_relations(r,v.length,n.length)||!verb.eval.nurbs.are_valid_relations(i,v[0].length,s.length)||!verb.eval.nurbs.are_valid_relations(o,v[0][0].length,u.length))return console.error("Invalid relations between control points and knot vector"),null;for(var h=v[0][0][0].length,_=verb.eval.nurbs.knot_span_given_n(e,r,l,n),g=verb.eval.nurbs.knot_span_given_n(t,i,b,s),m=verb.eval.nurbs.knot_span_given_n(a,o,c,u),f=verb.eval.nurbs.basis_functions_given_knot_span_index(_,l,r,n),p=verb.eval.nurbs.basis_functions_given_knot_span_index(g,b,i,s),d=verb.eval.nurbs.basis_functions_given_knot_span_index(m,c,o,u),y=_-r,x=g,k=m,w=verb.eval.nurbs.zeros_1d(h),N=verb.eval.nurbs.zeros_1d(h),z=verb.eval.nurbs.zeros_1d(h),M=0,A=0,E=0;o>=E;E++){for(z=verb.eval.nurbs.zeros_1d(h),k=m-o+E,M=0;i>=M;M++){for(N=verb.eval.nurbs.zeros_1d(h),x=g-i+M,A=0;r>=A;A++)N=numeric.add(N,numeric.mul(f[A],v[y+A][x][k]));z=numeric.add(z,numeric.mul(p[M],N))}w=numeric.add(w,numeric.mul(d[E],z))}return w},verb.eval.nurbs.surface_point_given_n_m=function(e,r,n,t,i,s,a,o,u){if(verb.eval.nurbs.are_valid_relations(r,a.length,n.length)===!1||verb.eval.nurbs.are_valid_relations(i,a[0].length,s.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var v=a[0][0].length,l=verb.eval.nurbs.knot_span_given_n(e,r,o,n),b=verb.eval.nurbs.knot_span_given_n(t,i,u,s),c=verb.eval.nurbs.basis_functions_given_knot_span_index(l,o,r,n),h=verb.eval.nurbs.basis_functions_given_knot_span_index(b,u,i,s),_=l-r,g=b,m=verb.eval.nurbs.zeros_1d(v),f=verb.eval.nurbs.zeros_1d(v),p=0,d=0;for(p=0;i>=p;p++){for(f=verb.eval.nurbs.zeros_1d(v),g=b-i+p,d=0;r>=d;d++)f=numeric.add(f,numeric.mul(c[d],a[_+d][g]));m=numeric.add(m,numeric.mul(h[p],f))}return m},verb.eval.nurbs.curve_derivs=function(e,r,n,t,i){var s=r.length-e-2;return verb.eval.nurbs.curve_derivs_given_n(s,e,r,n,t,i)},verb.eval.nurbs.curve_derivs_given_n=function(e,r,n,t,i,s){if(verb.eval.nurbs.are_valid_relations(r,t.length,n.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var a=t[0].length,o=Math.min(s,r),u=verb.eval.nurbs.zeros_2d(o+1,a),v=verb.eval.nurbs.knot_span_given_n(e,r,i,n),l=verb.eval.nurbs.deriv_basis_functions_given_n_i(v,i,r,o,n),b=0,c=0;for(b=0;o>=b;b++)for(c=0;r>=c;c++)u[b]=numeric.add(u[b],numeric.mul(l[b][c],t[v-r+c]));return u},verb.eval.nurbs.are_valid_relations=function(e,r,n){return 0===r+e+1-n?!0:!1},verb.eval.nurbs.curve_point=function(e,r,n,t){var i=r.length-e-2;return verb.eval.nurbs.curve_point_given_n(i,e,r,n,t)},verb.eval.nurbs.curve_point_given_n=function(e,r,n,t,i){if(verb.eval.nurbs.are_valid_relations(r,t.length,n.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;for(var s=verb.eval.nurbs.knot_span_given_n(e,r,i,n),a=verb.eval.nurbs.basis_functions_given_knot_span_index(s,i,r,n),o=verb.eval.nurbs.zeros_1d(t[0].length),u=0;r>=u;u++)o=numeric.add(o,numeric.mul(a[u],t[s-r+u]));return o},verb.eval.nurbs.zeros_1d=function(e){e=e>0?e:0;for(var r=[];e--;)r.push(0);return r},verb.eval.nurbs.zeros_2d=function(e,r){r=r>0?r:0,e=e>0?e:0;for(var n=[],t=r,i=e;e--;){for(n.push([]);t--;)n[i-e-1].push(0);t=r}return n},verb.eval.nurbs.zeros_3d=function(e,r,n){r=r>0?r:0,e=e>0?e:0;for(var t=[],i=r,s=e;e--;){for(t.push([]);i--;)t[s-e-1].push(verb.eval.nurbs.zeros_1d(n));i=r}return t},verb.eval.nurbs.deriv_basis_functions=function(e,r,n){var t=verb.eval.nurbs.knot_span(r,e,n),i=n.length-1,s=i-r-1;return verb.eval.nurbs.deriv_basis_functions_given_n_i(t,e,r,s,n)},verb.eval.nurbs.deriv_basis_functions_given_n_i=function(e,r,n,t,i){var s=verb.eval.nurbs.zeros_2d(n+1,n+1),a=Array(n+1),o=Array(n+1),u=0,v=0,l=1,b=0;for(s[0][0]=1,l=1;n>=l;l++){for(a[l]=r-i[e+1-l],o[l]=i[e+l]-r,u=0,b=0;l>b;b++)s[l][b]=o[b+1]+a[l-b],v=s[b][l-1]/s[l][b],s[b][l]=u+o[b+1]*v,u=a[l-b]*v;s[l][l]=u}var c=verb.eval.nurbs.zeros_2d(t+1,n+1),h=verb.eval.nurbs.zeros_2d(2,n+1),_=1,g=0,m=1,f=0,p=0,d=0,y=0,x=0;for(l=0;n>=l;l++)c[0][l]=s[l][n];for(b=0;n>=b;b++)for(g=0,m=1,h[0][0]=1,_=1;t>=_;_++){for(f=0,p=b-_,d=n-_,b>=_&&(h[m][0]=h[g][0]/s[d+1][p],f=h[m][0]*s[p][d]),y=p>=-1?1:-p,x=d>=b-1?_-1:n-b,l=y;x>=l;l++)h[m][l]=(h[g][l]-h[g][l-1])/s[d+1][p+l],f+=h[m][l]*s[p+l][d];d>=b&&(h[m][_]=-h[g][_-1]/s[d+1][b],f+=h[m][_]*s[b][d]),c[_][b]=f,l=g,g=m,m=l}for(b=n,_=1;t>=_;_++){for(l=0;n>=l;l++)c[_][l]*=b;b*=n-_}return c},verb.eval.nurbs.basis_functions=function(e,r,n){var t=verb.eval.nurbs.knot_span(e,r,n);return verb.eval.nurbs.basis_functions_given_knot_span_index(t,e,r,n)},verb.eval.nurbs.basis_functions_given_knot_span_index=function(e,r,n,t){var i=Array(n+1),s=Array(n+1),a=Array(n+1),o=0,u=0;i[0]=1;for(var v=1;n>=v;v++){s[v]=r-t[e+1-v],a[v]=t[e+v]-r,o=0;for(var l=0;v>l;l++)u=i[l]/(a[l+1]+s[v-l]),i[l]=o+a[l+1]*u,o=s[v-l]*u;i[v]=o}return i},verb.eval.nurbs.knot_span=function(e,r,n){var t=n.length-1,i=t-e-1;return verb.eval.nurbs.knot_span_given_n(i,e,r,n)},verb.eval.nurbs.knot_span_given_n=function(e,r,n,t){if(n>=t[e+1])return e;if(t[r]>n)return r;for(var i=r,s=e+1,a=Math.floor((i+s)/2);t[a]>n||n>=t[a+1];)t[a]>n?s=a:i=a,a=Math.floor((i+s)/2);return a};