/*! verb 2013-11-26 */
function crossprod(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]}if("object"!=typeof exports||void 0===exports)var verb={},numeric=window.numeric,binomial=window.binomial,labor=window.labor,_=window.underscore;else var verb=module.exports={},numeric=require("numeric"),binomial=require("binomial"),labor=require("labor"),_=require("underscore");verb.geom={},verb.core={},verb.eval={},verb.eval.nurbs=verb.eval.nurbs||{},verb.eval.geom=verb.eval.geom||{},verb.eval.mesh=verb.eval.mesh||{},verb.EPSILON=1e-8,verb.init=function(){verb.nurbsEngine=new verb.core.Engine(verb.eval.nurbs),verb.geom.NurbsGeometry.prototype.nurbsEngine=verb.nurbsEngine},"function"!=typeof Object.create&&(Object.create=function(e){function r(){}return r.prototype=e,new r}),Function.prototype.method=function(e,r){return this.prototype[e]=r,this},Function.method("inherits",function(e){return this.prototype=new e,this.prototype,this.prototype.constructor=e,this}),verb.core.Engine=function(e){var r="function"==typeof Worker&&(e.use_pool||void 0===e.use_pool),t=e.num_workers||2,n=e.tolerance||1e-4,i=e.url||"verb_nurbs_eval.js",s=e.library||verb.eval.nurbs,o=e.error_handler||function(e){console.warn(e)},a=void 0,u=function(){try{a=new labor.Pool(i,t),a.start()}catch(e){return o("Failed to initialize labor.Pool."),!1}return!0};this.start=function(){r&&u()},this.eval=function(e,t,n){if(r&&(a||void 0===a&&u()))a.addWork(e,t,n);else{var i=this;setTimeout(function(){n(i.eval_sync(e,t))},0)}},this.eval_sync=function(e,r){return s[e].apply(null,r)},this.set_tolerance=function(e){n=e},this.set_use_pool=function(e){return e&&void 0===a&&u()?(r=e,!0):e?!1:(a=null,delete a,!0)},this.set_error_handler=function(e){o=e},this.set_num_threads=function(e){t=e}},verb.core.WatchObject=function(){var e={change:{}},r={},t=0,n=this,i=function(r,t){for(ele in e[r])e[ele](t);for(ele in e.change)e[ele](t)};this.get=function(e){return r[e]},this.set=function(e,t){var s=r[e];r[e]=t,i({name:e,old:s,"new":t,target:n,type:"full"})},this.setAll=function(e){var t={};for(propName in e)t[propName]=r[propName],r[propName]=e[propName];i({old:t,"new":e,target:n,type:"multi"})},this.setAt=function(e,t,s){var o=r[e];if(!(void 0===o||o.length>=t||0>t)){var a=r[e][t];r[e][t]=s,i({name:e,index:t,old:a,"new":s,target:n,type:"index"})}},this.watch=function(r,n){return void 0!==e[r]&&n?(t++,e[r][t]=n,t++):void 0},this.watchAll=function(e,r){for(var t=[],n=0;e.length>n;n++)t.push(this.watch(e[n],r));return t},this.ignore=function(r,t){void 0!==e[r]&&void 0!==e[r][t]&&(e[r][t]=void 0)}},verb.core.uid=function(){var e=0;return function(){return e++}}(),verb.geom.Geometry=function(){var e=verb.core.uid();this.uniqueId=function(){return e}}.inherits(verb.core.WatchObject),verb.geom.NurbsGeometry=function(){verb.geom.Geometry.call(this)}.inherits(verb.geom.Geometry),verb.geom.NurbsCurve=function(e,r,t,n){this.setAll({controlPoints:r,weights:t,knots:n?n.slice(0):[],degree:e}),verb.geom.NurbsGeometry.call(this)}.inherits(verb.geom.NurbsGeometry),verb.geom.NurbsCurve.prototype.point=function(e,r){return r?(this.nurbsEngine.eval("rational_curve_point",[this.get("degree"),this.get("knots"),this.homogenize(),e],r),void 0):this.nurbsEngine.eval_sync("rational_curve_point",[this.get("degree"),this.get("knots"),this.homogenize(),e])},verb.geom.NurbsCurve.prototype.derivatives=function(e,r,t){return t?(this.nurbsEngine.eval("rational_curve_derivs",[this.get("degree"),this.get("knots"),this.homogenize(),e,r],t),void 0):this.nurbsEngine.eval_sync("rational_curve_derivs",[this.get("degree"),this.get("knots"),this.homogenize(),e,r])},verb.geom.NurbsCurve.prototype.tesselate=function(e){return e?this.nurbsEngine.eval("rational_curve_adaptive_sample",[this.get("degree"),this.get("knots"),this.homogenize(),verb.TOLERANCE],e):this.nurbsEngine.eval_sync("rational_curve_adaptive_sample",[this.get("degree"),this.get("knots"),this.homogenize(),verb.TOLERANCE])},verb.geom.NurbsCurve.prototype.transform=function(e){for(var r=this.get("controlPoints"),t=0;r.length>t;t++){var n=r[1].push(1);r[t]=numeric.mul(e,n).slice(0,n.length-2)}return this.set("controlPoints",r),this},verb.geom.NurbsCurve.prototype.clone=function(){for(var e=this.get("controlPoints"),r=[],t=0;e.length>t;t++)r.push(e[t].slice(0));return new verb.geom.NurbsCurve(this.get("degree"),r,this.get("weights").slice(0),this.get("knots").slice)},verb.geom.NurbsCurve.prototype.homogenize=function(){return verb.eval.nurbs.homogenize_1d(this.get("controlPoints"),this.get("weights"))},verb.geom.NurbsCurve.prototype.update=function(){if(this.nurbsRep){var e=this.nurbsRep();this.setAll({controlPoints:e.control_points,weights:e.weights,knots:e.knots,degree:degree})}},verb.geom.NurbsSurface=function(e,r,t,n,i,s){this.setAll({controlPoints:i,weights:s,knotsU:r?r.slice(0):[],knotsV:n?n.slice(0):[],degreeU:e,degreeV:t}),verb.geom.NurbsGeometry.call(this)}.inherits(verb.geom.NurbsGeometry),verb.geom.NurbsSurface.prototype.point=function(e,r,t){return t?this.nurbsEngine.eval("rational_surface_point",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),e,r],t):this.nurbsEngine.eval_sync("rational_surface_point",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),e,r])},verb.geom.NurbsSurface.prototype.derivatives=function(e,r,t,n){return n?this.nurbsEngine.eval("rational_surface_derivs",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),t,e,r],n):this.nurbsEngine.eval_sync("rational_surface_derivs",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),t,e,r])},verb.geom.NurbsSurface.prototype.tesselate=function(e,r){return callback?this.nurbsEngine.eval("tesselate_rational_surface_naive",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),e,r],callback):this.nurbsEngine.eval("tesselate_rational_surface_naive",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),e,r])},verb.geom.NurbsSurface.prototype.transform=function(e){for(var r=this.get("controlPoints"),t=0;r.length>t;t++)for(var n=0;r[t].length>n;n++){var i=r[1].push(1);r[t]=numeric.mul(e,i).slice(0,i.length-2)}return this.set("controlPoints",r),this},verb.geom.NurbsSurface.prototype.clone=function(){for(var e=this.get("controlPoints"),r=[],t=0;e.length>t;t++){r.push([]);for(var n=0;e[t].length>n;n++)r[t].push(e[t][n].slice(0))}for(var i=this.get("weights"),s=[],t=0;i.length>t;t++)s.push(i[t].slice(0));return new verb.geom.NurbsSurface(this.get("degreeU"),this.get("knotsU").slice(0),this.get("degreeV"),this.get("knotsV").slice(0),r,s)},verb.geom.NurbsSurface.prototype.homogenize=function(){return verb.eval.nurbs.homogenize_2d(this.get("controlPoints"),this.get("weights"))},verb.geom.NurbsSurface.prototype.update=function(){if(this.nurbsRep){var e=this.nurbsRep();this.setAll({controlPoints:e.control_points,weights:e.weights,knotsU:e.knots_u,knotsV:e.knots_v,degreeU:e.degree_u,degreeV:e.degree_v})}},verb.geom.Arc=function(e,r,t,n,i){this.setAll({center:e,xaxis:r,yaxis:t,radius:n,interval:i});var s=this.nurbsRep();verb.geom.NurbsCurve.call(this,s.degree,s.control_points,s.weights,s.knots),this.watchAll(["center","xaxis","yaxis","radius","interval"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Arc.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("radius"),this.get("interval").get("min"),this.get("interval").get("max")])},verb.geom.BezierCurve=function(e,r,t){for(var n=[],i=0;e+1>i;i++)n.push(0);for(var i=0;e+1>i;i++)n.push(1);var s=r.slice(0);if(void 0===t){t=[];for(var i=0;s.length>i;i++)t.push(1)}verb.geom.NurbsCurve.call(this,e,r,weight,n)}.inherits(verb.geom.NurbsCurve),verb.geom.BoundingBox=function(){this.initialized=!1,this.min=[0,0,0],this.max=[0,0,0];var e=Array.prototype.slice.call(arguments,0);this.add_elements_sync(e)},verb.geom.BoundingBox.prototype.add_elements=function(e,r){var t=this;_.defer(function(){_.each(e,function(e){t.add(e)}),r(t)})},verb.geom.BoundingBox.prototype.add_elements_sync=function(e){var r=this;return _.each(e,function(e){r.add(e)}),this},verb.geom.BoundingBox.prototype.add=function(e){return this.initialized?(e[0]>this.max[0]&&(this.max[0]=e[0]),e[1]>this.max[1]&&(this.max[1]=e[1]),e[2]>this.max[2]&&(this.max[2]=e[2]),e[0]<this.min[0]&&(this.min[0]=e[0]),e[1]<this.min[1]&&(this.min[1]=e[1]),e[2]<this.min[2]&&(this.min[2]=e[2]),this):(this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this)},verb.geom.BoundingBox.prototype.contains=function(e){return this.initialized?this.intersects(new verb.geom.BoundingBox(e)):!1},verb.geom.BoundingBox.prototype.TOLERANCE=1e-4,verb.geom.BoundingBox.prototype.intervals_overlap=function(e,r,t,n){var i=verb.geom.BoundingBox.prototype.TOLERANCE,s=Math.min(e,r)-i,o=Math.max(e,r)+i,a=Math.min(t,n)-i,u=Math.max(t,n)+i;return s>=a&&u>=s||o>=a&&u>=o||a>=s&&o>=a||u>=s&&o>=u?!0:!1},verb.geom.BoundingBox.prototype.intersects=function(e){if(!this.initialized||!e.initialized)return!1;var r=this.min,t=this.max,n=e.min,i=e.max;return this.intervals_overlap(r[0],t[0],n[0],i[0])&&this.intervals_overlap(r[1],t[1],n[1],i[1])&&this.intervals_overlap(r[2],t[2],n[2],i[2])?!0:!1},verb.geom.BoundingBox.prototype.clear=function(){return this.initialized=!1,this},verb.geom.BoundingBox.prototype.get_longest_axis=function(){var e=[this.get_axis_length(0),this.get_axis_length(1),this.get_axis_length(2)];return e.indexOf(Math.max.apply(Math,e))},verb.geom.BoundingBox.prototype.get_axis_length=function(e){return 0>e||e>2?0:Math.abs(this.min[e]-this.max[e])},verb.geom.BoundingBox.prototype.intersect=function(e){if(!this.initialized)return null;var r=this.min,t=this.max,n=e.min,i=e.max;if(!this.intersects(e))return null;var s=Math.min(t[0],i[0]),o=Math.max(r[0],n[0]),a=Math.min(t[1],i[1]),u=Math.max(r[1],n[1]),l=Math.min(t[2],i[2]),v=Math.max(r[2],n[2]),c=[s,a,l],b=[o,u,v];return new verb.geom.BoundingBox(b,c)},verb.geom.Circle=function(e,r,t,n){this.setAll({center:e,xaxis:r,yaxis:t,radius:n});var i=this.nurbsRep();verb.geom.NurbsCurve.call(this,i.degree,i.control_points,i.weight,i.knots),this.watchAll(["center","xaxis","yaxis","radius"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Circle.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("radius"),0,2*Math.PI])},verb.geom.Cone=function(e,r,t,n,i){this.setAll({axis:e,xaxis:r,base:t,height:n,radius:i});var s=this.nurbsRep();verb.geom.NurbsSurface.call(this,s.degree,s.control_points,s.weight,s.knots),this.watchAll(["axis","xaxis","base","height","radius"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Cone.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_cone_surface",[this.get("axis"),this.get("xaxis"),this.get("base"),this.get("height"),this.get("radius")])},verb.geom.Cylinder=function(e,r,t,n,i){this.setAll({axis:e,xaxis:r,base:t,height:n,radius:i});var s=this.nurbsRep();verb.geom.NurbsSurface.call(this,s.degree,s.control_points,s.weight,s.knots),this.watchAll(["axis","xaxis","base","height","radius"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Cylinder.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_cylinder_surface",[this.get("axis"),this.get("xaxis"),this.get("base"),this.get("height"),this.get("radius")])},verb.geom.Ellipse=function(e,r,t,n,i){this.setAll({center:e,xaxis:r,yaxis:t,xradius:n,yradius:i});var s=this.nurbsRep();verb.geom.NurbsCurve.call(this,s.degree,s.control_points,s.weight,s.knots),this.watchAll(["center","xaxis","yaxis","xradius","yradius"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Ellipse.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_ellipse_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("xradius"),this.get("yradius"),0,2*Math.PI])},verb.geom.EllipseArc=function(e,r,t,n,i,s){this.setAll({center:e,xaxis:r,yaxis:t,xradius:n,yradius:i,interval:s});var o=this.nurbsRep();verb.geom.NurbsCurve.call(this,o.degree,o.control_points,o.weight,o.knots),this.watchAll(["center","xaxis","yaxis","xradius","yradius","interval"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.EllipseArc.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_ellipse_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("xradius"),this.get("yradius"),this.get("interval").get("min"),this.get("center").get("max")])},verb.geom.Extrusion=function(e,r,t){this.setAll({profile:e,axis:r,length:t});var n=this.nurbsRep();verb.geom.NurbsSurface.call(this,n.degree,n.control_points,n.weight,n.knots),this.watchAll(["axis","length"],this.update),e.watchAll(["knots","degree","controlPoints","weights"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Extrusion.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_extruded_surface",[this.get("axis"),this.get("length"),this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights")])},verb.geom.FourPointSurface=function(){this.setAll({p1:center,p2:xaxis,p3:yaxis,p4:radius});var e=this.nurbsRep();verb.geom.NurbsCurve.call(this,e.degree,e.control_points,e.weight,e.knots),this.watchAll(["p1","p2","p3","p4"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.FourPointSurface.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_4pt_surface",[this.get("p1"),this.get("p2"),this.get("p3"),this.get("p4")])},verb.geom.Interval=function(e,r){this.setAll({min:e,max:r})}.inherits(verb.core.WatchObject),verb.geom.Interval2=function(e,r,t,n){this.setAll({uinterval:new verb.geom.Interval(e,r),vinterval:new verb.geom.Interval(t,n)})}.inherits(verb.core.WatchObject),verb.geom.Line=function(e,r){this.setAll({start:e,end:r});var t=this.nurbsRep();verb.geom.NurbsCurve.call(this,t.degree,t.control_points,t.weight,t.knots),this.watchAll(["start","end"],this.update)}.inherits(verb.geom.NurbsCurve),verb.geom.Line.prototype.nurbsRep=function(){return{knots:[0,0,1,1],control_points:[this.get("start"),this.get("end")],weights:[1,1],degree:1}},verb.geom.PlanarSurface=function(){this.setAll({base:center,uaxis:xaxis,vaxis:yaxis,ulength:xradius,vlength:yradius});var e=this.nurbsRep();verb.geom.NurbsSurface.call(this,e.degree,e.control_points,e.weight,e.knots),this.watchAll(["base","uaxis","vaxis","ulength","vlength"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Cone.prototype.nurbsRep=function(){var e=this.get("base"),r=numeric.mul(this.get("uaxis"),this.get("ulength")),t=numeric.mul(this.get("vaxis"),this.get("vlength")),n=numeric.add(base,r),i=numeric.add(base,t,r),s=numeric.add(base,t);return this.nurbsEngine.eval_sync("get_4pt_surface",[e,n,i,s])},verb.geom.Polyline=function(e){this.setAll({control_points:e?e.slice(0):[]});var r=this.nurbsRep();verb.geom.NurbsCurve.call(this,r.degree,r.control_points,r.weights,r.knots)}.inherits(verb.geom.NurbsCurve),verb.geom.Polyline.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_polyline_surface",[this.get("control_points")])},verb.geom.RevolvedSurface=function(e,r,t,n){this.setAll({center:e,axis:r,angle:t,profile:n});var i=this.nurbsRep();verb.geom.NurbsSurface.call(this,i.degree,i.control_points,i.weight,i.knots),this.watchAll(["center","axis","angle","profile"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.RevolvedSurface.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_revolved_surface",[this.get("center"),this.get("axis"),this.get("angle"),this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights")])},verb.geom.Sphere=function(e,r){this.setAll({center:e,radius:r});var t=this.nurbsRep();verb.geom.NurbsSurface.call(this,t.degree,t.control_points,t.weight,t.knots),this.watchAll(["center","radius"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.Sphere.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_sphere_surface",[this.get("center"),[0,0,1],[1,0,0],this.get("radius")])},verb.geom.SweepOneRail=function(e,r){this.setAll({rail:e,profile:r});var t=this.nurbsRep();verb.geom.NurbsSurface.call(this,t.degree,t.control_points,t.weight,t.knots),this.watchAll(["rail","profile"],this.update)}.inherits(verb.geom.NurbsSurface),verb.geom.SweepOneRail.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_sweep1_surface",[this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights"),this.get("rail").get("knots"),this.get("rail").get("degree"),this.get("rail").get("controlPoints"),this.get("rail").get("weights")])},verb.eval.nurbs.get_sweep1_surface=function(e,r,t,n,i,s){for(var o=verb.eval.nurbs.homogenize_1d(rail_control_points,rail_weights),a=verb.eval.nurbs.rational_curve_point(s,i,o,0),u=1/rail_control_points.length,l=[],v=[],c=0;rail_control_points>c;c++){for(var b=verb.eval.nurbs.rational_curve_point(s,i,o,c*u),h=verb.sub(b,a),g=[],_=[],m=0;t>m;m++)g.push(numeric.add(h,t[m])),_.push(t[m]*rail_control_points[c]);l.add(g),v.add(_)}return{knots_u:i,knots_v:e,control_points:l,degree_u:s,degree_v:r,weights:v}},verb.eval.nurbs.get_ellipse_arc=function(e,r,t,n,i,s,o){s>o&&(o=2*Math.PI+s);var a=o-s,u=0;u=Math.PI/2>=a?1:Math.PI>=a?2:3*Math.PI/2>=a?3:4;var l=a/u,v=Math.cos(l/2),c=numeric.add(e,numeric.mul(n,Math.cos(s),r),numeric.mul(i,Math.sin(s),t)),b=numeric.sub(numeric.mul(Math.cos(s),t),numeric.mul(Math.sin(s),r)),h=verb.eval.nurbs.zeros_1d(2*u),g=verb.eval.nurbs.zeros_1d(2*u+3),_=0,m=s,p=verb.eval.nurbs.zeros_1d(2*u);h[0]=c,p[0]=1;for(var d=1;u>=d;d++){m+=l;var f=numeric.add(e,numeric.mul(n,Math.cos(m),r),numeric.mul(i,Math.sin(m),t));p[_+2]=1,h[_+2]=f;var y=numeric.sub(numeric.mul(Math.cos(m),t),numeric.mul(Math.sin(m),r)),x=verb.eval.geom.intersect_rays(c,numeric.mul(1/numeric.norm2(b),b),f,numeric.mul(1/numeric.norm2(y),y)),w=numeric.add(c,numeric.mul(b,x[0]));p[_+1]=v,h[_+1]=w,_+=2,u>d&&(c=f,b=y)}for(var k=2*u+1,d=0;3>d;d++)g[d]=0,g[d+k]=1;switch(u){case 1:break;case 2:g[3]=g[4]=.5;break;case 3:g[3]=g[4]=1/3,g[5]=g[6]=2/3;break;case 4:g[3]=g[4]=.25,g[5]=g[6]=.5,g[7]=g[8]=.75}return{knots:g,control_points:h,degree:2,weights:p}},verb.eval.nurbs.get_sphere_surface=function(e,r,t,n){var i=verb.eval.nurbs.get_arc(e,numeric.mul(r,-1),t,n,0,Math.PI);return verb.eval.nurbs.get_revolved_surface(e,r,2*Math.PI,i.knots,i.degree,i.control_points,i.weights)},verb.eval.nurbs.get_polyline_curve=function(e){for(var r=e.length-1,t=1/r,n=[0,0],i=1;r>i;i++)n.push(i*t);n.push(1),n.push(1);for(var s=[],i=0;e.length>i;i++)s.push(1);return{knots:n,control_points:e.slice(0),degree:1,weights:s}},verb.eval.nurbs.get_4pt_surface=function(e,r,t,n){return{knots_u:[0,0,1,1],knots_v:[0,0,1,1],control_points:[[e,n],[r,t]],degree_u:1,degree_v:1,weights:[[1,1],[1,1]]}},verb.eval.nurbs.get_cylinder_surface=function(e,r,t,n,i){var s=crossprod(e,r),o=(2*Math.PI,verb.eval.nurbs.get_arc(t,r,s,i,0,2*Math.PI));return verb.eval.nurbs.get_extruded_surface(e,n,o.knots,o.degree,o.control_points,o.weights)},verb.eval.nurbs.get_cone_surface=function(e,r,t,n,i){var s=2*Math.PI,o=1,a=[numeric.add(t,numeric.mul(n,e)),numeric.add(t,numeric.mul(i,r))],u=[0,0,1,1],l=[1,1];return verb.eval.nurbs.get_revolved_surface(t,e,s,u,o,a,l)},verb.eval.nurbs.get_extruded_surface=function(e,r,t,n,i,s){for(var o=verb.eval.nurbs.zeros_2d(2,i.length),a=verb.eval.nurbs.zeros_2d(2,i.length),u=0;i.length>u;u++)o[0][u]=i[u],a[0][u]=s[u];for(var l=numeric.mul(e,r),u=0;i.length>u;u++)o[1][u]=numeric.add(l,i[u]),a[1][u]=s[u];return{knots_u:[0,0,1,1],knots_v:t,control_points:o,degree_u:1,degree_v:n,weights:a}},verb.eval.nurbs.get_revolved_surface=function(e,r,t,n,i,s,o){var a,u,l,v;Math.PI/2>=t?(a=1,u=verb.eval.nurbs.zeros_1d(6+2*(a-1))):Math.PI>=t?(a=2,u=verb.eval.nurbs.zeros_1d(6+2*(a-1)),u[3]=u[4]=.5):3*Math.PI/2>=t?(a=3,u=verb.eval.nurbs.zeros_1d(6+2*(a-1)),u[3]=u[4]=1/3,u[5]=u[6]=2/3):(a=4,u=verb.eval.nurbs.zeros_1d(6+2*(a-1)),u[3]=u[4]=.25,u[5]=u[6]=.5,u[7]=u[8]=.75);for(var c=t/a,b=3+2*(a-1),h=0;3>h;b++,h++)u[h]=0,u[b]=1;for(var g=Math.cos(c/2),_=0,m=verb.eval.nurbs.zeros_1d(a+1),p=verb.eval.nurbs.zeros_1d(a+1),l=verb.eval.nurbs.zeros_2d(2*a+1,s.length),v=verb.eval.nurbs.zeros_2d(2*a+1,s.length),h=1;a>=h;h++)_+=c,p[h]=Math.cos(_),m[h]=Math.sin(_);for(b=0;s.length>b;b++){var d=verb.eval.geom.closest_point_on_ray(s[b],e,r),f=numeric.sub(s[b],d),y=numeric.norm2(f),x=crossprod(r,f);y>verb.EPSILON&&(f=numeric.mul(1/y,f),x=numeric.mul(1/y,x)),l[0][b]=s[b];var w=s[b];v[0][b]=o[b];for(var k=x,N=0,_=0,h=1;a>=h;h++){var z=0==y?d:numeric.add(d,numeric.mul(y,p[h],f),numeric.mul(y,m[h],x));l[N+2][b]=z,v[N+2][b]=o[b];var M=numeric.sub(numeric.mul(p[h],x),numeric.mul(m[h],f));if(0==y)l[N+1][b]=d;else{var A=verb.eval.geom.intersect_rays(w,numeric.mul(1/numeric.norm2(k),k),z,numeric.mul(1/numeric.norm2(M),M)),E=numeric.add(w,numeric.mul(k,A[0]));l[N+1][b]=E}v[N+1][b]=g*o[b],N+=2,a>h&&(w=z,k=M)}}return{knots_u:u,knots_v:n,control_points:l,degree_u:2,degree_v:i,weights:v}},verb.eval.nurbs.get_arc=function(e,r,t,n,i,s){return verb.eval.nurbs.get_ellipse_arc(e,r,t,n,n,i,s)},verb.eval.nurbs.intersect_rational_surfaces=function(){},verb.eval.mesh.intersect_meshes=function(){},verb.eval.mesh.intersect_meshes_by_aabb=function(e,r,t,n,i){var s=_.range(r.length),o=_.range(i.length),a=verb.eval.mesh.make_mesh_aabb_tree(e,r,s),u=verb.eval.mesh.make_mesh_aabb_tree(n,i,o);verb.eval.mesh.intersect_aabb_tree(e,r,n,i,a,u)},verb.eval.geom.intersect_tris=function(e,r,t,n,i){for(var s=[e[tr1[0]],e[tr1[1]]],o=[e[tr1[1]],e[tr1[2]]],a=[e[tr1[2]],e[tr1[0]]],u=[n[tr2[0]],n[tr2[1]]],l=[n[tr2[1]],n[tr2[2]]],v=[n[tr2[2]],n[tr2[0]]],c=[s,o,a],b=[u,l,v],h=[],g=verb.eval.geom.get_tri_norm(n,i),_=n[tr2[0]],m=0;3>m;m++){var p=verb.eval.geom.intersect_segment_with_plane(c[m][0],b[m][1],_,g);p.intersects&&h.push(p)}if(2!==h.length)return null;for(var d=[h[0].point,h[1].point],f=[],m=0;3>m;m++){var y=verb.eval.geom.intersect_segments(d[0],d[1],d,b1,tol);y&&f.push(y)}0===f.length||1===f.length||2===f.length},verb.eval.geom.intersect_segment_with_tri=function(e,r,t,n){var i=t[n[0]],s=t[n[1]],o=t[n[2]],a=numeric.sub(s,i),u=numeric.sub(o,i),l=numeric.dot(a,u),v=numeric.dot(a,a),c=numeric.dot(u,u),b=l*l-v*c,h=(l*numeric.dot(a,u)-c*numeric.dot(w,a))/b,g=(l*numeric.dot(w,a)-v*numeric.dot(w,u))/b;if(h>1+EPSILON||g>1+EPSILON||-EPSILON>g||-EPSILON>h||h+g>1+EPSILON)return null;var _=numeric.add(i,numeric.add(numeric.mul(h,a),numeric.mul(g,u))),m=numeric.sub(e,r),p=numeric.dot(m,m),d=numeric.sub(_,r),f=numeric.dot(d,d),y=f/p;return{point:_,s:h,t:g,param:y}},verb.eval.geom.intersect_segment_with_plane=function(e,r,t,n){var i=numeric.dot(n,numeric.sub(e,r));if(EPSILON>abs(i))return null;var s=numeric.dot(n,numeric.sub(t,e));return{param:s/i}},verb.eval.geom.intersect_aabb_trees=function(e,r,t,n,i,s){var o=i.bounding_box.intersects(s.bounding_box);return o?0===i.children.length&&0===s.children.length?[[i.triangle,s.triangle]]:0===i.children.length&&0!=s.children.length?verb.eval.geom.intersect_aabb_trees(e,r,t,n,i,s.children[0]).concat(verb.eval.geom.intersect_aabb_trees(e,r,t,n,i,s.children[1])):0!=i.children.length&&0===s.children.length?verb.eval.geom.intersect_aabb_trees(e,r,t,n,i.children[0],s).concat(verb.eval.geom.intersect_aabb_trees(e,r,t,n,i.children[1],s)):0!=i.children.length&&0!=s.children.length?verb.eval.geom.intersect_aabb_trees(e,r,t,n,i.children[0],s.children[0]).concat(verb.eval.geom.intersect_aabb_trees(e,r,t,n,i.children[0],s.children[1])).concat(verb.eval.geom.intersect_aabb_trees(e,r,t,n,i.children[1],s.children[0])).concat(verb.eval.geom.intersect_aabb_trees(e,r,t,n,i.children[1],s.children[1])):void 0:[]},verb.eval.mesh.make_mesh_aabb_tree=function(e,r,t){var n={bounding_box:verb.eval.mesh.make_mesh_aabb(e,r,t),children:[]};if(1===t.length)return n.triangle=t[0],n;var i=verb.eval.mesh.sort_tris_on_longest_axis(n.bounding_box,e,r,t),s=i.slice(0,Math.floor(i.length/2)),o=i.slice(Math.floor(i.length/2),i.length);return n.children=[verb.eval.mesh.make_mesh_aabb_tree(e,r,s),verb.eval.mesh.make_mesh_aabb_tree(e,r,o)],n},verb.eval.mesh.make_mesh_aabb=function(e,r,t){for(var n=new verb.geom.BoundingBox,i=t.length-1;i>=0;i--){var s=t[i];n.add(e[r[s][0]]),n.add(e[r[s][1]]),n.add(e[r[s][2]])}return n},verb.eval.mesh.sort_tris_on_longest_axis=function(e,r,t,n){for(var i=e.get_longest_axis(),s=[],o=n.length-1;o>=0;o--){var a=n[o],u=verb.eval.mesh.get_min_coordinate_on_axis(r,t[a],i);s.push([u,a])}s.sort(function(e,r){return e[0]>r[0]});for(var l=[],o=0,v=s.length;v>o;o++)l.push(s[o][1]);return l},verb.eval.mesh.get_min_coordinate_on_axis=function(e,r,t){for(var n=[],i=0;3>i;i++)n.push(e[r[i]][t]);return Math.min.apply(Math,n)},verb.eval.geom.get_tri_centroid=function(e,r){for(var t=[0,0,0],n=0;3>n;n++)for(var i=0;3>i;i++)t[i]+=e[r[n]][i];for(var n=0;3>n;n++)t[n]/=3;return t},verb.eval.geom.get_tri_norm=function(e,r){var t=e[r[0]],n=e[r[1]],i=e[r[2]],s=numeric.sub(n,t),o=numeric.sub(i,t),a=numeric.cross(s,o);return numeric.mul(1/numeric.norm2(a),a)},verb.eval.mesh.tesselate_rational_surface_naive=function(e,r,t,n,i,s,o){1>s&&(s=1),1>o&&(o=1);for(var a=1/s,u=1/o,l=[],v=[],c=0;s+1>c;c++)for(var b=0;o+1>b;b++){var h=c*a,g=b*u;v.push([h,g]),l.push(verb.eval.nurbs.rational_surface_point(e,r,t,n,i,h,g))}for(var _=[],c=0;s>c;c++)for(var b=0;o>b;b++){var m=c*(o+1)+b,p=(c+1)*(o+1)+b,d=p+1,f=m+1,y=[m,p,d],x=[m,d,f];_.push(y),_.push(x)}return{points:l,faces:_,uvs:v}},verb.eval.nurbs.rational_curve_curve_bb_intersect_refine=function(e,r,t,n,i,s,o){var a=function(o){var a=verb.eval.nurbs.rational_curve_point(e,r,t,o[0]),u=verb.eval.nurbs.rational_curve_point(n,i,s,o[1]),l=numeric.sub(a,u);return numeric.dot(l,l)},u=numeric.uncmin(a,o);return[u.f].concat(u.solution)},verb.eval.nurbs.intersect_rational_curves_by_aabb=function(e,r,t,n,i,s,o,a){var u=verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(e,r,t,o),l=verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(e,r,t,o),v=_.map(u,function(e){return e[0]}),c=_.map(l,function(e){return e[0]}),b=_.map(u,function(e){return e.slice(1)}),h=_.map(l,function(e){return e.slice(1)});return verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(b,h,v,c,a)},verb.eval.nurbs.intersect_parametric_polylines_by_aabb=function(e,r,t,n,i){var s=new verb.geom.BoundingBox(e),o=new verb.geom.BoundingBox(r);if(s.intersects(o)){if(2!==e.length||2!==r.length){if(2===e.length){var a=Math.ceil(r.length/2),u=r.slice(0,a),l=n.slice(0,a),v=r.slice(a-1);return m=r.slice(a-1),verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(e,u,t,l,i).concat(verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(e,v,t,m,i))}if(2===r.length){var c=Math.ceil(e.length/2),b=e.slice(0,c),h=t.slice(0,c),g=e.slice(c-1);return _=e.slice(c-1),verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(r,b,n,b,i).concat(verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(r,g,n,_,i))}var c=Math.ceil(e.length/2),b=e.slice(0,c),h=t.slice(0,c),g=e.slice(c-1),_=e.slice(c-1),a=Math.ceil(r.length/2),u=r.slice(0,a),l=n.slice(0,a),v=r.slice(a-1),m=r.slice(a-1);return verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(b,u,h,u,i).concat(verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(b,v,h,m,i)).concat(verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(g,u,_,l,i)).concat(verb.eval.nurbs.parametric_polyline_polyline_bb_intersect(g,v,_,m,i))}var p=verb.eval.geom.segment_segment_intersect(e[0],e[1],r[0],r[1],i);return null!=p?(p[0][0]=p[0][0]*(t[1]-t[0])+t[0],p[1][0]=p[1][0]*(n[1]-n[0])+n[0],p):[]}},verb.eval.geom.intersect_segments=function(e,r,t,n){var i=numeric.sub(r,e),s=Math.sqrt(numeric.dot(i,i)),o=numeric.mul(1/s,i);if(b1mb0=numeric.sub(n,t),bN=Math.sqrt(numeric.dot(b1mb0,b1mb0)),o=numeric.mul(1/bN,i),int_params=ray_ray_intersect(e,o,t,b),null!=int_params){var a=Math.min(Math.max(0,int_params[0]/o),1),u=Math.min(Math.max(0,int_params[1]/b),1),l=numeric.add(numeric.mul(a,i),e),v=numeric.add(numeric.mul(u,b1mb0),t),c=numeric.norm2Squared(numeric.sub(l,v));if(tolerance*tolerance>c)return[[a].concat(l),[u].concat(v)]}return null},verb.eval.geom.closest_point_on_ray=function(e,r,t){var n=numeric.sub(e,r),i=numeric.dot(n,t),s=numeric.add(r,numeric.mul(i,t));return s},verb.eval.geom.intersect_rays=function(e,r,t,n){var i=numeric.dot(r,n),s=numeric.dot(r,t),o=numeric.dot(r,e),a=numeric.dot(n,t),u=numeric.dot(n,e),l=numeric.dot(r,r),v=numeric.dot(n,n),c=l*v-i*i;if(Math.abs(c)<verb.EPSILON)return null;var b=i*(s-o)-l*(a-u),h=b/c,g=(s-o+h*i)/l;return[g,h]},verb.eval.nurbs.rational_curve_regular_sample=function(e,r,t,n){return verb.eval.nurbs.rational_curve_regular_sample_range(e,r,t,0,1,n)},verb.eval.nurbs.rational_curve_regular_sample_range=function(e,r,t,n,i,s){1>s&&(s=2);for(var o=[],a=(i-n)/(s-1),u=0,l=0;s>l;l++)u=n+a*l,o.push([u].concat(verb.eval.nurbs.rational_curve_point(e,r,t,u)));return o},verb.eval.nurbs.rational_curve_adaptive_sample=function(e,r,t,n){return 1===e?t.map(verb.eval.nurbs.dehomogenize):verb.eval.nurbs.rational_curve_adaptive_sample_range(e,r,t,0,1,n)},verb.eval.nurbs.rational_curve_adaptive_sample_range=function(e,r,t,n,i,s){var o=verb.eval.nurbs.rational_curve_point(e,r,t,n),a=verb.eval.nurbs.rational_curve_point(e,r,t,i),u=.45+.1*Math.random(),l=n+(i-n)*u,v=verb.eval.nurbs.rational_curve_point(e,r,t,l);if(verb.eval.nurbs.three_points_are_flat(o,v,a,s))return[[n,o[0],o[1],o[2]],[i,a[0],a[1],a[2]]];var c=verb.eval.nurbs.rational_curve_adaptive_sample_range(e,r,t,n,l,s),b=verb.eval.nurbs.rational_curve_adaptive_sample_range(e,r,t,l,i,s);return c.slice(0,-1).concat(b)},verb.eval.nurbs.three_points_are_flat=function(e,r,t,n){var i=new verb.geom.Vector3(e),s=new verb.geom.Vector3(r),o=new verb.geom.Vector3(t),a=s.minus(i).cross(o.minus(i)),u=a.dot(a);return n>u},verb.eval.nurbs.curve_knot_insert=function(e,r,t,n,i,s){var o=(t[0].length,r.length-e-2),a=t.length,u=verb.eval.nurbs.knot_span(e,n,r),l=o+e+1,v=a+s,c=Array(e+1),b=Array(r.length+s),h=Array(v),g=0;for(g=0;u>=g;g++)b[g]=r[g];for(g=1;s>=g;g++)b[u+g]=n;for(g=u+1;l>=g;g++)b[g+s]=r[g];for(g=0;u-e>=g;g++)h[g]=t[g];for(g=u-i;o>=g;g++)h[g+s]=t[g];for(g=0;e-i>=g;g++)c[g]=t[u-e+1];for(var _=0,m=0,p=1;s>=p;p++){for(_=u-e+p,g=0;e-p-i>=g;g++)m=(n-r[_+g])/(r[g+u+1]-r[_+g]),c[g]=numeric.add(numeric.mul(m,c[g+1]),numeric.mul(1-m,c[g]));h[_]=c[0],h[u+s-p-i]=c[e-p-i]}for(g=_+1;u-i>g;g++)h[g]=c[g-_];return[b,h]},verb.eval.nurbs.rational_surface_derivs=function(e,r,t,n,i,s,o,a){var u=verb.eval.nurbs.surface_derivs(e,r,t,n,i,s,o,a),l=verb.eval.nurbs.separate_homo_derivs_2d(u),v=l[0],c=l[1],b=0,h=0,g=0,_=0,m=[],p=v[0][0].length;for(b=0;s>=b;b++)for(m.push([]),_=0;s-b>=_;_++){var a=v[b][_];for(g=1;_>=g;g++)a=numeric.sub(a,numeric.mul(numeric.mul(binomial.get(_,g),c[0][g]),m[b][_-g]));for(h=1;b>=h;h++){a=numeric.sub(a,numeric.mul(numeric.mul(binomial.get(b,h),c[h][0]),m[b-h][_]));var d=verb.eval.nurbs.zeros_1d(p);for(g=1;_>=g;g++)d=numeric.add(d,numeric.mul(numeric.mul(binomial.get(_,g),c[h][g]),m[b-h][_-g]));a=numeric.sub(a,numeric.mul(binomial.get(b,h),d))}m[b].push(numeric.mul(1/c[0][0],a))}return m},verb.eval.nurbs.rational_surface_point=function(e,r,t,n,i,s,o){return verb.eval.nurbs.dehomogenize(verb.eval.nurbs.surface_point(e,r,t,n,i,s,o))},verb.eval.nurbs.rational_curve_derivs=function(e,r,t,n,i){var s=verb.eval.nurbs.separate_homo_derivs_1d(verb.eval.nurbs.curve_derivs(e,r,t,n,i)),o=s[0],a=s[1],u=0,l=0,v=[];for(u=0;i>=u;u++){var c=o[u];for(l=1;u>=l;l++)c=numeric.sub(c,numeric.mul(numeric.mul(binomial.get(u,l),a[l]),v[u-l]));v.push(numeric.mul(1/a[0],c))}return v},verb.eval.nurbs.separate_homo_derivs_1d=function(e){for(var r=e[0].length,t=r-1,n=[],i=[],s=0,o=e.length;o>s;s++)n.push(e[s].slice(0,t)),i.push(e[s][t]);
return[n,i]},verb.eval.nurbs.separate_homo_derivs_2d=function(e){for(var r=[],t=[],n=0,i=e.length;i>n;n++){var s=verb.eval.nurbs.separate_homo_derivs_1d(e[n]);r.push(s[0]),t.push(s[1])}return[r,t]},verb.eval.nurbs.rational_curve_point=function(e,r,t,n){return verb.eval.nurbs.dehomogenize(verb.eval.nurbs.curve_point(e,r,t,n))},verb.eval.nurbs.dehomogenize=function(e){for(var r=e.length,t=[],n=e[r-1],i=0;e.length-1>i;i++)t.push(e[i]/n);return t},verb.eval.nurbs.homogenize_1d=function(e,r){for(var t=e.length,n=e[0].length,i=0,s=[],o=0,a=[],u=0;t>u;u++){var l=[];for(a=e[u],o=r[u],i=0;n>i;i++)l.push(a[i]*o);l.push(o),s.push(l)}return s},verb.eval.nurbs.homogenize_2d=function(e,r){for(var t=e.length,n=(e[0].length,e[0][0].length,[]),i=0;t>i;i++)n.push(verb.eval.nurbs.homogenize_1d(e[i],r[i]));return n},verb.eval.nurbs.surface_derivs=function(e,r,t,n,i,s,o,a){var u=r.length-e-2,l=n.length-t-2;return verb.eval.nurbs.surface_derivs_given_n_m(u,e,r,l,t,n,i,s,o,a)},verb.eval.nurbs.surface_derivs_given_n_m=function(e,r,t,n,i,s,o,a,u,l){if(verb.eval.nurbs.are_valid_relations(r,o.length,t.length)===!1||verb.eval.nurbs.are_valid_relations(i,o[0].length,s.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var v=o[0][0].length,c=Math.min(a,r),b=Math.min(a,i),h=verb.eval.nurbs.zeros_3d(c+1,b+1,v),g=verb.eval.nurbs.knot_span_given_n(e,r,u,t),_=verb.eval.nurbs.knot_span_given_n(n,i,l,s),m=verb.eval.nurbs.deriv_basis_functions_given_n_i(g,u,r,e,t),p=verb.eval.nurbs.deriv_basis_functions_given_n_i(_,l,i,n,s),d=verb.eval.nurbs.zeros_2d(i+1,v),f=0,y=0,x=0,w=0,k=0;for(f=0;c>=f;f++){for(y=0;i>=y;y++)for(d[y]=verb.eval.nurbs.zeros_1d(v),x=0;r>=x;x++)d[y]=numeric.add(d[y],numeric.mul(m[f][x],o[g-r+x][_-i+y]));for(k=Math.min(a-f,b),w=0;k>=w;w++)for(h[f][w]=verb.eval.nurbs.zeros_1d(v),y=0;i>=y;y++)h[f][w]=numeric.add(h[f][w],numeric.mul(p[w][y],d[y]))}return h},verb.eval.nurbs.surface_point=function(e,r,t,n,i,s,o){var a=r.length-e-2,u=n.length-t-2;return verb.eval.nurbs.surface_point_given_n_m(a,e,r,u,t,n,i,s,o)},verb.eval.nurbs.surface_point_given_n_m=function(e,r,t,n,i,s,o,a,u){if(verb.eval.nurbs.are_valid_relations(r,o.length,t.length)===!1||verb.eval.nurbs.are_valid_relations(i,o[0].length,s.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var l=o[0][0].length,v=verb.eval.nurbs.knot_span_given_n(e,r,a,t),c=verb.eval.nurbs.knot_span_given_n(n,i,u,s),b=verb.eval.nurbs.basis_functions_given_knot_span_index(v,a,r,t),h=verb.eval.nurbs.basis_functions_given_knot_span_index(c,u,i,s),g=v-r,_=c,m=verb.eval.nurbs.zeros_1d(l),p=verb.eval.nurbs.zeros_1d(l),d=0,f=0;for(d=0;i>=d;d++){for(p=verb.eval.nurbs.zeros_1d(l),_=c-i+d,f=0;r>=f;f++)p=numeric.add(p,numeric.mul(b[f],o[g+f][_]));m=numeric.add(m,numeric.mul(h[d],p))}return m},verb.eval.nurbs.curve_derivs=function(e,r,t,n,i){var s=r.length-e-2;return verb.eval.nurbs.curve_derivs_given_n(s,e,r,t,n,i)},verb.eval.nurbs.curve_derivs_given_n=function(e,r,t,n,i,s){if(verb.eval.nurbs.are_valid_relations(r,n.length,t.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;var o=n[0].length,a=Math.min(s,r),u=verb.eval.nurbs.zeros_2d(a+1,o),l=verb.eval.nurbs.knot_span_given_n(e,r,i,t),v=verb.eval.nurbs.deriv_basis_functions_given_n_i(l,i,r,a,t),c=0,b=0;for(c=0;a>=c;c++)for(b=0;r>=b;b++)u[c]=numeric.add(u[c],numeric.mul(v[c][b],n[l-r+b]));return u},verb.eval.nurbs.are_valid_relations=function(e,r,t){return 0===r+e+1-t?!0:!1},verb.eval.nurbs.curve_point=function(e,r,t,n){var i=r.length-e-2;return verb.eval.nurbs.curve_point_given_n(i,e,r,t,n)},verb.eval.nurbs.curve_point_given_n=function(e,r,t,n,i){if(verb.eval.nurbs.are_valid_relations(r,n.length,t.length)===!1)return console.error("Invalid relations between control points, knot vector, and n"),null;for(var s=verb.eval.nurbs.knot_span_given_n(e,r,i,t),o=verb.eval.nurbs.basis_functions_given_knot_span_index(s,i,r,t),a=verb.eval.nurbs.zeros_1d(n[0].length),u=0;r>=u;u++)a=numeric.add(a,numeric.mul(o[u],n[s-r+u]));return a},verb.eval.nurbs.zeros_1d=function(e){e=e>0?e:0;for(var r=[];e--;)r.push(0);return r},verb.eval.nurbs.zeros_2d=function(e,r){r=r>0?r:0,e=e>0?e:0;for(var t=[],n=r,i=e;e--;){for(t.push([]);n--;)t[i-e-1].push(0);n=r}return t},verb.eval.nurbs.zeros_3d=function(e,r,t){r=r>0?r:0,e=e>0?e:0;for(var n=[],i=r,s=e;e--;){for(n.push([]);i--;)n[s-e-1].push(verb.eval.nurbs.zeros_1d(t));i=r}return n},verb.eval.nurbs.deriv_basis_functions=function(e,r,t){var n=verb.eval.nurbs.knot_span(r,e,t),i=t.length-1,s=i-r-1;return verb.eval.nurbs.deriv_basis_functions_given_n_i(n,e,r,s,t)},verb.eval.nurbs.deriv_basis_functions_given_n_i=function(e,r,t,n,i){var s=verb.eval.nurbs.zeros_2d(t+1,t+1),o=Array(t+1),a=Array(t+1),u=0,l=0,v=1,c=0;for(s[0][0]=1,v=1;t>=v;v++){for(o[v]=r-i[e+1-v],a[v]=i[e+v]-r,u=0,c=0;v>c;c++)s[v][c]=a[c+1]+o[v-c],l=s[c][v-1]/s[v][c],s[c][v]=u+a[c+1]*l,u=o[v-c]*l;s[v][v]=u}var b=verb.eval.nurbs.zeros_2d(n+1,t+1),h=verb.eval.nurbs.zeros_2d(2,t+1),g=1,_=0,m=1,p=0,d=0,f=0,y=0,x=0;for(v=0;t>=v;v++)b[0][v]=s[v][t];for(c=0;t>=c;c++)for(_=0,m=1,h[0][0]=1,g=1;n>=g;g++){for(p=0,d=c-g,f=t-g,c>=g&&(h[m][0]=h[_][0]/s[f+1][d],p=h[m][0]*s[d][f]),y=d>=-1?1:-d,x=f>=c-1?g-1:t-c,v=y;x>=v;v++)h[m][v]=(h[_][v]-h[_][v-1])/s[f+1][d+v],p+=h[m][v]*s[d+v][f];f>=c&&(h[m][g]=-h[_][g-1]/s[f+1][c],p+=h[m][g]*s[c][f]),b[g][c]=p,v=_,_=m,m=v}for(c=t,g=1;n>=g;g++){for(v=0;t>=v;v++)b[g][v]*=c;c*=t-g}return b},verb.eval.nurbs.basis_functions=function(e,r,t){var n=verb.eval.nurbs.knot_span(e,r,t);return verb.eval.nurbs.basis_functions_given_knot_span_index(n,e,r,t)},verb.eval.nurbs.basis_functions_given_knot_span_index=function(e,r,t,n){var i=Array(t+1),s=Array(t+1),o=Array(t+1),a=0,u=0;i[0]=1;for(var l=1;t>=l;l++){s[l]=r-n[e+1-l],o[l]=n[e+l]-r,a=0;for(var v=0;l>v;v++)u=i[v]/(o[v+1]+s[l-v]),i[v]=a+o[v+1]*u,a=s[l-v]*u;i[l]=a}return i},verb.eval.nurbs.knot_span=function(e,r,t){var n=t.length-1,i=n-e-1;return verb.eval.nurbs.knot_span_given_n(i,e,r,t)},verb.eval.nurbs.knot_span_given_n=function(e,r,t,n){if(t>=n[e+1])return e;if(n[r]>t)return r;for(var i=r,s=e+1,o=Math.floor((i+s)/2);n[o]>t||t>=n[o+1];)n[o]>t?s=o:i=o,o=Math.floor((i+s)/2);return o};