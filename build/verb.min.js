/*! verb 2015-01-20 */
if("object"!=typeof exports||void 0===exports)var verb=exports={};else var Worker=require("webworker-threads").Worker;if("object"!=typeof window){var global=this,lookup=function(e,r){var n=global;return e.split(".").forEach(function(e){n&&(n=n[e])}),n?n[r]:null};onmessage=function(e){var r=lookup(e.data.className,e.data.methodName);return r?(postMessage({result:r.apply(null,e.data.args),id:e.data.id}),void 0):console.error("could not find "=e.data.className+"."+e.data.methodName)}}(function(e){"use strict";function r(e,r){function n(){}n.prototype=e;var t=new n;for(var o in r)t[o]=r[o];return r.toString!==Object.prototype.toString&&(t.toString=r.toString),t}function n(e){return e instanceof Array?function(){return i.iter(e)}:"function"==typeof e.iterator?t(e,e.iterator):e.iterator}function t(e,r){if(null==r)return null;null==r.__id__&&(r.__id__=p++);var n;return null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[r.__id__],null==n&&(n=function(){return n.method.apply(n.scope,arguments)},n.scope=e,n.method=r,e.hx__closures__[r.__id__]=n),n}e.core=e.core||{},e.promhx=e.promhx||{};var o=function(){return js.Boot.__string_rec(this,"")},i=function(){};i.__name__=["HxOverrides"],i.substr=function(e,r,n){return null!=r&&0!=r&&null!=n&&0>n?"":(null==n&&(n=e.length),0>r?(r=e.length+r,0>r&&(r=0)):0>n&&(n=e.length+n-r),e.substr(r,n))},i.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var c=function(){};c.__name__=["Lambda"],c.fold=function(e,r,t){for(var o=n(e)();o.hasNext();){var i=o.next();t=r(i,t)}return t};var s=function(){this.length=0};s.__name__=["List"],s.prototype={add:function(e){var r=[e];null==this.h?this.h=r:this.q[1]=r,this.q=r,this.length++},pop:function(){if(null==this.h)return null;var e=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,e},isEmpty:function(){return null==this.h}};var a=function(){};a.__name__=["IMap"],Math.__name__=["Math"];var u=function(){this.b=""};u.__name__=["StringBuf"];var l=function(){};l.__name__=["Type"],l.getClassName=function(e){var r=e.__name__;return r.join(".")};var h={};h.StackItem={__constructs__:["CFunction","Module","FilePos","Method","LocalFunction"]},h.StackItem.CFunction=["CFunction",0],h.StackItem.CFunction.toString=o,h.StackItem.CFunction.__enum__=h.StackItem,h.StackItem.Module=function(e){var r=["Module",1,e];return r.__enum__=h.StackItem,r.toString=o,r},h.StackItem.FilePos=function(e,r,n){var t=["FilePos",2,e,r,n];return t.__enum__=h.StackItem,t.toString=o,t},h.StackItem.Method=function(e,r){var n=["Method",3,e,r];return n.__enum__=h.StackItem,n.toString=o,n},h.StackItem.LocalFunction=function(e){var r=["LocalFunction",4,e];return r.__enum__=h.StackItem,r.toString=o,r},h.CallStack=function(){},h.CallStack.__name__=["haxe","CallStack"],h.CallStack.callStack=function(){var e=Error.prepareStackTrace;Error.prepareStackTrace=function(e,r){for(var n=[],t=0;r.length>t;){var o=r[t];++t;var c=null,s=o.getFunctionName();if(null!=s){var a=s.lastIndexOf(".");if(a>=0){var u=i.substr(s,0,a),l=i.substr(s,a+1,null);c=h.StackItem.Method(u,l)}}n.push(h.StackItem.FilePos(c,o.getFileName(),o.getLineNumber()))}return n};var r=h.CallStack.makeStack(Error().stack);return r.shift(),Error.prepareStackTrace=e,r},h.CallStack.toString=function(e){for(var r=new u,n=0;e.length>n;){var t=e[n];++n,r.b+="\nCalled from ",h.CallStack.itemToString(r,t)}return r.b},h.CallStack.itemToString=function(e,r){switch(r[1]){case 0:e.b+="a C function";break;case 1:var n=r[2];e.b+="module ",e.b+=null==n?"null":""+n;break;case 2:var t=r[4],o=r[3],i=r[2];null!=i&&(h.CallStack.itemToString(e,i),e.b+=" ("),e.b+=null==o?"null":""+o,e.b+=" line ",e.b+=null==t?"null":""+t,null!=i&&(e.b+=")");break;case 3:var c=r[3],s=r[2];e.b+=null==s?"null":""+s,e.b+=".",e.b+=null==c?"null":""+c;break;case 4:var a=r[2];e.b+="local function #",e.b+=null==a?"null":""+a}},h.CallStack.makeStack=function(e){if("string"==typeof e){for(var r=e.split("\n"),n=[],t=0;r.length>t;){var o=r[t];++t,n.push(h.StackItem.Module(o))}return n}return e},h.ds={},h.ds.IntMap=function(){this.h={}},h.ds.IntMap.__name__=["haxe","ds","IntMap"],h.ds.IntMap.__interfaces__=[a],h.ds.IntMap.prototype={set:function(e,r){this.h[e]=r},get:function(e){return this.h[e]},exists:function(e){return this.h.hasOwnProperty(e)},remove:function(e){return this.h.hasOwnProperty(e)?(delete this.h[e],!0):!1}},h.ds.Option={__constructs__:["Some","None"]},h.ds.Option.Some=function(e){var r=["Some",0,e];return r.__enum__=h.ds.Option,r.toString=o,r},h.ds.Option.None=["None",1],h.ds.Option.None.toString=o,h.ds.Option.None.__enum__=h.ds.Option;var v={};v.base={},v.base.AsyncBase=function(e){this._resolved=!1,this._pending=!1,this._errorPending=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,null!=e&&v.base.AsyncBase.link(e,this,function(e){return e})},v.base.AsyncBase.__name__=["promhx","base","AsyncBase"],v.base.AsyncBase.link=function(e,r,n){e._update.push({async:r,linkf:function(e){r.handleResolve(n(e))}}),v.base.AsyncBase.immediateLinkUpdate(e,r,n)},v.base.AsyncBase.immediateLinkUpdate=function(e,r,n){if(e._errored&&r.handleError(e._errorVal),e._resolved&&!e._pending)try{r.handleResolve(n(e._val))}catch(t){r.handleError(t)}},v.base.AsyncBase.linkAll=function(e,r){for(var t=function(t,o,i){if(0==t.length||v.base.AsyncBase.allFulfilled(t)){for(var c,s=[],a=n(e)();a.hasNext();){var u=a.next();s.push(u==o?i:u._val)}c=s,r.handleResolve(c)}return null},o=n(e)();o.hasNext();){var i=o.next();i._update.push({async:r,linkf:function(e,r,n){return function(t){return e(r,n,t)}}(t,function(){for(var r,t=[],o=n(e)();o.hasNext();){var c=o.next();c!=i&&t.push(c)}return r=t}(this),i)})}v.base.AsyncBase.allFulfilled(e)&&r.handleResolve(function(){for(var r,t=[],o=n(e)();o.hasNext();){var i=o.next();t.push(i._val)}return r=t}(this))},v.base.AsyncBase.pipeLink=function(e,r,n){var o=!1,i=function(e){if(!o){o=!0;var i=n(e);i._update.push({async:r,linkf:t(r,r.handleResolve)}),v.base.AsyncBase.immediateLinkUpdate(i,r,function(e){return e})}};if(e._update.push({async:r,linkf:i}),e._resolved&&!e._pending)try{i(e._val)}catch(c){r.handleError(c)}},v.base.AsyncBase.allResolved=function(e){for(var r=n(e)();r.hasNext();){var t=r.next();if(!t._resolved)return!1}return!0},v.base.AsyncBase.allFulfilled=function(e){for(var r=n(e)();r.hasNext();){var t=r.next();if(!t._fulfilled)return!1}return!0},v.base.AsyncBase.prototype={catchError:function(e){return this._error.push(e),this},errorThen:function(e){return this._errorMap=e,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(e){this._resolve(e)},_resolve:function(e){var r=this;this._pending?v.base.EventLoop.enqueue(function(e,r){return function(){return e(r)}}(t(this,this._resolve),e)):(this._resolved=!0,this._pending=!0,v.base.EventLoop.queue.add(function(){r._val=e;for(var n=0,t=r._update;t.length>n;){var o=t[n];++n;try{o.linkf(e)}catch(i){o.async.handleError(i)}}r._fulfilled=!0,r._pending=!1}),v.base.EventLoop.continueOnNextLoop())},handleError:function(e){this._handleError(e)},_handleError:function(e){var r=this,n=function(e){if(r._error.length>0)for(var n=0,t=r._error;t.length>n;){var o=t[n];++n,o(e)}else{if(!(r._update.length>0))throw console.log("Call Stack: "+h.CallStack.toString(h.CallStack.callStack())),e;for(var i=0,c=r._update;c.length>i;){var s=c[i];++i,s.async.handleError(e)}}r._errorPending=!1};this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=e,v.base.EventLoop.queue.add(function(){if(null!=r._errorMap)try{r._resolve(r._errorMap(e))}catch(t){n(t)}else n(e)}),v.base.EventLoop.continueOnNextLoop())},then:function(e){var r=new v.base.AsyncBase;return v.base.AsyncBase.link(this,r,e),r},unlink:function(e){var r=this;v.base.EventLoop.queue.add(function(){r._update=r._update.filter(function(r){return r.async!=e})}),v.base.EventLoop.continueOnNextLoop()},isLinked:function(e){for(var r=!1,n=0,t=this._update;t.length>n;){var o=t[n];if(++n,o.async==e)return!0}return r}},v.Deferred=e.promhx.Deferred=function(){v.base.AsyncBase.call(this)},v.Deferred.__name__=["promhx","Deferred"],v.Deferred.__super__=v.base.AsyncBase,v.Deferred.prototype=r(v.base.AsyncBase.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},promise:function(){return new v.Promise(this)},stream:function(){return new v.Stream(this)},publicStream:function(){return new v.PublicStream(this)}}),v.Promise=e.promhx.Promise=function(e){v.base.AsyncBase.call(this,e),this._rejected=!1},v.Promise.__name__=["promhx","Promise"],v.Promise.whenAll=function(e){var r=new v.Promise;return v.base.AsyncBase.linkAll(e,r),r},v.Promise.promise=function(e){var r=new v.Promise;return r.handleResolve(e),r},v.Promise.__super__=v.base.AsyncBase,v.Promise.prototype=r(v.base.AsyncBase.prototype,{isRejected:function(){return this._rejected},reject:function(e){this._rejected=!0,this.handleError(e)},handleResolve:function(e){if(this._resolved){var r="Promise has already been resolved";throw v.error.PromiseError.AlreadyResolved(r)}this._resolve(e)},then:function(e){var r=new v.Promise;return v.base.AsyncBase.link(this,r,e),r},unlink:function(e){var r=this;v.base.EventLoop.queue.add(function(){if(r._fulfilled)r._update=r._update.filter(function(r){return r.async!=e});else{var n="Downstream Promise is not fullfilled";r.handleError(v.error.PromiseError.DownstreamNotFullfilled(n))}}),v.base.EventLoop.continueOnNextLoop()},handleError:function(e){this._rejected=!0,this._handleError(e)},pipe:function(e){var r=new v.Promise;return v.base.AsyncBase.pipeLink(this,r,e),r},errorPipe:function(e){var r=new v.Promise;return this.catchError(function(n){var o=e(n);o.then(t(r,r._resolve))}),this.then(t(r,r._resolve)),r}}),v.Stream=e.promhx.Stream=function(e){v.base.AsyncBase.call(this,e),this._end_deferred=new v.Deferred,this._end_promise=this._end_deferred.promise()},v.Stream.__name__=["promhx","Stream"],v.Stream.foreach=function(e){for(var r=new v.Stream,t=n(e)();t.hasNext();){var o=t.next();r.handleResolve(o)}return r.end(),r},v.Stream.wheneverAll=function(e){var r=new v.Stream;return v.base.AsyncBase.linkAll(e,r),r},v.Stream.concatAll=function(e){for(var r=new v.Stream,t=n(e)();t.hasNext();){var o=t.next();r.concat(o)}return r},v.Stream.mergeAll=function(e){for(var r=new v.Stream,t=n(e)();t.hasNext();){var o=t.next();r.merge(o)}return r},v.Stream.stream=function(e){var r=new v.Stream;return r.handleResolve(e),r},v.Stream.__super__=v.base.AsyncBase,v.Stream.prototype=r(v.base.AsyncBase.prototype,{then:function(e){var r=new v.Stream;return v.base.AsyncBase.link(this,r,e),this._end_promise.then(function(){r.end()}),r},detachStream:function(e){for(var r=[],n=!1,t=0,o=this._update;o.length>t;){var i=o[t];++t,i.async==e?n=!0:r.push(i)}return this._update=r,n},first:function(){var e=new v.Promise;return this.then(function(r){e._resolved||e.handleResolve(r)}),e},handleResolve:function(e){this._end||this._pause||this._resolve(e)},pause:function(e){null==e&&(e=!this._pause),this._pause=e},pipe:function(e){var r=new v.Stream;return v.base.AsyncBase.pipeLink(this,r,e),this._end_promise.then(function(){r.end()}),r},errorPipe:function(e){var r=new v.Stream;return this.catchError(function(n){var o=e(n);o.then(t(r,r._resolve)),o._end_promise.then((f=r._end_promise,t(f,f._resolve)))}),this.then(t(r,r._resolve)),this._end_promise.then(function(){r.end()}),r},handleEnd:function(){if(this._pending)v.base.EventLoop.queue.add(t(this,this.handleEnd)),v.base.EventLoop.continueOnNextLoop();else{if(this._end_promise._resolved)return;this._end=!0;var e;e=this._resolved?h.ds.Option.Some(this._val):h.ds.Option.None,this._end_promise.handleResolve(e),this._update=[],this._error=[]}},end:function(){return v.base.EventLoop.queue.add(t(this,this.handleEnd)),v.base.EventLoop.continueOnNextLoop(),this},endThen:function(e){return this._end_promise.then(e)},filter:function(e){var r=new v.Stream;return this._update.push({async:r,linkf:function(n){e(n)&&r.handleResolve(n)}}),v.base.AsyncBase.immediateLinkUpdate(this,r,function(e){return e}),r},concat:function(e){var r=new v.Stream;return this._update.push({async:r,linkf:t(r,r.handleResolve)}),v.base.AsyncBase.immediateLinkUpdate(this,r,function(e){return e}),this._end_promise.then(function(){e.pipe(function(e){return r.handleResolve(e),r}),e._end_promise.then(function(){r.end()})}),r},merge:function(e){var r=new v.Stream;return this._update.push({async:r,linkf:t(r,r.handleResolve)}),e._update.push({async:r,linkf:t(r,r.handleResolve)}),v.base.AsyncBase.immediateLinkUpdate(this,r,function(e){return e}),v.base.AsyncBase.immediateLinkUpdate(e,r,function(e){return e}),r}}),v.PublicStream=e.promhx.PublicStream=function(e){v.Stream.call(this,e)},v.PublicStream.__name__=["promhx","PublicStream"],v.PublicStream.publicstream=function(e){var r=new v.PublicStream;return r.handleResolve(e),r},v.PublicStream.__super__=v.Stream,v.PublicStream.prototype=r(v.Stream.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},update:function(e){this.handleResolve(e)}}),v.base.EventLoop=function(){},v.base.EventLoop.__name__=["promhx","base","EventLoop"],v.base.EventLoop.enqueue=function(e){v.base.EventLoop.queue.add(e),v.base.EventLoop.continueOnNextLoop()},v.base.EventLoop.set_nextLoop=function(e){if(null!=v.base.EventLoop.nextLoop)throw"nextLoop has already been set";return v.base.EventLoop.nextLoop=e,v.base.EventLoop.nextLoop},v.base.EventLoop.queueEmpty=function(){return v.base.EventLoop.queue.isEmpty()},v.base.EventLoop.finish=function(e){null==e&&(e=1e3);for(var r=null;e-->0&&null!=(r=v.base.EventLoop.queue.pop());)r();return v.base.EventLoop.queue.isEmpty()},v.base.EventLoop.clear=function(){v.base.EventLoop.queue=new s},v.base.EventLoop.f=function(){var e=v.base.EventLoop.queue.pop();null!=e&&e(),v.base.EventLoop.queue.isEmpty()||v.base.EventLoop.continueOnNextLoop()},v.base.EventLoop.continueOnNextLoop=function(){null!=v.base.EventLoop.nextLoop?v.base.EventLoop.nextLoop(v.base.EventLoop.f):setImmediate(v.base.EventLoop.f)},v.error={},v.error.PromiseError={__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]},v.error.PromiseError.AlreadyResolved=function(e){var r=["AlreadyResolved",0,e];return r.__enum__=v.error.PromiseError,r.toString=o,r},v.error.PromiseError.DownstreamNotFullfilled=function(e){var r=["DownstreamNotFullfilled",1,e];return r.__enum__=v.error.PromiseError,r.toString=o,r};var d={};d.exe={},d.exe.AsyncObject=function(){},d.exe.AsyncObject.__name__=["verb","exe","AsyncObject"],d.exe.AsyncObject.prototype={applyMethod:function(e,r,n){return d.exe.Dispatcher.instance().applyMethod(l.getClassName(e),r,n)}},d.NurbsCurve=e.NurbsCurve=function(e){this._data=e},d.NurbsCurve.__name__=["verb","NurbsCurve"],d.NurbsCurve.byControlPointsWeights=function(e,r,n,t){return new d.NurbsCurve(new d.core.types.CurveData(e,r.slice(),d.core.Eval.homogenize1d(n,t)))},d.NurbsCurve.__super__=d.exe.AsyncObject,d.NurbsCurve.prototype=r(d.exe.AsyncObject.prototype,{data:function(){return new d.core.types.CurveData(this.degree(),this.knots(),d.core.Eval.homogenize1d(this.controlPoints(),this.weights()))},degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return d.core.Eval.dehomogenize1d(this._data.controlPoints)},weights:function(){return d.core.Eval.weight1d(this._data.controlPoints)},point:function(e){return d.core.Eval.rationalCurvePoint(this._data,e)},pointAsync:function(e){return this.applyMethod(d.core.Eval,"rationalCurvePoint",[this._data,e])},derivatives:function(e,r){return null==r&&(r=1),d.core.Eval.rationalCurveDerivatives(this._data,e,r)},derivativesAsync:function(e,r){return null==r&&(r=1),this.applyMethod(d.core.Eval,"rationalCurveDerivatives",[this._data,e,r])},closestPoint:function(e){return d.core.Analyze.rationalCurveClosestPoint(this._data,e)},closestPointAsync:function(e){return this.applyMethod(d.core.Analyze,"rationalCurveClosestPoint",[this._data,e])},closestParam:function(e){return d.core.Analyze.rationalCurveClosestParam(this._data,e)},closestParamAsync:function(e){return this.applyMethod(d.core.Analyze,"rationalCurveClosestParam",[this._data,e])},length:function(){return d.core.Analyze.rationalCurveArcLength(this._data)},lengthAsync:function(){return this.applyMethod(d.core.Analyze,"rationalCurveArcLength",[this._data])},lengthAtParam:function(e){return d.core.Analyze.rationalCurveArcLength(this._data,e)},lengthAtParamAsync:function(){return this.applyMethod(d.core.Analyze,"rationalCurveArcLength",[this._data])},paramAtLength:function(e,r){return d.core.Analyze.rationalCurveParamAtArcLength(this._data,e,r)},paramAtLengthAsync:function(e,r){return this.applyMethod(d.core.Analyze,"rationalCurveParamAtArcLength",[this._data,e,r])},divideByEqualArcLength:function(e){return d.core.Divide.rationalCurveByEqualArcLength(this._data,e)},divideByEqualArcLengthAsync:function(e){return this.applyMethod(d.core.Divide,"rationalCurveByEqualArcLength",[this._data,e])},divideByArcLength:function(e){return d.core.Divide.rationalCurveByArcLength(this._data,e)},divideByArcLengthAsync:function(e){return this.applyMethod(d.core.Divide,"rationalCurveByArcLength",[this._data,e])},tessellate:function(e){return d.core.Tess.rationalCurveAdaptiveSample(this._data,e,!1)},tessellateAsync:function(e){return this.applyMethod(d.core.Tess,"rationalCurveAdaptiveSample",[this._data,e,!1])},split:function(e){return d.core.Modify.curveSplit(this._data,e).map(function(e){return new d.NurbsCurve(e)})},domain:function(){return new d.core.types.Interval(this._data.knots[0],d.core.ArrayExtensions.last(this._data.knots))},transform:function(e){for(var r=this.controlPoints(),n=0,t=r.length;t>n;){var o=n++,i=r[o];i.push(1),r[o]=d.core.Mat.dot(e,i).slice(0,i.length-2)}return new d.NurbsCurve(new d.core.types.CurveData(this.degree(),this.knots(),d.core.Eval.homogenize1d(r,this.weights())))},clone:function(){return new d.NurbsCurve(this._data)}}),d.Arc=e.Arc=function(e,r,n,t,o,i){d.NurbsCurve.call(this,d.core.Make.arc(e,r,n,t,o,i)),this._center=e,this._xaxis=r,this._yaxis=n,this._radius=t,this._minAngle=o,this._maxAngle=i},d.Arc.__name__=["verb","Arc"],d.Arc.byCenterAxesRadius=function(e,r,n,t,o,i){return new d.Arc(e,r,n,t,o,i)},d.Arc.__super__=d.NurbsCurve,d.Arc.prototype=r(d.NurbsCurve.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle}}),d.BoundingBox=e.BoundingBox=function(e){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=e&&this.addRange(e)},d.BoundingBox.__name__=["verb","BoundingBox"],d.BoundingBox.intervalsOverlap=function(e,r,n,t,o){null==o&&(o=-1);var i;i=0>o?d.BoundingBox.TOLERANCE:o;var c=Math.min(e,r)-i,s=Math.max(e,r)+i,a=Math.min(n,t)-i,u=Math.max(n,t)+i;return c>=a&&u>=c||s>=a&&u>=s||a>=c&&s>=a||u>=c&&s>=u},d.BoundingBox.prototype={fromPoint:function(e){return new d.BoundingBox([e])},add:function(e){if(!this.initialized)return this.dim=e.length,this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this;for(var r=0,n=this.dim;n>r;){var t=r++;e[t]>this.max[t]&&(this.max[t]=e[t]),e[t]<this.min[t]&&(this.min[t]=e[t])}return this},addRange:function(e){for(var r=e.length,n=0;r>n;){var t=n++;this.add(e[t])}return this},contains:function(e,r){return null==r&&(r=-1),this.initialized?this.intersects(new d.BoundingBox([e]),r):!1},intersects:function(e,r){if(null==r&&(r=-1),!this.initialized||!e.initialized)return!1;for(var n=this.min,t=this.max,o=e.min,i=e.max,c=0,s=this.dim;s>c;){var a=c++;if(!d.BoundingBox.intervalsOverlap(n[a],t[a],o[a],i[a],r))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var e=0,r=0,n=0,t=this.dim;t>n;){var o=n++,i=this.getAxisLength(o);i>e&&(e=i,r=o)}return r},getAxisLength:function(e){return 0>e||e>this.dim-1?0:Math.abs(this.min[e]-this.max[e])},intersect:function(e,r){if(!this.initialized)return null;var n=this.min,t=this.max,o=e.min,i=e.max;if(!this.intersects(e,r))return null;for(var c=[],s=[],a=0,u=this.dim;u>a;){var l=a++;c.push(Math.min(t[l],i[l])),s.push(Math.max(n[l],o[l]))}return new d.BoundingBox([s,c])}},d.Init=function(){},d.Init.__name__=["verb","Init"],d.Init.main=function(){console.log("verb 0.2.0")},d.core={},d.core.Analyze=e.core.Analyze=function(){},d.core.Analyze.__name__=["verb","core","Analyze"],d.core.Analyze.isRationalSurfaceClosed=function(e,r){null==r&&(r=!0);var n;n=r?e.controlPoints:d.core.Mat.transpose(e.controlPoints);for(var t=0,o=n[0].length;o>t;){var i=t++,c=d.core.Vec.dist(n[0][i],n[n.length-1][i])<d.core.Constants.EPSILON;if(!c)return!1}return!0},d.core.Analyze.rationalSurfaceClosestPoint=function(e,r){for(var n,t,o,i=5,c=0,s=1e-4,a=5e-4,u=e.knotsU[0],l=d.core.ArrayExtensions.last(e.knotsU),h=e.knotsV[0],v=d.core.ArrayExtensions.last(e.knotsV),f=d.core.Analyze.isRationalSurfaceClosed(e),p=d.core.Analyze.isRationalSurfaceClosed(e,!1),m=d.core.Tess.rationalSurfaceAdaptive(e,new d.core.types.AdaptiveRefinementOptions),_=Math.POSITIVE_INFINITY,g=0,y=m.points.length;y>g;){var V=g++,b=m.points[V],x=d.core.Vec.normSquared(d.core.Vec.sub(r,b));_>x&&(_=x,o=m.uvs[V])}for(var E=function(r){return d.core.Eval.rationalSurfaceDerivatives(e,2,r[0],r[1])},k=function(e,r,n){var t=r[1][0],o=r[0][1],i=r[2][0],c=r[0][2],s=r[1][1],a=r[1][1],u=d.core.Vec.dot(t,n),l=d.core.Vec.dot(o,n),h=[-u,-l],v=d.core.Vec.dot(t,t)+d.core.Vec.dot(i,n),f=d.core.Vec.dot(t,o)+d.core.Vec.dot(s,n),p=d.core.Vec.dot(t,o)+d.core.Vec.dot(a,n),m=d.core.Vec.dot(o,o)+d.core.Vec.dot(c,n),_=[[v,f],[p,m]],g=d.core.Mat.solve(_,h);return d.core.Vec.add(g,e)};i>c;){n=E(o),t=d.core.Vec.sub(n[0][0],r);var P=d.core.Vec.norm(t),S=d.core.Vec.dot(n[1][0],t),M=d.core.Vec.norm(n[1][0])*P,B=d.core.Vec.dot(n[0][1],t),I=d.core.Vec.norm(n[0][1])*P,A=S/M,C=B/I,N=s>P,w=a>A,L=a>C;if(N&&w&&L)return o;var z=k(o,n,t);u>z[0]?z=f?[l-(z[0]-u),z[1]]:[u+d.core.Constants.EPSILON,z[1]]:z[0]>l&&(z=f?[u+(z[0]-l),z[1]]:[l-d.core.Constants.EPSILON,z[1]]),h>z[1]?z=p?[z[0],v-(z[1]-h)]:[z[0],h+d.core.Constants.EPSILON]:z[1]>v&&(z=p?[z[0],h+(z[0]-v)]:[z[0],v-d.core.Constants.EPSILON]);var T=d.core.Vec.norm(d.core.Vec.mul(z[0]-o[0],n[1][0])),D=d.core.Vec.norm(d.core.Vec.mul(z[1]-o[1],n[0][1]));if(s>T+D)return o;o=z,c++}return o},d.core.Analyze.rationalCurveClosestPoint=function(e,r){return d.core.Eval.rationalCurvePoint(e,d.core.Analyze.rationalCurveClosestParam(e,r))},d.core.Analyze.rationalCurveClosestParam=function(e,r){for(var n=.001,t=Math.POSITIVE_INFINITY,o=0,i=d.core.Tess.rationalCurveAdaptiveSample(e,n,!0),c=0,s=i.length-1;s>c;){var a=c++,u=i[a][0],l=i[a+1][0],h=i[a].slice(1),v=i[a+1].slice(1),f=d.core.Trig.segmentClosestPoint(r,h,v,u,l),p=d.core.Vec.norm(d.core.Vec.sub(r,f.pt));t>p&&(t=p,o=f.u)}for(var m,_,g=5,y=0,V=1e-4,b=5e-4,x=e.knots[0],E=d.core.ArrayExtensions.last(e.knots),k=d.core.Vec.normSquared(d.core.Vec.sub(e.controlPoints[0],d.core.ArrayExtensions.last(e.controlPoints)))<d.core.Constants.EPSILON,P=o,S=function(r){return d.core.Eval.rationalCurveDerivatives(e,r,2)},M=function(e,r,n){var t=d.core.Vec.dot(r[1],n),o=d.core.Vec.dot(r[2],n),i=d.core.Vec.dot(r[1],r[1]),c=o+i;return e-t/c};g>y;){m=S(P),_=d.core.Vec.sub(m[0],r);var B=d.core.Vec.norm(_),I=d.core.Vec.dot(m[1],_),A=d.core.Vec.norm(m[1])*B,C=I/A,N=V>B,w=b>Math.abs(C);if(N&&w)return P;var L=M(P,m,_);x>L?L=k?E-(L-x):x:L>E&&(L=k?x+(L-E):E);var z=d.core.Vec.norm(d.core.Vec.mul(L-P,m[1]));if(V>z)return P;P=L,y++}return P},d.core.Analyze.rationalCurveParamAtArcLength=function(e,r,n,t,o){if(null==n&&(n=.001),d.core.Constants.EPSILON>r)return e.knots[0];var i;i=null!=t?t:d.core.Modify.decomposeCurveIntoBeziers(e);var c=0;i[c];var s,a=-d.core.Constants.EPSILON;for(s=null!=o?o:[];r>a&&i.length>c;){if(s[c]=s.length>c?s[c]:d.core.Analyze.rationalBezierCurveArcLength(e),a+=s[c],a+d.core.Constants.EPSILON>r)return d.core.Analyze.rationalBezierCurveParamAtArcLength(e,r,n,s[c]);c++}return-1},d.core.Analyze.rationalBezierCurveParamAtArcLength=function(e,r,n,t){if(0>r)return e.knots[0];var o;if(o=null!=t?t:d.core.Analyze.rationalBezierCurveArcLength(e),r>o)return d.core.ArrayExtensions.last(e.knots);var i,c=e.knots[0],s=0,a=d.core.ArrayExtensions.last(e.knots),u=o,l=0,h=0;for(i=null!=n?n:2*d.core.Constants.TOLERANCE;u-s>i;)l=(c+a)/2,h=d.core.Analyze.rationalBezierCurveArcLength(e,l),h>r?(a=l,u=h):(c=l,s=h);return(c+a)/2},d.core.Analyze.rationalCurveArcLength=function(e,r,n){null==n&&(n=16),r=null==r?d.core.ArrayExtensions.last(e.knots):r;for(var t=d.core.Modify.decomposeCurveIntoBeziers(e),o=0,i=t[0],c=0;t.length>o&&r>i.knots[0]+d.core.Constants.EPSILON;){var s=Math.min(d.core.ArrayExtensions.last(i.knots),r);c+=d.core.Analyze.rationalBezierCurveArcLength(i,s,n),i=t[++o]}return c},d.core.Analyze.rationalBezierCurveArcLength=function(e,r,n){null==n&&(n=16);var t;t=null==r?d.core.ArrayExtensions.last(e.knots):r;for(var o,i,c=(t-e.knots[0])/2,s=0,a=e.degree+n,u=0;a>u;){var l=u++;o=c*d.core.Analyze.Tvalues[a][l]+c+e.knots[0],i=d.core.Eval.rationalCurveDerivatives(e,o,1),s+=d.core.Analyze.Cvalues[a][l]*d.core.Vec.norm(i[1])}return c*s},d.core.ArrayExtensions=function(){},d.core.ArrayExtensions.__name__=["verb","core","ArrayExtensions"],d.core.ArrayExtensions.last=function(e){return e[e.length-1]},d.core.ArrayExtensions.first=function(e){return e[0]},d.core.ArrayExtensions.spliceAndInsert=function(e,r,n,t){e.splice(r,n),e.splice(r,0,t)},d.core.ArrayExtensions.left=function(e){if(0==e.length)return[];var r=Math.ceil(e.length/2);return e.slice(0,r)},d.core.ArrayExtensions.right=function(e){if(0==e.length)return[];var r=Math.ceil(e.length/2);return e.slice(r)},d.core.ArrayExtensions.rightWithPivot=function(e){if(0==e.length)return[];var r=Math.ceil(e.length/2);return e.slice(r-1)},d.core.ArrayExtensions.unique=function(e,r){if(0==e.length)return[];for(var n=[e.pop()];e.length>0;){for(var t=e.pop(),o=!0,i=0;n.length>i;){var c=n[i];if(++i,r(t,c)){o=!1;break}}o&&n.push(t)}return n},d.core.Binomial=function(){},d.core.Binomial.__name__=["verb","core","Binomial"],d.core.Binomial.get=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;if(r>e-r&&(r=e-r),d.core.Binomial.memo_exists(e,r))return d.core.Binomial.get_memo(e,r);for(var n=1,t=e,o=1,i=r+1;i>o;){var c=o++;d.core.Binomial.memo_exists(t,c)?(e--,n=d.core.Binomial.get_memo(t,c)):(n*=e--,n/=c,d.core.Binomial.memoize(t,c,n))}return n},d.core.Binomial.get_no_memo=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;r>e-r&&(r=e-r);for(var n=1,t=1,o=r+1;o>t;){var i=t++;n*=e--,n/=i}return n},d.core.Binomial.memo_exists=function(e,r){return d.core.Binomial.memo.exists(e)&&d.core.Binomial.memo.get(e).exists(r)},d.core.Binomial.get_memo=function(e,r){return d.core.Binomial.memo.get(e).get(r)},d.core.Binomial.memoize=function(e,r,n){d.core.Binomial.memo.exists(e)||d.core.Binomial.memo.set(e,new h.ds.IntMap),d.core.Binomial.memo.get(e).set(r,n)},d.core.Constants=e.core.Constants=function(){},d.core.Constants.__name__=["verb","core","Constants"],d.core.Divide=e.core.Divide=function(){},d.core.Divide.__name__=["verb","core","Divide"],d.core.Divide.rationalCurveByEqualArcLength=function(e,r){var n=d.core.Analyze.rationalCurveArcLength(e),t=n/r;return d.core.Divide.rationalCurveByArcLength(e,t)},d.core.Divide.rationalCurveByArcLength=function(e,r){var n=d.core.Modify.decomposeCurveIntoBeziers(e),t=n.map(function(e){return d.core.Analyze.rationalBezierCurveArcLength(e)}),o=d.core.Vec.sum(t),i=[new d.core.types.CurveLengthSample(e.knots[0],0)];if(r>o)return i;for(var c,s=r,a=0,u=s,l=0,h=0;n.length>a;){for(l+=t[a];l+d.core.Constants.EPSILON>u;)c=d.core.Analyze.rationalBezierCurveParamAtArcLength(n[a],u-h,d.core.Constants.TOLERANCE,t[a]),i.push(new d.core.types.CurveLengthSample(c,u)),u+=s;h+=t[a],a++}return i},d.core.Eval=e.core.Eval=function(){},d.core.Eval.__name__=["verb","core","Eval"],d.core.Eval.volumePoint=function(e,r,n,t){var o=e.knotsU.length-e.degreeU-2,i=e.knotsV.length-e.degreeV-2,c=e.knotsW.length-e.degreeW-2;return d.core.Eval.volumePointGivenNML(e,o,i,c,r,n,t)},d.core.Eval.volumePointGivenNML=function(e,r,n,t,o,i,c){if(!d.core.Eval.areValidRelations(e.degreeU,e.controlPoints.length,e.knotsU.length)||!d.core.Eval.areValidRelations(e.degreeV,e.controlPoints[0].length,e.knotsV.length)||!d.core.Eval.areValidRelations(e.degreeW,e.controlPoints[0][0].length,e.knotsW.length))throw"Invalid relations between control points and knot vector";for(var s=e.controlPoints,a=e.degreeU,u=e.degreeV,l=e.degreeW,h=e.knotsU,v=e.knotsV,f=e.knotsW,p=s[0][0][0].length,m=d.core.Eval.knotSpanGivenN(r,a,o,h),_=d.core.Eval.knotSpanGivenN(n,u,i,v),g=d.core.Eval.knotSpanGivenN(t,l,c,f),y=d.core.Eval.basisFunctionsGivenKnotSpanIndex(m,o,a,h),V=d.core.Eval.basisFunctionsGivenKnotSpanIndex(_,i,u,v),b=d.core.Eval.basisFunctionsGivenKnotSpanIndex(g,c,l,f),x=m-a,E=d.core.Vec.zeros1d(p),k=d.core.Vec.zeros1d(p),P=d.core.Vec.zeros1d(p),S=0,M=l+1;M>S;){var B=S++;P=d.core.Vec.zeros1d(p);for(var I=g-l+B,A=0,C=u+1;C>A;){var N=A++;k=d.core.Vec.zeros1d(p);for(var w=_-u+N,L=0,z=a+1;z>L;){var T=L++;k=d.core.Vec.add(k,d.core.Vec.mul(y[T],s[x+T][w][I]))}P=d.core.Vec.add(P,d.core.Vec.mul(V[N],k))}E=d.core.Vec.add(E,d.core.Vec.mul(b[B],P))}return E},d.core.Eval.rationalSurfaceDerivatives=function(e,r,n,t){for(var o=d.core.Eval.surfaceDerivatives(e,r,n,t),i=d.core.Eval.rational2d(o),c=d.core.Eval.weight2d(o),s=[],a=i[0][0].length,u=0,l=r+1;l>u;){var h=u++;s.push([]);for(var v=0,f=r-h+1;f>v;){for(var p=v++,m=i[h][p],_=1,g=p+1;g>_;){var y=_++;m=d.core.Vec.sub(m,d.core.Vec.mul(d.core.Binomial.get(p,y)*c[0][y],s[h][p-y]))}for(var V=1,b=h+1;b>V;){var x=V++;m=d.core.Vec.sub(m,d.core.Vec.mul(d.core.Binomial.get(h,x)*c[x][0],s[h-x][p]));for(var E=d.core.Vec.zeros1d(a),k=1,P=p+1;P>k;){var S=k++;E=d.core.Vec.add(E,d.core.Vec.mul(d.core.Binomial.get(p,S)*c[x][S],s[h-x][p-S]))}m=d.core.Vec.sub(m,d.core.Vec.mul(d.core.Binomial.get(h,x),E))}s[h].push(d.core.Vec.mul(1/c[0][0],m))}}return s},d.core.Eval.rationalSurfacePoint=function(e,r,n){return d.core.Eval.dehomogenize(d.core.Eval.surfacePoint(e,r,n))},d.core.Eval.rationalCurveDerivatives=function(e,r,n){for(var t=d.core.Eval.curveDerivatives(e,r,n),o=d.core.Eval.rational1d(t),i=d.core.Eval.weight1d(t),c=[],s=0,a=n+1;a>s;){for(var u=s++,l=o[u],h=1,v=u+1;v>h;){var f=h++;l=d.core.Vec.sub(l,d.core.Vec.mul(d.core.Binomial.get(u,f)*i[f],c[u-f]))}c.push(d.core.Vec.mul(1/i[0],l))}return c},d.core.Eval.rationalCurvePoint=function(e,r){return d.core.Eval.dehomogenize(d.core.Eval.curvePoint(e,r))},d.core.Eval.dehomogenize=function(e){for(var r=e.length,n=[],t=e[r-1],o=e.length-1,i=0;o>i;){var c=i++;n.push(e[c]/t)}return n},d.core.Eval.rational1d=function(e){var r=e[0].length-1;return e.map(function(e){return e.slice(0,r)})},d.core.Eval.rational2d=function(e){return e.map(d.core.Eval.rational1d)},d.core.Eval.weight1d=function(e){var r=e[0].length-1;return e.map(function(e){return e[r]})},d.core.Eval.weight2d=function(e){return e.map(d.core.Eval.weight1d)},d.core.Eval.dehomogenize1d=function(e){return e.map(d.core.Eval.dehomogenize)},d.core.Eval.dehomogenize2d=function(e){return e.map(d.core.Eval.dehomogenize1d)},d.core.Eval.homogenize1d=function(e,r){for(var n=e.length,t=e[0].length,o=[],i=0,c=[],s=0;n>s;){var a=s++,u=[];c=e[a],i=r[a];for(var l=0;t>l;){var h=l++;u.push(c[h]*i)}u.push(i),o.push(u)}return o},d.core.Eval.homogenize2d=function(e,r){for(var n=e.length,t=[],o=0;n>o;){var i=o++;t.push(d.core.Eval.homogenize1d(e[i],r[i]))}return t},d.core.Eval.surfaceDerivatives=function(e,r,n,t){var o=e.knotsU.length-e.degreeU-2,i=e.knotsV.length-e.degreeV-2;return d.core.Eval.surfaceDerivativesGivenNM(o,i,e,r,n,t)},d.core.Eval.surfaceDerivativesGivenNM=function(e,r,n,t,o,i){var c=n.degreeU,s=n.degreeV,a=n.controlPoints,u=n.knotsU,l=n.knotsV;
if(!d.core.Eval.areValidRelations(c,a.length,u.length)||!d.core.Eval.areValidRelations(s,a[0].length,l.length))throw"Invalid relations between control points, knot vector, and n";var h,v=a[0][0].length;h=c>t?t:c;var f;f=s>t?t:s;for(var p=d.core.Vec.zeros3d(h+1,f+1,v),m=d.core.Eval.knotSpanGivenN(e,c,o,u),_=d.core.Eval.knotSpanGivenN(r,s,i,l),g=d.core.Eval.derivativeBasisFunctionsGivenNI(m,o,c,e,u),y=d.core.Eval.derivativeBasisFunctionsGivenNI(_,i,s,r,l),V=d.core.Vec.zeros2d(s+1,v),b=0,x=0,E=h+1;E>x;){for(var k=x++,P=0,S=s+1;S>P;){var M=P++;V[M]=d.core.Vec.zeros1d(v);for(var B=0,I=c+1;I>B;){var A=B++;V[M]=d.core.Vec.add(V[M],d.core.Vec.mul(g[k][A],a[m-c+A][_-s+M]))}}var C=t-k;b=f>C?C:f;for(var N=0,w=b+1;w>N;){var L=N++;p[k][L]=d.core.Vec.zeros1d(v);for(var z=0,T=s+1;T>z;){var D=z++;p[k][L]=d.core.Vec.add(p[k][L],d.core.Vec.mul(y[L][D],V[D]))}}}return p},d.core.Eval.surfacePoint=function(e,r,n){var t=e.knotsU.length-e.degreeU-2,o=e.knotsV.length-e.degreeV-2;return d.core.Eval.surfacePointGivenNM(t,o,e,r,n)},d.core.Eval.surfacePointGivenNM=function(e,r,n,t,o){var i=n.degreeU,c=n.degreeV,s=n.controlPoints,a=n.knotsU,u=n.knotsV;if(!d.core.Eval.areValidRelations(i,s.length,a.length)||!d.core.Eval.areValidRelations(c,s[0].length,u.length))throw"Invalid relations between control points, knot vector, and n";for(var l=s[0][0].length,h=d.core.Eval.knotSpanGivenN(e,i,t,a),v=d.core.Eval.knotSpanGivenN(r,c,o,u),f=d.core.Eval.basisFunctionsGivenKnotSpanIndex(h,t,i,a),p=d.core.Eval.basisFunctionsGivenKnotSpanIndex(v,o,c,u),m=h-i,_=v,g=d.core.Vec.zeros1d(l),y=d.core.Vec.zeros1d(l),V=0,b=c+1;b>V;){var x=V++;y=d.core.Vec.zeros1d(l),_=v-c+x;for(var E=0,k=i+1;k>E;){var P=E++;y=d.core.Vec.add(y,d.core.Vec.mul(f[P],s[m+P][_]))}g=d.core.Vec.add(g,d.core.Vec.mul(p[x],y))}return g},d.core.Eval.curveDerivatives=function(e,r,n){var t=e.knots.length-e.degree-2;return d.core.Eval.curveDerivativesGivenN(t,e,r,n)},d.core.Eval.curveDerivativesGivenN=function(e,r,n,t){var o=r.degree,i=r.controlPoints,c=r.knots;if(!d.core.Eval.areValidRelations(o,i.length,c.length))throw"Invalid relations between control points, knot vector, and n";var s,a=i[0].length;s=o>t?t:o;for(var u=d.core.Vec.zeros2d(s+1,a),l=d.core.Eval.knotSpanGivenN(e,o,n,c),h=d.core.Eval.derivativeBasisFunctionsGivenNI(l,n,o,s,c),v=0,f=s+1;f>v;)for(var p=v++,m=0,_=o+1;_>m;){var g=m++;u[p]=d.core.Vec.add(u[p],d.core.Vec.mul(h[p][g],i[l-o+g]))}return u},d.core.Eval.curvePoint=function(e,r){var n=e.knots.length-e.degree-2;return d.core.Eval.curvePoint_given_n(n,e,r)},d.core.Eval.areValidRelations=function(e,r,n){return 0==r+e+1-n},d.core.Eval.curvePoint_given_n=function(e,r,n){var t=r.degree,o=r.controlPoints,i=r.knots;if(!d.core.Eval.areValidRelations(t,o.length,i.length))throw"Invalid relations between control points, knot Array, and n";for(var c=d.core.Eval.knotSpanGivenN(e,t,n,i),s=d.core.Eval.basisFunctionsGivenKnotSpanIndex(c,n,t,i),a=d.core.Vec.zeros1d(o[0].length),u=0,l=t+1;l>u;){var h=u++;a=d.core.Vec.add(a,d.core.Vec.mul(s[h],o[c-t+h]))}return a},d.core.Eval.deriv_basisFunctions=function(e,r,n){var t=d.core.Eval.knotSpan(r,e,n),o=n.length-1,i=o-r-1;return d.core.Eval.derivativeBasisFunctionsGivenNI(t,e,r,i,n)},d.core.Eval.derivativeBasisFunctionsGivenNI=function(e,r,n,t,o){var i=d.core.Vec.zeros2d(n+1,n+1),c=d.core.Vec.zeros1d(n+1),s=d.core.Vec.zeros1d(n+1),a=0,u=0;i[0][0]=1;for(var l=1,h=n+1;h>l;){var v=l++;c[v]=r-o[e+1-v],s[v]=o[e+v]-r,a=0;for(var f=0;v>f;){var p=f++;i[v][p]=s[p+1]+c[v-p],u=i[p][v-1]/i[v][p],i[p][v]=a+s[p+1]*u,a=c[v-p]*u}i[v][v]=a}for(var m=d.core.Vec.zeros2d(t+1,n+1),_=d.core.Vec.zeros2d(2,n+1),g=0,y=1,V=0,b=0,x=0,E=0,k=0,P=0,S=n+1;S>P;){var M=P++;m[0][M]=i[M][n]}for(var B=0,I=n+1;I>B;){var A=B++;g=0,y=1,_[0][0]=1;for(var C=1,N=t+1;N>C;){var w=C++;V=0,b=A-w,x=n-w,A>=w&&(_[y][0]=_[g][0]/i[x+1][b],V=_[y][0]*i[b][x]),E=b>=-1?1:-b,k=x>=A-1?w-1:n-A;for(var L=E,z=k+1;z>L;){var T=L++;_[y][T]=(_[g][T]-_[g][T-1])/i[x+1][b+T],V+=_[y][T]*i[b+T][x]}x>=A&&(_[y][w]=-_[g][w-1]/i[x+1][A],V+=_[y][w]*i[A][x]),m[w][A]=V;var D=g;g=y,y=D}}for(var R=n,O=1,U=t+1;U>O;){for(var F=O++,q=0,G=n+1;G>q;){var K=q++;m[F][K]*=R}R*=n-F}return m},d.core.Eval.basisFunctions=function(e,r,n){var t=d.core.Eval.knotSpan(r,e,n);return d.core.Eval.basisFunctionsGivenKnotSpanIndex(t,e,r,n)},d.core.Eval.basisFunctionsGivenKnotSpanIndex=function(e,r,n,t){var o=d.core.Vec.zeros1d(n+1),i=d.core.Vec.zeros1d(n+1),c=d.core.Vec.zeros1d(n+1),s=0,a=0;o[0]=1;for(var u=1,l=n+1;l>u;){var h=u++;i[h]=r-t[e+1-h],c[h]=t[e+h]-r,s=0;for(var v=0;h>v;){var f=v++;a=o[f]/(c[f+1]+i[h-f]),o[f]=s+c[f+1]*a,s=i[h-f]*a}o[h]=s}return o},d.core.Eval.knotSpan=function(e,r,n){var t=n.length-1,o=t-e-1;return d.core.Eval.knotSpanGivenN(o,e,r,n)},d.core.Eval.knotSpanGivenN=function(e,r,n,t){if(n>=t[e+1])return e;if(t[r]>n)return r;for(var o=r,i=e+1,c=Math.floor((o+i)/2);t[c]>n||n>=t[c+1];)t[c]>n?i=c:o=c,c=Math.floor((o+i)/2);return c},d.core.Intersect=e.core.Intersect=function(){},d.core.Intersect.__name__=["verb","core","Intersect"],d.core.Intersect.surfaces=function(e,r,n){var t=d.core.Tess.rationalSurfaceAdaptive(e),o=d.core.Tess.rationalSurfaceAdaptive(r),i=d.core.Intersect.meshes(t,o),c=i.map(function(t){return t.map(function(t){return d.core.Intersect.surfaces_at_point_with_estimate(e,r,t.uv0,t.uv1,n)})});return c.map(function(e){return d.core.Make.rationalInterpCurve(e.map(function(e){return e.point}),3)})},d.core.Intersect.surfaces_at_point_with_estimate=function(e,r,n,t,o){var i,c,s,a,u,l,h,v,f,p,m,_,g,y=10,V=0;do{if(i=d.core.Eval.rationalSurfaceDerivatives(e,1,n[0],n[1]),c=i[0][0],a=i[1][0],u=i[0][1],s=d.core.Vec.normalized(d.core.Vec.cross(a,u)),l=d.core.Vec.dot(s,c),h=d.core.Eval.rationalSurfaceDerivatives(e,1,t[0],t[1]),v=h[0][0],p=h[1][0],m=h[0][1],f=d.core.Vec.normalized(d.core.Vec.cross(p,m)),_=d.core.Vec.dot(f,v),g=d.core.Vec.norm(d.core.Vec.sub(c,v)),o>g)break;var b=d.core.Vec.normalized(d.core.Vec.cross(s,f)),x=d.core.Vec.dot(b,c),E=d.core.Intersect.threePlanes(s,l,f,_,b,x);if(null==E)throw"panic!";var k=d.core.Vec.sub(E,c),P=d.core.Vec.sub(E,v),S=d.core.Vec.cross(a,s),M=d.core.Vec.cross(u,s),B=d.core.Vec.cross(p,f),I=d.core.Vec.cross(m,f),A=d.core.Vec.dot(M,k)/d.core.Vec.dot(M,a),C=d.core.Vec.dot(S,k)/d.core.Vec.dot(S,u),N=d.core.Vec.dot(I,P)/d.core.Vec.dot(I,p),w=d.core.Vec.dot(B,P)/d.core.Vec.dot(B,m);n=d.core.Vec.add([A,C],n),t=d.core.Vec.add([N,w],t),V++}while(y>V);return new d.core.types.SurfaceSurfaceIntersectionPoint(n,t,c,g)},d.core.Intersect.meshes=function(e,r){var n=d.core.Intersect.bounding_box_trees(new d.core.types.LazyMeshBoundingBoxTree(e),new d.core.types.LazyMeshBoundingBoxTree(r),0),t=d.core.ArrayExtensions.unique(n.map(function(n){return d.core.Intersect.triangles(e,n.item0,r,n.item1)}).filter(function(e){return null!=e}).filter(function(e){return d.core.Vec.distSquared(e.min.point,e.max.point)>d.core.Constants.EPSILON}),function(e,r){var n=d.core.Vec.sub(e.min.uv0,r.min.uv0),t=d.core.Vec.dot(n,n),o=d.core.Vec.sub(e.max.uv0,r.max.uv0),i=d.core.Vec.dot(o,o),c=d.core.Vec.sub(e.min.uv0,r.max.uv0),s=d.core.Vec.dot(c,c),a=d.core.Vec.sub(e.max.uv0,r.min.uv0),u=d.core.Vec.dot(a,a);return d.core.Constants.EPSILON>t&&d.core.Constants.EPSILON>i||d.core.Constants.EPSILON>s&&d.core.Constants.EPSILON>u});return 0==t.length?[]:d.core.Intersect.makeMeshIntersectionPolylines(t)},d.core.Intersect.makeMeshIntersectionPolylines=function(e){for(var r=0;e.length>r;){var n=e[r];++r,n.max.opp=n.min,n.min.opp=n.max}for(var t=d.core.Intersect.kdTreeFromSegments(e),o=[],i=0;e.length>i;){var c=e[i];++i,o.push(c.min),o.push(c.max)}for(var s=0;o.length>s;){var a=o[s];if(++s,null==a.adj){var u=d.core.Intersect.lookupAdjacentSegment(a,t,e.length);null!=u&&null==u.adj&&(a.adj=u,u.adj=a)}}var l=o.filter(function(e){return null==e.adj});0==l.length&&(l=o);for(var h=[],v=0;l.length>v;){var f=l[v];if(++v,!f.visited){for(var p=[],m=f;null!=m;){if(m.visited)throw"Segment end encountered twice!";if(m.visited=!0,m.opp.visited=!0,p.push(m),m=m.opp.adj,m==f)break}p.length>0&&(p.push(p[p.length-1].opp),h.push(p))}}return h},d.core.Intersect.kdTreeFromSegments=function(e){for(var r=[],n=0;e.length>n;){var t=e[n];++n,r.push(new d.core.KdPoint(t.min.point,t.min)),r.push(new d.core.KdPoint(t.max.point,t.max))}return new d.core.KdTree(r,d.core.Vec.distSquared)},d.core.Intersect.lookupAdjacentSegment=function(e,r,n){var t;t=null!=n?3>n?3:n:3;var o=r.nearest(e.point,t,d.core.Constants.EPSILON).filter(function(r){return e!=r.item0.obj}).map(function(e){return e.item0.obj});return 1==o.length?o[0]:null},d.core.Intersect.curveAndSurface=function(e,r,n){null==n&&(n=.001);var t=d.core.Intersect.bounding_box_trees(new d.core.types.LazyCurveBoundingBoxTree(e),new d.core.types.LazySurfaceBoundingBoxTree(r),0);return t.map(function(e){var r=e.item0,t=e.item1,o=r.knots[0],i=d.core.ArrayExtensions.last(r.knots),c=(o+i)/2,s=t.knotsU[0],a=d.core.ArrayExtensions.last(t.knotsU),u=t.knotsV[0],l=d.core.ArrayExtensions.last(t.knotsV),h=[(s+a)/2,(u+l)/2];return d.core.Intersect.curveAndSurfaceWithEstimate(r,t,[c].concat(h),n)})},d.core.Intersect.curveAndSurfaceWithEstimate=function(e,r,n,t){null==t&&(t=.001);var o=function(n){var t=d.core.Eval.rationalCurvePoint(e,n[0]),o=d.core.Eval.rationalSurfacePoint(r,n[1],n[2]),i=d.core.Vec.sub(t,o);return d.core.Vec.dot(i,i)},i=d.core.Numeric.uncmin(o,n,t),c=i.solution;return new d.core.types.CurveSurfaceIntersection(c[0],[c[1],c[2]])},d.core.Intersect.polyline_and_mesh=function(e,r,n){for(var t=d.core.Intersect.bounding_box_trees(new d.core.types.LazyPolylineBoundingBoxTree(e),new d.core.types.LazyMeshBoundingBoxTree(r),n),o=[],i=0;t.length>i;){var c=t[i];++i;var s=c.item0,a=c.item1,u=d.core.Intersect.segmentWithTriangle(e.points[s],e.points[s+1],r.points,r.faces[a]);if(null!=u){var l=u.point,h=d.core.Vec.lerp(u.p,[e.params[s]],[e.params[s+1]])[0],v=d.core.Mesh.triangleUVFromPoint(r,a,l);o.push(new d.core.types.PolylineMeshIntersection(l,h,v,s,a))}}return o},d.core.Intersect.mesh_bounding_boxes=function(e,r,n){return d.core.Intersect.bounding_box_trees(new d.core.types.LazyMeshBoundingBoxTree(e),new d.core.types.LazyMeshBoundingBoxTree(r),n)},d.core.Intersect.bounding_box_trees=function(e,r,n){if(null==n&&(n=1e-9),e.empty()||r.empty())return[];if(!e.boundingBox().intersects(r.boundingBox(),n))return[];if(e.indivisible(n)&&r.indivisible(n))return[new d.core.types.Pair(e.yield(),r.yield())];var t=e.split(),o=r.split();return d.core.Intersect.bounding_box_trees(t.item0,o.item0,n).concat(d.core.Intersect.bounding_box_trees(t.item0,o.item1,n)).concat(d.core.Intersect.bounding_box_trees(t.item1,o.item0,n)).concat(d.core.Intersect.bounding_box_trees(t.item1,o.item1,n))},d.core.Intersect.curves=function(e,r,n){var t=d.core.Intersect.bounding_box_trees(new d.core.types.LazyCurveBoundingBoxTree(e),new d.core.types.LazyCurveBoundingBoxTree(r),0);return t.map(function(t){return d.core.Intersect.curves_with_estimate(e,r,t.item0.knots[0],t.item1.knots[0],n)})},d.core.Intersect.curves_with_estimate=function(e,r,n,t,o){var i=function(n){var t=d.core.Eval.rationalCurvePoint(e,n[0]),o=d.core.Eval.rationalCurvePoint(r,n[1]),i=d.core.Vec.sub(t,o);return d.core.Vec.dot(i,i)},c=d.core.Numeric.uncmin(i,[n,t],o),s=c.solution[0],a=c.solution[1],u=d.core.Eval.rationalCurvePoint(e,s),l=d.core.Eval.rationalCurvePoint(r,a);return new d.core.types.CurveCurveIntersection(u,l,s,a)},d.core.Intersect.triangles=function(e,r,n,t){var o=e.faces[r],i=n.faces[t],c=d.core.Mesh.getTriangleNorm(e.points,o),s=d.core.Mesh.getTriangleNorm(n.points,i),a=e.points[o[0]],u=n.points[i[0]],l=d.core.Intersect.planes(a,c,u,s);if(null==l)return null;var h=d.core.Intersect.clipRayInCoplanarTriangle(l,e,r);if(null==h)return null;var v=d.core.Intersect.clipRayInCoplanarTriangle(l,n,t);if(null==v)return null;var f=d.core.Intersect.mergeTriangleClipIntervals(h,v,e,r,n,t);return null==f?null:new d.core.types.Interval(new d.core.types.MeshIntersectionPoint(f.min.uv0,f.min.uv1,f.min.point,r,t),new d.core.types.MeshIntersectionPoint(f.max.uv0,f.max.uv1,f.max.point,r,t))},d.core.Intersect.clipRayInCoplanarTriangle=function(e,r,n){for(var t=r.faces[n],o=[r.points[t[0]],r.points[t[1]],r.points[t[2]]],i=[r.uvs[t[0]],r.uvs[t[1]],r.uvs[t[2]]],c=[d.core.Vec.sub(i[1],i[0]),d.core.Vec.sub(i[2],i[1]),d.core.Vec.sub(i[0],i[2])],s=[d.core.Vec.sub(o[1],o[0]),d.core.Vec.sub(o[2],o[1]),d.core.Vec.sub(o[0],o[2])],a=s.map(d.core.Vec.normalized),u=s.map(d.core.Vec.norm),l=null,h=null,v=0;3>v;){var f=v++,p=o[f],m=a[f],_=d.core.Intersect.rays(p,m,e.origin,e.dir);if(null!=_){var g=_.u0,y=_.u1;-d.core.Constants.EPSILON>g||g>u[f]+d.core.Constants.EPSILON||((null==l||l.u>y)&&(l=new d.core.types.CurveTriPoint(y,d.core.Vec.onRay(e.origin,e.dir,y),d.core.Vec.onRay(i[f],c[f],g/u[f]))),(null==h||y>h.u)&&(h=new d.core.types.CurveTriPoint(y,d.core.Vec.onRay(e.origin,e.dir,y),d.core.Vec.onRay(i[f],c[f],g/u[f]))))}}return null==h||null==l?null:new d.core.types.Interval(l,h)},d.core.Intersect.mergeTriangleClipIntervals=function(e,r,n,t,o,i){if(r.min.u>e.max.u+d.core.Constants.EPSILON||e.min.u>r.max.u+d.core.Constants.EPSILON)return null;var c;c=e.min.u>r.min.u?new d.core.types.Pair(e.min,0):new d.core.types.Pair(r.min,1);var s;s=e.max.u<r.max.u?new d.core.types.Pair(e.max,0):new d.core.types.Pair(r.max,1);var a=new d.core.types.Interval(new d.core.types.MeshIntersectionPoint(null,null,c.item0.point,t,i),new d.core.types.MeshIntersectionPoint(null,null,s.item0.point,t,i));return 0==c.item1?(a.min.uv0=c.item0.uv,a.min.uv1=d.core.Mesh.triangleUVFromPoint(o,i,c.item0.point)):(a.min.uv0=d.core.Mesh.triangleUVFromPoint(n,t,c.item0.point),a.min.uv1=c.item0.uv),0==s.item1?(a.max.uv0=s.item0.uv,a.max.uv1=d.core.Mesh.triangleUVFromPoint(o,i,s.item0.point)):(a.max.uv0=d.core.Mesh.triangleUVFromPoint(n,t,s.item0.point),a.max.uv1=s.item0.uv),a},d.core.Intersect.planes=function(e,r,n,t){var o=d.core.Vec.cross(r,t);if(d.core.Vec.dot(o,o)<d.core.Constants.EPSILON)return null;var i=0,c=Math.abs(o[0]),s=Math.abs(o[1]),a=Math.abs(o[2]);s>c&&(i=1,c=s),a>c&&(i=2,c=a);var u,l,h,v;0==i?(u=r[1],l=r[2],h=t[1],v=t[2]):1==i?(u=r[0],l=r[2],h=t[0],v=t[2]):(u=r[0],l=r[1],h=t[0],v=t[1]);var f,p=-d.core.Vec.dot(e,r),m=-d.core.Vec.dot(n,t),_=u*v-l*h,g=(l*m-p*v)/_,y=(p*h-u*m)/_;return f=0==i?[0,g,y]:1==i?[g,0,y]:[g,y,0],new d.core.types.Ray(f,d.core.Vec.normalized(o))},d.core.Intersect.threePlanes=function(e,r,n,t,o,i){var c=d.core.Vec.cross(n,o),s=d.core.Vec.dot(e,c);if(Math.abs(s)<d.core.Constants.EPSILON)return null;var a=d.core.Vec.sub(d.core.Vec.mul(i,n),d.core.Vec.mul(t,o)),u=d.core.Vec.add(d.core.Vec.mul(r,c),d.core.Vec.cross(e,a));return d.core.Vec.mul(1/s,u)},d.core.Intersect.polylines=function(e,r,n){for(var t=d.core.Intersect.bounding_box_trees(new d.core.types.LazyPolylineBoundingBoxTree(e),new d.core.types.LazyPolylineBoundingBoxTree(r),n),o=[],i=0;t.length>i;){var c=t[i];++i;var s=c.item0,a=c.item1,u=d.core.Intersect.segments(e.points[s],e.points[s+1],r.points[a],r.points[a+1],n);null!=u&&(u.u0=d.core.Vec.lerp(u.u0,[e.params[s]],[e.params[s+1]])[0],u.u1=d.core.Vec.lerp(u.u1,[r.params[a]],[r.params[a+1]])[0],o.push(u))}return o},d.core.Intersect.segments=function(e,r,n,t,o){var i=d.core.Vec.sub(r,e),c=Math.sqrt(d.core.Vec.dot(i,i)),s=d.core.Vec.mul(1/c,i),a=d.core.Vec.sub(t,n),u=Math.sqrt(d.core.Vec.dot(a,a)),l=d.core.Vec.mul(1/u,a),h=d.core.Intersect.rays(e,s,n,l);if(null!=h){var v=Math.min(Math.max(0,h.u0/c),1),f=Math.min(Math.max(0,h.u1/u),1),p=d.core.Vec.onRay(e,i,v),m=d.core.Vec.onRay(n,a,f),_=d.core.Vec.distSquared(p,m);if(o*o>_)return new d.core.types.CurveCurveIntersection(p,m,v,f)}return null},d.core.Intersect.rays=function(e,r,n,t){var o=d.core.Vec.dot(r,t),i=d.core.Vec.dot(r,n),c=d.core.Vec.dot(r,e),s=d.core.Vec.dot(t,n),a=d.core.Vec.dot(t,e),u=d.core.Vec.dot(r,r),l=d.core.Vec.dot(t,t),h=u*l-o*o;if(Math.abs(h)<d.core.Constants.EPSILON)return null;var v=o*(i-c)-u*(s-a),f=v/h,p=(i-c+f*o)/u,m=d.core.Vec.onRay(e,r,p),_=d.core.Vec.onRay(n,t,f);return new d.core.types.CurveCurveIntersection(m,_,p,f)},d.core.Intersect.segmentWithTriangle=function(e,r,n,t){var o=n[t[0]],i=n[t[1]],c=n[t[2]],s=d.core.Vec.sub(i,o),a=d.core.Vec.sub(c,o),u=d.core.Vec.cross(s,a),l=d.core.Vec.sub(r,e),h=d.core.Vec.sub(e,o),v=-d.core.Vec.dot(u,h),f=d.core.Vec.dot(u,l);if(Math.abs(f)<d.core.Constants.EPSILON)return null;var p=v/f;if(0>p||p>1)return null;var m=d.core.Vec.add(e,d.core.Vec.mul(p,l)),_=d.core.Vec.dot(s,a),g=d.core.Vec.dot(s,s),y=d.core.Vec.dot(a,a),V=d.core.Vec.sub(m,o),b=d.core.Vec.dot(V,s),x=d.core.Vec.dot(V,a),E=_*_-g*y;if(Math.abs(E)<d.core.Constants.EPSILON)return null;var k=(_*x-y*b)/E,P=(_*b-g*x)/E;return k>1+d.core.Constants.EPSILON||P>1+d.core.Constants.EPSILON||-d.core.Constants.EPSILON>P||-d.core.Constants.EPSILON>k||k+P>1+d.core.Constants.EPSILON?null:new d.core.types.TriSegmentIntersection(m,k,P,p)},d.core.Intersect.segment_with_plane=function(e,r,n,t){var o=d.core.Vec.dot(t,d.core.Vec.sub(e,r));if(Math.abs(o)<d.core.Constants.EPSILON)return null;var i=d.core.Vec.dot(t,d.core.Vec.sub(n,e));return{p:i/o}},d.core.KdPoint=e.core.KdPoint=function(e,r){this.point=e,this.obj=r},d.core.KdPoint.__name__=["verb","core","KdPoint"],d.core.KdNode=e.core.KdNode=function(e,r,n){this.kdPoint=e,this.left=null,this.right=null,this.parent=n,this.dimension=r},d.core.KdNode.__name__=["verb","core","KdNode"],d.core.KdTree=e.core.KdTree=function(e,r){this.dim=3,this.points=e,this.distanceFunction=r,this.dim=e[0].point.length,this.root=this.buildTree(e,0,null)},d.core.KdTree.__name__=["verb","core","KdTree"],d.core.KdTree.prototype={buildTree:function(e,r,n){var t,o,i=r%this.dim;return 0==e.length?null:1==e.length?new d.core.KdNode(e[0],i,n):(e.sort(function(e,r){var n=e.point[i]-r.point[i];return 0==n?0:n>0?1:-1}),t=Math.floor(e.length/2),o=new d.core.KdNode(e[t],i,n),o.left=this.buildTree(e.slice(0,t),r+1,o),o.right=this.buildTree(e.slice(t+1),r+1,o),o)},nearest:function(e,r,n){var t,o=this,i=new d.core.BinaryHeap(function(e){return-e.item1}),c=null;if(c=function(n){for(var t,s,a=n.dimension,u=o.distanceFunction(e,n.kdPoint.point),l=[],h=0,v=o.dim;v>h;)h++,l.push(0);s=l;for(var f,p,m=function(e,n){i.push(new d.core.types.Pair(e,n)),i.size()>r&&i.pop()},_=0,g=o.dim;g>_;){var y=_++;s[y]=y==n.dimension?e[y]:n.kdPoint.point[y]}return f=o.distanceFunction(s,n.kdPoint.point),null==n.right&&null==n.left?((r>i.size()||i.peek().item1>u)&&m(n,u),void 0):(t=null==n.right?n.left:null==n.left?n.right:e[a]<n.kdPoint.point[a]?n.left:n.right,c(t),(r>i.size()||i.peek().item1>u)&&m(n,u),(r>i.size()||Math.abs(f)<i.peek().item1)&&(p=t==n.left?n.right:n.left,null!=p&&c(p)),void 0)},t=c,null!=n)for(var s=0;r>s;)s++,i.push(new d.core.types.Pair(null,n));t(this.root);for(var a=[],u=0;r>u;){var l=u++;null!=i.content[l].item0&&a.push(new d.core.types.Pair(i.content[l].item0.kdPoint,i.content[l].item1))}return a}},d.core.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},d.core.BinaryHeap.__name__=["verb","core","BinaryHeap"],d.core.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],r=this.content.pop();return this.content.length>0&&(this.content[0]=r,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var r=this.content.length,n=0;r>n;){var t=n++;if(this.content[t]==e){var o=this.content.pop();return t!=r-1&&(this.content[t]=o,this.scoreFunction(o)<this.scoreFunction(e)?this.bubbleUp(t):this.sinkDown(t)),void 0}}throw"Node not found."},size:function(){return this.content.length},bubbleUp:function(e){for(var r=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,t=this.content[n];if(!(this.scoreFunction(r)<this.scoreFunction(t)))break;this.content[n]=r,this.content[e]=t,e=n}},sinkDown:function(e){for(var r=this.content.length,n=this.content[e],t=this.scoreFunction(n);;){var o=2*(e+1),i=o-1,c=null,s=0;if(r>i){var a=this.content[i];s=this.scoreFunction(a),t>s&&(c=i)}if(r>o){var u=this.content[o],l=this.scoreFunction(u);(null==c?t:s)>l&&(c=o)}if(null==c)break;this.content[e]=this.content[c],this.content[c]=n,e=c}}},d.core.Make=e.core.Make=function(){},d.core.Make.__name__=["verb","core","Make"],d.core.Make.fourPointSurface=function(e,r,n,t,o){null==o&&(o=3);for(var i=o,c=[],s=0,a=o+1;a>s;){for(var u=s++,l=[],h=0,v=o+1;v>h;){var f=h++,p=1-u/i,m=d.core.Vec.lerp(p,e,r),_=d.core.Vec.lerp(p,t,n),g=d.core.Vec.lerp(1-f/i,m,_);g.push(1),l.push(g)}c.push(l)}var y=d.core.Vec.rep(o+1,0),V=d.core.Vec.rep(o+1,1);return new d.core.types.SurfaceData(o,o,y.concat(V),y.concat(V),c)},d.core.Make.sweep1_surface=function(e,r){for(var n=d.core.Eval.rationalCurvePoint(r,0),t=1/r.controlPoints.length,o=[],i=[],c=d.core.Eval.weight1d(r.controlPoints),s=d.core.Eval.weight1d(e.controlPoints),a=d.core.Eval.dehomogenize1d(e.controlPoints),u=0,l=r.controlPoints.length;l>u;){for(var h=u++,v=d.core.Eval.rationalCurvePoint(r,h*t),f=d.core.Vec.sub(v,n),p=[],m=[],_=0,g=e.controlPoints.length;g>_;){var y=_++;p.push(d.core.Vec.add(f,a[y])),m.push(s[y]*c[h])}o.push(p),i.push(m)}return new d.core.types.SurfaceData(r.degree,e.degree,r.knots,e.knots,d.core.Eval.homogenize2d(o,i))},d.core.Make.ellipseArc=function(e,r,n,t,o,i,c){i>c&&(c=2*Math.PI+i);var s=c-i,a=0;a=Math.PI/2>=s?1:Math.PI>=s?2:3*Math.PI/2>=s?3:4;var u=s/a,l=Math.cos(u/2),h=d.core.Vec.add(e,d.core.Vec.add(d.core.Vec.mul(t*Math.cos(i),r),d.core.Vec.mul(o*Math.sin(i),n))),v=d.core.Vec.sub(d.core.Vec.mul(Math.cos(i),n),d.core.Vec.mul(Math.sin(i),r)),f=[],p=d.core.Vec.zeros1d(2*a+3),m=0,_=i,g=d.core.Vec.zeros1d(2*a);f[0]=h,g[0]=1;for(var y=1,V=a+1;V>y;){var b=y++;_+=u;var x=d.core.Vec.add(e,d.core.Vec.add(d.core.Vec.mul(t*Math.cos(_),r),d.core.Vec.mul(o*Math.sin(_),n)));g[m+2]=1,f[m+2]=x;var E=d.core.Vec.sub(d.core.Vec.mul(Math.cos(_),n),d.core.Vec.mul(Math.sin(_),r)),k=d.core.Intersect.rays(h,d.core.Vec.mul(1/d.core.Vec.norm(v),v),x,d.core.Vec.mul(1/d.core.Vec.norm(E),E)),P=d.core.Vec.add(h,d.core.Vec.mul(k.u0,v));g[m+1]=l,f[m+1]=P,m+=2,a>b&&(h=x,v=E)}for(var S=2*a+1,M=0;3>M;){var B=M++;p[B]=0,p[B+S]=1}switch(a){case 2:p[3]=p[4]=.5;break;case 3:p[3]=p[4]=.3333333333333333,p[5]=p[6]=.6666666666666666;break;case 4:p[3]=p[4]=.25,p[5]=p[6]=.5,p[7]=p[8]=.75}return new d.core.types.CurveData(2,p,d.core.Eval.homogenize1d(f,g))},d.core.Make.arc=function(e,r,n,t,o,i){return d.core.Make.ellipseArc(e,r,n,t,t,o,i)},d.core.Make.polylineCurve=function(e){for(var r=[0,0],n=0,t=0,o=e.length-1;o>t;){var i=t++;n+=d.core.Vec.dist(e[i],e[i+1]),r.push(n)}r.push(n),r=d.core.Vec.mul(1/n,r);for(var c,s=[],a=0,u=e.length;u>a;)a++,s.push(1);return c=s,new d.core.types.CurveData(1,r,d.core.Eval.homogenize1d(e.slice(0),c))},d.core.Make.extrudedSurface=function(e,r,n){for(var t=[[],[],[]],o=[[],[],[]],i=d.core.Eval.dehomogenize1d(n.controlPoints),c=d.core.Eval.weight1d(n.controlPoints),s=d.core.Vec.mul(r,e),a=d.core.Vec.mul(.5*r,e),u=0,l=i.length;l>u;){var h=u++;t[2][h]=i[h],t[1][h]=d.core.Vec.add(a,i[h]),t[0][h]=d.core.Vec.add(s,i[h]),o[0][h]=c[h],o[1][h]=c[h],o[2][h]=c[h]}return new d.core.types.SurfaceData(2,n.degree,[0,0,0,1,1,1],n.knots,d.core.Eval.homogenize2d(t,o))},d.core.Make.cylinderSurface=function(e,r,n,t,o){var i=d.core.Vec.cross(e,r);2*Math.PI;var c=d.core.Make.arc(n,r,i,o,0,2*Math.PI);return d.core.Make.extrudedSurface(e,t,c)},d.core.Make.revolvedSurface=function(e,r,n,t){var o,i,c=d.core.Eval.dehomogenize1d(t.controlPoints),s=d.core.Eval.weight1d(t.controlPoints);Math.PI/2>=n?(o=1,i=d.core.Vec.zeros1d(6+2*(o-1))):Math.PI>=n?(o=2,i=d.core.Vec.zeros1d(6+2*(o-1)),i[3]=i[4]=.5):3*Math.PI/2>=n?(o=3,i=d.core.Vec.zeros1d(6+2*(o-1)),i[3]=i[4]=.3333333333333333,i[5]=i[6]=.6666666666666666):(o=4,i=d.core.Vec.zeros1d(6+2*(o-1)),i[3]=i[4]=.25,i[5]=i[6]=.5,i[7]=i[8]=.75);for(var a=n/o,u=3+2*(o-1),l=0;3>l;){var h=l++;i[h]=0,i[u+h]=1}for(var v=Math.cos(a/2),f=0,p=d.core.Vec.zeros1d(o+1),m=d.core.Vec.zeros1d(o+1),_=d.core.Vec.zeros3d(2*o+1,c.length,3),g=d.core.Vec.zeros2d(2*o+1,c.length),y=1,V=o+1;V>y;){var b=y++;f+=a,m[b]=Math.cos(f),p[b]=Math.sin(f)}for(var x=0,E=c.length;E>x;){var k=x++,P=d.core.Trig.rayClosestPoint(c[k],e,r),S=d.core.Vec.sub(c[k],P),M=d.core.Vec.norm(S),B=d.core.Vec.cross(r,S);M>d.core.Constants.EPSILON&&(S=d.core.Vec.mul(1/M,S),B=d.core.Vec.mul(1/M,B)),_[0][k]=c[k];var I=c[k];g[0][k]=s[k];for(var A=B,C=0,N=1,w=o+1;w>N;){var L,z=N++;L=0==M?P:d.core.Vec.add(P,d.core.Vec.add(d.core.Vec.mul(M*m[z],S),d.core.Vec.mul(M*p[z],B))),_[C+2][k]=L,g[C+2][k]=s[k];var T=d.core.Vec.sub(d.core.Vec.mul(m[z],B),d.core.Vec.mul(p[z],S));if(0==M)_[C+1][k]=P;else{var D=d.core.Intersect.rays(I,d.core.Vec.mul(1/d.core.Vec.norm(A),A),L,d.core.Vec.mul(1/d.core.Vec.norm(T),T)),R=d.core.Vec.add(I,d.core.Vec.mul(D.u0,A));_[C+1][k]=R}g[C+1][k]=v*s[k],C+=2,o>z&&(I=L,A=T)}}return new d.core.types.SurfaceData(2,t.degree,i,t.knots,d.core.Eval.homogenize2d(_,g))},d.core.Make.sphereSurface=function(e,r,n,t){var o=d.core.Make.arc(e,d.core.Vec.mul(-1,r),n,t,0,Math.PI);return d.core.Make.revolvedSurface(e,r,2*Math.PI,o)},d.core.Make.coneSurface=function(e,r,n,t,o){var i=2*Math.PI,c=1,s=[d.core.Vec.add(n,d.core.Vec.mul(t,e)),d.core.Vec.add(n,d.core.Vec.mul(o,r))],a=[0,0,1,1],u=[1,1],l=new d.core.types.CurveData(c,a,d.core.Eval.homogenize1d(s,u));return d.core.Make.revolvedSurface(n,e,i,l)},d.core.Make.rationalInterpCurve=function(e,r,n,t){if(null==r&&(r=3),r+1>e.length)throw"You need to supply at least degree + 1 points!";for(var o=[0],i=1,c=e.length;c>i;){var s=i++,a=d.core.Vec.norm(d.core.Vec.sub(e[s],e[s-1])),u=o[o.length-1];o.push(u+a)}for(var l=o[o.length-1],h=0,v=o.length;v>h;){var f=h++;o[f]=o[f]/l}var p,m=d.core.Vec.rep(r+1,0),_=null!=n&&null!=t;p=_?0:1;var g;g=_?o.length-r+1:o.length-r;for(var y=p;g>y;){for(var V=y++,b=0,x=0;r>x;){var E=x++;b+=o[V+E]}m.push(1/r*b)}var k,P=m.concat(d.core.Vec.rep(r+1,1)),S=[];k=_?e.length+1:e.length-1;var M;M=_?1:0;var B;B=_?e.length-(r-1):e.length-(r+1);for(var I=0;o.length>I;){var A=o[I];++I;var C=d.core.Eval.knotSpanGivenN(k,r,A,P),N=d.core.Eval.basisFunctionsGivenKnotSpanIndex(C,A,r,P),w=C-r,L=d.core.Vec.zeros1d(w),z=d.core.Vec.zeros1d(B-w);S.push(L.concat(N).concat(z))}if(_){var T=S[0].length-2,D=[-1,1].concat(d.core.Vec.zeros1d(T)),R=d.core.Vec.zeros1d(T).concat([-1,1]);d.core.ArrayExtensions.spliceAndInsert(S,1,0,D),d.core.ArrayExtensions.spliceAndInsert(S,S.length-1,0,R)}for(var O=e[0].length,U=[],F=(1-P[P.length-r-2])/r,q=P[r+1]/r,G=0;O>G;){var K,j=[G++];if(_){K=[e[0][j[0]]],K.push(q*n[j[0]]);for(var W=1,H=e.length-1;H>W;){var Y=W++;K.push(e[Y][j[0]])}K.push(F*t[j[0]]),K.push(e[e.length-1][j[0]])}else K=e.map(function(e){return function(r){return r[e[0]]}}(j));var Q=d.core.Mat.solve(S,K);U.push(Q)}var Z=d.core.Mat.transpose(U),J=d.core.Vec.rep(Z.length,1);return new d.core.types.CurveData(r,P,d.core.Eval.homogenize1d(Z,J))},d.core.LUDecomp=function(e,r){this.LU=e,this.P=r},d.core.LUDecomp.__name__=["verb","core","LUDecomp"],d.core.Mat=e.core.Mat=function(){},d.core.Mat.__name__=["verb","core","Mat"],d.core.Mat.mul=function(e,r){for(var n=[],t=0,o=r.length;o>t;){var i=t++;n.push(d.core.Vec.mul(e,r[i]))}return n},d.core.Mat.add=function(e,r){for(var n=[],t=0,o=e.length;o>t;){var i=t++;n.push(d.core.Vec.add(e[i],r[i]))}return n},d.core.Mat.div=function(e,r){for(var n=[],t=0,o=e.length;o>t;){var i=t++;n.push(d.core.Vec.div(e[i],r))}return n},d.core.Mat.sub=function(e,r){for(var n=[],t=0,o=e.length;o>t;){var i=t++;n.push(d.core.Vec.sub(e[i],r[i]))}return n},d.core.Mat.dot=function(e,r){for(var n=[],t=0,o=e.length;o>t;){var i=t++;n.push(d.core.Vec.dot(e[i],r))}return n},d.core.Mat.identity=function(e){for(var r=d.core.Vec.zeros2d(e,e),n=0;e>n;){var t=n++;r[t][t]=1}return r},d.core.Mat.transpose=function(e){if(0==e.length)return[];for(var r=[],n=0,t=e[0].length;t>n;){var o=n++;r.push(function(){for(var r,n=[],t=0,i=e.length;i>t;){var c=t++;n.push(e[c][o])}return r=n}(this))}return r},d.core.Mat.solve=function(e,r){return d.core.Mat.LUsolve(d.core.Mat.LU(e),r)},d.core.Mat.LUsolve=function(e,r){var n,t,o,i,c,s=e.LU,a=s.length,u=r.slice(),l=e.P;for(n=a-1;-1!=n;)u[n]=r[n],--n;for(n=0;a>n;){for(o=l[n],l[n]!=n&&(c=u[n],u[n]=u[o],u[o]=c),i=s[n],t=0;n>t;)u[n]-=u[t]*i[t],++t;++n}for(n=a-1;n>=0;){for(i=s[n],t=n+1;a>t;)u[n]-=u[t]*i[t],++t;u[n]/=i[n],--n}return u},d.core.Mat.LU=function(e){Math.abs;for(var r,n,t,o,i,c,s,a,u,l=[],h=0,v=e.length;v>h;){var f=h++;l.push(e[f].slice())}e=l;var p=e.length,m=p-1,_=[];for(t=0;p>t;){for(s=t,c=e[t],u=Math.abs(c[t]),n=t+1;p>n;)o=Math.abs(e[n][t]),o>u&&(u=o,s=n),++n;for(_[t]=s,s!=t&&(e[t]=e[s],e[s]=c,c=e[t]),i=c[t],r=t+1;p>r;)e[r][t]/=i,++r;for(r=t+1;p>r;){for(a=e[r],n=t+1;m>n;)a[n]-=a[t]*c[n],++n,a[n]-=a[t]*c[n],++n;n==m&&(a[n]-=a[t]*c[n]),++r}++t}return new d.core.LUDecomp(e,_)},d.core.Mesh=e.core.Mesh=function(){},d.core.Mesh.__name__=["verb","core","Mesh"],d.core.Mesh.getTriangleNorm=function(e,r){var n=e[r[0]],t=e[r[1]],o=e[r[2]],i=d.core.Vec.sub(t,n),c=d.core.Vec.sub(o,n),s=d.core.Vec.cross(i,c);return d.core.Vec.mul(1/d.core.Vec.norm(s),s)},d.core.Mesh.makeMeshAabb=function(e,r){for(var n=new d.BoundingBox,t=0;r.length>t;){var o=r[t];++t,n.add(e.points[e.faces[o][0]]),n.add(e.points[e.faces[o][1]]),n.add(e.points[e.faces[o][2]])}return n},d.core.Mesh.makeMeshAabbTree=function(e,r){var n=d.core.Mesh.makeMeshAabb(e,r);if(1==r.length)return new d.core.types.BoundingBoxLeaf(n,r[0]);var t=d.core.Mesh.sortTrianglesOnLongestAxis(n,e,r),o=d.core.ArrayExtensions.left(t),i=d.core.ArrayExtensions.right(t);return new d.core.types.BoundingBoxInnerNode(n,[d.core.Mesh.makeMeshAabbTree(e,o),d.core.Mesh.makeMeshAabbTree(e,i)])},d.core.Mesh.sortTrianglesOnLongestAxis=function(e,r,n){for(var t=e.getLongestAxis(),o=[],i=0;n.length>i;){var c=n[i];++i;var s=d.core.Mesh.getMinCoordOnAxis(r.points,r.faces[c],t);o.push(new d.core.types.Pair(s,c))}o.sort(function(e,r){var n=e.item0,t=r.item0;return n==t?0:n>t?1:-1});for(var a=[],u=0,l=o.length;l>u;){var h=u++;a.push(o[h].item1)}return a},d.core.Mesh.getMinCoordOnAxis=function(e,r,n){for(var t=Math.POSITIVE_INFINITY,o=0;3>o;){var i=o++,c=e[r[i]][n];t>c&&(t=c)}return t},d.core.Mesh.getTriangleCentroid=function(e,r){for(var n=[0,0,0],t=0;3>t;)for(var o=t++,i=0;3>i;){var c=i++;n[c]+=e[r[o]][c]}for(var s=0;3>s;){var a=s++;n[a]/=3}return n},d.core.Mesh.triangleUVFromPoint=function(e,r,n){var t=e.faces[r],o=e.points[t[0]],i=e.points[t[1]],c=e.points[t[2]],s=e.uvs[t[0]],a=e.uvs[t[1]],u=e.uvs[t[2]],l=d.core.Vec.sub(o,n),h=d.core.Vec.sub(i,n),v=d.core.Vec.sub(c,n),f=d.core.Vec.norm(d.core.Vec.cross(d.core.Vec.sub(o,i),d.core.Vec.sub(o,c))),p=d.core.Vec.norm(d.core.Vec.cross(h,v))/f,m=d.core.Vec.norm(d.core.Vec.cross(v,l))/f,_=d.core.Vec.norm(d.core.Vec.cross(l,h))/f;return d.core.Vec.add(d.core.Vec.mul(p,s),d.core.Vec.add(d.core.Vec.mul(m,a),d.core.Vec.mul(_,u)))},d.core.KnotMultiplicity=e.core.KnotMultiplicity=function(e,r){this.knot=e,this.mult=r},d.core.KnotMultiplicity.__name__=["verb","core","KnotMultiplicity"],d.core.KnotMultiplicity.prototype={inc:function(){this.mult++}},d.core.Modify=e.core.Modify=function(){},d.core.Modify.__name__=["verb","core","Modify"],d.core.Modify.surfaceKnotRefine=function(e,r,n){var t,o,i,c=[];n?(i=e.controlPoints,t=e.knotsV,o=e.degreeV):(i=d.core.Mat.transpose(e.controlPoints),t=e.knotsU,o=e.degreeU);for(var s=null,a=0;i.length>a;){var u=i[a];++a,s=d.core.Modify.curveKnotRefine(new d.core.types.CurveData(o,t,u),r),c.push(s.controlPoints)}var l=s.knots;return n?new d.core.types.SurfaceData(e.degreeU,e.degreeV,e.knotsU.slice(),l,c):(c=d.core.Mat.transpose(c),new d.core.types.SurfaceData(e.degreeU,e.degreeV,l,e.knotsV.slice(),c))},d.core.Modify.surfaceSplit=function(e,r,n){null==n&&(n=!1);var t,o,i;n?(i=e.controlPoints,t=e.knotsV,o=e.degreeV):(i=d.core.Mat.transpose(e.controlPoints),t=e.knotsU,o=e.degreeU);for(var c,s=[],a=0,u=o+1;u>a;)a++,s.push(r);c=s;for(var l=[],h=[],v=d.core.Eval.knotSpan(o,r,t),f=null,p=0;i.length>p;){var m=i[p];++p,f=d.core.Modify.curveKnotRefine(new d.core.types.CurveData(o,t,m),c),l.push(f.controlPoints.slice(0,v+1)),h.push(f.controlPoints.slice(v+1))}var _=f.knots.slice(0,v+o+2),g=f.knots.slice(v+1);return n?[new d.core.types.SurfaceData(e.degreeU,o,e.knotsU.slice(),_,l),new d.core.types.SurfaceData(e.degreeU,o,e.knotsU.slice(),g,h)]:(l=d.core.Mat.transpose(l),h=d.core.Mat.transpose(h),[new d.core.types.SurfaceData(o,e.degreeV,_,e.knotsV.slice(),l),new d.core.types.SurfaceData(o,e.degreeV,g,e.knotsV.slice(),h)])
},d.core.Modify.decomposeCurveIntoBeziers=function(e){for(var r=e.degree,n=e.controlPoints,t=e.knots,o=d.core.Modify.knotMultiplicities(t),i=r+1,c=0;o.length>c;){var s=o[c];if(++c,i>s.mult){var a=d.core.Vec.rep(i-s.mult,s.knot),u=d.core.Modify.curveKnotRefine(new d.core.types.CurveData(r,t,n),a);t=u.knots,n=u.controlPoints}}t.length/i-1;for(var l=2*i,h=[],v=0;n.length>v;){var f=t.slice(v,v+l),p=n.slice(v,v+i);h.push(new d.core.types.CurveData(r,f,p)),v+=i}return h},d.core.Modify.knotMultiplicities=function(e){for(var r=[new d.core.KnotMultiplicity(e[0],0)],n=r[0],t=0;e.length>t;){var o=e[t];++t,Math.abs(o-n.knot)>d.core.Constants.EPSILON&&(n=new d.core.KnotMultiplicity(o,0),r.push(n)),n.inc()}return r},d.core.Modify.curveSplit=function(e,r){var n=e.degree;e.controlPoints;for(var t,o=e.knots,i=[],c=0,s=n+1;s>c;)c++,i.push(r);t=i;var a=d.core.Modify.curveKnotRefine(e,t),u=d.core.Eval.knotSpan(n,r,o),l=a.knots.slice(0,u+n+2),h=a.knots.slice(u+1),v=a.controlPoints.slice(0,u+1),f=a.controlPoints.slice(u+1);return[new d.core.types.CurveData(n,l,v),new d.core.types.CurveData(n,h,f)]},d.core.Modify.curveKnotRefine=function(e,r){for(var n=e.degree,t=e.controlPoints,o=e.knots,i=t.length-1,c=i+n+1,s=r.length-1,a=d.core.Eval.knotSpan(n,r[0],o),u=d.core.Eval.knotSpan(n,r[s],o),l=[],h=[],v=0,f=a-n+1;f>v;){var p=v++;l[p]=t[p]}for(var m=u-1,_=i+1;_>m;){var g=m++;l[g+s+1]=t[g]}for(var y=0,V=a+1;V>y;){var b=y++;h[b]=o[b]}for(var x=u+n,E=c+1;E>x;){var k=x++;h[k+s+1]=o[k]}for(var P=u+n-1,S=u+n+s,M=s;M>=0;){for(;r[M]<=o[P]&&P>a;)l[S-n-1]=t[P-n-1],h[S]=o[P],S-=1,P-=1;l[S-n-1]=l[S-n];for(var B=1,I=n+1;I>B;){var A=B++,C=S-n+A,N=h[S+A]-r[M];Math.abs(N)<d.core.Constants.EPSILON?l[C-1]=l[C]:(N/=h[S+A]-o[P-n+A],l[C-1]=d.core.Vec.add(d.core.Vec.mul(N,l[C-1]),d.core.Vec.mul(1-N,l[C])))}h[S]=r[M],S-=1,M--}return new d.core.types.CurveData(n,h,l)},d.core.Modify.curveKnotInsert=function(e,r,n){for(var t=e.degree,o=e.controlPoints,i=e.knots,c=0,s=o.length,a=d.core.Eval.knotSpan(t,r,i),u=[],l=[],h=[],v=1,f=a+1;f>v;){var p=v++;l[p]=i[p]}for(var m=1,_=n+1;_>m;){var g=m++;l[a+g]=r}for(var y=a+1,V=i.length;V>y;){var b=y++;l[b+n]=i[b]}for(var x=0,E=a-t+1;E>x;){var k=x++;h[k]=o[k]}for(var P=a-c;s>P;){var S=P++;h[S+n]=o[S]}for(var M=0,B=t-c+1;B>M;){var I=M++;u[I]=o[a-t+I]}for(var A=0,C=0,N=1,w=n+1;w>N;){var L=N++;A=a-t+L;for(var z=0,T=t-L-c+1;T>z;){var D=z++;C=(r-i[A+D])/(i[D+a+1]-i[A+D]),u[D]=d.core.Vec.add(d.core.Vec.mul(C,u[D+1]),d.core.Vec.mul(1-C,u[D]))}h[A]=u[0],h[a+n-L-c]=u[t-L-c]}for(var R=A+1,O=a-c;O>R;){var U=R++;h[U]=u[U-A]}return new d.core.types.CurveData(t,l,h)},d.core.MinimizationResult=function(e,r,n,t,o,i){this.solution=e,this.value=r,this.gradient=n,this.invHessian=t,this.iterations=o,this.message=i},d.core.MinimizationResult.__name__=["verb","core","MinimizationResult"],d.core.Numeric=function(){},d.core.Numeric.__name__=["verb","core","Numeric"],d.core.Numeric.numericalGradient=function(e,r){var n=r.length,t=e(r);if(t==Math.NaN)throw"gradient: f(x) is a NaN!";for(var o,i,c,s,a,u,l,h,v,f=r.slice(0),p=[],m=.001,_=0,g=0;n>g;)for(var y=g++,V=Math.max(1e-6*t,1e-8);;){if(++_,_>20)throw"Numerical gradient fails";if(f[y]=r[y]+V,o=e(f),f[y]=r[y]-V,i=e(f),f[y]=r[y],Math.isNaN(o)||Math.isNaN(i))V/=16;else{if(p[y]=(o-i)/(2*V),s=r[y]-V,a=r[y],u=r[y]+V,l=(o-t)/V,h=(t-i)/V,v=d.core.Vec.max([Math.abs(p[y]),Math.abs(t),Math.abs(o),Math.abs(i),Math.abs(s),Math.abs(a),Math.abs(u),1e-8]),c=Math.min(d.core.Vec.max([Math.abs(l-p[y]),Math.abs(h-p[y]),Math.abs(l-h)])/v,V/v),!(c>m))break;V/=16}}return p},d.core.Numeric.uncmin=function(e,r,n,t,o){null==n&&(n=1e-8),null==t&&(t=function(r){return d.core.Numeric.numericalGradient(e,r)}),null==o&&(o=1e3),r=r.slice(0);var i,c=r.length,s=e(r),a=s;if(Math.isNaN(s))throw"uncmin: f(x0) is a NaN!";n=Math.max(n,d.core.Constants.EPSILON);var u,l,h,v,f,p,m,_,g,y=d.core.Mat.identity(c),V=0,b=[],x="";for(l=t(r);o>V;){if(!d.core.Vec.all(d.core.Vec.finite(l))){x="Gradient has Infinity or NaN";break}if(u=d.core.Vec.neg(d.core.Mat.dot(y,l)),!d.core.Vec.all(d.core.Vec.finite(u))){x="Search direction has Infinity or NaN";break}if(g=d.core.Vec.norm(u),n>g){x="Newton step smaller than tol";break}for(_=1,i=d.core.Vec.dot(l,u),v=r;o>V&&!(n>_*g)&&(b=d.core.Vec.mul(_,u),v=d.core.Vec.add(r,b),a=e(v),a-s>=.1*_*i||Math.isNaN(a));)_*=.5,++V;if(n>_*g){x="Line search step size smaller than tol";break}if(V==o){x="maxit reached during line search";break}h=t(v),f=d.core.Vec.sub(h,l),m=d.core.Vec.dot(f,b),p=d.core.Mat.dot(y,f),y=d.core.Mat.sub(d.core.Mat.add(y,d.core.Mat.mul((m+d.core.Vec.dot(f,p))/(m*m),d.core.Numeric.tensor(b,b))),d.core.Mat.div(d.core.Mat.add(d.core.Numeric.tensor(p,b),d.core.Numeric.tensor(b,p)),m)),r=v,s=a,l=h,++V}return new d.core.MinimizationResult(r,s,l,y,V,x)},d.core.Numeric.tensor=function(e,r){for(var n,t,o=e.length,i=r.length,c=[],s=o-1;s>=0;){n=[],t=e[s];for(var a=i-1;a>=3;)n[a]=t*r[a],--a,n[a]=t*r[a],--a,n[a]=t*r[a],--a,n[a]=t*r[a],--a;for(;a>=0;)n[a]=t*r[a],--a;c[s]=n,s--}return c},d.core.Tess=e.core.Tess=function(){},d.core.Tess.__name__=["verb","core","Tess"],d.core.Tess.rationalCurveRegularSample=function(e,r,n){return d.core.Tess.rationalCurveRegularSampleRange(e,e.knots[0],d.core.ArrayExtensions.last(e.knots),r,n)},d.core.Tess.rationalCurveRegularSampleRange=function(e,r,n,t,o){1>t&&(t=2);for(var i=[],c=(n-r)/(t-1),s=0,a=0;t>a;){var u=a++;s=r+c*u,o?i.push([s].concat(d.core.Eval.rationalCurvePoint(e,s))):i.push(d.core.Eval.rationalCurvePoint(e,s))}return i},d.core.Tess.rationalCurveAdaptiveSample=function(e,r,n){if(null==n&&(n=!1),null==r&&(r=1e-6),1==e.degree){if(n){for(var t=[],o=0,i=e.controlPoints.length;i>o;){var c=o++;t.push([e.knots[c+1]].concat(d.core.Eval.dehomogenize(e.controlPoints[c])))}return t}return e.controlPoints.map(d.core.Eval.dehomogenize)}return d.core.Tess.rationalCurveAdaptiveSample_range(e,e.knots[0],d.core.ArrayExtensions.last(e.knots),r,n)},d.core.Tess.rationalCurveAdaptiveSample_range=function(e,r,n,t,o){var i=d.core.Eval.rationalCurvePoint(e,r),c=d.core.Eval.rationalCurvePoint(e,n),s=.5+.2*Math.random(),a=r+(n-r)*s,u=d.core.Eval.rationalCurvePoint(e,a),l=d.core.Vec.sub(i,c),h=d.core.Vec.sub(i,u);if(t>d.core.Vec.dot(l,l)&&d.core.Vec.dot(h,h)>t||!d.core.Trig.threePointsAreFlat(i,u,c,t)){var v=r+.5*(n-r),f=d.core.Tess.rationalCurveAdaptiveSample_range(e,r,v,t,o),p=d.core.Tess.rationalCurveAdaptiveSample_range(e,v,n,t,o);return f.slice(0,-1).concat(p)}return o?[[r].concat(i),[n].concat(c)]:[i,c]},d.core.Tess.rationalSurfaceNaive=function(e,r,n){1>r&&(r=1),1>n&&(n=1),e.degreeU,e.degreeV,e.controlPoints;for(var t=e.knotsU,o=e.knotsV,i=t[t.length-1]-t[0],c=o[o.length-1]-o[0],s=i/r,a=c/n,u=[],l=[],h=[],v=0,f=r+1;f>v;)for(var p=v++,m=0,_=n+1;_>m;){var g=m++,y=p*s,V=g*a;l.push([y,V]);var b=d.core.Eval.rationalSurfaceDerivatives(e,1,y,V),x=b[0][0];u.push(x);var E=d.core.Vec.normalized(d.core.Vec.cross(b[1][0],b[0][1]));h.push(E)}for(var k=[],P=0;r>P;)for(var S=P++,M=0;n>M;){var B=M++,I=S*(n+1)+B,A=(S+1)*(n+1)+B,C=A+1,N=I+1,w=[I,A,C],L=[I,C,N];k.push(w),k.push(L)}return new d.core.types.MeshData(k,u,h,l)},d.core.Tess.divideRationalSurfaceAdaptive=function(e,r){null==r&&(r=new d.core.types.AdaptiveRefinementOptions),r.minDivsU=null!=r.minDivsU?r.minDivsU:1,r.minDivsU=null!=r.minDivsV?r.minDivsV:1,r.refine=null!=r.refine?r.refine:!0;var n,t=3*(e.controlPoints.length-1),o=3*(e.controlPoints[0].length-1);n=r.minDivsU=r.minDivsU>t?r.minDivsU:t;var i;i=r.minDivsV=r.minDivsV>o?r.minDivsV:o;for(var c=d.core.ArrayExtensions.last(e.knotsU),s=e.knotsU[0],a=d.core.ArrayExtensions.last(e.knotsV),u=e.knotsV[0],l=(c-s)/n,h=(a-u)/i,v=[],f=[],p=0,m=i+1;m>p;){for(var _=p++,g=[],y=0,V=n+1;V>y;){var b=y++,x=s+l*b,E=u+h*_,k=d.core.Eval.rationalSurfaceDerivatives(e,1,x,E),P=d.core.Vec.normalized(d.core.Vec.cross(k[0][1],k[1][0]));g.push(new d.core.types.SurfacePoint(k[0][0],P,[x,E],-1,d.core.Vec.isZero(P)))}f.push(g)}for(var S=0;i>S;)for(var M=S++,B=0;n>B;){var I=B++,A=[f[i-M-1][I],f[i-M-1][I+1],f[i-M][I+1],f[i-M][I]];v.push(new d.core.types.AdaptiveRefinementNode(e,A))}if(!r.refine)return v;for(var C=0;i>C;)for(var N=C++,w=0;n>w;){var L=w++,z=N*n+L,T=d.core.Tess.north(z,N,L,n,i,v),D=d.core.Tess.east(z,N,L,n,i,v),R=d.core.Tess.south(z,N,L,n,i,v),O=d.core.Tess.west(z,N,L,n,i,v);v[z].neighbors=[R,D,T,O],v[z].divide(r)}return v},d.core.Tess.north=function(e,r,n,t,o,i){return 0==r?null:i[e-t]},d.core.Tess.south=function(e,r,n,t,o,i){return r==o-1?null:i[e+t]},d.core.Tess.east=function(e,r,n,t,o,i){return n==t-1?null:i[e+1]},d.core.Tess.west=function(e,r,n,t,o,i){return 0==n?null:i[e-1]},d.core.Tess.triangulateAdaptiveRefinementNodeTree=function(e){for(var r=d.core.types.MeshData.empty(),n=0;e.length>n;){var t=e[n];++n,t.triangulate(r)}return r},d.core.Tess.rationalSurfaceAdaptive=function(e,r){r=null!=r?r:new d.core.types.AdaptiveRefinementOptions;var n=d.core.Tess.divideRationalSurfaceAdaptive(e,r);return d.core.Tess.triangulateAdaptiveRefinementNodeTree(n)},d.core.Trig=e.core.Trig=function(){},d.core.Trig.__name__=["verb","core","Trig"],d.core.Trig.distToSegment=function(e,r,n){var t=d.core.Vec.sub(n,e),o=d.core.Vec.norm(t),i=d.core.Vec.sub(r,e);if(d.core.Constants.TOLERANCE>o)return d.core.Vec.norm(i);var c=d.core.Vec.mul(1/o,t),s=d.core.Vec.dot(i,c),a=d.core.Vec.add(e,d.core.Vec.mul(s,c));return d.core.Vec.dist(a,r)},d.core.Trig.rayClosestPoint=function(e,r,n){var t=d.core.Vec.sub(e,r),o=d.core.Vec.dot(t,n),i=d.core.Vec.add(r,d.core.Vec.mul(o,n));return i},d.core.Trig.distToRay=function(e,r,n){var t=d.core.Trig.rayClosestPoint(e,r,n),o=d.core.Vec.sub(t,e);return d.core.Vec.norm(o)},d.core.Trig.threePointsAreFlat=function(e,r,n,t){var o=d.core.Vec.sub(r,e),i=d.core.Vec.sub(n,e),c=d.core.Vec.cross(o,i),s=d.core.Vec.dot(c,c);return t>s},d.core.Trig.segmentClosestPoint=function(e,r,n,t,o){var i=d.core.Vec.sub(n,r),c=d.core.Vec.norm(i);if(d.core.Constants.EPSILON>c)return{u:t,pt:r};var s=r,a=d.core.Vec.mul(1/c,i),u=d.core.Vec.sub(e,s),l=d.core.Vec.dot(u,a);return 0>l?{u:t,pt:r}:l>c?{u:o,pt:n}:{u:t+(o-t)*l/c,pt:d.core.Vec.add(s,d.core.Vec.mul(l,a))}},d.core.Vec=e.core.Vec=function(){},d.core.Vec.__name__=["verb","core","Vec"],d.core.Vec.range=function(e){for(var r=[],n=0,t=0;e>t;)t++,r.push(n),n+=1;return r},d.core.Vec.neg=function(e){return e.map(function(e){return-e})},d.core.Vec.min=function(e){return c.fold(e,function(e,r){return Math.min(e,r)},Math.POSITIVE_INFINITY)},d.core.Vec.max=function(e){return c.fold(e,function(e,r){return Math.max(e,r)},Math.NEGATIVE_INFINITY)},d.core.Vec.all=function(e){return c.fold(e,function(e,r){return r&&e},!0)},d.core.Vec.finite=function(e){return e.map(function(e){return Math.isFinite(e)})},d.core.Vec.onRay=function(e,r,n){return d.core.Vec.add(e,d.core.Vec.mul(n,r))},d.core.Vec.lerp=function(e,r,n){return d.core.Vec.add(d.core.Vec.mul(e,r),d.core.Vec.mul(1-e,n))},d.core.Vec.normalized=function(e){return d.core.Vec.div(e,d.core.Vec.norm(e))},d.core.Vec.cross=function(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]},d.core.Vec.dist=function(e,r){return d.core.Vec.norm(d.core.Vec.sub(e,r))},d.core.Vec.distSquared=function(e,r){return d.core.Vec.normSquared(d.core.Vec.sub(e,r))},d.core.Vec.sum=function(e){return c.fold(e,function(e,r){return r+e},0)},d.core.Vec.norm=function(e){return Math.sqrt(d.core.Vec.normSquared(e))},d.core.Vec.normSquared=function(e){return c.fold(e,function(e,r){return r+e*e},0)},d.core.Vec.rep=function(e,r){for(var n=[],t=0;e>t;)t++,n.push(r);return n},d.core.Vec.zeros1d=function(e){for(var r=[],n=0;e>n;)n++,r.push(0);return r},d.core.Vec.zeros2d=function(e,r){for(var n=[],t=0;e>t;)t++,n.push(d.core.Vec.zeros1d(r));return n},d.core.Vec.zeros3d=function(e,r,n){for(var t=[],o=0;e>o;)o++,t.push(d.core.Vec.zeros2d(r,n));return t},d.core.Vec.dot=function(e,r){for(var n=0,t=0,o=e.length;o>t;){var i=t++;n+=e[i]*r[i]}return n},d.core.Vec.add=function(e,r){for(var n=[],t=0,o=e.length;o>t;){var i=t++;n.push(e[i]+r[i])}return n},d.core.Vec.mul=function(e,r){for(var n=[],t=0,o=r.length;o>t;){var i=t++;n.push(e*r[i])}return n},d.core.Vec.div=function(e,r){for(var n=[],t=0,o=e.length;o>t;){var i=t++;n.push(e[i]/r)}return n},d.core.Vec.sub=function(e,r){for(var n=[],t=0,o=e.length;o>t;){var i=t++;n.push(e[i]-r[i])}return n},d.core.Vec.isZero=function(e){for(var r=0,n=e.length;n>r;){var t=r++;if(Math.abs(e[t])>d.core.Constants.TOLERANCE)return!1}return!0},d.core.types={},d.core.types.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.085},d.core.types.AdaptiveRefinementOptions.__name__=["verb","core","types","AdaptiveRefinementOptions"],d.core.types.AdaptiveRefinementNode=e.core.AdaptiveRefinementNode=function(e,r,n){if(this.srf=e,this.neighbors=null==n?[null,null,null,null]:n,this.corners=r,null==this.corners){var t=e.knotsU[0],o=d.core.ArrayExtensions.last(e.knotsU),i=e.knotsV[0],c=d.core.ArrayExtensions.last(e.knotsV);this.corners=[d.core.types.SurfacePoint.fromUv(t,i),d.core.types.SurfacePoint.fromUv(o,i),d.core.types.SurfacePoint.fromUv(o,c),d.core.types.SurfacePoint.fromUv(t,c)]}},d.core.types.AdaptiveRefinementNode.__name__=["verb","core","types","AdaptiveRefinementNode"],d.core.types.AdaptiveRefinementNode.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var e=0;4>e;){var r=e++;if(null==this.corners[r].point){var n=this.corners[r];this.evalSrf(n.uv[0],n.uv[1],n)}}},evalSrf:function(e,r,n){var t=d.core.Eval.rationalSurfaceDerivatives(this.srf,1,e,r),o=t[0][0],i=d.core.Vec.cross(t[0][1],t[1][0]),c=d.core.Vec.isZero(i);return c||(i=d.core.Vec.normalized(i)),null!=n?(n.degen=c,n.point=o,n.normal=i,n):new d.core.types.SurfacePoint(o,i,[e,r],-1,c)},getEdgeCorners:function(e){if(this.isLeaf())return[this.corners[e]];if(this.horizontal)switch(e){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(e){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(e){var r=[this.corners[e]];if(null==this.neighbors[e])return r;var n=this.neighbors[e].getEdgeCorners((e+2)%4),t=e%2,o=d.core.Constants.EPSILON,i=this,c=[function(e){return e.uv[0]>i.corners[0].uv[0]+o&&e.uv[0]<i.corners[2].uv[0]-o},function(e){return e.uv[1]>i.corners[0].uv[1]+o&&e.uv[1]<i.corners[2].uv[1]-o}],s=n.filter(c[t]);return s.reverse(),r.concat(s)},midpoint:function(e){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[e])return this.midPoints[e];switch(e){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[e]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var e=this.corners.length,r=0;e>r;){var n=r++;if(this.corners[n],this.corners[n].degen){var t=this.corners[(n+1)%e],o=this.corners[(n+3)%e];this.corners[n].normal=t.degen?o.normal:t.normal}}},shouldDivide:function(e,r){if(e.minDepth>r)return!0;if(r>=e.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=d.core.Vec.normSquared(d.core.Vec.sub(this.corners[0].normal,this.corners[1].normal))>e.normTol||d.core.Vec.normSquared(d.core.Vec.sub(this.corners[2].normal,this.corners[3].normal))>e.normTol,this.splitHoriz=d.core.Vec.normSquared(d.core.Vec.sub(this.corners[1].normal,this.corners[2].normal))>e.normTol||d.core.Vec.normSquared(d.core.Vec.sub(this.corners[3].normal,this.corners[0].normal))>e.normTol,this.splitVert||this.splitHoriz)return!0;var n=this.center();return d.core.Vec.normSquared(d.core.Vec.sub(n.normal,this.corners[0].normal))>e.normTol||d.core.Vec.normSquared(d.core.Vec.sub(n.normal,this.corners[1].normal))>e.normTol||d.core.Vec.normSquared(d.core.Vec.sub(n.normal,this.corners[2].normal))>e.normTol||d.core.Vec.normSquared(d.core.Vec.sub(n.normal,this.corners[3].normal))>e.normTol},divide:function(e){null==e&&(e=new d.core.types.AdaptiveRefinementOptions),null==e.normTol&&(e.normTol=.085),null==e.minDepth&&(e.minDepth=0),null==e.maxDepth&&(e.maxDepth=10),this._divide(e,0,!0)},_divide:function(e,r,n){if(this.evalCorners(),this.shouldDivide(e,r)){if(r++,this.splitVert&&!this.splitHoriz?n=!1:!this.splitVert&&this.splitHoriz&&(n=!0),this.horizontal=n,this.horizontal){var t=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],o=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new d.core.types.AdaptiveRefinementNode(this.srf,t),new d.core.types.AdaptiveRefinementNode(this.srf,o)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var i=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],c=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new d.core.types.AdaptiveRefinementNode(this.srf,i),new d.core.types.AdaptiveRefinementNode(this.srf,c)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var s=0,a=this.children;a.length>s;){var u=a[s];++s,u._divide(e,r,!n)}}},triangulate:function(e){if(null==e&&(e=d.core.types.MeshData.empty()),this.isLeaf())return this.triangulateLeaf(e);for(var r=0,n=this.children;n.length>r;){var t=n[r];if(++r,null==t)break;t.triangulate(e)}return e},triangulateLeaf:function(e){for(var r=e.points.length,n=[],t=[],o=0,i=0;4>i;){var c=i++,s=this.getAllCorners(c);2==s.length&&(o=c+1);for(var a=0,u=s.length;u>a;){var l=a++;n.push(s[l])}}for(var h=0;n.length>h;){var v=n[h];++h,-1==v.id?(e.uvs.push(v.uv),e.points.push(v.point),e.normals.push(v.normal),v.id=r,t.push(r),r++):t.push(v.id)}if(4==n.length)return e.faces.push([t[0],t[3],t[1]]),e.faces.push([t[3],t[2],t[1]]),e;if(5==n.length){var d=t.length;return e.faces.push([t[o],t[(o+1)%d],t[(o+2)%d]]),e.faces.push([t[(o+4)%d],t[(o+3)%d],t[o]]),e.faces.push([t[o],t[(o+2)%d],t[(o+3)%d]]),e}var f=this.center();e.uvs.push(f.uv),e.points.push(f.point),e.normals.push(f.normal);for(var p=e.points.length-1,m=0,_=n.length-1;n.length>m;)e.faces.push([p,t[_],t[m]]),_=m++;return e}},d.core.types.BoundingBoxNode=e.core.BoundingBoxNode=function(e){this.boundingBox=e},d.core.types.BoundingBoxNode.__name__=["verb","core","types","BoundingBoxNode"],d.core.types.BoundingBoxInnerNode=e.core.BoundingBoxInnerNode=function(e,r){d.core.types.BoundingBoxNode.call(this,e),this.children=r},d.core.types.BoundingBoxInnerNode.__name__=["verb","core","types","BoundingBoxInnerNode"],d.core.types.BoundingBoxInnerNode.__super__=d.core.types.BoundingBoxNode,d.core.types.BoundingBoxInnerNode.prototype=r(d.core.types.BoundingBoxNode.prototype,{}),d.core.types.BoundingBoxLeaf=e.core.BoundingBoxLeaf=function(e,r){d.core.types.BoundingBoxNode.call(this,e),this.item=r},d.core.types.BoundingBoxLeaf.__name__=["verb","core","types","BoundingBoxLeaf"],d.core.types.BoundingBoxLeaf.__super__=d.core.types.BoundingBoxNode,d.core.types.BoundingBoxLeaf.prototype=r(d.core.types.BoundingBoxNode.prototype,{}),d.core.types.CurveCurveIntersection=e.core.CurveCurveIntersection=function(e,r,n,t){this.point0=e,this.point1=r,this.u0=n,this.u1=t},d.core.types.CurveCurveIntersection.__name__=["verb","core","types","CurveCurveIntersection"],d.core.types.CurveData=e.core.CurveData=function(e,r,n){this.degree=e,this.controlPoints=n,this.knots=r},d.core.types.CurveData.__name__=["verb","core","types","CurveData"],d.core.types.CurveLengthSample=e.core.CurveLengthSample=function(e,r){this.u=e,this.len=r},d.core.types.CurveLengthSample.__name__=["verb","core","types","CurveLengthSample"],d.core.types.CurveSurfaceIntersection=e.core.CurveSurfaceIntersection=function(e,r){this.u=e,this.uv=r},d.core.types.CurveSurfaceIntersection.__name__=["verb","core","types","CurveSurfaceIntersection"],d.core.types.CurveTriPoint=e.core.CurveTriPoint=function(e,r,n){this.u=e,this.point=r,this.uv=n},d.core.types.CurveTriPoint.__name__=["verb","core","types","CurveTriPoint"],d.core.types.IBoundingBoxTree=function(){},d.core.types.IBoundingBoxTree.__name__=["verb","core","types","IBoundingBoxTree"],d.core.types.Interval=e.core.Interval=function(e,r){this.min=e,this.max=r},d.core.types.Interval.__name__=["verb","core","types","Interval"],d.core.types.LazyCurveBoundingBoxTree=function(e,r){this._boundingBox=null,this._curve=e,null==r&&(r=d.core.ArrayExtensions.last(this._curve.knots)-this._curve.knots[0]/1e3),this._knotTol=r},d.core.types.LazyCurveBoundingBoxTree.__name__=["verb","core","types","LazyCurveBoundingBoxTree"],d.core.types.LazyCurveBoundingBoxTree.__interfaces__=[d.core.types.IBoundingBoxTree],d.core.types.LazyCurveBoundingBoxTree.prototype={split:function(){var e=this._curve.knots[0],r=d.core.ArrayExtensions.last(this._curve.knots),n=r-e,t=d.core.Modify.curveSplit(this._curve,(r+e)/2+.01*n*Math.random());return new d.core.types.Pair(new d.core.types.LazyCurveBoundingBoxTree(t[0],this._knotTol),new d.core.types.LazyCurveBoundingBoxTree(t[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new d.BoundingBox(d.core.Eval.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(){return d.core.ArrayExtensions.last(this._curve.knots)-this._curve.knots[0]<this._knotTol},empty:function(){return!1}},d.core.types.LazyMeshBoundingBoxTree=function(e,r){if(this._boundingBox=null,this._mesh=e,null==r){for(var n=[],t=0,o=e.faces.length;o>t;){var i=t++;n.push(i)}r=n}this._faceIndices=r},d.core.types.LazyMeshBoundingBoxTree.__name__=["verb","core","types","LazyMeshBoundingBoxTree"],d.core.types.LazyMeshBoundingBoxTree.__interfaces__=[d.core.types.IBoundingBoxTree],d.core.types.LazyMeshBoundingBoxTree.prototype={split:function(){var e=d.core.Mesh.sortTrianglesOnLongestAxis(this._boundingBox,this._mesh,this._faceIndices),r=d.core.ArrayExtensions.left(e),n=d.core.ArrayExtensions.right(e);return new d.core.types.Pair(new d.core.types.LazyMeshBoundingBoxTree(this._mesh,r),new d.core.types.LazyMeshBoundingBoxTree(this._mesh,n))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=d.core.Mesh.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length}},d.core.types.LazyPolylineBoundingBoxTree=function(e,r){this._boundingBox=null,this._polyline=e,null==r&&(r=new d.core.types.Interval(0,0!=e.points.length?e.points.length-1:0)),this._interval=r},d.core.types.LazyPolylineBoundingBoxTree.__name__=["verb","core","types","LazyPolylineBoundingBoxTree"],d.core.types.LazyPolylineBoundingBoxTree.__interfaces__=[d.core.types.IBoundingBoxTree],d.core.types.LazyPolylineBoundingBoxTree.prototype={split:function(){var e=this._interval.min,r=this._interval.max,n=e+Math.ceil((r-e)/2),t=new d.core.types.Interval(e,n),o=new d.core.types.Interval(n,r);return new d.core.types.Pair(new d.core.types.LazyPolylineBoundingBoxTree(this._polyline,t),new d.core.types.LazyPolylineBoundingBoxTree(this._polyline,o))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new d.BoundingBox(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(){return 1==this._interval.max-this._interval.min},empty:function(){return 0==this._interval.max-this._interval.min}},d.core.types.LazySurfaceBoundingBoxTree=function(e,r,n,t){null==r&&(r=!1),this._boundingBox=null,this._surface=e,this._splitV=r,null==n&&(n=(d.core.ArrayExtensions.last(e.knotsU)-e.knotsU[0])/1e3),null==t&&(t=(d.core.ArrayExtensions.last(e.knotsV)-e.knotsV[0])/1e3),this._knotTolU=n,this._knotTolV=t},d.core.types.LazySurfaceBoundingBoxTree.__name__=["verb","core","types","LazySurfaceBoundingBoxTree"],d.core.types.LazySurfaceBoundingBoxTree.__interfaces__=[d.core.types.IBoundingBoxTree],d.core.types.LazySurfaceBoundingBoxTree.prototype={split:function(){var e,r;this._splitV?(e=this._surface.knotsV[0],r=d.core.ArrayExtensions.last(this._surface.knotsV)):(e=this._surface.knotsU[0],r=d.core.ArrayExtensions.last(this._surface.knotsU));var n=r-e,t=(e+r)/2+.01*n*Math.random(),o=d.core.Modify.surfaceSplit(this._surface,t,this._splitV);return new d.core.types.Pair(new d.core.types.LazySurfaceBoundingBoxTree(o[0],!this._splitV,this._knotTolU,this._knotTolV),new d.core.types.LazySurfaceBoundingBoxTree(o[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new d.BoundingBox;for(var e=0,r=this._surface.controlPoints;r.length>e;){var n=r[e];++e,this._boundingBox.addRange(d.core.Eval.dehomogenize1d(n))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(){return this._splitV?d.core.ArrayExtensions.last(this._surface.knotsV)-this._surface.knotsV[0]<this._knotTolV:d.core.ArrayExtensions.last(this._surface.knotsU)-this._surface.knotsU[0]<this._knotTolU},empty:function(){return!1}},d.core.types.MeshData=e.core.MeshData=function(e,r,n,t){this.faces=e,this.points=r,this.normals=n,this.uvs=t},d.core.types.MeshData.__name__=["verb","core","types","MeshData"],d.core.types.MeshData.empty=function(){return new d.core.types.MeshData([],[],[],[])},d.core.types.MeshIntersectionPoint=e.core.MeshIntersectionPoint=function(e,r,n){this.visited=!1,this.adj=null,this.opp=null,this.uv0=e,this.uv1=r,this.point=n,this.faceIndex0,this.faceIndex1},d.core.types.MeshIntersectionPoint.__name__=["verb","core","types","MeshIntersectionPoint"],d.core.types.Pair=e.core.Pair=function(e,r){this.item0=e,this.item1=r},d.core.types.Pair.__name__=["verb","core","types","Pair"],d.core.types.PolylineData=e.core.PolylineData=function(e,r){this.points=e,this.params=r},d.core.types.PolylineData.__name__=["verb","core","types","PolylineData"],d.core.types.PolylineMeshIntersection=e.core.PolylineMeshIntersection=function(e,r,n,t,o){this.point=e,this.u=r,this.uv=n,this.polylineIndex=t,this.faceIndex=o},d.core.types.PolylineMeshIntersection.__name__=["verb","core","types","PolylineMeshIntersection"],d.core.types.Ray=e.core.Ray=function(e,r){this.origin=e,this.dir=r},d.core.types.Ray.__name__=["verb","core","types","Ray"],d.core.types.SurfaceData=e.core.SurfaceData=function(e,r,n,t,o){this.degreeU=e,this.degreeV=r,this.knotsU=n,this.knotsV=t,this.controlPoints=o},d.core.types.SurfaceData.__name__=["verb","core","types","SurfaceData"],d.core.types.SurfaceData.prototype={get_foo:function(){return this.foo}},d.core.types.SurfacePoint=function(e,r,n,t,o){null==o&&(o=!1),null==t&&(t=-1),this.uv=n,this.point=e,this.normal=r,this.id=t,this.degen=o},d.core.types.SurfacePoint.__name__=["verb","core","types","SurfacePoint"],d.core.types.SurfacePoint.fromUv=function(e,r){return new d.core.types.SurfacePoint(null,null,[e,r])},d.core.types.SurfaceSurfaceIntersectionPoint=e.core.SurfaceSurfaceIntersectionPoint=function(e,r,n,t){this.uv0=e,this.uv1=r,this.point=n,this.dist=t},d.core.types.SurfaceSurfaceIntersectionPoint.__name__=["verb","core","types","SurfaceSurfaceIntersectionPoint"],d.core.types.TriSegmentIntersection=e.core.TriSegmentIntersection=function(e,r,n,t){this.point=e,this.s=r,this.t=n,this.p=t},d.core.types.TriSegmentIntersection.__name__=["verb","core","types","TriSegmentIntersection"],d.core.types.VolumeData=e.core.VolumeData=function(e,r,n,t,o,i,c){this.degreeU=e,this.degreeV=r,this.degreeW=n,this.knotsU=t,this.knotsV=o,this.knotsW=i,this.controlPoints=c},d.core.types.VolumeData.__name__=["verb","core","types","VolumeData"],d.exe.Dispatcher=function(){this._workerPool=new d.exe.WorkerPool(d.exe.Dispatcher.THREADS)},d.exe.Dispatcher.__name__=["verb","exe","Dispatcher"],d.exe.Dispatcher.instance=function(){return null==d.exe.Dispatcher._instance&&(d.exe.Dispatcher._instance=new d.exe.Dispatcher),d.exe.Dispatcher._instance},d.exe.Dispatcher.prototype={applyMethod:function(e,r,n){var t=new v.Deferred,o=function(e){t.resolve(e)};return this._workerPool.addWork(e,r,n,o),new v.Promise(t)}},d.exe.Work=function(e,r,n){this.className=e,this.methodName=r,this.args=n,this.id=d.exe.Work.uuid++},d.exe.Work.__name__=["verb","exe","Work"],d.exe.WorkerPool=function(e,r){null==r&&(r="/Users/peter/Dropbox/Github/personal/verb2/verb/build/verb.js"),this._callbacks=new h.ds.IntMap,this._working=new h.ds.IntMap,this._pool=[],this._queue=[];for(var n=0;e>n;)n++,this._pool.push(new Worker(r))},d.exe.WorkerPool.__name__=["verb","exe","WorkerPool"],d.exe.WorkerPool.prototype={addWork:function(e,r,n,t){var o=new d.exe.Work(e,r,n);this._callbacks.set(o.id,t),this._queue.push(o),this.processQueue()},processQueue:function(){for(var e=this;this._queue.length>0&&this._pool.length>0;){var r=this._queue.shift(),n=[r.id],t=[this._pool.shift()];this._working.set(n[0],t[0]),t[0].onmessage=function(r,n){return function(t){e._working.remove(n[0]),e._pool.push(r[0]);try{e._callbacks.exists(n[0])&&(e._callbacks.get(n[0])(t.data.result),e._callbacks.remove(n[0]))}catch(o){console.log(o)}e.processQueue()}}(t,n),t[0].postMessage(r)}}};var f,p=0;Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Math.isFinite=function(e){return isFinite(e)},Math.isNaN=function(e){return isNaN(e)},String.__name__=["String"],Array.__name__=["Array"],null==Array.prototype.map&&(Array.prototype.map=function(e){for(var r=[],n=0,t=this.length;t>n;){var o=n++;r[o]=e(this[o])}return r}),null==Array.prototype.filter&&(Array.prototype.filter=function(e){for(var r=[],n=0,t=this.length;t>n;){var o=n++,i=this[o];e(i)&&r.push(i)}return r}),v.base.EventLoop.queue=new s,d.BoundingBox.TOLERANCE=1e-4,d.core.Analyze.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],d.core.Analyze.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],d.core.Binomial.memo=new h.ds.IntMap,d.core.Constants.TOLERANCE=1e-6,d.core.Constants.EPSILON=1e-10,d.exe.Dispatcher.THREADS=1,d.exe.Work.uuid=0,d.Init.main()
})("undefined"!=typeof window?window:exports);