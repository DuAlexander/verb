<!DOCTYPE html>
<html>
<head>
    <script src="../build/verb.js"></script>
    <script src="js/three.min.js"></script>
    <script src="js/verbToThreeConversion.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/threeBasic.js"></script>
    <style> body {  margin: 0; } </style>
</head>
<body>
<script>

	threeSetup();

	var degree = 3
		, knots = [0, 0, 0, 0, 0.333, 0.666, 1, 1, 1, 1]
		, pts = [ 	[ [0, 0, -10], 	[10, 0, 0], 	[20, 0, 0], 	[30, 0, 0] , 	[40, 0, 0], [50, 0, 10] ],
					[ [0, -10, 0], 	[10, -10, 10], 	[20, -10, 10], 	[30, -10, 0] , [40, -10, 0], [50, -10, 0]	],
					[ [0, -20, 0], 	[10, -20, 10], 	[20, -20, 10], 	[30, -20, 0] , [40, -20, -2], [50, -20, -12] 	],
					[ [0, -30, 0], 	[10, -30, 0], 	[20, -30, -23], 	[30, -30, 0] , [40, -30, 0], [50, -30, 0]     ],
					[ [0, -40, 0], 	[10, -40, 0], 	[20, -40, 0], 	[30, -40, 4] , [40, -40, -20], [50, -40, 0]     ],
					[ [0, -50, 12], [10, -50, 0], 	[20, -50, 20], 	[30, -50, 0] , [50, -50, -10], [50, -50, -15]     ],     ];

	var srf = verb.geom.NurbsSurface.byKnotsControlPointsWeights( degree, degree, knots, knots, pts );

	addMeshToScene( srf.toThreeGeometry(), null, true );

    var mesh = srf.tessellate();
	var res;
	var runs = 20;

	var d1 = Date.now();

	for (var i = 0 ; i < runs; i++){
		res = verb.core.Intersect.meshSlices( mesh, 0, 2, 1 );
	}

	var d2 = Date.now();

	var numLengths = res.reduce(function(a,x){ return a + x.length-1; }, 0);

	console.log( "intersected in ", (d2 - d1) / runs, " ms and " + res.length + " polylines were discovered");
	console.log( numLengths + " edges were formed in total ");

	for (var i = 0; i < res.length; i++){
	    for (var j = 0; j < res[i].length; j++){
            var pwl = res[i][j].map(function(x){ return x.point; });
		    addCurveToScene( pointsAsGeometry( pwl ));
	    }
	}

	threeRender();

</script>

</body>

</html>