/*! verb 2013-12-08 */
if("object"!=typeof exports||void 0===exports)var verb={},numeric=window.numeric,binomial=window.binomial,labor=window.labor,_=window.underscore;else var verb=module.exports={},numeric=require("numeric"),binomial=require("binomial"),labor=require("labor"),_=require("underscore");verb={},verb=verb||{},verb.core={},verb.eval={},verb.eval=verb.eval||{},verb.eval=verb.eval||{},verb.eval=verb.eval||{},verb.EPSILON=1e-8,verb.TOLERANCE=.001,verb.init=function(){verb.nurbsEngine=new verb.core.Engine(verb.eval),verb.NurbsGeometry.prototype.nurbsEngine=verb.nurbsEngine},"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),Function.prototype.method=function(e,t){return this.prototype[e]=t,this},Function.method("inherits",function(e){return this.prototype=new e,this.prototype,this.prototype.constructor=e,this}),Array.prototype.flatten=function(){if(0==this.length)return[];for(var e=[],t=0;this.length>t;t++)e=this[t]instanceof Array?e.concat(this[t].flatten()):e.concat(this[t]);return e},numeric.normalized=function(e){return numeric.div(e,numeric.norm2(e))},numeric.cross=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},verb.core.Engine=function(e){var t="function"==typeof Worker&&(e.use_pool||void 0===e.use_pool),r=e.num_workers||2,i=e.tolerance||1e-4,n=e.url||"js/verbEval.js",s=e.library||verb.eval,o=e.error_handler||function(e){console.warn(e)},u=void 0,a=function(){try{u=new labor.Pool(n,r),u.start()}catch(e){return o("Failed to initialize labor.Pool: "+e),!1}return!0};this.start=function(){t&&a()},this.eval=function(e,r,i){if(!i)return this.eval_sync(e,r);if(t&&(u||void 0===u&&a()))u.addWork(e,r,i);else{var n=this;setTimeout(function(){i(n.eval_sync(e,r))},0)}},this.eval_sync=function(e,t){return s[e].apply(null,t)},this.set_tolerance=function(e){i=e},this.set_use_pool=function(e){return e&&void 0===u&&a()?(t=e,!0):e?!1:(u=null,delete u,!0)},this.set_error_handler=function(e){o=e},this.set_num_threads=function(e){r=e}},verb.core.WatchObject=function(){var e={change:{}},t={},r=0,i=this,s=function(t,r){if("string"==typeof t){for(ele in e[t])e[t][ele](r);for(ele in e.change)e.change[ele](r)}else for(n in t)s(n,r)};this.get=function(e){return t[e]},this.set=function(r,n){var o=t[r];t[r]=n,e[r]=e[r]||{},s(r,{name:r,old:o,"new":n,target:i,type:"full"})},this.setAll=function(r){var n={};for(propName in r)n[propName]=t[propName],t[propName]=r[propName],e[propName]=e[propName]||{};s(r,{old:n,"new":r,target:i,type:"multi"})},this.setAt=function(e,r,n){var o=t[e];if(!(void 0===o||o.length>=r||0>r)){var u=t[e][r];t[e][r]=n,s(e,{name:e,index:r,old:u,"new":n,target:i,type:"index"})}},this.watch=function(i,n){return void 0!==t[i]&&n?(r++,e[i][r]=n,r++):void 0},this.watchAll=function(e,t){for(var r=[],i=0;e.length>i;i++)r.push(this.watch(e[i],t));return r},this.ignore=function(t,r){void 0!==e[t]&&void 0!==e[t][r]&&(e[t][r]=void 0)}},verb.core.uid=function(){var e=0;return function(){return e++}}(),verb.Geometry=function(){verb.core.WatchObject.call(this);var e=verb.core.uid();this.uniqueId=function(){return e}}.inherits(verb.core.WatchObject),verb.NurbsGeometry=function(){verb.Geometry.call(this)}.inherits(verb.Geometry),verb.NurbsCurve=function(e,t,r,i){verb.NurbsGeometry.call(this),this.setAll({controlPoints:t,weights:r,knots:i?i.slice(0):[],degree:e})}.inherits(verb.NurbsGeometry),verb.NurbsCurve.prototype.point=function(e,t){return this.nurbsEngine.eval("rational_curve_point",[this.get("degree"),this.get("knots"),this.homogenize(),e],t)},verb.NurbsCurve.prototype.derivatives=function(e,t,r){return this.nurbsEngine.eval("rational_curve_derivs",[this.get("degree"),this.get("knots"),this.homogenize(),e,t],r)},verb.NurbsCurve.prototype.tesselate=function(e,t){var e=e||{};return e.tolerance=e.tolerance||verb.EPSILON,this.nurbsEngine.eval("rational_curve_adaptive_sample",[this.get("degree"),this.get("knots"),this.homogenize(),e.tolerance],t)},verb.NurbsCurve.prototype.transform=function(e){for(var t=this.get("controlPoints"),r=0;t.length>r;r++){var i=t[1].push(1);t[r]=numeric.mul(e,i).slice(0,i.length-2)}return this.set("controlPoints",t),this},verb.NurbsCurve.prototype.clone=function(){for(var e=this.get("controlPoints"),t=[],r=0;e.length>r;r++)t.push(e[r].slice(0));return new verb.NurbsCurve(this.get("degree"),t,this.get("weights").slice(0),this.get("knots").slice)},verb.NurbsCurve.prototype.homogenize=function(){return verb.eval.homogenize_1d(this.get("controlPoints"),this.get("weights"))},verb.NurbsCurve.prototype.update=function(){if(this.nurbsRep){var e=this.nurbsRep();this.setAll({controlPoints:e.control_points,weights:e.weights,knots:e.knots,degree:e.degree})}},verb.NurbsSurface=function(e,t,r,i,n,s){verb.NurbsGeometry.call(this),this.setAll({controlPoints:n,weights:s,knotsU:t?t.slice(0):[],knotsV:i?i.slice(0):[],degreeU:e,degreeV:r})}.inherits(verb.NurbsGeometry),verb.NurbsSurface.prototype.point=function(e,t,r){return this.nurbsEngine.eval("rational_surface_point",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),e,t],r)},verb.NurbsSurface.prototype.derivatives=function(e,t,r,i){return this.nurbsEngine.eval("rational_surface_derivs",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),r,e,t],i)},verb.NurbsSurface.prototype.tesselate=function(e,t){var r=20,i=20;return e&&(r=e.minDivsV||r,i=e.minDivsU||i),this.nurbsEngine.eval("tesselate_rational_surface_naive",[this.get("degreeU"),this.get("knotsU"),this.get("degreeV"),this.get("knotsV"),this.homogenize(),i,r],t)},verb.NurbsSurface.prototype.transform=function(e){for(var t=this.get("controlPoints"),r=0;t.length>r;r++)for(var i=0;t[r].length>i;i++){var n=t[1].push(1);t[r]=numeric.mul(e,n).slice(0,n.length-2)}return this.set("controlPoints",t),this},verb.NurbsSurface.prototype.clone=function(){for(var e=this.get("controlPoints"),t=[],r=0;e.length>r;r++){t.push([]);for(var i=0;e[r].length>i;i++)t[r].push(e[r][i].slice(0))}for(var n=this.get("weights"),s=[],r=0;n.length>r;r++)s.push(n[r].slice(0));return new verb.NurbsSurface(this.get("degreeU"),this.get("knotsU").slice(0),this.get("degreeV"),this.get("knotsV").slice(0),t,s)},verb.NurbsSurface.prototype.homogenize=function(){return verb.eval.homogenize_2d(this.get("controlPoints"),this.get("weights"))},verb.NurbsSurface.prototype.update=function(){if(this.nurbsRep){var e=this.nurbsRep();this.setAll({controlPoints:e.control_points,weights:e.weights,knotsU:e.knots_u,knotsV:e.knots_v,degreeU:e.degree_u,degreeV:e.degree_v})}},verb.Arc=function(e,t,r,i,n){verb.NurbsCurve.call(this),this.setAll({center:e,xaxis:t,yaxis:r,radius:i,interval:n}),this.update(),this.watchAll(["center","xaxis","yaxis","radius","interval"],this.update)}.inherits(verb.NurbsCurve),verb.Arc.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("radius"),this.get("interval").get("min"),this.get("interval").get("max")])},verb.BezierCurve=function(e,t){verb.NurbsCurve.call(this),this.setAll({controlPoints:e?e.slice(0):[],weights:t?t.slice(0):void 0}),this.update()}.inherits(verb.NurbsCurve),verb.BezierCurve.prototype.nurbsRep=function(){for(var e=this.get("controlPoints"),t=this.get("weights"),r=e.length-1,i=[],n=0;r+1>n;n++)i.push(0);for(var n=0;r+1>n;n++)i.push(1);if(void 0===t){t=[];for(var n=0;e.length>n;n++)t.push(1)}return{degree:r,knots:i,control_points:e,weights:t}},verb.BoundingBox=function(){this.initialized=!1,this.min=[0,0,0],this.max=[0,0,0];var e=Array.prototype.slice.call(arguments,0);this.add_elements_sync(e)},verb.BoundingBox.prototype.add_elements=function(e,t){var r=this;_.defer(function(){_.each(e,function(e){r.add(e)}),t(r)})},verb.BoundingBox.prototype.add_elements_sync=function(e){var t=this;return _.each(e,function(e){t.add(e)}),this},verb.BoundingBox.prototype.add=function(e){return this.initialized?(e[0]>this.max[0]&&(this.max[0]=e[0]),e[1]>this.max[1]&&(this.max[1]=e[1]),e[2]>this.max[2]&&(this.max[2]=e[2]),e[0]<this.min[0]&&(this.min[0]=e[0]),e[1]<this.min[1]&&(this.min[1]=e[1]),e[2]<this.min[2]&&(this.min[2]=e[2]),this):(this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this)},verb.BoundingBox.prototype.contains=function(e){return this.initialized?this.intersects(new verb.BoundingBox(e)):!1},verb.BoundingBox.prototype.TOLERANCE=1e-4,verb.BoundingBox.prototype.intervals_overlap=function(e,t,r,i){var n=verb.BoundingBox.prototype.TOLERANCE,s=Math.min(e,t)-n,o=Math.max(e,t)+n,u=Math.min(r,i)-n,a=Math.max(r,i)+n;return s>=u&&a>=s||o>=u&&a>=o||u>=s&&o>=u||a>=s&&o>=a?!0:!1},verb.BoundingBox.prototype.intersects=function(e){if(!this.initialized||!e.initialized)return!1;var t=this.min,r=this.max,i=e.min,n=e.max;return this.intervals_overlap(t[0],r[0],i[0],n[0])&&this.intervals_overlap(t[1],r[1],i[1],n[1])&&this.intervals_overlap(t[2],r[2],i[2],n[2])?!0:!1},verb.BoundingBox.prototype.clear=function(){return this.initialized=!1,this},verb.BoundingBox.prototype.get_longest_axis=function(){var e=[this.get_axis_length(0),this.get_axis_length(1),this.get_axis_length(2)];return e.indexOf(Math.max.apply(Math,e))},verb.BoundingBox.prototype.get_axis_length=function(e){return 0>e||e>2?0:Math.abs(this.min[e]-this.max[e])},verb.BoundingBox.prototype.intersect=function(e){if(!this.initialized)return null;var t=this.min,r=this.max,i=e.min,n=e.max;if(!this.intersects(e))return null;var s=Math.min(r[0],n[0]),o=Math.max(t[0],i[0]),u=Math.min(r[1],n[1]),a=Math.max(t[1],i[1]),h=Math.min(r[2],n[2]),g=Math.max(t[2],i[2]),l=[s,u,h],c=[o,a,g];return new verb.BoundingBox(c,l)},verb.Circle=function(e,t,r,i){verb.NurbsCurve.call(this),this.setAll({center:e,xaxis:t,yaxis:r,radius:i}),this.update(),this.watchAll(["center","xaxis","yaxis","radius"],this.update)}.inherits(verb.NurbsCurve),verb.Circle.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("radius"),0,2*Math.PI])},verb.Cone=function(e,t,r,i,n){verb.NurbsSurface.call(this),this.setAll({axis:e,xaxis:t,base:r,height:i,radius:n});var s=this.nurbsRep();verb.NurbsSurface.call(this,s.degree_u,s.knots_u,s.degree_v,s.knots_v,s.control_points,s.weights),this.watchAll(["axis","xaxis","base","height","radius"],this.update)}.inherits(verb.NurbsSurface),verb.Cone.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_cone_surface",[this.get("axis"),this.get("xaxis"),this.get("base"),this.get("height"),this.get("radius")])},verb.Cylinder=function(e,t,r,i,n){this.setAll({axis:e,xaxis:t,base:r,height:i,radius:n});var s=this.nurbsRep();verb.NurbsSurface.call(this,s.degree_u,s.knots_u,s.degree_v,s.knots_v,s.control_points,s.weights),this.watchAll(["axis","xaxis","base","height","radius"],this.update)}.inherits(verb.NurbsSurface),verb.Cylinder.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_cylinder_surface",[this.get("axis"),this.get("xaxis"),this.get("base"),this.get("height"),this.get("radius")])},verb.Ellipse=function(e,t,r,i,n){verb.NurbsCurve.call(this),this.setAll({center:e,xaxis:t,yaxis:r,xradius:i,yradius:n}),this.update(),this.watchAll(["center","xaxis","yaxis","xradius","yradius"],this.update)}.inherits(verb.NurbsCurve),verb.Ellipse.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_ellipse_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("xradius"),this.get("yradius"),0,2*Math.PI])},verb.EllipseArc=function(e,t,r,i,n,s){verb.NurbsCurve.call(this),this.setAll({center:e,xaxis:t,yaxis:r,xradius:i,yradius:n,interval:s}),this.update(),this.watchAll(["center","xaxis","yaxis","xradius","yradius","interval"],this.update)}.inherits(verb.NurbsCurve),verb.EllipseArc.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_ellipse_arc",[this.get("center"),this.get("xaxis"),this.get("yaxis"),this.get("xradius"),this.get("yradius"),this.get("interval").get("min"),this.get("interval").get("max")])},verb.Extrusion=function(e,t,r){verb.NurbsSurface.call(this),this.setAll({profile:e,axis:t,length:r}),this.update(),this.watchAll(["axis","length"],this.update),e.watchAll(["knots","degree","controlPoints","weights"],this.update)}.inherits(verb.NurbsSurface),verb.Extrusion.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_extruded_surface",[this.get("axis"),this.get("length"),this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights")])},verb.FourPointSurface=function(e,t,r,i){verb.NurbsSurface.call(this),this.setAll({p1:e,p2:t,p3:r,p4:i}),this.update(),this.watchAll(["p1","p2","p3","p4"],this.update)}.inherits(verb.NurbsSurface),verb.FourPointSurface.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_4pt_surface",[this.get("p1"),this.get("p2"),this.get("p3"),this.get("p4")])},verb.Interval=function(e,t){verb.core.WatchObject.call(this),this.setAll({min:e,max:t})}.inherits(verb.core.WatchObject),verb.Interval2=function(e,t,r,i){verb.core.WatchObject.call(this),this.setAll({uinterval:new verb.Interval(e,t),vinterval:new verb.Interval(r,i)})}.inherits(verb.core.WatchObject),verb.Line=function(e,t){verb.NurbsCurve.call(this),this.setAll({start:e,end:t}),this.update(),this.watchAll(["start","end"],this.update)}.inherits(verb.NurbsCurve),verb.Line.prototype.nurbsRep=function(){return{knots:[0,0,1,1],control_points:[this.get("start"),this.get("end")],weights:[1,1],degree:1}},verb.PlanarSurface=function(e,t,r,i,n){verb.NurbsSurface.call(this),this.setAll({base:e,uaxis:t,vaxis:r,ulength:i,vlength:n}),this.update(),this.watchAll(["base","uaxis","vaxis","ulength","vlength"],this.update)}.inherits(verb.NurbsSurface),verb.PlanarSurface.prototype.nurbsRep=function(){var e=this.get("base"),t=numeric.mul(this.get("uaxis"),this.get("ulength")),r=numeric.mul(this.get("vaxis"),this.get("vlength")),i=numeric.add(e,t),n=numeric.add(e,r,t),s=numeric.add(e,r);return this.nurbsEngine.eval_sync("get_4pt_surface",[e,i,n,s])},verb.PolyLine=function(e){verb.NurbsCurve.call(this),this.setAll({control_points:e?e.slice(0):[]}),this.update()}.inherits(verb.NurbsCurve),verb.PolyLine.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_polyline_curve",[this.get("control_points")])},verb.RevolvedSurface=function(e,t,r,i){verb.NurbsSurface.call(this),this.setAll({center:e,axis:t,angle:r,profile:i}),this.update(),this.watchAll(["center","axis","angle","profile"],this.update)}.inherits(verb.NurbsSurface),verb.RevolvedSurface.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_revolved_surface",[this.get("center"),this.get("axis"),this.get("angle"),this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights")])},verb.Sphere=function(e,t){verb.NurbsSurface.call(this),this.setAll({center:e,radius:t}),this.update(),this.watchAll(["center","radius"],this.update)}.inherits(verb.NurbsSurface),verb.Sphere.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_sphere_surface",[this.get("center"),[0,0,1],[1,0,0],this.get("radius")])},verb.SweepOneRail=function(e,t){verb.NurbsSurface.call(this),this.setAll({rail:e,profile:t}),this.update(),this.watchAll(["rail","profile"],this.update)}.inherits(verb.NurbsSurface),verb.SweepOneRail.prototype.nurbsRep=function(){return this.nurbsEngine.eval_sync("get_sweep1_surface",[this.get("profile").get("knots"),this.get("profile").get("degree"),this.get("profile").get("controlPoints"),this.get("profile").get("weights"),this.get("rail").get("knots"),this.get("rail").get("degree"),this.get("rail").get("controlPoints"),this.get("rail").get("weights")])},verb.intersectCurves=function(e,t,r){return e instanceof verb.NurbsCurve&&t instanceof verb.NurbsCurve?verb.nurbsEngine.eval("intersect_rational_curves_by_aabb",[e.get("degree"),e.get("knots"),e.homogenize(),t.get("degree"),t.get("knots"),t.homogenize(),verb.TOLERANCE],r):void 0};