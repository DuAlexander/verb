/*! verb 2014-12-29 */
(function(e){"use strict";function r(e){return e instanceof Array?function(){return o.iter(e)}:"function"==typeof e.iterator?n(e,e.iterator):e.iterator}function n(e,r){if(null==r)return null;null==r.__id__&&(r.__id__=a++);var n;return null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[r.__id__],null==n&&(n=function(){return n.method.apply(n.scope,arguments)},n.scope=e,n.method=r,e.hx__closures__[r.__id__]=n),n}e.core=e.core||{};var o=function(){};o.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var t=function(){};t.fold=function(e,n,o){for(var t=r(e)();t.hasNext();){var i=t.next();o=n(i,o)}return o};var i=function(){},c={};c.ds={},c.ds.IntMap=function(){this.h={}},c.ds.IntMap.__interfaces__=[i],c.ds.IntMap.prototype={set:function(e,r){this.h[e]=r},get:function(e){return this.h[e]},exists:function(e){return this.h.hasOwnProperty(e)}};var s={};s.BoundingBox=e.BoundingBox=function(e){this.dim=3,this.initialized=!1,this.dim=3,this.min=null,this.max=null,null!=e&&this.addRange(e)},s.BoundingBox.intervalsOverlap=function(e,r,n,o,t){null==t&&(t=-1);var i;i=0>t?s.BoundingBox.TOLERANCE:t;var c=Math.min(e,r)-i,a=Math.max(e,r)+i,u=Math.min(n,o)-i,l=Math.max(n,o)+i;return c>=u&&l>=c||a>=u&&l>=a||u>=c&&a>=u||l>=c&&a>=l},s.BoundingBox.prototype={fromPoint:function(e){var r=new s.BoundingBox(null);return r.add(e),r},add:function(e){if(!this.initialized)return this.dim=e.length,this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this;for(var r=this.dim,n=0;r>n;){var o=n++;e[o]>this.max[o]&&(this.max[o]=e[o])}for(var t=0;r>t;){var i=t++;e[i]<this.min[i]&&(this.min[i]=e[i])}return this},addRange:function(e){for(var r=e.length,n=0;r>n;){var o=n++;this.add(e[o])}return this},contains:function(e,r){return null==r&&(r=-1),this.initialized?this.intersects(new s.BoundingBox([e]),r):!1},intersects:function(e,r){if(null==r&&(r=-1),!this.initialized||!e.initialized)return!1;for(var n=this.min,o=this.max,t=e.min,i=e.max,c=0,a=this.dim;a>c;){var u=c++;if(!s.BoundingBox.intervalsOverlap(n[u],o[u],t[u],i[u],r))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var e=0,r=0,n=0,o=this.dim;o>n;){var t=n++,i=this.getAxisLength(t);i>e&&(e=i,r=t)}return r},getAxisLength:function(e){return 0>e||e>this.dim-1?0:Math.abs(this.min[e]-this.max[e])},intersect:function(e,r){if(!this.initialized)return null;var n=this.min,o=this.max,t=e.min,i=e.max;if(!this.intersects(e,r))return null;for(var c=[],a=[],u=0,l=this.dim;l>u;){var v=u++;c.push(Math.min(o[v],i[v])),a.push(Math.max(n[v],t[v]))}return new s.BoundingBox([a,c])}},s.Init=function(){},s.Init.main=function(){console.log("verb 0.2.0")},s.core={},s.core.Analyze=function(){},s.core.Binomial=function(){},s.core.Binomial.get=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;if(r>e-r&&(r=e-r),s.core.Binomial.memo_exists(e,r))return s.core.Binomial.get_memo(e,r);for(var n=1,o=e,t=1,i=r+1;i>t;){var c=t++;s.core.Binomial.memo_exists(o,c)?(e--,n=s.core.Binomial.get_memo(o,c)):(n*=e--,n/=c,s.core.Binomial.memoize(o,c,n))}return n},s.core.Binomial.get_no_memo=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;r>e-r&&(r=e-r);for(var n=1,o=1,t=r+1;t>o;){var i=o++;n*=e--,n/=i}return n},s.core.Binomial.memo_exists=function(e,r){return s.core.Binomial.memo.exists(e)&&s.core.Binomial.memo.get(e).exists(r)},s.core.Binomial.get_memo=function(e,r){return s.core.Binomial.memo.get(e).get(r)},s.core.Binomial.memoize=function(e,r,n){s.core.Binomial.memo.exists(e)||s.core.Binomial.memo.set(e,new c.ds.IntMap),s.core.Binomial.memo.get(e).set(r,n)},s.core.Constants=e.core.Constants=function(){},s.core.Eval=e.core.Eval=function(){},s.core.Eval.rational_surface_derivs=function(e,r,n,o){for(var t=s.core.Eval.surface_derivs(e,r,n,o),i=s.core.Eval.rational_2d(t),c=s.core.Eval.weight_2d(t),a=[],u=i[0][0].length,l=0,v=r+1;v>l;){var h=l++;a.push([]);for(var f=0,d=r-h+1;d>f;){for(var _=f++,m=i[h][_],g=1,p=_+1;p>g;){var V=g++;m=s.core.Vec.sub(m,s.core.Vec.mul(s.core.Binomial.get(_,V)*c[0][V],a[h][_-V]))}for(var E=1,k=h+1;k>E;){var y=E++;m=s.core.Vec.sub(m,s.core.Vec.mul(s.core.Binomial.get(h,y)*c[y][0],a[h-y][_]));for(var b=s.core.Vec.zeros1d(u),M=1,P=_+1;P>M;){var z=M++;b=s.core.Vec.add(b,s.core.Vec.mul(s.core.Binomial.get(_,z)*c[y][z],a[h-y][_-z]))}m=s.core.Vec.sub(m,s.core.Vec.mul(s.core.Binomial.get(h,y),b))}a[h].push(s.core.Vec.mul(1/c[0][0],m))}}return a},s.core.Eval.rational_surface_point=function(e,r,n){return s.core.Eval.dehomogenize(s.core.Eval.surface_point(e,r,n))},s.core.Eval.rational_curve_derivs=function(e,r,n){for(var o=s.core.Eval.curve_derivs(e,r,n),t=s.core.Eval.rational_1d(o),i=s.core.Eval.weight_1d(o),c=[],a=0,u=n+1;u>a;){for(var l=a++,v=t[l],h=1,f=l+1;f>h;){var d=h++;v=s.core.Vec.sub(v,s.core.Vec.mul(s.core.Binomial.get(l,d)*i[d],c[l-d]))}c.push(s.core.Vec.mul(1/i[0],v))}return c},s.core.Eval.rational_curve_point=function(e,r){return s.core.Eval.dehomogenize(s.core.Eval.curve_point(e,r))},s.core.Eval.dehomogenize=function(e){for(var r=e.length,n=[],o=e[r-1],t=e.length-1,i=0;t>i;){var c=i++;n.push(e[c]/o)}return n},s.core.Eval.rational_1d=function(e){var r=e[0].length-1;return e.map(function(e){return e.slice(0,r)})},s.core.Eval.rational_2d=function(e){return e.map(s.core.Eval.rational_1d)},s.core.Eval.weight_1d=function(e){var r=e[0].length-1;return e.map(function(e){return e[r]})},s.core.Eval.weight_2d=function(e){return e.map(s.core.Eval.weight_1d)},s.core.Eval.dehomogenize_1d=function(e){return e.map(s.core.Eval.dehomogenize)},s.core.Eval.dehomogenize_2d=function(e){return e.map(s.core.Eval.dehomogenize_1d)},s.core.Eval.homogenize_1d=function(e,r){for(var n=e.length,o=e[0].length,t=[],i=0,c=[],s=0;n>s;){var a=s++,u=[];c=e[a],i=r[a];for(var l=0;o>l;){var v=l++;u.push(c[v]*i)}u.push(i),t.push(u)}return t},s.core.Eval.homogenize_2d=function(e,r){for(var n=e.length,o=[],t=0;n>t;){var i=t++;o.push(s.core.Eval.homogenize_1d(e[i],r[i]))}return o},s.core.Eval.surface_derivs=function(e,r,n,o){var t=e.knotsU.length-e.degreeU-2,i=e.knotsV.length-e.degreeV-2;return s.core.Eval.surface_derivs_given_n_m(t,i,e,r,n,o)},s.core.Eval.surface_derivs_given_n_m=function(e,r,n,o,t,i){var c=n.degreeU,a=n.degreeV,u=n.controlPoints,l=n.knotsU,v=n.knotsV;if(!s.core.Eval.are_valid_relations(c,u.length,l.length)||!s.core.Eval.are_valid_relations(a,u[0].length,v.length))throw"Invalid relations between control points, knot vector, and n";var h,f=u[0][0].length;h=c>o?o:c;var d;d=a>o?o:a;for(var _=s.core.Vec.zeros3d(h+1,d+1,f),m=s.core.Eval.knot_span_given_n(e,c,t,l),g=s.core.Eval.knot_span_given_n(r,a,i,v),p=s.core.Eval.deriv_basis_functions_given_n_i(m,t,c,e,l),V=s.core.Eval.deriv_basis_functions_given_n_i(g,i,a,r,v),E=s.core.Vec.zeros2d(a+1,f),k=0,y=0,b=h+1;b>y;){for(var M=y++,P=0,z=a+1;z>P;){var w=P++;E[w]=s.core.Vec.zeros1d(f);for(var T=0,x=c+1;x>T;){var D=T++;E[w]=s.core.Vec.add(E[w],s.core.Vec.mul(p[M][D],u[m-c+D][g-a+w]))}}var U=o-M;k=d>U?U:d;for(var B=0,N=k+1;N>B;){var S=B++;_[M][S]=s.core.Vec.zeros1d(f);for(var C=0,I=a+1;I>C;){var A=C++;_[M][S]=s.core.Vec.add(_[M][S],s.core.Vec.mul(V[S][A],E[A]))}}}return _},s.core.Eval.surface_point=function(e,r,n){var o=e.knotsU.length-e.degreeU-2,t=e.knotsV.length-e.degreeV-2;return s.core.Eval.surface_point_given_n_m(o,t,e,r,n)},s.core.Eval.surface_point_given_n_m=function(e,r,n,o,t){var i=n.degreeU,c=n.degreeV,a=n.controlPoints,u=n.knotsU,l=n.knotsV;if(!s.core.Eval.are_valid_relations(i,a.length,u.length)||!s.core.Eval.are_valid_relations(c,a[0].length,l.length))throw"Invalid relations between control points, knot vector, and n";for(var v=a[0][0].length,h=s.core.Eval.knot_span_given_n(e,i,o,u),f=s.core.Eval.knot_span_given_n(r,c,t,l),d=s.core.Eval.basis_functions_given_knot_span_index(h,o,i,u),_=s.core.Eval.basis_functions_given_knot_span_index(f,t,c,l),m=h-i,g=f,p=s.core.Vec.zeros1d(v),V=s.core.Vec.zeros1d(v),E=0,k=c+1;k>E;){var y=E++;V=s.core.Vec.zeros1d(v),g=f-c+y;for(var b=0,M=i+1;M>b;){var P=b++;V=s.core.Vec.add(V,s.core.Vec.mul(d[P],a[m+P][g]))}p=s.core.Vec.add(p,s.core.Vec.mul(_[y],V))}return p},s.core.Eval.curve_derivs=function(e,r,n){var o=e.knots.length-e.degree-2;return s.core.Eval.curve_derivs_given_n(o,e,r,n)},s.core.Eval.curve_derivs_given_n=function(e,r,n,o){var t=r.degree,i=r.controlPoints,c=r.knots;if(!s.core.Eval.are_valid_relations(t,i.length,c.length))throw"Invalid relations between control points, knot vector, and n";var a,u=i[0].length;a=t>o?o:t;for(var l=s.core.Vec.zeros2d(a+1,u),v=s.core.Eval.knot_span_given_n(e,t,n,c),h=s.core.Eval.deriv_basis_functions_given_n_i(v,n,t,a,c),f=0,d=a+1;d>f;)for(var _=f++,m=0,g=t+1;g>m;){var p=m++;l[_]=s.core.Vec.add(l[_],s.core.Vec.mul(h[_][p],i[v-t+p]))}return l},s.core.Eval.curve_point=function(e,r){var n=e.knots.length-e.degree-2;return s.core.Eval.curve_point_given_n(n,e,r)},s.core.Eval.are_valid_relations=function(e,r,n){return 0==r+e+1-n},s.core.Eval.curve_point_given_n=function(e,r,n){var o=r.degree,t=r.controlPoints,i=r.knots;if(!s.core.Eval.are_valid_relations(o,t.length,i.length))throw"Invalid relations between control points, knot Array, and n";for(var c=s.core.Eval.knot_span_given_n(e,o,n,i),a=s.core.Eval.basis_functions_given_knot_span_index(c,n,o,i),u=s.core.Vec.zeros1d(t[0].length),l=0,v=o+1;v>l;){var h=l++;u=s.core.Vec.add(u,s.core.Vec.mul(a[h],t[c-o+h]))}return u},s.core.Eval.deriv_basis_functions=function(e,r,n){var o=s.core.Eval.knot_span(r,e,n),t=n.length-1,i=t-r-1;return s.core.Eval.deriv_basis_functions_given_n_i(o,e,r,i,n)},s.core.Eval.deriv_basis_functions_given_n_i=function(e,r,n,o,t){var i=s.core.Vec.zeros2d(n+1,n+1),c=s.core.Vec.zeros1d(n+1),a=s.core.Vec.zeros1d(n+1),u=0,l=0;i[0][0]=1;for(var v=1,h=n+1;h>v;){var f=v++;c[f]=r-t[e+1-f],a[f]=t[e+f]-r,u=0;for(var d=0;f>d;){var _=d++;i[f][_]=a[_+1]+c[f-_],l=i[_][f-1]/i[f][_],i[_][f]=u+a[_+1]*l,u=c[f-_]*l}i[f][f]=u}for(var m=s.core.Vec.zeros2d(o+1,n+1),g=s.core.Vec.zeros2d(2,n+1),p=0,V=1,E=0,k=0,y=0,b=0,M=0,P=0,z=n+1;z>P;){var w=P++;m[0][w]=i[w][n]}for(var T=0,x=n+1;x>T;){var D=T++;p=0,V=1,g[0][0]=1;for(var U=1,B=o+1;B>U;){var N=U++;E=0,k=D-N,y=n-N,D>=N&&(g[V][0]=g[p][0]/i[y+1][k],E=g[V][0]*i[k][y]),b=k>=-1?1:-k,M=y>=D-1?N-1:n-D;for(var S=b,C=M+1;C>S;){var I=S++;g[V][I]=(g[p][I]-g[p][I-1])/i[y+1][k+I],E+=g[V][I]*i[k+I][y]}y>=D&&(g[V][N]=-g[p][N-1]/i[y+1][D],E+=g[V][N]*i[D][y]),m[N][D]=E;var A=p;p=V,V=A}}for(var L=n,O=1,R=o+1;R>O;){for(var q=O++,F=0,K=n+1;K>F;){var H=F++;m[q][H]*=L}L*=n-q}return m},s.core.Eval.basis_functions=function(e,r,n){var o=s.core.Eval.knot_span(r,e,n);return s.core.Eval.basis_functions_given_knot_span_index(o,e,r,n)},s.core.Eval.basis_functions_given_knot_span_index=function(e,r,n,o){var t=s.core.Vec.zeros1d(n+1),i=s.core.Vec.zeros1d(n+1),c=s.core.Vec.zeros1d(n+1),a=0,u=0;t[0]=1;for(var l=1,v=n+1;v>l;){var h=l++;i[h]=r-o[e+1-h],c[h]=o[e+h]-r,a=0;for(var f=0;h>f;){var d=f++;u=t[d]/(c[d+1]+i[h-d]),t[d]=a+c[d+1]*u,a=i[h-d]*u}t[h]=a}return t},s.core.Eval.knot_span=function(e,r,n){var o=n.length-1,t=o-e-1;return s.core.Eval.knot_span_given_n(t,e,r,n)},s.core.Eval.knot_span_given_n=function(e,r,n,o){if(n>=o[e+1])return e;if(o[r]>n)return r;for(var t=r,i=e+1,c=Math.floor((t+i)/2);o[c]>n||n>=o[c+1];)o[c]>n?i=c:t=c,c=Math.floor((t+i)/2);return c},s.core.Intersect=e.core.Intersect=function(){},s.core.Intersect.rays=function(e,r,n,o){var t=s.core.Vec.dot(r,o),i=s.core.Vec.dot(r,n),c=s.core.Vec.dot(r,e),a=s.core.Vec.dot(o,n),u=s.core.Vec.dot(o,e),l=s.core.Vec.dot(r,r),v=s.core.Vec.dot(o,o),h=l*v-t*t;if(Math.abs(h)<s.core.Constants.EPSILON)return null;var f=t*(i-c)-l*(a-u),d=f/h,_=(i-c+d*t)/l;return[_,d]},s.core.Make=e.core.Make=function(){},s.core.Make.sweep1_surface=function(e,r){for(var n=s.core.Eval.rational_curve_point(r,0),o=1/r.controlPoints.length,t=[],i=[],c=s.core.Eval.weight_1d(r.controlPoints),a=s.core.Eval.weight_1d(e.controlPoints),u=s.core.Eval.dehomogenize_1d(e.controlPoints),l=0,v=r.controlPoints.length;v>l;){for(var h=l++,f=s.core.Eval.rational_curve_point(r,h*o),d=s.core.Vec.sub(f,n),_=[],m=[],g=0,p=e.controlPoints.length;p>g;){var V=g++;_.push(s.core.Vec.add(d,u[V])),m.push(a[V]*c[h])}t.push(_),i.push(m)}return new s.core.types.SurfaceData(r.degree,e.degree,r.knots,e.knots,s.core.Eval.homogenize_2d(t,i))},s.core.Make.ellipse_arc=function(e,r,n,o,t,i,c){i>c&&(c=2*Math.PI+i);var a=c-i,u=0;u=Math.PI/2>=a?1:Math.PI>=a?2:3*Math.PI/2>=a?3:4;var l=a/u,v=Math.cos(l/2),h=s.core.Vec.add(e,s.core.Vec.add(s.core.Vec.mul(o*Math.cos(i),r),s.core.Vec.mul(t*Math.sin(i),n))),f=s.core.Vec.sub(s.core.Vec.mul(Math.cos(i),n),s.core.Vec.mul(Math.sin(i),r)),d=[],_=s.core.Vec.zeros1d(2*u+3),m=0,g=i,p=s.core.Vec.zeros1d(2*u);d[0]=h,p[0]=1;for(var V=1;u>V;){var E=V++;g+=l;var k=s.core.Vec.add(e,s.core.Vec.add(s.core.Vec.mul(o*Math.cos(g),r),s.core.Vec.mul(t*Math.sin(g),n)));p[m+2]=1,d[m+2]=k;var y=s.core.Vec.sub(s.core.Vec.mul(Math.cos(g),n),s.core.Vec.mul(Math.sin(g),r)),b=s.core.Intersect.rays(h,s.core.Vec.mul(1/s.core.Vec.norm(f),f),k,s.core.Vec.mul(1/s.core.Vec.norm(y),y)),M=s.core.Vec.add(h,s.core.Vec.mul(b[0],f));p[m+1]=v,d[m+1]=M,m+=2,u>E&&(h=k,f=y)}for(var P=2*u+1,z=0;3>z;){var w=z++;_[w]=0,_[w+P]=1}switch(u){case 1:case 2:_[3]=_[4]=.5,_[3]=_[4]=.3333333333333333,_[5]=_[6]=.6666666666666666;break;case 3:_[3]=_[4]=.3333333333333333,_[5]=_[6]=.6666666666666666;break;case 4:_[3]=_[4]=.25,_[5]=_[6]=.5,_[7]=_[8]=.75}return new s.core.types.CurveData(2,_,s.core.Eval.homogenize_1d(d,p))},s.core.Mesh=function(){},s.core.KnotMultiplicity=e.core.KnotMultiplicity=function(e,r){this.knot=e,this.mult=r},s.core.KnotMultiplicity.prototype={inc:function(){this.mult++}},s.core.Modify=e.core.Modify=function(){},s.core.Modify.surface_knot_refine=function(e,r,n){var o,t,i,c=[];n?(i=e.controlPoints,o=e.knotsV,t=e.degreeV):(i=s.core.Vec.transpose(e.controlPoints),o=e.knotsU,t=e.degreeU);for(var a=null,u=0;i.length>u;){var l=i[u];++u,a=s.core.Modify.curve_knot_refine(new s.core.types.CurveData(t,o,l),r),c.push(a.controlPoints)}var v=a.knots;return n?new s.core.types.SurfaceData(e.degreeU,e.degreeV,e.knotsU.slice(),v,c):(c=s.core.Vec.transpose(c),new s.core.types.SurfaceData(e.degreeU,e.degreeV,v,e.knotsV.slice(),c))},s.core.Modify.surface_split=function(e,r,n){null==n&&(n=!1);var o,t,i;n?(i=e.controlPoints,o=e.knotsV,t=e.degreeV):(i=s.core.Vec.transpose(e.controlPoints),o=e.knotsU,t=e.degreeU);for(var c,a=[],u=0,l=t+1;l>u;)u++,a.push(r);c=a;for(var v=[],h=[],f=s.core.Eval.knot_span(t,r,o),d=null,_=0;i.length>_;){var m=i[_];++_,d=s.core.Modify.curve_knot_refine(new s.core.types.CurveData(t,o,m),c),v.push(d.controlPoints.slice(0,f+1)),h.push(d.controlPoints.slice(f+1))}var g=d.knots.slice(0,f+t+2),p=d.knots.slice(f+1);return n?[new s.core.types.SurfaceData(e.degreeU,t,e.knotsU.slice(),g,v),new s.core.types.SurfaceData(e.degreeU,t,e.knotsU.slice(),p,h)]:(v=s.core.Vec.transpose(v),h=s.core.Vec.transpose(h),[new s.core.types.SurfaceData(t,e.degreeV,g,e.knotsV.slice(),v),new s.core.types.SurfaceData(t,e.degreeV,p,e.knotsV.slice(),h)])},s.core.Modify.curve_bezier_decompose=function(e){for(var r=e.degree,n=e.controlPoints,o=e.knots,t=s.core.Modify.knot_multiplicities(o),i=r+1,c=0;t.length>c;){var a=t[c];if(++c,i>a.mult){var u=s.core.Vec.rep(i-a.mult,a.knot),l=s.core.Modify.curve_knot_refine(new s.core.types.CurveData(r,o,n),u);o=l.knots,n=l.controlPoints}}o.length/i-1;for(var v=2*i,h=[],f=0;n.length>f;){var d=o.slice(f,f+v),_=n.slice(f,f+i);h.push(new s.core.types.CurveData(r,d,_)),f+=i}return h},s.core.Modify.knot_multiplicities=function(e){for(var r=[new s.core.KnotMultiplicity(e[0],0)],n=r[0],o=0;e.length>o;){var t=e[o];++o,Math.abs(t-n.knot)>s.core.Constants.EPSILON&&(n=new s.core.KnotMultiplicity(t,0),r.push(n)),n.inc()}return r},s.core.Modify.curve_split=function(e,r){var n=e.degree;e.controlPoints;for(var o,t=e.knots,i=[],c=0,a=n+1;a>c;)c++,i.push(r);o=i;var u=s.core.Modify.curve_knot_refine(e,o),l=s.core.Eval.knot_span(n,r,t),v=u.knots.slice(0,l+n+2),h=u.knots.slice(l+1),f=u.controlPoints.slice(0,l+1),d=u.controlPoints.slice(l+1);return[new s.core.types.CurveData(n,v,f),new s.core.types.CurveData(n,h,d)]},s.core.Modify.curve_knot_refine=function(e,r){for(var n=e.degree,o=e.controlPoints,t=e.knots,i=o.length-1,c=i+n+1,a=r.length-1,u=s.core.Eval.knot_span(n,r[0],t),l=s.core.Eval.knot_span(n,r[a],t),v=[],h=[],f=0,d=u-n+1;d>f;){var _=f++;v[_]=o[_]}for(var m=l-1,g=i+1;g>m;){var p=m++;v[p+a+1]=o[p]}for(var V=0,E=u+1;E>V;){var k=V++;h[k]=t[k]}for(var y=l+n,b=c+1;b>y;){var M=y++;h[M+a+1]=t[M]}for(var P=l+n-1,z=l+n+a,w=a;w>=0;){for(;r[w]<=t[P]&&P>u;)v[z-n-1]=o[P-n-1],h[z]=t[P],z-=1,P-=1;v[z-n-1]=v[z-n];for(var T=1,x=n+1;x>T;){var D=T++,U=z-n+D,B=h[z+D]-r[w];Math.abs(B)<s.core.Constants.EPSILON?v[U-1]=v[U]:(B/=h[z+D]-t[P-n+D],v[U-1]=s.core.Vec.add(s.core.Vec.mul(B,v[U-1]),s.core.Vec.mul(1-B,v[U])))}h[z]=r[w],z-=1,w--}return new s.core.types.CurveData(n,h,v)},s.core.Modify.curve_knot_insert=function(e,r,n){for(var o=e.degree,t=e.controlPoints,i=e.knots,c=0,a=t.length,u=s.core.Eval.knot_span(o,r,i),l=[],v=[],h=[],f=1,d=u+1;d>f;){var _=f++;v[_]=i[_]}for(var m=1,g=n+1;g>m;){var p=m++;v[u+p]=r}for(var V=u+1,E=i.length;E>V;){var k=V++;v[k+n]=i[k]}for(var y=0,b=u-o+1;b>y;){var M=y++;h[M]=t[M]}for(var P=u-c;a>P;){var z=P++;h[z+n]=t[z]}for(var w=0,T=o-c+1;T>w;){var x=w++;l[x]=t[u-o+x]}for(var D=0,U=0,B=1,N=n+1;N>B;){var S=B++;D=u-o+S;for(var C=0,I=o-S-c+1;I>C;){var A=C++;U=(r-i[D+A])/(i[A+u+1]-i[D+A]),l[A]=s.core.Vec.add(s.core.Vec.mul(U,l[A+1]),s.core.Vec.mul(1-U,l[A]))}h[D]=l[0],h[u+n-S-c]=l[o-S-c]}for(var L=D+1,O=u-c;O>L;){var R=L++;h[R]=l[R-D]}return new s.core.types.CurveData(o,v,h)},s.core.Tess=e.core.Tess=function(){},s.core.Tess.rational_curve_regular_sample=function(e,r,n){return s.core.Tess.rational_curve_regular_sample_range(e,e.knots[0],s.core.Utils.last(e.knots),r,n)},s.core.Tess.rational_curve_regular_sample_range=function(e,r,n,o,t){1>o&&(o=2);for(var i=[],c=(n-r)/(o-1),a=0,u=0;o>u;){var l=u++;a=r+c*l,t?i.push([a].concat(s.core.Eval.rational_curve_point(e,a))):i.push(s.core.Eval.rational_curve_point(e,a))}return i},s.core.Tess.rational_curve_adaptive_sample=function(e,r,n){if(1==e.degree){if(n){for(var o=[],t=0,i=e.controlPoints.length;i>t;){var c=t++;o.push([e.knots[c+1]].concat(s.core.Eval.dehomogenize(e.controlPoints[c])))}return o}return e.controlPoints.map(s.core.Eval.dehomogenize)}return s.core.Tess.rational_curve_adaptive_sample_range(e,e.knots[0],s.core.Utils.last(e.knots),r,n)},s.core.Tess.rational_curve_adaptive_sample_range=function(e,r,n,o,t){var i=s.core.Eval.rational_curve_point(e,r),c=s.core.Eval.rational_curve_point(e,n),a=.5+.2*Math.random(),u=r+(n-r)*a,l=s.core.Eval.rational_curve_point(e,u),v=s.core.Vec.sub(i,c),h=s.core.Vec.sub(i,l);if(o>s.core.Vec.dot(v,v)&&s.core.Vec.dot(h,h)>o||!s.core.Trig.three_points_are_flat(i,l,c,o)){var f=r+.5*(n-r),d=s.core.Tess.rational_curve_adaptive_sample_range(e,r,f,o,t),_=s.core.Tess.rational_curve_adaptive_sample_range(e,f,n,o,t);return d.slice(0,-1).concat(_)}return t?[[r].concat(i),[n].concat(c)]:[i,c]},s.core.Tess.tessellate_rational_surface_naive=function(e,r,n){1>r&&(r=1),1>n&&(n=1),e.degreeU,e.degreeV,e.controlPoints;for(var o=e.knotsU,t=e.knotsV,i=s.core.Utils.last(o)-o[0],c=s.core.Utils.last(t)-t[0],a=i/r,u=c/n,l=[],v=[],h=[],f=0,d=r+1;d>f;)for(var _=f++,m=0,g=n+1;g>m;){var p=m++,V=_*a,E=p*u;v.push([V,E]);var k=s.core.Eval.rational_surface_derivs(e,1,V,E),y=k[0][0];l.push(y);var b=s.core.Vec.normalized(s.core.Vec.cross(k[1][0],k[0][1]));h.push(b)}for(var M=[],P=0;r>P;)for(var z=P++,w=0;n>w;){var T=w++,x=z*(n+1)+T,D=(z+1)*(n+1)+T,U=D+1,B=x+1,N=[x,D,U],S=[x,U,B];M.push(N),M.push(S)}return new s.core.types.MeshData(M,l,h,v)},s.core.Tess.divide_rational_surface_adaptive=function(e,r){null==r&&(r=new s.core.types.AdaptiveRefinementOptions),r.minDivsU=null!=r.minDivsU?r.minDivsU:1,r.minDivsU=null!=r.minDivsV?r.minDivsV:1,r.refine=null!=r.refine?r.refine:!0;var n,o=3*(e.controlPoints.length-1),t=3*(e.controlPoints[0].length-1);n=r.minDivsU=r.minDivsU>o?r.minDivsU:o;var i;i=r.minDivsV=r.minDivsV>t?r.minDivsV:t;for(var c=s.core.Utils.last(e.knotsU),a=e.knotsU[0],u=s.core.Utils.last(e.knotsV),l=e.knotsV[0],v=(c-a)/n,h=(u-l)/i,f=[],d=[],_=0,m=i+1;m>_;){for(var g=_++,p=[],V=0,E=n+1;E>V;){var k=V++,y=a+v*k,b=l+h*g,M=s.core.Eval.rational_surface_derivs(e,1,y,b),P=s.core.Vec.normalized(s.core.Vec.cross(M[0][1],M[1][0]));p.push(new s.core.types.SurfacePoint(M[0][0],P,[y,b],-1,s.core.Vec.isZero(P)))}d.push(p)}for(var z=0;i>z;)for(var w=z++,T=0;n>T;){var x=T++,D=[d[i-w-1][x],d[i-w-1][x+1],d[i-w][x+1],d[i-w][x]];f.push(new s.core.types.AdaptiveRefinementNode(e,D))}if(!r.refine)return f;for(var U=0;i>U;)for(var B=U++,N=0;n>N;){var S=N++,C=B*n+S,I=s.core.Tess.north(C,B,S,n,i,f),A=s.core.Tess.east(C,B,S,n,i,f),L=s.core.Tess.south(C,B,S,n,i,f),O=s.core.Tess.west(C,B,S,n,i,f);f[C].neighbors=[L,A,I,O],f[C].divide(r)}return f},s.core.Tess.north=function(e,r,n,o,t,i){return 0==r?null:i[e-o]},s.core.Tess.south=function(e,r,n,o,t,i){return r==t-1?null:i[e+o]},s.core.Tess.east=function(e,r,n,o,t,i){return n==o-1?null:i[e+1]},s.core.Tess.west=function(e,r,n,o,t,i){return 0==n?null:i[e-1]},s.core.Tess.triangulate_adaptive_refinement_node_tree=function(e){for(var r=s.core.types.MeshData.empty(),n=0;e.length>n;){var o=e[n];++n,o.triangulate(r)}return r},s.core.Tess.tessellate_rational_surface_adaptive=function(e,r){var n=s.core.Tess.divide_rational_surface_adaptive(e,r);return s.core.Tess.triangulate_adaptive_refinement_node_tree(n)},s.core.Trig=e.core.Trig=function(){},s.core.Trig.dist_to_seg=function(e,r,n){var o=s.core.Vec.sub(n,e),t=s.core.Vec.norm(o),i=s.core.Vec.sub(r,e);if(s.core.Constants.TOLERANCE>t)return s.core.Vec.norm(i);var c=s.core.Vec.mul(1/t,o),a=s.core.Vec.dot(i,c),u=s.core.Vec.add(e,s.core.Vec.mul(a,c));return s.core.Vec.dist(u,r)},s.core.Trig.three_points_are_flat=function(e,r,n,o){var t=s.core.Vec.sub(r,e),i=s.core.Vec.sub(n,e),c=s.core.Vec.cross(t,i),a=s.core.Vec.dot(c,c);return o>a},s.core.Utils=function(){},s.core.Utils.last=function(e){return e[e.length-1]},s.core.Vec=e.core.Vec=function(){},s.core.Vec.normalized=function(e){return s.core.Vec.div(e,s.core.Vec.normSquared(e))},s.core.Vec.cross=function(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]},s.core.Vec.transpose=function(e){if(0==e.length)return[];for(var r=[],n=0,o=e[0].length;o>n;){var t=n++;r.push(function(){for(var r,n=[],o=0,i=e.length;i>o;){var c=o++;n.push(e[c][t])}return r=n}(this))}return r},s.core.Vec.dist=function(e,r){return s.core.Vec.norm(s.core.Vec.sub(e,r))},s.core.Vec.distSquared=function(e,r){return s.core.Vec.normSquared(s.core.Vec.sub(e,r))},s.core.Vec.sum=function(e){return t.fold(e,function(e,r){return r+e},0)},s.core.Vec.norm=function(e){return Math.sqrt(s.core.Vec.normSquared(e))},s.core.Vec.normSquared=function(e){return t.fold(e,function(e,r){return r+e*e},0)},s.core.Vec.rep=function(e,r){for(var n=[],o=0;e>o;)o++,n.push(r);return n},s.core.Vec.zeros1d=function(e){for(var r=[],n=0;e>n;)n++,r.push(0);return r},s.core.Vec.zeros2d=function(e,r){for(var n=[],o=0;e>o;)o++,n.push(s.core.Vec.zeros1d(r));return n},s.core.Vec.zeros3d=function(e,r,n){for(var o=[],t=0;e>t;)t++,o.push(s.core.Vec.zeros2d(r,n));return o},s.core.Vec.dot=function(e,r){for(var n=0,o=0,t=e.length;t>o;){var i=o++;n+=e[i]*r[i]}return n},s.core.Vec.add=function(e,r){for(var n=[],o=0,t=e.length;t>o;){var i=o++;n.push(e[i]+r[i])}return n},s.core.Vec.mul=function(e,r){for(var n=[],o=0,t=r.length;t>o;){var i=o++;n.push(e*r[i])}return n},s.core.Vec.div=function(e,r){for(var n=[],o=0,t=e.length;t>o;){var i=o++;n.push(e[i]/r)}return n},s.core.Vec.sub=function(e,r){for(var n=[],o=0,t=e.length;t>o;){var i=o++;n.push(e[i]-r[i])}return n},s.core.Vec.isZero=function(e){for(var r=0,n=e.length;n>r;){var o=r++;if(Math.abs(e[o])>s.core.Constants.TOLERANCE)return!1}return!0},s.core.types={},s.core.types.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.085},s.core.types.AdaptiveRefinementNode=e.core.AdaptiveRefinementNode=function(e,r,n){if(this.srf=e,this.neighbors=null==n?[null,null,null,null]:n,this.corners=r,null==this.corners){var o=e.knotsU[0],t=s.core.Utils.last(e.knotsU),i=e.knotsV[0],c=s.core.Utils.last(e.knotsV);this.corners=[s.core.types.SurfacePoint.fromUv(o,i),s.core.types.SurfacePoint.fromUv(t,i),s.core.types.SurfacePoint.fromUv(t,c),s.core.types.SurfacePoint.fromUv(o,c)]}},s.core.types.AdaptiveRefinementNode.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var e=0;4>e;){var r=e++;if(null==this.corners[r].point){var n=this.corners[r];this.evalSrf(n.uv[0],n.uv[1],n)}}},evalSrf:function(e,r,n){var o=s.core.Eval.rational_surface_derivs(this.srf,1,e,r),t=o[0][0],i=s.core.Vec.cross(o[0][1],o[1][0]),c=s.core.Vec.isZero(i);return c||(i=s.core.Vec.normalized(i)),null!=n?(n.degen=c,n.point=t,n.normal=i,n):new s.core.types.SurfacePoint(t,i,[e,r],-1,c)},getEdgeCorners:function(e){if(this.isLeaf())return[this.corners[e]];if(this.horizontal)switch(e){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(e){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(e){var r=[this.corners[e]];if(null==this.neighbors[e])return r;var n=this.neighbors[e].getEdgeCorners((e+2)%4),o=e%2,t=s.core.Constants.EPSILON,i=this,c=[function(e){return e.uv[0]>i.corners[0].uv[0]+t&&e.uv[0]<i.corners[2].uv[0]-t},function(e){return e.uv[1]>i.corners[0].uv[1]+t&&e.uv[1]<i.corners[2].uv[1]-t}],a=n.filter(c[o]);return a.reverse(),r.concat(a)},midpoint:function(e){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[e])return this.midPoints[e];switch(e){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[e]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var e=this.corners.length,r=0;e>r;){var n=r++;if(this.corners[n],this.corners[n].degen){var o=this.corners[(n+1)%e],t=this.corners[(n+3)%e];this.corners[n].normal=o.degen?t.normal:o.normal}}},shouldDivide:function(e,r){if(e.minDepth>r)return!0;if(r>=e.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=s.core.Vec.normSquared(s.core.Vec.sub(this.corners[0].normal,this.corners[1].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(this.corners[2].normal,this.corners[3].normal))>e.normTol,this.splitHoriz=s.core.Vec.normSquared(s.core.Vec.sub(this.corners[1].normal,this.corners[2].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(this.corners[3].normal,this.corners[0].normal))>e.normTol,this.splitVert||this.splitHoriz)return!0;var n=this.center();return s.core.Vec.normSquared(s.core.Vec.sub(n.normal,this.corners[0].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(n.normal,this.corners[1].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(n.normal,this.corners[2].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(n.normal,this.corners[3].normal))>e.normTol},divide:function(e){null==e&&(e=new s.core.types.AdaptiveRefinementOptions),null==e.normTol&&(e.normTol=.085),null==e.minDepth&&(e.minDepth=0),null==e.maxDepth&&(e.maxDepth=10),this._divide(e,0,!0)},_divide:function(e,r,n){if(this.evalCorners(),this.shouldDivide(e,r)){if(r++,this.splitVert&&!this.splitHoriz?n=!1:!this.splitVert&&this.splitHoriz&&(n=!0),this.horizontal=n,this.horizontal){var o=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],t=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new s.core.types.AdaptiveRefinementNode(this.srf,o),new s.core.types.AdaptiveRefinementNode(this.srf,t)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var i=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],c=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new s.core.types.AdaptiveRefinementNode(this.srf,i),new s.core.types.AdaptiveRefinementNode(this.srf,c)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var a=0,u=this.children;u.length>a;){var l=u[a];++a,l._divide(e,r,!n)}}},triangulate:function(e){if(null==e&&(e=s.core.types.MeshData.empty()),this.isLeaf())return this.triangulateLeaf(e);for(var r=0,n=this.children;n.length>r;){var o=n[r];if(++r,null==o)break;o.triangulate(e)}return e},triangulateLeaf:function(e){for(var r=e.points.length,n=[],o=[],t=0,i=0;4>i;){var c=i++,s=this.getAllCorners(c);2==s.length&&(t=c+1);for(var a=0,u=s.length;u>a;){var l=a++;n.push(s[l])}}for(var v=0;n.length>v;){var h=n[v];++v,-1==h.id?(e.uvs.push(h.uv),e.points.push(h.point),e.normals.push(h.normal),h.id=r,o.push(r),r++):o.push(h.id)}if(4==n.length)return e.faces.push([o[0],o[3],o[1]]),e.faces.push([o[3],o[2],o[1]]),e;if(5==n.length){var f=o.length;return e.faces.push([o[t],o[(t+1)%f],o[(t+2)%f]]),e.faces.push([o[(t+4)%f],o[(t+3)%f],o[t]]),e.faces.push([o[t],o[(t+2)%f],o[(t+3)%f]]),e}var d=this.center();e.uvs.push(d.uv),e.points.push(d.point),e.normals.push(d.normal);for(var _=e.points.length-1,m=0,g=n.length-1;n.length>m;)e.faces.push([_,o[g],o[m]]),g=m++;return e}},s.core.types.CurveData=e.core.CurveData=function(e,r,n){this.degree=e,this.controlPoints=n,this.knots=r},s.core.types.MeshData=e.core.MeshData=function(e,r,n,o){this.faces=e,this.points=r,this.normals=n,this.uvs=o},s.core.types.MeshData.empty=function(){return new s.core.types.MeshData([],[],[],[])},s.core.types.SurfaceData=e.core.SurfaceData=function(e,r,n,o,t){this.degreeU=e,this.degreeV=r,this.knotsU=n,this.knotsV=o,this.controlPoints=t},s.core.types.SurfacePoint=function(e,r,n,o,t){null==t&&(t=!1),null==o&&(o=-1),this.uv=n,this.point=e,this.normal=r,this.id=o,this.degen=t},s.core.types.SurfacePoint.fromUv=function(e,r){return new s.core.types.SurfacePoint(null,null,[e,r])};var a=0;Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Math.isFinite=function(e){return isFinite(e)},Math.isNaN=function(e){return isNaN(e)},null==Array.prototype.map&&(Array.prototype.map=function(e){for(var r=[],n=0,o=this.length;o>n;){var t=n++;r[t]=e(this[t])}return r}),null==Array.prototype.filter&&(Array.prototype.filter=function(e){for(var r=[],n=0,o=this.length;o>n;){var t=n++,i=this[t];e(i)&&r.push(i)}return r}),s.BoundingBox.TOLERANCE=1e-4,s.core.Binomial.memo=new c.ds.IntMap,s.core.Constants.TOLERANCE=1e-6,s.core.Constants.EPSILON=1e-10,s.Init.main()})("undefined"!=typeof window?window:exports);