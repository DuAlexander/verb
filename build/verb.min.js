/*! verb 2014-12-29 */
if("object"!=typeof exports||void 0===exports)var verb=exports={};else var verb=module.exports={};(function(e){"use strict";function r(e){return e instanceof Array?function(){return n.iter(e)}:"function"==typeof e.iterator?o(e,e.iterator):e.iterator}function o(e,r){if(null==r)return null;null==r.__id__&&(r.__id__=a++);var o;return null==e.hx__closures__?e.hx__closures__={}:o=e.hx__closures__[r.__id__],null==o&&(o=function(){return o.method.apply(o.scope,arguments)},o.scope=e,o.method=r,e.hx__closures__[r.__id__]=o),o}e.core=e.core||{};var n=function(){};n.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var t=function(){};t.fold=function(e,o,n){for(var t=r(e)();t.hasNext();){var c=t.next();n=o(c,n)}return n};var c=function(){},i={};i.ds={},i.ds.IntMap=function(){this.h={}},i.ds.IntMap.__interfaces__=[c],i.ds.IntMap.prototype={set:function(e,r){this.h[e]=r},get:function(e){return this.h[e]},exists:function(e){return this.h.hasOwnProperty(e)}};var s={};s.BoundingBox=e.BoundingBox=function(e){this.dim=3,this.initialized=!1,this.dim=3,this.min=null,this.max=null,null!=e&&this.addRange(e)},s.BoundingBox.intervalsOverlap=function(e,r,o,n,t){null==t&&(t=-1);var c;c=0>t?s.BoundingBox.TOLERANCE:t;var i=Math.min(e,r)-c,a=Math.max(e,r)+c,u=Math.min(o,n)-c,l=Math.max(o,n)+c;return i>=u&&l>=i||a>=u&&l>=a||u>=i&&a>=u||l>=i&&a>=l},s.BoundingBox.prototype={fromPoint:function(e){var r=new s.BoundingBox(null);return r.add(e),r},add:function(e){if(!this.initialized)return this.dim=e.length,this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this;for(var r=this.dim,o=0;r>o;){var n=o++;e[n]>this.max[n]&&(this.max[n]=e[n])}for(var t=0;r>t;){var c=t++;e[c]<this.min[c]&&(this.min[c]=e[c])}return this},addRange:function(e){for(var r=e.length,o=0;r>o;){var n=o++;this.add(e[n])}return this},contains:function(e,r){return null==r&&(r=-1),this.initialized?this.intersects(new s.BoundingBox([e]),r):!1},intersects:function(e,r){if(null==r&&(r=-1),!this.initialized||!e.initialized)return!1;for(var o=this.min,n=this.max,t=e.min,c=e.max,i=0,a=this.dim;a>i;){var u=i++;if(!s.BoundingBox.intervalsOverlap(o[u],n[u],t[u],c[u],r))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var e=0,r=0,o=0,n=this.dim;n>o;){var t=o++,c=this.getAxisLength(t);c>e&&(e=c,r=t)}return r},getAxisLength:function(e){return 0>e||e>this.dim-1?0:Math.abs(this.min[e]-this.max[e])},intersect:function(e,r){if(!this.initialized)return null;var o=this.min,n=this.max,t=e.min,c=e.max;if(!this.intersects(e,r))return null;for(var i=[],a=[],u=0,l=this.dim;l>u;){var v=u++;i.push(Math.min(n[v],c[v])),a.push(Math.max(o[v],t[v]))}return new s.BoundingBox([a,i])}},s.Init=function(){},s.Init.main=function(){console.log("verb 0.2.0")},s.core={},s.core.Analyze=function(){},s.core.Binomial=function(){},s.core.Binomial.get=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;if(r>e-r&&(r=e-r),s.core.Binomial.memo_exists(e,r))return s.core.Binomial.get_memo(e,r);for(var o=1,n=e,t=1,c=r+1;c>t;){var i=t++;s.core.Binomial.memo_exists(n,i)?(e--,o=s.core.Binomial.get_memo(n,i)):(o*=e--,o/=i,s.core.Binomial.memoize(n,i,o))}return o},s.core.Binomial.get_no_memo=function(e,r){if(0==r)return 1;if(0==e||r>e)return 0;r>e-r&&(r=e-r);for(var o=1,n=1,t=r+1;t>n;){var c=n++;o*=e--,o/=c}return o},s.core.Binomial.memo_exists=function(e,r){return s.core.Binomial.memo.exists(e)&&s.core.Binomial.memo.get(e).exists(r)},s.core.Binomial.get_memo=function(e,r){return s.core.Binomial.memo.get(e).get(r)},s.core.Binomial.memoize=function(e,r,o){s.core.Binomial.memo.exists(e)||s.core.Binomial.memo.set(e,new i.ds.IntMap),s.core.Binomial.memo.get(e).set(r,o)},s.core.Constants=e.core.Constants=function(){},s.core.Eval=e.core.Eval=function(){},s.core.Eval.rational_surface_derivs=function(e,r,o,n){for(var t=s.core.Eval.surface_derivs(e,r,o,n),c=s.core.Eval.rational_2d(t),i=s.core.Eval.weight_2d(t),a=[],u=c[0][0].length,l=0,v=r+1;v>l;){var h=l++;a.push([]);for(var f=0,d=r-h+1;d>f;){for(var _=f++,m=c[h][_],g=1,p=_+1;p>g;){var V=g++;m=s.core.Vec.sub(m,s.core.Vec.mul(s.core.Binomial.get(_,V)*i[0][V],a[h][_-V]))}for(var E=1,k=h+1;k>E;){var M=E++;m=s.core.Vec.sub(m,s.core.Vec.mul(s.core.Binomial.get(h,M)*i[M][0],a[h-M][_]));for(var y=s.core.Vec.zeros1d(u),b=1,z=_+1;z>b;){var P=b++;y=s.core.Vec.add(y,s.core.Vec.mul(s.core.Binomial.get(_,P)*i[M][P],a[h-M][_-P]))}m=s.core.Vec.sub(m,s.core.Vec.mul(s.core.Binomial.get(h,M),y))}a[h].push(s.core.Vec.mul(1/i[0][0],m))}}return a},s.core.Eval.rational_surface_point=function(e,r,o){return s.core.Eval.dehomogenize(s.core.Eval.surface_point(e,r,o))},s.core.Eval.rational_curve_derivs=function(e,r,o){for(var n=s.core.Eval.curve_derivs(e,r,o),t=s.core.Eval.rational_1d(n),c=s.core.Eval.weight_1d(n),i=[],a=0,u=o+1;u>a;){for(var l=a++,v=t[l],h=1,f=l+1;f>h;){var d=h++;v=s.core.Vec.sub(v,s.core.Vec.mul(s.core.Binomial.get(l,d)*c[d],i[l-d]))}i.push(s.core.Vec.mul(1/c[0],v))}return i},s.core.Eval.rational_curve_point=function(e,r){return s.core.Eval.dehomogenize(s.core.Eval.curve_point(e,r))},s.core.Eval.dehomogenize=function(e){for(var r=e.length,o=[],n=e[r-1],t=e.length-1,c=0;t>c;){var i=c++;o.push(e[i]/n)}return o},s.core.Eval.rational_1d=function(e){var r=e[0].length-1;return e.map(function(e){return e.slice(0,r)})},s.core.Eval.rational_2d=function(e){return e.map(s.core.Eval.rational_1d)},s.core.Eval.weight_1d=function(e){var r=e[0].length-1;return e.map(function(e){return e[r]})},s.core.Eval.weight_2d=function(e){return e.map(s.core.Eval.weight_1d)},s.core.Eval.dehomogenize_1d=function(e){return e.map(s.core.Eval.dehomogenize)},s.core.Eval.dehomogenize_2d=function(e){return e.map(s.core.Eval.dehomogenize_1d)},s.core.Eval.homogenize_1d=function(e,r){for(var o=e.length,n=e[0].length,t=[],c=0,i=[],s=0;o>s;){var a=s++,u=[];i=e[a],c=r[a];for(var l=0;n>l;){var v=l++;u.push(i[v]*c)}u.push(c),t.push(u)}return t},s.core.Eval.homogenize_2d=function(e,r){for(var o=e.length,n=[],t=0;o>t;){var c=t++;n.push(s.core.Eval.homogenize_1d(e[c],r[c]))}return n},s.core.Eval.surface_derivs=function(e,r,o,n){var t=e.knotsU.length-e.degreeU-2,c=e.knotsV.length-e.degreeV-2;return s.core.Eval.surface_derivs_given_n_m(t,c,e,r,o,n)},s.core.Eval.surface_derivs_given_n_m=function(e,r,o,n,t,c){var i=o.degreeU,a=o.degreeV,u=o.controlPoints,l=o.knotsU,v=o.knotsV;if(!s.core.Eval.are_valid_relations(i,u.length,l.length)||!s.core.Eval.are_valid_relations(a,u[0].length,v.length))throw"Invalid relations between control points, knot vector, and n";var h,f=u[0][0].length;h=i>n?n:i;var d;d=a>n?n:a;for(var _=s.core.Vec.zeros3d(h+1,d+1,f),m=s.core.Eval.knot_span_given_n(e,i,t,l),g=s.core.Eval.knot_span_given_n(r,a,c,v),p=s.core.Eval.deriv_basis_functions_given_n_i(m,t,i,e,l),V=s.core.Eval.deriv_basis_functions_given_n_i(g,c,a,r,v),E=s.core.Vec.zeros2d(a+1,f),k=0,M=0,y=h+1;y>M;){for(var b=M++,z=0,P=a+1;P>z;){var w=z++;E[w]=s.core.Vec.zeros1d(f);for(var U=0,x=i+1;x>U;){var D=U++;E[w]=s.core.Vec.add(E[w],s.core.Vec.mul(p[b][D],u[m-i+D][g-a+w]))}}var T=n-b;k=d>T?T:d;for(var I=0,C=k+1;C>I;){var S=I++;_[b][S]=s.core.Vec.zeros1d(f);for(var N=0,B=a+1;B>N;){var A=N++;_[b][S]=s.core.Vec.add(_[b][S],s.core.Vec.mul(V[S][A],E[A]))}}}return _},s.core.Eval.surface_point=function(e,r,o){var n=e.knotsU.length-e.degreeU-2,t=e.knotsV.length-e.degreeV-2;return s.core.Eval.surface_point_given_n_m(n,t,e,r,o)},s.core.Eval.surface_point_given_n_m=function(e,r,o,n,t){var c=o.degreeU,i=o.degreeV,a=o.controlPoints,u=o.knotsU,l=o.knotsV;if(!s.core.Eval.are_valid_relations(c,a.length,u.length)||!s.core.Eval.are_valid_relations(i,a[0].length,l.length))throw"Invalid relations between control points, knot vector, and n";for(var v=a[0][0].length,h=s.core.Eval.knot_span_given_n(e,c,n,u),f=s.core.Eval.knot_span_given_n(r,i,t,l),d=s.core.Eval.basis_functions_given_knot_span_index(h,n,c,u),_=s.core.Eval.basis_functions_given_knot_span_index(f,t,i,l),m=h-c,g=f,p=s.core.Vec.zeros1d(v),V=s.core.Vec.zeros1d(v),E=0,k=i+1;k>E;){var M=E++;V=s.core.Vec.zeros1d(v),g=f-i+M;for(var y=0,b=c+1;b>y;){var z=y++;V=s.core.Vec.add(V,s.core.Vec.mul(d[z],a[m+z][g]))}p=s.core.Vec.add(p,s.core.Vec.mul(_[M],V))}return p},s.core.Eval.curve_derivs=function(e,r,o){var n=e.knots.length-e.degree-2;return s.core.Eval.curve_derivs_given_n(n,e,r,o)},s.core.Eval.curve_derivs_given_n=function(e,r,o,n){var t=r.degree,c=r.controlPoints,i=r.knots;if(!s.core.Eval.are_valid_relations(t,c.length,i.length))throw"Invalid relations between control points, knot vector, and n";var a,u=c[0].length;a=t>n?n:t;for(var l=s.core.Vec.zeros2d(a+1,u),v=s.core.Eval.knot_span_given_n(e,t,o,i),h=s.core.Eval.deriv_basis_functions_given_n_i(v,o,t,a,i),f=0,d=a+1;d>f;)for(var _=f++,m=0,g=t+1;g>m;){var p=m++;l[_]=s.core.Vec.add(l[_],s.core.Vec.mul(h[_][p],c[v-t+p]))}return l},s.core.Eval.curve_point=function(e,r){var o=e.knots.length-e.degree-2;return s.core.Eval.curve_point_given_n(o,e,r)},s.core.Eval.are_valid_relations=function(e,r,o){return 0==r+e+1-o},s.core.Eval.curve_point_given_n=function(e,r,o){var n=r.degree,t=r.controlPoints,c=r.knots;if(!s.core.Eval.are_valid_relations(n,t.length,c.length))throw"Invalid relations between control points, knot Array, and n";for(var i=s.core.Eval.knot_span_given_n(e,n,o,c),a=s.core.Eval.basis_functions_given_knot_span_index(i,o,n,c),u=s.core.Vec.zeros1d(t[0].length),l=0,v=n+1;v>l;){var h=l++;u=s.core.Vec.add(u,s.core.Vec.mul(a[h],t[i-n+h]))}return u},s.core.Eval.deriv_basis_functions=function(e,r,o){var n=s.core.Eval.knot_span(r,e,o),t=o.length-1,c=t-r-1;return s.core.Eval.deriv_basis_functions_given_n_i(n,e,r,c,o)},s.core.Eval.deriv_basis_functions_given_n_i=function(e,r,o,n,t){var c=s.core.Vec.zeros2d(o+1,o+1),i=s.core.Vec.zeros1d(o+1),a=s.core.Vec.zeros1d(o+1),u=0,l=0;c[0][0]=1;for(var v=1,h=o+1;h>v;){var f=v++;i[f]=r-t[e+1-f],a[f]=t[e+f]-r,u=0;for(var d=0;f>d;){var _=d++;c[f][_]=a[_+1]+i[f-_],l=c[_][f-1]/c[f][_],c[_][f]=u+a[_+1]*l,u=i[f-_]*l}c[f][f]=u}for(var m=s.core.Vec.zeros2d(n+1,o+1),g=s.core.Vec.zeros2d(2,o+1),p=0,V=1,E=0,k=0,M=0,y=0,b=0,z=0,P=o+1;P>z;){var w=z++;m[0][w]=c[w][o]}for(var U=0,x=o+1;x>U;){var D=U++;p=0,V=1,g[0][0]=1;for(var T=1,I=n+1;I>T;){var C=T++;E=0,k=D-C,M=o-C,D>=C&&(g[V][0]=g[p][0]/c[M+1][k],E=g[V][0]*c[k][M]),y=k>=-1?1:-k,b=M>=D-1?C-1:o-D;for(var S=y,N=b+1;N>S;){var B=S++;g[V][B]=(g[p][B]-g[p][B-1])/c[M+1][k+B],E+=g[V][B]*c[k+B][M]}M>=D&&(g[V][C]=-g[p][C-1]/c[M+1][D],E+=g[V][C]*c[D][M]),m[C][D]=E;var A=p;p=V,V=A}}for(var L=o,O=1,R=n+1;R>O;){for(var q=O++,F=0,K=o+1;K>F;){var Y=F++;m[q][Y]*=L}L*=o-q}return m},s.core.Eval.basis_functions=function(e,r,o){var n=s.core.Eval.knot_span(r,e,o);return s.core.Eval.basis_functions_given_knot_span_index(n,e,r,o)},s.core.Eval.basis_functions_given_knot_span_index=function(e,r,o,n){var t=s.core.Vec.zeros1d(o+1),c=s.core.Vec.zeros1d(o+1),i=s.core.Vec.zeros1d(o+1),a=0,u=0;t[0]=1;for(var l=1,v=o+1;v>l;){var h=l++;c[h]=r-n[e+1-h],i[h]=n[e+h]-r,a=0;for(var f=0;h>f;){var d=f++;u=t[d]/(i[d+1]+c[h-d]),t[d]=a+i[d+1]*u,a=c[h-d]*u}t[h]=a}return t},s.core.Eval.knot_span=function(e,r,o){var n=o.length-1,t=n-e-1;return s.core.Eval.knot_span_given_n(t,e,r,o)},s.core.Eval.knot_span_given_n=function(e,r,o,n){if(o>=n[e+1])return e;if(n[r]>o)return r;for(var t=r,c=e+1,i=Math.floor((t+c)/2);n[i]>o||o>=n[i+1];)n[i]>o?c=i:t=i,i=Math.floor((t+c)/2);return i},s.core.Intersect=e.core.Intersect=function(){},s.core.Intersect.rays=function(e,r,o,n){var t=s.core.Vec.dot(r,n),c=s.core.Vec.dot(r,o),i=s.core.Vec.dot(r,e),a=s.core.Vec.dot(n,o),u=s.core.Vec.dot(n,e),l=s.core.Vec.dot(r,r),v=s.core.Vec.dot(n,n),h=l*v-t*t;if(Math.abs(h)<s.core.Constants.EPSILON)return null;var f=t*(c-i)-l*(a-u),d=f/h,_=(c-i+d*t)/l;return[_,d]},s.core.Make=e.core.Make=function(){},s.core.Make.sweep1_surface=function(e,r){for(var o=s.core.Eval.rational_curve_point(r,0),n=1/r.controlPoints.length,t=[],c=[],i=s.core.Eval.weight_1d(r.controlPoints),a=s.core.Eval.weight_1d(e.controlPoints),u=s.core.Eval.dehomogenize_1d(e.controlPoints),l=0,v=r.controlPoints.length;v>l;){for(var h=l++,f=s.core.Eval.rational_curve_point(r,h*n),d=s.core.Vec.sub(f,o),_=[],m=[],g=0,p=e.controlPoints.length;p>g;){var V=g++;_.push(s.core.Vec.add(d,u[V])),m.push(a[V]*i[h])}t.push(_),c.push(m)}return new s.core.types.SurfaceData(r.degree,e.degree,r.knots,e.knots,s.core.Eval.homogenize_2d(t,c))},s.core.Make.ellipse_arc=function(e,r,o,n,t,c,i){c>i&&(i=2*Math.PI+c);var a=i-c,u=0;u=Math.PI/2>=a?1:Math.PI>=a?2:3*Math.PI/2>=a?3:4;var l=a/u,v=Math.cos(l/2),h=s.core.Vec.add(e,s.core.Vec.add(s.core.Vec.mul(n*Math.cos(c),r),s.core.Vec.mul(t*Math.sin(c),o))),f=s.core.Vec.sub(s.core.Vec.mul(Math.cos(c),o),s.core.Vec.mul(Math.sin(c),r)),d=[],_=s.core.Vec.zeros1d(2*u+3),m=0,g=c,p=s.core.Vec.zeros1d(2*u);d[0]=h,p[0]=1;for(var V=1,E=u+1;E>V;){var k=V++;g+=l;var M=s.core.Vec.add(e,s.core.Vec.add(s.core.Vec.mul(n*Math.cos(g),r),s.core.Vec.mul(t*Math.sin(g),o)));p[m+2]=1,d[m+2]=M;var y=s.core.Vec.sub(s.core.Vec.mul(Math.cos(g),o),s.core.Vec.mul(Math.sin(g),r)),b=s.core.Intersect.rays(h,s.core.Vec.mul(1/s.core.Vec.norm(f),f),M,s.core.Vec.mul(1/s.core.Vec.norm(y),y)),z=s.core.Vec.add(h,s.core.Vec.mul(b[0],f));p[m+1]=v,d[m+1]=z,m+=2,u>k&&(h=M,f=y)}for(var P=2*u+1,w=0;3>w;){var U=w++;_[U]=0,_[U+P]=1}switch(u){case 2:_[3]=_[4]=.5;break;case 3:_[3]=_[4]=.3333333333333333,_[5]=_[6]=.6666666666666666;break;case 4:_[3]=_[4]=.25,_[5]=_[6]=.5,_[7]=_[8]=.75}return new s.core.types.CurveData(2,_,s.core.Eval.homogenize_1d(d,p))},s.core.Make.arc=function(e,r,o,n,t,c){return s.core.Make.ellipse_arc(e,r,o,n,n,t,c)},s.core.Make.polyline_curve=function(e){for(var r=[0,0],o=0,n=0,t=e.length-1;t>n;){var c=n++;o+=s.core.Vec.dist(e[c],e[c+1]),r.push(o)}r.push(o),r=s.core.Vec.mul(1/o,r);for(var i,a=[],u=0,l=e.length;l>u;)u++,a.push(1);return i=a,new s.core.types.CurveData(1,r,s.core.Eval.homogenize_1d(e.slice(0),i))},s.core.Make.extruded_surface=function(e,r,o){for(var n=[[],[],[]],t=[[],[],[]],c=s.core.Eval.dehomogenize_1d(o.controlPoints),i=s.core.Eval.weight_1d(o.controlPoints),a=s.core.Vec.mul(r,e),u=s.core.Vec.mul(.5*r,e),l=0,v=c.length;v>l;){var h=l++;n[2][h]=c[h],n[1][h]=s.core.Vec.add(u,c[h]),n[0][h]=s.core.Vec.add(a,c[h]),t[0][h]=i[h],t[1][h]=i[h],t[2][h]=i[h]}return new s.core.types.SurfaceData(2,o.degree,[0,0,0,1,1,1],o.knots,s.core.Eval.homogenize_2d(n,t))},s.core.Make.cylinder_surface=function(e,r,o,n,t){var c=s.core.Vec.cross(e,r);2*Math.PI;var i=s.core.Make.arc(o,r,c,t,0,2*Math.PI);return s.core.Make.extruded_surface(e,n,i)},s.core.Make.revolved_surface=function(e,r,o,n){var t,c,i=s.core.Eval.dehomogenize_1d(n.controlPoints),a=s.core.Eval.weight_1d(n.controlPoints);Math.PI/2>=o?(t=1,c=s.core.Vec.zeros1d(6+2*(t-1))):Math.PI>=o?(t=2,c=s.core.Vec.zeros1d(6+2*(t-1)),c[3]=c[4]=.5):3*Math.PI/2>=o?(t=3,c=s.core.Vec.zeros1d(6+2*(t-1)),c[3]=c[4]=.3333333333333333,c[5]=c[6]=.6666666666666666):(t=4,c=s.core.Vec.zeros1d(6+2*(t-1)),c[3]=c[4]=.25,c[5]=c[6]=.5,c[7]=c[8]=.75);for(var u=o/t,l=3+2*(t-1),v=0;3>v;){var h=v++;c[h]=0,c[l+h]=1}for(var f=Math.cos(u/2),d=0,_=s.core.Vec.zeros1d(t+1),m=s.core.Vec.zeros1d(t+1),g=s.core.Vec.zeros3d(2*t+1,i.length,3),p=s.core.Vec.zeros2d(2*t+1,i.length),V=1,E=t+1;E>V;){var k=V++;d+=u,m[k]=Math.cos(d),_[k]=Math.sin(d)}for(var M=0,y=i.length;y>M;){var b=M++,z=s.core.Trig.closest_point_on_ray(i[b],e,r),P=s.core.Vec.sub(i[b],z),w=s.core.Vec.norm(P),U=s.core.Vec.cross(r,P);w>s.core.Constants.EPSILON&&(P=s.core.Vec.mul(1/w,P),U=s.core.Vec.mul(1/w,U)),g[0][b]=i[b];var x=i[b];p[0][b]=a[b];for(var D=U,T=0,I=1,C=t+1;C>I;){var S,N=I++;S=0==w?z:s.core.Vec.add(z,s.core.Vec.add(s.core.Vec.mul(w*m[N],P),s.core.Vec.mul(w*_[N],U))),g[T+2][b]=S,p[T+2][b]=a[b];var B=s.core.Vec.sub(s.core.Vec.mul(m[N],U),s.core.Vec.mul(_[N],P));if(0==w)g[T+1][b]=z;else{var A=s.core.Intersect.rays(x,s.core.Vec.mul(1/s.core.Vec.norm(D),D),S,s.core.Vec.mul(1/s.core.Vec.norm(B),B)),L=s.core.Vec.add(x,s.core.Vec.mul(A[0],D));g[T+1][b]=L}p[T+1][b]=f*a[b],T+=2,t>N&&(x=S,D=B)}}return new s.core.types.SurfaceData(2,n.degree,c,n.knots,s.core.Eval.homogenize_2d(g,p))},s.core.Make.sphere_surface=function(e,r,o,n){var t=s.core.Make.arc(e,s.core.Vec.mul(-1,r),o,n,0,Math.PI);return s.core.Make.revolved_surface(e,r,2*Math.PI,t)},s.core.Make.cone_surface=function(e,r,o,n,t){var c=2*Math.PI,i=1,a=[s.core.Vec.add(o,s.core.Vec.mul(n,e)),s.core.Vec.add(o,s.core.Vec.mul(t,r))],u=[0,0,1,1],l=[1,1],v=new s.core.types.CurveData(i,u,s.core.Eval.homogenize_1d(a,l));return s.core.Make.revolved_surface(o,e,c,v)},s.core.Make.rational_interp_curve=function(e,r,o,n){if(null==r&&(r=3),r+1>e.length)throw"You need to supply at least degree + 1 points!";for(var t=[0],c=1,i=e.length;i>c;){var a=c++,u=s.core.Vec.norm(s.core.Vec.sub(e[a],e[a-1])),l=t[t.length-1];t.push(l+u)}for(var v=t[t.length-1],h=0,f=t.length;f>h;){var d=h++;t[d]=t[d]/v}var _,m=s.core.Vec.rep(r+1,0),g=null!=o&&null!=n;_=g?0:1;var p;p=g?t.length-r+1:t.length-r;for(var V=_;p>V;){for(var E=V++,k=0,M=0;r>M;){var y=M++;k+=t[E+y]}m.push(1/r*k)}var b,z=m.concat(s.core.Vec.rep(r+1,1)),P=[];b=g?e.length+1:e.length-1;var w;w=g?1:0;var U;U=g?e.length-(r-1):e.length-(r+1);for(var x=0;t.length>x;){var D=t[x];++x;var T=s.core.Eval.knot_span_given_n(b,r,D,z),I=s.core.Eval.basis_functions_given_knot_span_index(T,D,r,z),C=T-r,S=s.core.Vec.zeros1d(C),N=s.core.Vec.zeros1d(U-C);P.push(S.concat(I).concat(N))}if(g){var B=P[0].length-2,A=[-1,1].concat(s.core.Vec.zeros1d(B)),L=s.core.Vec.zeros1d(B).concat([-1,1]);s.core.Utils.spliceAndInsert(P,1,0,A),s.core.Utils.spliceAndInsert(P,P.length-1,0,L)}var O=e[0].length,R=[];(1-z[z.length-r-2])/r,z[r+1]/r,console.log(P);for(var q=0;O>q;){var F,K=[q++];F=e.map(function(e){return function(r){return r[e[0]]}}(K)),console.log(F);var Y=s.core.Mat.solve(P,F);R.push(Y)}var H=s.core.Vec.transpose(R),Z=s.core.Vec.rep(H.length,1);return new s.core.types.CurveData(r,z,s.core.Eval.homogenize_1d(H,Z))},s.core.LUDecomp=function(e,r){this.LU=e,this.P=r},s.core.Mat=e.core.Mat=function(){},s.core.Mat.solve=function(e,r){return s.core.Mat.LUsolve(s.core.Mat.LU(e),r)},s.core.Mat.LUsolve=function(e,r){var o,n,t,c,i,s=e.LU,a=s.length,u=r.slice(),l=e.P;for(o=a-1;-1!=o;)u[o]=r[o],--o;for(o=0;a>o;){for(t=l[o],l[o]!=o&&(i=u[o],u[o]=u[t],u[t]=i),c=s[o],n=0;o>n;)u[o]-=u[n]*c[n],++n;++o}for(o=a-1;o>=0;){for(c=s[o],n=o+1;a>n;)u[o]-=u[n]*c[n],++n;u[o]/=c[o],--o}return u},s.core.Mat.LU=function(e){Math.abs;var r,o,n,t,c,i,a,u,l,v=e.length,h=v-1,f=[];for(n=0;v>n;){for(a=n,i=e[n],l=Math.abs(i[n]),o=n+1;v>o;)t=Math.abs(e[o][n]),t>l&&(l=t,a=o),++o;for(f[n]=a,a!=n&&(e[n]=e[a],e[a]=i,i=e[n]),c=i[n],r=n+1;v>r;)e[r][n]/=c,++r;for(r=n+1;v>r;){for(u=e[r],o=n+1;h>o;)u[o]-=u[n]*i[o],++o,u[o]-=u[n]*i[o],++o;o==h&&(u[o]-=u[n]*i[o]),++r}++n}return new s.core.LUDecomp(e,f)},s.core.Mesh=function(){},s.core.KnotMultiplicity=e.core.KnotMultiplicity=function(e,r){this.knot=e,this.mult=r},s.core.KnotMultiplicity.prototype={inc:function(){this.mult++}},s.core.Modify=e.core.Modify=function(){},s.core.Modify.surface_knot_refine=function(e,r,o){var n,t,c,i=[];o?(c=e.controlPoints,n=e.knotsV,t=e.degreeV):(c=s.core.Vec.transpose(e.controlPoints),n=e.knotsU,t=e.degreeU);for(var a=null,u=0;c.length>u;){var l=c[u];++u,a=s.core.Modify.curve_knot_refine(new s.core.types.CurveData(t,n,l),r),i.push(a.controlPoints)}var v=a.knots;return o?new s.core.types.SurfaceData(e.degreeU,e.degreeV,e.knotsU.slice(),v,i):(i=s.core.Vec.transpose(i),new s.core.types.SurfaceData(e.degreeU,e.degreeV,v,e.knotsV.slice(),i))},s.core.Modify.surface_split=function(e,r,o){null==o&&(o=!1);var n,t,c;o?(c=e.controlPoints,n=e.knotsV,t=e.degreeV):(c=s.core.Vec.transpose(e.controlPoints),n=e.knotsU,t=e.degreeU);for(var i,a=[],u=0,l=t+1;l>u;)u++,a.push(r);i=a;for(var v=[],h=[],f=s.core.Eval.knot_span(t,r,n),d=null,_=0;c.length>_;){var m=c[_];++_,d=s.core.Modify.curve_knot_refine(new s.core.types.CurveData(t,n,m),i),v.push(d.controlPoints.slice(0,f+1)),h.push(d.controlPoints.slice(f+1))}var g=d.knots.slice(0,f+t+2),p=d.knots.slice(f+1);return o?[new s.core.types.SurfaceData(e.degreeU,t,e.knotsU.slice(),g,v),new s.core.types.SurfaceData(e.degreeU,t,e.knotsU.slice(),p,h)]:(v=s.core.Vec.transpose(v),h=s.core.Vec.transpose(h),[new s.core.types.SurfaceData(t,e.degreeV,g,e.knotsV.slice(),v),new s.core.types.SurfaceData(t,e.degreeV,p,e.knotsV.slice(),h)])},s.core.Modify.curve_bezier_decompose=function(e){for(var r=e.degree,o=e.controlPoints,n=e.knots,t=s.core.Modify.knot_multiplicities(n),c=r+1,i=0;t.length>i;){var a=t[i];if(++i,c>a.mult){var u=s.core.Vec.rep(c-a.mult,a.knot),l=s.core.Modify.curve_knot_refine(new s.core.types.CurveData(r,n,o),u);n=l.knots,o=l.controlPoints}}n.length/c-1;for(var v=2*c,h=[],f=0;o.length>f;){var d=n.slice(f,f+v),_=o.slice(f,f+c);h.push(new s.core.types.CurveData(r,d,_)),f+=c}return h},s.core.Modify.knot_multiplicities=function(e){for(var r=[new s.core.KnotMultiplicity(e[0],0)],o=r[0],n=0;e.length>n;){var t=e[n];++n,Math.abs(t-o.knot)>s.core.Constants.EPSILON&&(o=new s.core.KnotMultiplicity(t,0),r.push(o)),o.inc()}return r},s.core.Modify.curve_split=function(e,r){var o=e.degree;e.controlPoints;for(var n,t=e.knots,c=[],i=0,a=o+1;a>i;)i++,c.push(r);n=c;var u=s.core.Modify.curve_knot_refine(e,n),l=s.core.Eval.knot_span(o,r,t),v=u.knots.slice(0,l+o+2),h=u.knots.slice(l+1),f=u.controlPoints.slice(0,l+1),d=u.controlPoints.slice(l+1);return[new s.core.types.CurveData(o,v,f),new s.core.types.CurveData(o,h,d)]},s.core.Modify.curve_knot_refine=function(e,r){for(var o=e.degree,n=e.controlPoints,t=e.knots,c=n.length-1,i=c+o+1,a=r.length-1,u=s.core.Eval.knot_span(o,r[0],t),l=s.core.Eval.knot_span(o,r[a],t),v=[],h=[],f=0,d=u-o+1;d>f;){var _=f++;v[_]=n[_]}for(var m=l-1,g=c+1;g>m;){var p=m++;v[p+a+1]=n[p]}for(var V=0,E=u+1;E>V;){var k=V++;h[k]=t[k]}for(var M=l+o,y=i+1;y>M;){var b=M++;h[b+a+1]=t[b]}for(var z=l+o-1,P=l+o+a,w=a;w>=0;){for(;r[w]<=t[z]&&z>u;)v[P-o-1]=n[z-o-1],h[P]=t[z],P-=1,z-=1;v[P-o-1]=v[P-o];for(var U=1,x=o+1;x>U;){var D=U++,T=P-o+D,I=h[P+D]-r[w];Math.abs(I)<s.core.Constants.EPSILON?v[T-1]=v[T]:(I/=h[P+D]-t[z-o+D],v[T-1]=s.core.Vec.add(s.core.Vec.mul(I,v[T-1]),s.core.Vec.mul(1-I,v[T])))}h[P]=r[w],P-=1,w--}return new s.core.types.CurveData(o,h,v)},s.core.Modify.curve_knot_insert=function(e,r,o){for(var n=e.degree,t=e.controlPoints,c=e.knots,i=0,a=t.length,u=s.core.Eval.knot_span(n,r,c),l=[],v=[],h=[],f=1,d=u+1;d>f;){var _=f++;v[_]=c[_]}for(var m=1,g=o+1;g>m;){var p=m++;v[u+p]=r}for(var V=u+1,E=c.length;E>V;){var k=V++;v[k+o]=c[k]}for(var M=0,y=u-n+1;y>M;){var b=M++;h[b]=t[b]}for(var z=u-i;a>z;){var P=z++;h[P+o]=t[P]}for(var w=0,U=n-i+1;U>w;){var x=w++;l[x]=t[u-n+x]}for(var D=0,T=0,I=1,C=o+1;C>I;){var S=I++;D=u-n+S;for(var N=0,B=n-S-i+1;B>N;){var A=N++;T=(r-c[D+A])/(c[A+u+1]-c[D+A]),l[A]=s.core.Vec.add(s.core.Vec.mul(T,l[A+1]),s.core.Vec.mul(1-T,l[A]))}h[D]=l[0],h[u+o-S-i]=l[n-S-i]}for(var L=D+1,O=u-i;O>L;){var R=L++;h[R]=l[R-D]}return new s.core.types.CurveData(n,v,h)},s.core.Tess=e.core.Tess=function(){},s.core.Tess.rational_curve_regular_sample=function(e,r,o){return s.core.Tess.rational_curve_regular_sample_range(e,e.knots[0],s.core.Utils.last(e.knots),r,o)},s.core.Tess.rational_curve_regular_sample_range=function(e,r,o,n,t){1>n&&(n=2);for(var c=[],i=(o-r)/(n-1),a=0,u=0;n>u;){var l=u++;a=r+i*l,t?c.push([a].concat(s.core.Eval.rational_curve_point(e,a))):c.push(s.core.Eval.rational_curve_point(e,a))}return c},s.core.Tess.rational_curve_adaptive_sample=function(e,r,o){if(1==e.degree){if(o){for(var n=[],t=0,c=e.controlPoints.length;c>t;){var i=t++;n.push([e.knots[i+1]].concat(s.core.Eval.dehomogenize(e.controlPoints[i])))}return n}return e.controlPoints.map(s.core.Eval.dehomogenize)}return s.core.Tess.rational_curve_adaptive_sample_range(e,e.knots[0],s.core.Utils.last(e.knots),r,o)},s.core.Tess.rational_curve_adaptive_sample_range=function(e,r,o,n,t){var c=s.core.Eval.rational_curve_point(e,r),i=s.core.Eval.rational_curve_point(e,o),a=.5+.2*Math.random(),u=r+(o-r)*a,l=s.core.Eval.rational_curve_point(e,u),v=s.core.Vec.sub(c,i),h=s.core.Vec.sub(c,l);if(n>s.core.Vec.dot(v,v)&&s.core.Vec.dot(h,h)>n||!s.core.Trig.three_points_are_flat(c,l,i,n)){var f=r+.5*(o-r),d=s.core.Tess.rational_curve_adaptive_sample_range(e,r,f,n,t),_=s.core.Tess.rational_curve_adaptive_sample_range(e,f,o,n,t);return d.slice(0,-1).concat(_)}return t?[[r].concat(c),[o].concat(i)]:[c,i]},s.core.Tess.tessellate_rational_surface_naive=function(e,r,o){1>r&&(r=1),1>o&&(o=1),e.degreeU,e.degreeV,e.controlPoints;for(var n=e.knotsU,t=e.knotsV,c=s.core.Utils.last(n)-n[0],i=s.core.Utils.last(t)-t[0],a=c/r,u=i/o,l=[],v=[],h=[],f=0,d=r+1;d>f;)for(var _=f++,m=0,g=o+1;g>m;){var p=m++,V=_*a,E=p*u;v.push([V,E]);var k=s.core.Eval.rational_surface_derivs(e,1,V,E),M=k[0][0];l.push(M);var y=s.core.Vec.normalized(s.core.Vec.cross(k[1][0],k[0][1]));h.push(y)}for(var b=[],z=0;r>z;)for(var P=z++,w=0;o>w;){var U=w++,x=P*(o+1)+U,D=(P+1)*(o+1)+U,T=D+1,I=x+1,C=[x,D,T],S=[x,T,I];b.push(C),b.push(S)}return new s.core.types.MeshData(b,l,h,v)},s.core.Tess.divide_rational_surface_adaptive=function(e,r){null==r&&(r=new s.core.types.AdaptiveRefinementOptions),r.minDivsU=null!=r.minDivsU?r.minDivsU:1,r.minDivsU=null!=r.minDivsV?r.minDivsV:1,r.refine=null!=r.refine?r.refine:!0;var o,n=3*(e.controlPoints.length-1),t=3*(e.controlPoints[0].length-1);o=r.minDivsU=r.minDivsU>n?r.minDivsU:n;var c;c=r.minDivsV=r.minDivsV>t?r.minDivsV:t;for(var i=s.core.Utils.last(e.knotsU),a=e.knotsU[0],u=s.core.Utils.last(e.knotsV),l=e.knotsV[0],v=(i-a)/o,h=(u-l)/c,f=[],d=[],_=0,m=c+1;m>_;){for(var g=_++,p=[],V=0,E=o+1;E>V;){var k=V++,M=a+v*k,y=l+h*g,b=s.core.Eval.rational_surface_derivs(e,1,M,y),z=s.core.Vec.normalized(s.core.Vec.cross(b[0][1],b[1][0]));p.push(new s.core.types.SurfacePoint(b[0][0],z,[M,y],-1,s.core.Vec.isZero(z)))}d.push(p)}for(var P=0;c>P;)for(var w=P++,U=0;o>U;){var x=U++,D=[d[c-w-1][x],d[c-w-1][x+1],d[c-w][x+1],d[c-w][x]];f.push(new s.core.types.AdaptiveRefinementNode(e,D))}if(!r.refine)return f;for(var T=0;c>T;)for(var I=T++,C=0;o>C;){var S=C++,N=I*o+S,B=s.core.Tess.north(N,I,S,o,c,f),A=s.core.Tess.east(N,I,S,o,c,f),L=s.core.Tess.south(N,I,S,o,c,f),O=s.core.Tess.west(N,I,S,o,c,f);f[N].neighbors=[L,A,B,O],f[N].divide(r)}return f},s.core.Tess.north=function(e,r,o,n,t,c){return 0==r?null:c[e-n]},s.core.Tess.south=function(e,r,o,n,t,c){return r==t-1?null:c[e+n]},s.core.Tess.east=function(e,r,o,n,t,c){return o==n-1?null:c[e+1]},s.core.Tess.west=function(e,r,o,n,t,c){return 0==o?null:c[e-1]},s.core.Tess.triangulate_adaptive_refinement_node_tree=function(e){for(var r=s.core.types.MeshData.empty(),o=0;e.length>o;){var n=e[o];++o,n.triangulate(r)}return r},s.core.Tess.tessellate_rational_surface_adaptive=function(e,r){var o=s.core.Tess.divide_rational_surface_adaptive(e,r);return s.core.Tess.triangulate_adaptive_refinement_node_tree(o)},s.core.Trig=e.core.Trig=function(){},s.core.Trig.dist_to_seg=function(e,r,o){var n=s.core.Vec.sub(o,e),t=s.core.Vec.norm(n),c=s.core.Vec.sub(r,e);if(s.core.Constants.TOLERANCE>t)return s.core.Vec.norm(c);var i=s.core.Vec.mul(1/t,n),a=s.core.Vec.dot(c,i),u=s.core.Vec.add(e,s.core.Vec.mul(a,i));return s.core.Vec.dist(u,r)},s.core.Trig.closest_point_on_ray=function(e,r,o){var n=s.core.Vec.sub(e,r),t=s.core.Vec.dot(n,o),c=s.core.Vec.add(r,s.core.Vec.mul(t,o));return c},s.core.Trig.dist_to_ray=function(e,r,o){var n=s.core.Trig.closest_point_on_ray(e,r,o),t=s.core.Vec.sub(n,e);return s.core.Vec.norm(t)},s.core.Trig.three_points_are_flat=function(e,r,o,n){var t=s.core.Vec.sub(r,e),c=s.core.Vec.sub(o,e),i=s.core.Vec.cross(t,c),a=s.core.Vec.dot(i,i);return n>a},s.core.Utils=function(){},s.core.Utils.last=function(e){return e[e.length-1]},s.core.Utils.spliceAndInsert=function(e,r,o,n){e.splice(r,o),e.splice(r,0,n)},s.core.Vec=e.core.Vec=function(){},s.core.Vec.normalized=function(e){return s.core.Vec.div(e,s.core.Vec.normSquared(e))},s.core.Vec.cross=function(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]},s.core.Vec.transpose=function(e){if(0==e.length)return[];for(var r=[],o=0,n=e[0].length;n>o;){var t=o++;r.push(function(){for(var r,o=[],n=0,c=e.length;c>n;){var i=n++;o.push(e[i][t])}return r=o}(this))}return r},s.core.Vec.dist=function(e,r){return s.core.Vec.norm(s.core.Vec.sub(e,r))},s.core.Vec.distSquared=function(e,r){return s.core.Vec.normSquared(s.core.Vec.sub(e,r))},s.core.Vec.sum=function(e){return t.fold(e,function(e,r){return r+e},0)},s.core.Vec.norm=function(e){return Math.sqrt(s.core.Vec.normSquared(e))},s.core.Vec.normSquared=function(e){return t.fold(e,function(e,r){return r+e*e},0)},s.core.Vec.rep=function(e,r){for(var o=[],n=0;e>n;)n++,o.push(r);return o},s.core.Vec.zeros1d=function(e){for(var r=[],o=0;e>o;)o++,r.push(0);return r},s.core.Vec.zeros2d=function(e,r){for(var o=[],n=0;e>n;)n++,o.push(s.core.Vec.zeros1d(r));return o},s.core.Vec.zeros3d=function(e,r,o){for(var n=[],t=0;e>t;)t++,n.push(s.core.Vec.zeros2d(r,o));return n},s.core.Vec.dot=function(e,r){for(var o=0,n=0,t=e.length;t>n;){var c=n++;o+=e[c]*r[c]}return o},s.core.Vec.add=function(e,r){for(var o=[],n=0,t=e.length;t>n;){var c=n++;o.push(e[c]+r[c])}return o},s.core.Vec.mul=function(e,r){for(var o=[],n=0,t=r.length;t>n;){var c=n++;o.push(e*r[c])}return o},s.core.Vec.div=function(e,r){for(var o=[],n=0,t=e.length;t>n;){var c=n++;o.push(e[c]/r)}return o},s.core.Vec.sub=function(e,r){for(var o=[],n=0,t=e.length;t>n;){var c=n++;o.push(e[c]-r[c])}return o},s.core.Vec.isZero=function(e){for(var r=0,o=e.length;o>r;){var n=r++;if(Math.abs(e[n])>s.core.Constants.TOLERANCE)return!1}return!0},s.core.types={},s.core.types.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.085},s.core.types.AdaptiveRefinementNode=e.core.AdaptiveRefinementNode=function(e,r,o){if(this.srf=e,this.neighbors=null==o?[null,null,null,null]:o,this.corners=r,null==this.corners){var n=e.knotsU[0],t=s.core.Utils.last(e.knotsU),c=e.knotsV[0],i=s.core.Utils.last(e.knotsV);this.corners=[s.core.types.SurfacePoint.fromUv(n,c),s.core.types.SurfacePoint.fromUv(t,c),s.core.types.SurfacePoint.fromUv(t,i),s.core.types.SurfacePoint.fromUv(n,i)]}},s.core.types.AdaptiveRefinementNode.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var e=0;4>e;){var r=e++;if(null==this.corners[r].point){var o=this.corners[r];this.evalSrf(o.uv[0],o.uv[1],o)}}},evalSrf:function(e,r,o){var n=s.core.Eval.rational_surface_derivs(this.srf,1,e,r),t=n[0][0],c=s.core.Vec.cross(n[0][1],n[1][0]),i=s.core.Vec.isZero(c);return i||(c=s.core.Vec.normalized(c)),null!=o?(o.degen=i,o.point=t,o.normal=c,o):new s.core.types.SurfacePoint(t,c,[e,r],-1,i)},getEdgeCorners:function(e){if(this.isLeaf())return[this.corners[e]];if(this.horizontal)switch(e){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(e){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(e){var r=[this.corners[e]];if(null==this.neighbors[e])return r;var o=this.neighbors[e].getEdgeCorners((e+2)%4),n=e%2,t=s.core.Constants.EPSILON,c=this,i=[function(e){return e.uv[0]>c.corners[0].uv[0]+t&&e.uv[0]<c.corners[2].uv[0]-t},function(e){return e.uv[1]>c.corners[0].uv[1]+t&&e.uv[1]<c.corners[2].uv[1]-t}],a=o.filter(i[n]);return a.reverse(),r.concat(a)},midpoint:function(e){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[e])return this.midPoints[e];
switch(e){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[e]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var e=this.corners.length,r=0;e>r;){var o=r++;if(this.corners[o],this.corners[o].degen){var n=this.corners[(o+1)%e],t=this.corners[(o+3)%e];this.corners[o].normal=n.degen?t.normal:n.normal}}},shouldDivide:function(e,r){if(e.minDepth>r)return!0;if(r>=e.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=s.core.Vec.normSquared(s.core.Vec.sub(this.corners[0].normal,this.corners[1].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(this.corners[2].normal,this.corners[3].normal))>e.normTol,this.splitHoriz=s.core.Vec.normSquared(s.core.Vec.sub(this.corners[1].normal,this.corners[2].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(this.corners[3].normal,this.corners[0].normal))>e.normTol,this.splitVert||this.splitHoriz)return!0;var o=this.center();return s.core.Vec.normSquared(s.core.Vec.sub(o.normal,this.corners[0].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(o.normal,this.corners[1].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(o.normal,this.corners[2].normal))>e.normTol||s.core.Vec.normSquared(s.core.Vec.sub(o.normal,this.corners[3].normal))>e.normTol},divide:function(e){null==e&&(e=new s.core.types.AdaptiveRefinementOptions),null==e.normTol&&(e.normTol=.085),null==e.minDepth&&(e.minDepth=0),null==e.maxDepth&&(e.maxDepth=10),this._divide(e,0,!0)},_divide:function(e,r,o){if(this.evalCorners(),this.shouldDivide(e,r)){if(r++,this.splitVert&&!this.splitHoriz?o=!1:!this.splitVert&&this.splitHoriz&&(o=!0),this.horizontal=o,this.horizontal){var n=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],t=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new s.core.types.AdaptiveRefinementNode(this.srf,n),new s.core.types.AdaptiveRefinementNode(this.srf,t)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var c=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],i=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new s.core.types.AdaptiveRefinementNode(this.srf,c),new s.core.types.AdaptiveRefinementNode(this.srf,i)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var a=0,u=this.children;u.length>a;){var l=u[a];++a,l._divide(e,r,!o)}}},triangulate:function(e){if(null==e&&(e=s.core.types.MeshData.empty()),this.isLeaf())return this.triangulateLeaf(e);for(var r=0,o=this.children;o.length>r;){var n=o[r];if(++r,null==n)break;n.triangulate(e)}return e},triangulateLeaf:function(e){for(var r=e.points.length,o=[],n=[],t=0,c=0;4>c;){var i=c++,s=this.getAllCorners(i);2==s.length&&(t=i+1);for(var a=0,u=s.length;u>a;){var l=a++;o.push(s[l])}}for(var v=0;o.length>v;){var h=o[v];++v,-1==h.id?(e.uvs.push(h.uv),e.points.push(h.point),e.normals.push(h.normal),h.id=r,n.push(r),r++):n.push(h.id)}if(4==o.length)return e.faces.push([n[0],n[3],n[1]]),e.faces.push([n[3],n[2],n[1]]),e;if(5==o.length){var f=n.length;return e.faces.push([n[t],n[(t+1)%f],n[(t+2)%f]]),e.faces.push([n[(t+4)%f],n[(t+3)%f],n[t]]),e.faces.push([n[t],n[(t+2)%f],n[(t+3)%f]]),e}var d=this.center();e.uvs.push(d.uv),e.points.push(d.point),e.normals.push(d.normal);for(var _=e.points.length-1,m=0,g=o.length-1;o.length>m;)e.faces.push([_,n[g],n[m]]),g=m++;return e}},s.core.types.CurveData=e.core.CurveData=function(e,r,o){this.degree=e,this.controlPoints=o,this.knots=r},s.core.types.MeshData=e.core.MeshData=function(e,r,o,n){this.faces=e,this.points=r,this.normals=o,this.uvs=n},s.core.types.MeshData.empty=function(){return new s.core.types.MeshData([],[],[],[])},s.core.types.SurfaceData=e.core.SurfaceData=function(e,r,o,n,t){this.degreeU=e,this.degreeV=r,this.knotsU=o,this.knotsV=n,this.controlPoints=t},s.core.types.SurfacePoint=function(e,r,o,n,t){null==t&&(t=!1),null==n&&(n=-1),this.uv=o,this.point=e,this.normal=r,this.id=n,this.degen=t},s.core.types.SurfacePoint.fromUv=function(e,r){return new s.core.types.SurfacePoint(null,null,[e,r])};var a=0;Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Math.isFinite=function(e){return isFinite(e)},Math.isNaN=function(e){return isNaN(e)},null==Array.prototype.map&&(Array.prototype.map=function(e){for(var r=[],o=0,n=this.length;n>o;){var t=o++;r[t]=e(this[t])}return r}),null==Array.prototype.filter&&(Array.prototype.filter=function(e){for(var r=[],o=0,n=this.length;n>o;){var t=o++,c=this[t];e(c)&&r.push(c)}return r}),s.BoundingBox.TOLERANCE=1e-4,s.core.Binomial.memo=new i.ds.IntMap,s.core.Constants.TOLERANCE=1e-6,s.core.Constants.EPSILON=1e-10,s.Init.main()})("undefined"!=typeof window?window:exports);