/*! verb 2015-07-06 */
if("object"!=typeof exports||void 0===exports)var verb=exports={};else var Worker=require("webworker-threads").Worker;if("object"!=typeof window){var global=this,window=global,lookup=function(a,b){var c=global;return a.split(".").forEach(function(a){c&&(c=c[a])}),c?c[b]:null};onmessage=function(a){var b=lookup(a.data.className,a.data.methodName);return b?void postMessage({result:b.apply(null,a.data.args),id:a.data.id}):console.error("could not find "+a.data.className+"."+a.data.methodName)}}!function(a,b){"use strict";function c(a,b){function c(){}c.prototype=a;var d=new c;for(var e in b)d[e]=b[e];return b.toString!==Object.prototype.toString&&(d.toString=b.toString),d}function d(a){return a instanceof Array?function(){return g.iter(a)}:"function"==typeof a.iterator?e(a,a.iterator):a.iterator}function e(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=Db++);var c;return null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__],null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c),c}b.topo=b.topo||{},b.geom=b.geom||{},b.exe=b.exe||{},b.core=b.core||{},b.promhx=b.promhx||{};var f=function(){return p.__string_rec(this,"")},g=function(){};g.__name__=["HxOverrides"],g.indexOf=function(a,b,c){var d=a.length;for(0>c&&(c+=d,0>c&&(c=0));d>c;){if(a[c]===b)return c;c++}return-1},g.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var h=function(){};h.__name__=["Lambda"],h.array=function(a){for(var b=[],c=d(a)();c.hasNext();){var e=c.next();b.push(e)}return b},h.fold=function(a,b,c){for(var e=d(a)();e.hasNext();){var f=e.next();c=b(f,c)}return c};var i=function(){this.length=0};i.__name__=["List"],i.prototype={add:function(a){var b=[a];null==this.h?this.h=b:this.q[1]=b,this.q=b,this.length++},pop:function(){if(null==this.h)return null;var a=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,a},isEmpty:function(){return null==this.h}},Math.__name__=["Math"];var j=function(){};j.__name__=["Type"],j.getClassName=function(a){var b=a.__name__;return null==b?null:b.join(".")};var k=function(){};k.__name__=["haxe","IMap"];var l=function(){};l.__name__=["haxe","Log"],l.trace=function(a,b){p.__trace(a,b)};var m=function(){this.h={}};m.__name__=["haxe","ds","IntMap"],m.__interfaces__=[k],m.prototype={set:function(a,b){this.h[a]=b},remove:function(a){return this.h.hasOwnProperty(a)?(delete this.h[a],!0):!1}};var n={__ename__:!0,__constructs__:["Some","None"]};n.Some=function(a){var b=["Some",0,a];return b.__enum__=n,b.toString=f,b},n.None=["None",1],n.None.toString=f,n.None.__enum__=n;var o=function(a){Error.call(this),this.val=a,this.message=String(a),Error.captureStackTrace&&Error.captureStackTrace(this,o)};o.__name__=["js","_Boot","HaxeError"],o.__super__=Error,o.prototype=c(Error.prototype,{});var p=function(){};p.__name__=["js","Boot"],p.__unhtml=function(a){return a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},p.__trace=function(b,c){var d;if(d=null!=c?c.fileName+":"+c.lineNumber+": ":"",d+=p.__string_rec(b,""),null!=c&&null!=c.customParams)for(var e=0,f=c.customParams;e<f.length;){var g=f[e];++e,d+=","+p.__string_rec(g,"")}var h;"undefined"!=typeof document&&null!=(h=document.getElementById("haxe:trace"))?h.innerHTML+=p.__unhtml(d)+"<br/>":"undefined"!=typeof a&&null!=a.log&&a.log(d)},p.__string_rec=function(a,b){if(null==a)return"null";if(b.length>=5)return"<...>";var c=typeof a;switch("function"==c&&(a.__name__||a.__ename__)&&(c="object"),c){case"object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];var d=a[0]+"(";b+="	";for(var e=2,f=a.length;f>e;){var g=e++;d+=2!=g?","+p.__string_rec(a[g],b):p.__string_rec(a[g],b)}return d+")"}var h=a.length,i="[";b+="	";for(var j=0;h>j;){var k=j++;i+=(k>0?",":"")+p.__string_rec(a[k],b)}return i+="]"}var l;try{l=a.toString}catch(m){return m instanceof o&&(m=m.val),"???"}if(null!=l&&l!=Object.toString&&"function"==typeof l){var n=a.toString();if("[object Object]"!=n)return n}var q=null,r="{\n";b+="	";var s=null!=a.hasOwnProperty;for(var q in a)(!s||a.hasOwnProperty(q))&&"prototype"!=q&&"__class__"!=q&&"__super__"!=q&&"__interfaces__"!=q&&"__properties__"!=q&&(2!=r.length&&(r+=", \n"),r+=b+q+" : "+p.__string_rec(a[q],b));return b=b.substring(1),r+="\n"+b+"}";case"function":return"<function>";case"string":return a;default:return String(a)}};var q=function(a){this._resolved=!1,this._pending=!1,this._errorPending=!1,this._errorHandled=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,null!=a&&q.link(a,this,function(a){return a})};q.__name__=["promhx","base","AsyncBase"],q.link=function(a,b,c){a._update.push({async:b,linkf:function(a){b.handleResolve(c(a))}}),q.immediateLinkUpdate(a,b,c)},q.immediateLinkUpdate=function(a,b,c){if(!a._errored||a._errorPending||a._error.length>0||b.handleError(a._errorVal),a._resolved&&!a._pending)try{b.handleResolve(c(a._val))}catch(d){d instanceof o&&(d=d.val),b.handleError(d)}},q.linkAll=function(a,b){for(var c=function(c,e,f){if(0==c.length||q.allFulfilled(c)){for(var g,h=[],i=d(a)();i.hasNext();){var j=i.next();h.push(j==e?f:j._val)}g=h,b.handleResolve(g)}},e=d(a)();e.hasNext();){var f=e.next();f._update.push({async:b,linkf:function(a,b,c){return function(d){a(b,c,d)}}(c,function(b){for(var c,e=[],g=d(a)();g.hasNext();){var h=g.next();h!=f&&e.push(h)}return c=e}(this),f)})}q.allFulfilled(a)&&b.handleResolve(function(b){for(var c,e=[],f=d(a)();f.hasNext();){var g=f.next();e.push(g._val)}return c=e}(this))},q.pipeLink=function(a,b,c){var d=!1,f=function(a){if(!d){d=!0;var f=c(a);f._update.push({async:b,linkf:e(b,b.handleResolve)}),q.immediateLinkUpdate(f,b,function(a){return a})}};if(a._update.push({async:b,linkf:f}),a._resolved&&!a._pending)try{f(a._val)}catch(g){g instanceof o&&(g=g.val),b.handleError(g)}},q.allResolved=function(a){for(var b=d(a)();b.hasNext();){var c=b.next();if(!c._resolved)return!1}return!0},q.allFulfilled=function(a){for(var b=d(a)();b.hasNext();){var c=b.next();if(!c._fulfilled)return!1}return!0},q.prototype={catchError:function(a){return this._error.push(a),this},errorThen:function(a){return this._errorMap=a,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isErrorHandled:function(){return this._error.length>0},isErrorPending:function(){return this._errorPending},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(a){this._resolve(a)},_resolve:function(a){var b=this;this._pending?v.enqueue(function(a,b){return function(){a(b)}}(e(this,this._resolve),a)):(this._resolved=!0,this._pending=!0,v.queue.add(function(){b._val=a;for(var c=0,d=b._update;c<d.length;){var e=d[c];++c;try{e.linkf(a)}catch(f){f instanceof o&&(f=f.val),e.async.handleError(f)}}b._fulfilled=!0,b._pending=!1}),v.continueOnNextLoop())},handleError:function(a){this._handleError(a)},_handleError:function(a){var b=this,c=function(a){if(b._error.length>0)for(var c=0,d=b._error;c<d.length;){var e=d[c];++c,e(a)}else{if(!(b._update.length>0))throw new o(a);for(var f=0,g=b._update;f<g.length;){var h=g[f];++f,h.async.handleError(a)}}b._errorPending=!1};this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=a,v.queue.add(function(){if(null!=b._errorMap)try{b._resolve(b._errorMap(a))}catch(d){d instanceof o&&(d=d.val),c(d)}else c(a)}),v.continueOnNextLoop())},then:function(a){var b=new q;return q.link(this,b,a),b},unlink:function(a){var b=this;v.queue.add(function(){b._update=b._update.filter(function(b){return b.async!=a})}),v.continueOnNextLoop()},isLinked:function(a){for(var b=!1,c=0,d=this._update;c<d.length;){var e=d[c];if(++c,e.async==a)return!0}return b}};var r=b.promhx.Deferred=function(){q.call(this)};r.__name__=["promhx","Deferred"],r.__super__=q,r.prototype=c(q.prototype,{resolve:function(a){this.handleResolve(a)},throwError:function(a){this.handleError(a)},promise:function(){return new s(this)},stream:function(){return new t(this)},publicStream:function(){return new u(this)}});var s=b.promhx.Promise=function(a){q.call(this,a),this._rejected=!1};s.__name__=["promhx","Promise"],s.whenAll=function(a){var b=new s;return q.linkAll(a,b),b},s.promise=function(a){var b=new s;return b.handleResolve(a),b},s.__super__=q,s.prototype=c(q.prototype,{isRejected:function(){return this._rejected},reject:function(a){this._rejected=!0,this.handleError(a)},handleResolve:function(a){if(this._resolved){var b="Promise has already been resolved";throw new o(w.AlreadyResolved(b))}this._resolve(a)},then:function(a){var b=new s;return q.link(this,b,a),b},unlink:function(a){var b=this;v.queue.add(function(){if(b._fulfilled)b._update=b._update.filter(function(b){return b.async!=a});else{var c="Downstream Promise is not fullfilled";b.handleError(w.DownstreamNotFullfilled(c))}}),v.continueOnNextLoop()},handleError:function(a){this._rejected=!0,this._handleError(a)},pipe:function(a){var b=new s;return q.pipeLink(this,b,a),b},errorPipe:function(a){var b=new s;return this.catchError(function(c){var d=a(c);d.then(e(b,b._resolve))}),this.then(e(b,b._resolve)),b}});var t=b.promhx.Stream=function(a){q.call(this,a),this._end_deferred=new r,this._end_promise=this._end_deferred.promise()};t.__name__=["promhx","Stream"],t.foreach=function(a){for(var b=new t,c=d(a)();c.hasNext();){var e=c.next();b.handleResolve(e)}return b.end(),b},t.wheneverAll=function(a){var b=new t;return q.linkAll(a,b),b},t.concatAll=function(a){for(var b=new t,c=d(a)();c.hasNext();){var e=c.next();b.concat(e)}return b},t.mergeAll=function(a){for(var b=new t,c=d(a)();c.hasNext();){var e=c.next();b.merge(e)}return b},t.stream=function(a){var b=new t;return b.handleResolve(a),b},t.__super__=q,t.prototype=c(q.prototype,{then:function(a){var b=new t;return q.link(this,b,a),this._end_promise.then(function(a){b.end()}),b},detachStream:function(a){for(var b=[],c=!1,d=0,e=this._update;d<e.length;){var f=e[d];++d,f.async==a?c=!0:b.push(f)}return this._update=b,c},first:function(){var a=new s;return this.then(function(b){a._resolved||a.handleResolve(b)}),a},handleResolve:function(a){this._end||this._pause||this._resolve(a)},pause:function(a){null==a&&(a=!this._pause),this._pause=a},pipe:function(a){var b=new t;return q.pipeLink(this,b,a),this._end_promise.then(function(a){b.end()}),b},errorPipe:function(a){var b=new t;return this.catchError(function(c){var d=a(c);d.then(e(b,b._resolve)),d._end_promise.then((Cb=b._end_promise,e(Cb,Cb._resolve)))}),this.then(e(b,b._resolve)),this._end_promise.then(function(a){b.end()}),b},handleEnd:function(){if(this._pending)v.queue.add(e(this,this.handleEnd)),v.continueOnNextLoop();else{if(this._end_promise._resolved)return;this._end=!0;var a;a=this._resolved?n.Some(this._val):n.None,this._end_promise.handleResolve(a),this._update=[],this._error=[]}},end:function(){return v.queue.add(e(this,this.handleEnd)),v.continueOnNextLoop(),this},endThen:function(a){return this._end_promise.then(a)},filter:function(a){var b=new t;return this._update.push({async:b,linkf:function(c){a(c)&&b.handleResolve(c)}}),q.immediateLinkUpdate(this,b,function(a){return a}),b},concat:function(a){var b=new t;return this._update.push({async:b,linkf:e(b,b.handleResolve)}),q.immediateLinkUpdate(this,b,function(a){return a}),this._end_promise.then(function(c){a.pipe(function(a){return b.handleResolve(a),b}),a._end_promise.then(function(a){b.end()})}),b},merge:function(a){var b=new t;return this._update.push({async:b,linkf:e(b,b.handleResolve)}),a._update.push({async:b,linkf:e(b,b.handleResolve)}),q.immediateLinkUpdate(this,b,function(a){return a}),q.immediateLinkUpdate(a,b,function(a){return a}),b}});var u=b.promhx.PublicStream=function(a){t.call(this,a)};u.__name__=["promhx","PublicStream"],u.publicstream=function(a){var b=new u;return b.handleResolve(a),b},u.__super__=t,u.prototype=c(t.prototype,{resolve:function(a){this.handleResolve(a)},throwError:function(a){this.handleError(a)},update:function(a){this.handleResolve(a)}});var v=function(){};v.__name__=["promhx","base","EventLoop"],v.enqueue=function(a){v.queue.add(a),v.continueOnNextLoop()},v.set_nextLoop=function(a){if(null!=v.nextLoop)throw new o("nextLoop has already been set");return v.nextLoop=a,v.nextLoop},v.queueEmpty=function(){return v.queue.isEmpty()},v.finish=function(a){null==a&&(a=1e3);for(var b=null;a-->0&&null!=(b=v.queue.pop());)b();return v.queue.isEmpty()},v.clear=function(){v.queue=new i},v.f=function(){var a=v.queue.pop();null!=a&&a(),v.queue.isEmpty()||v.continueOnNextLoop()},v.continueOnNextLoop=function(){null!=v.nextLoop?v.nextLoop(v.f):setImmediate(v.f)};var w={__ename__:!0,__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]};w.AlreadyResolved=function(a){var b=["AlreadyResolved",0,a];return b.__enum__=w,b.toString=f,b},w.DownstreamNotFullfilled=function(a){var b=["DownstreamNotFullfilled",1,a];return b.__enum__=w,b.toString=f,b};var x=function(){};x.__name__=["verb","Verb"],x.main=function(){l.trace("verb 0.2.0",{fileName:"Verb.hx",lineNumber:56,className:"verb.Verb",methodName:"main"})};var y=b.core.KnotMultiplicity=function(a,b){this.knot=a,this.mult=b};y.__name__=["verb","core","KnotMultiplicity"],y.prototype={inc:function(){this.mult++}};var z=b.core.Analyze=function(){};z.__name__=["verb","core","Analyze"],z.knotMultiplicities=function(a){for(var b=[new y(a[0],0)],c=b[0],d=0;d<a.length;){var e=a[d];++d,Math.abs(e-c.knot)>1e-10&&(c=new y(e,0),b.push(c)),c.inc()}return b},z.isRationalSurfaceClosed=function(a,b){null==b&&(b=!0);var c;c=b?a.controlPoints:Q.transpose(a.controlPoints);for(var d=0,e=c[0].length;e>d;){var f=d++,g=X.dist(c[0][f],c[c.length-1][f])<1e-10;if(!g)return!1}return!0},z.rationalSurfaceClosestPoint=function(a,b){var c=z.rationalSurfaceClosestParam(a,b);return F.rationalSurfacePoint(a,c[0],c[1])},z.rationalSurfaceClosestParam=function(a,b){for(var c,d,e,f=5,g=0,h=1e-4,i=5e-4,j=a.knotsU[0],k=A.last(a.knotsU),l=a.knotsV[0],m=A.last(a.knotsV),n=z.isRationalSurfaceClosed(a),o=z.isRationalSurfaceClosed(a,!1),p=V.rationalSurfaceAdaptive(a,new Y),q=1/0,r=0,s=p.points.length;s>r;){var t=r++,u=p.points[t],v=X.normSquared(X.sub(b,u));q>v&&(q=v,e=p.uvs[t])}for(var w=function(b){return F.rationalSurfaceDerivatives(a,b[0],b[1],2)},x=function(a,b,c){var d=b[1][0],e=b[0][1],f=b[2][0],g=b[0][2],h=b[1][1],i=b[1][1],j=X.dot(d,c),k=X.dot(e,c),l=[-j,-k],m=X.dot(d,d)+X.dot(f,c),n=X.dot(d,e)+X.dot(h,c),o=X.dot(d,e)+X.dot(i,c),p=X.dot(e,e)+X.dot(g,c),q=[[m,n],[o,p]],r=Q.solve(q,l);return X.add(r,a)};f>g;){c=w(e),d=X.sub(c[0][0],b);var y=X.norm(d),B=X.dot(c[1][0],d),C=X.norm(c[1][0])*y,D=X.dot(c[0][1],d),E=X.norm(c[0][1])*y,G=B/C,H=D/E,I=h>y,J=i>G,K=i>H;if(I&&J&&K)return e;var L=x(e,c,d);L[0]<j?L=n?[k-(L[0]-j),L[1]]:[j+1e-10,L[1]]:L[0]>k&&(L=n?[j+(L[0]-k),L[1]]:[k-1e-10,L[1]]),L[1]<l?L=o?[L[0],m-(L[1]-l)]:[L[0],l+1e-10]:L[1]>m&&(L=o?[L[0],l+(L[0]-m)]:[L[0],m-1e-10]);var M=X.norm(X.mul(L[0]-e[0],c[1][0])),N=X.norm(X.mul(L[1]-e[1],c[0][1]));if(h>M+N)return e;e=L,g++}return e},z.rationalCurveClosestPoint=function(a,b){return F.rationalCurvePoint(a,z.rationalCurveClosestParam(a,b))},z.rationalCurveClosestParam=function(a,b){for(var c=1/0,d=0,e=V.rationalCurveRegularSample(a,a.controlPoints.length*a.degree,!0),f=0,g=e.length-1;g>f;){var h=f++,i=e[h][0],j=e[h+1][0],k=e[h].slice(1),l=e[h+1].slice(1),m=W.segmentClosestPoint(b,k,l,i,j),n=X.norm(X.sub(b,m.pt));c>n&&(c=n,d=m.u)}for(var o,p,q=5,r=0,s=1e-4,t=5e-4,u=a.knots[0],v=A.last(a.knots),w=X.normSquared(X.sub(a.controlPoints[0],A.last(a.controlPoints)))<1e-10,x=d,y=function(b){return F.rationalCurveDerivatives(a,b,2)},z=function(a,b,c){var d=X.dot(b[1],c),e=X.dot(b[2],c),f=X.dot(b[1],b[1]),g=e+f;return a-d/g};q>r;){o=y(x),p=X.sub(o[0],b);var B=X.norm(p),C=X.dot(o[1],p),D=X.norm(o[1])*B,E=C/D,G=s>B,H=Math.abs(E)<t;if(G&&H)return x;var I=z(x,o,p);u>I?I=w?v-(I-u):u:I>v&&(I=w?u+(I-v):v);var J=X.norm(X.mul(I-x,o[1]));if(s>J)return x;x=I,r++}return x},z.rationalCurveParamAtArcLength=function(a,b,c,d,e){if(null==c&&(c=.001),1e-10>b)return a.knots[0];var f;f=null!=d?d:S.decomposeCurveIntoBeziers(a);var g,h=0,i=(f[h],-1e-10);for(g=null!=e?e:[];b>i&&h<f.length;){if(h<g.length?g[h]=g[h]:g[h]=z.rationalBezierCurveArcLength(a),i+=g[h],i+1e-10>b)return z.rationalBezierCurveParamAtArcLength(a,b,c,g[h]);h++}return-1},z.rationalBezierCurveParamAtArcLength=function(a,b,c,d){if(0>b)return a.knots[0];var e;if(e=null!=d?d:z.rationalBezierCurveArcLength(a),b>e)return A.last(a.knots);var f,g=a.knots[0],h=0,i=A.last(a.knots),j=e,k=0,l=0;for(f=null!=c?c:2e-6;j-h>f;)k=(g+i)/2,l=z.rationalBezierCurveArcLength(a,k),l>b?(i=k,j=l):(g=k,h=l);return(g+i)/2},z.rationalCurveArcLength=function(a,b,c){null==c&&(c=16),b=null==b?A.last(a.knots):b;for(var d=S.decomposeCurveIntoBeziers(a),e=0,f=d[0],g=0;e<d.length&&f.knots[0]+1e-10<b;){var h=Math.min(A.last(f.knots),b);g+=z.rationalBezierCurveArcLength(f,h,c),f=d[++e]}return g},z.rationalBezierCurveArcLength=function(a,b,c){null==c&&(c=16);var d;d=null==b?A.last(a.knots):b;for(var e,f,g=(d-a.knots[0])/2,h=0,i=a.degree+c,j=0;i>j;){var k=j++;e=g*z.Tvalues[i][k]+g+a.knots[0],f=F.rationalCurveDerivatives(a,e,1),h+=z.Cvalues[i][k]*X.norm(f[1])}return g*h};var A=function(){};A.__name__=["verb","core","ArrayExtensions"],A.alloc=function(a,b){if(!(0>b))for(;a.length<b;)a.push(null)},A.reversed=function(a){var b=a.slice();return b.reverse(),b},A.last=function(a){return a[a.length-1]},A.first=function(a){return a[0]},A.spliceAndInsert=function(a,b,c,d){a.splice(b,c),a.splice(b,0,d)},A.left=function(a){if(0==a.length)return[];var b=Math.ceil(a.length/2);return a.slice(0,b)},A.right=function(a){if(0==a.length)return[];var b=Math.ceil(a.length/2);return a.slice(b)},A.rightWithPivot=function(a){if(0==a.length)return[];var b=Math.ceil(a.length/2);return a.slice(b-1)},A.unique=function(a,b){if(0==a.length)return[];for(var c=[a.pop()];a.length>0;){for(var d=a.pop(),e=!0,f=0;f<c.length;){var g=c[f];if(++f,b(d,g)){e=!1;break}}e&&c.push(d)}return c};var B=function(){};B.__name__=["verb","core","Binomial"],B.get=function(a,b){if(0==b)return 1;if(0==a||b>a)return 0;if(b>a-b&&(b=a-b),B.memo_exists(a,b))return B.get_memo(a,b);for(var c=1,d=a,e=1,f=b+1;f>e;){var g=e++;B.memo_exists(d,g)?(a--,c=B.get_memo(d,g)):(c*=a--,c/=g,B.memoize(d,g,c))}return c},B.get_no_memo=function(a,b){if(0==b)return 1;if(0==a||b>a)return 0;b>a-b&&(b=a-b);for(var c=1,d=1,e=b+1;e>d;){var f=d++;c*=a--,c/=f}return c},B.memo_exists=function(a,b){return B.memo.h.hasOwnProperty(a)&&B.memo.h[a].h.hasOwnProperty(b)},B.get_memo=function(a,b){return B.memo.h[a].h[b]},B.memoize=function(a,b,c){B.memo.h.hasOwnProperty(a)||B.memo.set(a,new m),B.memo.h[a].h[b]=c};var C=b.core.Check=function(){};C.__name__=["verb","core","Check"],C.isValidKnotVector=function(a,b){if(0==a.length)return!1;if(a.length<2*(b+1))return!1;for(var c=a[0],d=0,e=b+1;e>d;){var f=d++;if(Math.abs(a[f]-c)>1e-10)return!1}c=a[a.length-1];for(var g=a.length-b-1,h=a.length;h>g;){var i=g++;if(Math.abs(a[i]-c)>1e-10)return!1}return C.isNonDecreasing(a)},C.isNonDecreasing=function(a){for(var b=a[0],c=0,d=a.length;d>c;){var e=c++;if(a[e]<b-1e-10)return!1;b=a[e]}return!0},C.nurbsCurveData=function(a){if(null==a.controlPoints)throw new o("Control points array cannot be null!");if(null==a.degree)throw new o("Degree cannot be null!");if(a.degree<1)throw new o("Degree must be greater than 1!");if(null==a.knots)throw new o("Knots cannot be null!");if(a.knots.length!=a.controlPoints.length+a.degree+1)throw new o("controlPoints.length + degree + 1 must equal knots.length!");if(!C.isValidKnotVector(a.knots,a.degree))throw new o("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return a},C.nurbsSurfaceData=function(a){if(null==a.controlPoints)throw new o("Control points array cannot be null!");if(null==a.degreeU)throw new o("DegreeU cannot be null!");if(null==a.degreeV)throw new o("DegreeV cannot be null!");if(a.degreeU<1)throw new o("DegreeU must be greater than 1!");if(a.degreeV<1)throw new o("DegreeV must be greater than 1!");if(null==a.knotsU)throw new o("KnotsU cannot be null!");if(null==a.knotsV)throw new o("KnotsV cannot be null!");if(a.knotsU.length!=a.controlPoints.length+a.degreeU+1)throw new o("controlPointsU.length + degreeU + 1 must equal knotsU.length!");if(a.knotsV.length!=a.controlPoints[0].length+a.degreeV+1)throw new o("controlPointsV.length + degreeV + 1 must equal knotsV.length!");if(!C.isValidKnotVector(a.knotsU,a.degreeU)||!C.isValidKnotVector(a.knotsV,a.degreeV))throw new o("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return a};var D=b.core.Constants=function(){};D.__name__=["verb","core","Constants"];var E=b.core.Divide=function(){};E.__name__=["verb","core","Divide"],E.rationalCurveByEqualArcLength=function(a,b){var c=z.rationalCurveArcLength(a),d=c/b;return E.rationalCurveByArcLength(a,d)},E.rationalCurveByArcLength=function(a,b){var c=S.decomposeCurveIntoBeziers(a),d=c.map(function(a){return z.rationalBezierCurveArcLength(a)}),e=X.sum(d),f=[new da(a.knots[0],0)];if(b>e)return f;for(var g,h=b,i=0,j=h,k=0,l=0;i<c.length;){for(k+=d[i];k+1e-10>j;)g=z.rationalBezierCurveParamAtArcLength(c[i],j-l,1e-6,d[i]),f.push(new da(g,j)),j+=h;l+=d[i],i++}return f};var F=b.core.Eval=function(){};F.__name__=["verb","core","Eval"],F.volumePoint=function(a,b,c,d){var e=a.knotsU.length-a.degreeU-2,f=a.knotsV.length-a.degreeV-2,g=a.knotsW.length-a.degreeW-2;return F.volumePointGivenNML(a,e,f,g,b,c,d)},F.volumePointGivenNML=function(a,b,c,d,e,f,g){if(!F.areValidRelations(a.degreeU,a.controlPoints.length,a.knotsU.length)||!F.areValidRelations(a.degreeV,a.controlPoints[0].length,a.knotsV.length)||!F.areValidRelations(a.degreeW,a.controlPoints[0][0].length,a.knotsW.length))throw new o("Invalid relations between control points and knot vector");for(var h=a.controlPoints,i=a.degreeU,j=a.degreeV,k=a.degreeW,l=a.knotsU,m=a.knotsV,n=a.knotsW,p=h[0][0][0].length,q=F.knotSpanGivenN(b,i,e,l),r=F.knotSpanGivenN(c,j,f,m),s=F.knotSpanGivenN(d,k,g,n),t=F.basisFunctionsGivenKnotSpanIndex(q,e,i,l),u=F.basisFunctionsGivenKnotSpanIndex(r,f,j,m),v=F.basisFunctionsGivenKnotSpanIndex(s,g,k,n),w=q-i,x=X.zeros1d(p),y=X.zeros1d(p),z=X.zeros1d(p),A=0,B=k+1;B>A;){var C=A++;z=X.zeros1d(p);for(var D=s-k+C,E=0,G=j+1;G>E;){var H=E++;y=X.zeros1d(p);for(var I=r-j+H,J=0,K=i+1;K>J;){var L=J++;y=X.add(y,X.mul(t[L],h[w+L][I][D]))}z=X.add(z,X.mul(u[H],y))}x=X.add(x,X.mul(v[C],z))}return x},F.rationalCurveTangent=function(a,b){var c=F.rationalCurveDerivatives(a,b,1);return c[1]},F.rationalSurfaceNormal=function(a,b,c){var d=F.rationalSurfaceDerivatives(a,b,c,1);return X.cross(d[1][0],d[0][1])},F.rationalSurfaceDerivatives=function(a,b,c,d){null==d&&(d=1);for(var e=F.surfaceDerivatives(a,b,c,d),f=F.rational2d(e),g=F.weight2d(e),h=[],i=f[0][0].length,j=0,k=d+1;k>j;){var l=j++;h.push([]);for(var m=0,n=d-l+1;n>m;){for(var o=m++,p=f[l][o],q=1,r=o+1;r>q;){var s=q++;p=X.sub(p,X.mul(B.get(o,s)*g[0][s],h[l][o-s]))}for(var t=1,u=l+1;u>t;){var v=t++;p=X.sub(p,X.mul(B.get(l,v)*g[v][0],h[l-v][o]));for(var w=X.zeros1d(i),x=1,y=o+1;y>x;){var z=x++;w=X.add(w,X.mul(B.get(o,z)*g[v][z],h[l-v][o-z]))}p=X.sub(p,X.mul(B.get(l,v),w))}h[l].push(X.mul(1/g[0][0],p))}}return h},F.rationalSurfacePoint=function(a,b,c){return F.dehomogenize(F.surfacePoint(a,b,c))},F.rationalCurveDerivatives=function(a,b,c){null==c&&(c=1);for(var d=F.curveDerivatives(a,b,c),e=F.rational1d(d),f=F.weight1d(d),g=[],h=0,i=c+1;i>h;){for(var j=h++,k=e[j],l=1,m=j+1;m>l;){var n=l++;k=X.sub(k,X.mul(B.get(j,n)*f[n],g[j-n]))}g.push(X.mul(1/f[0],k))}return g},F.rationalCurvePoint=function(a,b){return F.dehomogenize(F.curvePoint(a,b))},F.dehomogenize=function(a){for(var b=a.length,c=[],d=a[b-1],e=a.length-1,f=0;e>f;){var g=f++;c.push(a[g]/d)}return c},F.rational1d=function(a){var b=a[0].length-1;return a.map(function(a){return a.slice(0,b)})},F.rational2d=function(a){return a.map(F.rational1d)},F.weight1d=function(a){var b=a[0].length-1;return a.map(function(a){return a[b]})},F.weight2d=function(a){return a.map(F.weight1d)},F.dehomogenize1d=function(a){return a.map(F.dehomogenize)},F.dehomogenize2d=function(a){return a.map(F.dehomogenize1d)},F.homogenize1d=function(a,b){var c,d=a.length,e=a[0].length,f=[],g=0,h=[];c=null!=b?b:X.rep(a.length,1);for(var i=0;d>i;){var j=i++,k=[];h=a[j],g=c[j];for(var l=0;e>l;){var m=l++;k.push(h[m]*g)}k.push(g),f.push(k)}return f},F.homogenize2d=function(a,b){var c,d=a.length,e=[];if(null!=b)c=b;else{for(var f=[],g=0;d>g;){g++;f.push(X.rep(a[0].length,1))}c=f}for(var h=0;d>h;){var i=h++;e.push(F.homogenize1d(a[i],c[i]))}return e},F.surfaceDerivatives=function(a,b,c,d){var e=a.knotsU.length-a.degreeU-2,f=a.knotsV.length-a.degreeV-2;return F.surfaceDerivativesGivenNM(e,f,a,b,c,d)},F.surfaceDerivativesGivenNM=function(a,b,c,d,e,f){var g=c.degreeU,h=c.degreeV,i=c.controlPoints,j=c.knotsU,k=c.knotsV;if(!F.areValidRelations(g,i.length,j.length)||!F.areValidRelations(h,i[0].length,k.length))throw new o("Invalid relations between control points, knot vector, and n");var l,m=i[0][0].length;l=g>f?f:g;var n;n=h>f?f:h;for(var p=X.zeros3d(l+1,n+1,m),q=F.knotSpanGivenN(a,g,d,j),r=F.knotSpanGivenN(b,h,e,k),s=F.derivativeBasisFunctionsGivenNI(q,d,g,a,j),t=F.derivativeBasisFunctionsGivenNI(r,e,h,b,k),u=X.zeros2d(h+1,m),v=0,w=0,x=l+1;x>w;){for(var y=w++,z=0,A=h+1;A>z;){var B=z++;u[B]=X.zeros1d(m);for(var C=0,D=g+1;D>C;){var E=C++;u[B]=X.add(u[B],X.mul(s[y][E],i[q-g+E][r-h+B]))}}var G=f-y;v=n>G?G:n;for(var H=0,I=v+1;I>H;){var J=H++;p[y][J]=X.zeros1d(m);for(var K=0,L=h+1;L>K;){var M=K++;p[y][J]=X.add(p[y][J],X.mul(t[J][M],u[M]))}}}return p},F.surfacePoint=function(a,b,c){var d=a.knotsU.length-a.degreeU-2,e=a.knotsV.length-a.degreeV-2;return F.surfacePointGivenNM(d,e,a,b,c)},F.surfacePointGivenNM=function(a,b,c,d,e){var f=c.degreeU,g=c.degreeV,h=c.controlPoints,i=c.knotsU,j=c.knotsV;if(!F.areValidRelations(f,h.length,i.length)||!F.areValidRelations(g,h[0].length,j.length))throw new o("Invalid relations between control points, knot vector, and n");for(var k=h[0][0].length,l=F.knotSpanGivenN(a,f,d,i),m=F.knotSpanGivenN(b,g,e,j),n=F.basisFunctionsGivenKnotSpanIndex(l,d,f,i),p=F.basisFunctionsGivenKnotSpanIndex(m,e,g,j),q=l-f,r=m,s=X.zeros1d(k),t=X.zeros1d(k),u=0,v=g+1;v>u;){var w=u++;t=X.zeros1d(k),r=m-g+w;for(var x=0,y=f+1;y>x;){var z=x++;t=X.add(t,X.mul(n[z],h[q+z][r]))}s=X.add(s,X.mul(p[w],t))}return s},F.curveDerivatives=function(a,b,c){var d=a.knots.length-a.degree-2;return F.curveDerivativesGivenN(d,a,b,c)},F.curveDerivativesGivenN=function(a,b,c,d){var e=b.degree,f=b.controlPoints,g=b.knots;if(!F.areValidRelations(e,f.length,g.length))throw new o("Invalid relations between control points, knot vector, and n");var h,i=f[0].length;h=e>d?d:e;for(var j=X.zeros2d(h+1,i),k=F.knotSpanGivenN(a,e,c,g),l=F.derivativeBasisFunctionsGivenNI(k,c,e,h,g),m=0,n=h+1;n>m;)for(var p=m++,q=0,r=e+1;r>q;){var s=q++;j[p]=X.add(j[p],X.mul(l[p][s],f[k-e+s]))}return j},F.curvePoint=function(a,b){var c=a.knots.length-a.degree-2;return F.curvePointGivenN(c,a,b)},F.areValidRelations=function(a,b,c){return b+a+1-c==0},F.curvePointGivenN=function(a,b,c){var d=b.degree,e=b.controlPoints,f=b.knots;if(!F.areValidRelations(d,e.length,f.length))throw new o("Invalid relations between control points, knot Array, and n");for(var g=F.knotSpanGivenN(a,d,c,f),h=F.basisFunctionsGivenKnotSpanIndex(g,c,d,f),i=X.zeros1d(e[0].length),j=0,k=d+1;k>j;){var l=j++;i=X.add(i,X.mul(h[l],e[g-d+l]))}return i},F.derivativeBasisFunctions=function(a,b,c){var d=F.knotSpan(b,a,c),e=c.length-1,f=e-b-1;return F.derivativeBasisFunctionsGivenNI(d,a,b,f,c)},F.derivativeBasisFunctionsGivenNI=function(a,b,c,d,e){var f=X.zeros2d(c+1,c+1),g=X.zeros1d(c+1),h=X.zeros1d(c+1),i=0,j=0;f[0][0]=1;for(var k=1,l=c+1;l>k;){var m=k++;g[m]=b-e[a+1-m],h[m]=e[a+m]-b,i=0;for(var n=0;m>n;){var o=n++;f[m][o]=h[o+1]+g[m-o],j=f[o][m-1]/f[m][o],f[o][m]=i+h[o+1]*j,i=g[m-o]*j}f[m][m]=i}for(var p=X.zeros2d(d+1,c+1),q=X.zeros2d(2,c+1),r=0,s=1,t=0,u=0,v=0,w=0,x=0,y=0,z=c+1;z>y;){var A=y++;p[0][A]=f[A][c]}for(var B=0,C=c+1;C>B;){var D=B++;r=0,s=1,q[0][0]=1;for(var E=1,F=d+1;F>E;){var G=E++;t=0,u=D-G,v=c-G,D>=G&&(q[s][0]=q[r][0]/f[v+1][u],t=q[s][0]*f[u][v]),w=u>=-1?1:-u,x=v>=D-1?G-1:c-D;for(var H=w,I=x+1;I>H;){var J=H++;q[s][J]=(q[r][J]-q[r][J-1])/f[v+1][u+J],t+=q[s][J]*f[u+J][v]}v>=D&&(q[s][G]=-q[r][G-1]/f[v+1][D],t+=q[s][G]*f[D][v]),p[G][D]=t;var K=r;r=s,s=K}}for(var L=c,M=1,N=d+1;N>M;){for(var O=M++,P=0,Q=c+1;Q>P;){var R=P++;p[O][R]*=L}L*=c-O}return p},F.basisFunctions=function(a,b,c){var d=F.knotSpan(b,a,c);return F.basisFunctionsGivenKnotSpanIndex(d,a,b,c)},F.basisFunctionsGivenKnotSpanIndex=function(a,b,c,d){var e=X.zeros1d(c+1),f=X.zeros1d(c+1),g=X.zeros1d(c+1),h=0,i=0;e[0]=1;for(var j=1,k=c+1;k>j;){var l=j++;f[l]=b-d[a+1-l],g[l]=d[a+l]-b,h=0;for(var m=0;l>m;){var n=m++;i=e[n]/(g[n+1]+f[l-n]),e[n]=h+g[n+1]*i,h=f[l-n]*i}e[l]=h}return e},F.knotSpan=function(a,b,c){return F.knotSpanGivenN(c.length-a-2,a,b,c)},F.knotSpanGivenN=function(a,b,c,d){if(c>d[a+1]-1e-10)return a;if(c<d[b]+1e-10)return b;for(var e=b,f=a+1,g=Math.floor((e+f)/2);c<d[g]||c>=d[g+1];)c<d[g]?f=g:e=g,g=Math.floor((e+f)/2);return g};var G={__ename__:!0,__constructs__:["OutOfBounds","InsideDomain","AtBoundary","CompleteLoop","CoincidentStartPoint"]};G.OutOfBounds=["OutOfBounds",0],G.OutOfBounds.toString=f,G.OutOfBounds.__enum__=G,G.InsideDomain=["InsideDomain",1],G.InsideDomain.toString=f,G.InsideDomain.__enum__=G,G.AtBoundary=["AtBoundary",2],G.AtBoundary.toString=f,G.AtBoundary.__enum__=G,G.CompleteLoop=["CompleteLoop",3],G.CompleteLoop.toString=f,G.CompleteLoop.__enum__=G,G.CoincidentStartPoint=["CoincidentStartPoint",4],G.CoincidentStartPoint.toString=f,G.CoincidentStartPoint.__enum__=G;var H=function(a,b,c,d,e,f,g,h,i){this.stepCount=0,this.step=a,this.olduv0=b,this.olduv1=c,this.uv0=d,this.uv1=e,this.oldpoint=f,this.point=g,this.state=h,this.stepCount=i};H.__name__=["verb","core","MarchStep"],H.outOfBounds=function(){return new H(null,null,null,null,null,null,null,G.OutOfBounds,0)},H.init=function(a){return new H(null,null,null,a.uv0,a.uv1,null,a.point,G.InsideDomain,0)};var I=b.core.ExpIntersect=function(){};I.__name__=["verb","core","ExpIntersect"],I.outsideDomain=function(a,b){var c=b[0],d=b[1];return c<a.knotsU[0]||d<a.knotsV[0]||c>A.last(a.knotsU)||d>A.last(a.knotsV)},I.clampToDomain=function(a,b){var c=b[0],d=b[1];return c<a.knotsU[0]&&(c=a.knotsU[0]),c>A.last(a.knotsU)&&(c=A.last(a.knotsU)),d<a.knotsV[0]&&(d=a.knotsV[0]),d>A.last(a.knotsV)&&(c=A.last(a.knotsV)),[c,d]},I.clampStep=function(a,b,c){var d=b[0],e=b[1],f=d+c[0];f>A.last(a.knotsU)+1e-10?c=X.mul((A.last(a.knotsU)-d)/c[0],c):f<a.knotsU[0]-1e-10&&(c=X.mul((a.knotsU[0]-d)/c[0],c));var g=e+c[1];return g>A.last(a.knotsV)+1e-10?c=X.mul((A.last(a.knotsV)-e)/c[1],c):g<a.knotsV[0]-1e-10&&(c=X.mul((a.knotsV[0]-e)/c[1],c)),c},I.march=function(a,b,c,d,e,f){var g=e[d],h=c.uv0,i=c.uv1,j=F.rationalSurfaceDerivatives(a,h[0],h[1],1),k=F.rationalSurfaceDerivatives(b,i[0],i[1],1),l=j[0][0],m=k[0][0],n=j[1][0],o=j[0][1],p=k[1][0],q=k[0][1],r=X.cross(n,o),s=X.cross(p,q),t=X.normalized(X.cross(r,s)),u=I.INIT_STEP_LENGTH;if(null!=c.oldpoint){var v=Math.acos(X.dot(X.normalized(c.step),t));if(Math.abs(v)<1e-10)u=I.LINEAR_STEP_LENGTH;else{var w=X.dist(c.oldpoint,c.point)/Math.acos(X.dot(X.normalized(c.step),t)),x=2*Math.acos(1-4*f/w);u=w*Math.tan(x)}}var y=X.mul(u,t),z=X.add(c.point,y),A=X.sub(z,l),B=X.sub(z,m),C=X.cross(n,r),D=X.cross(o,r),E=X.cross(p,s),K=X.cross(q,s),L=X.dot(D,A)/X.dot(D,n),M=X.dot(C,A)/X.dot(C,o),N=X.dot(K,B)/X.dot(K,p),O=X.dot(E,B)/X.dot(E,q),P=[L,M],Q=[N,O],R=X.add(h,P),S=X.add(i,Q),T=G.InsideDomain;if(I.outsideDomain(a,R)){T=G.AtBoundary;var U=X.norm(P);P=I.clampStep(a,h,P),Q=X.mul(X.norm(P)/U,Q)}if(I.outsideDomain(b,S)){T=G.AtBoundary;var V=X.norm(Q);Q=I.clampStep(b,i,Q),P=X.mul(X.norm(Q)/V,P)}R=X.add(h,P),S=X.add(i,Q);var Y=J.surfacesAtPointWithEstimate(a,b,R,S,f);
return c.stepCount>5&&null!=c.olduv0&&W.distToSegment(c.point,g.point,Y.point)<10*f?new H(y,c.uv0,c.uv1,g.uv0,g.uv1,c.point,g.point,G.CompleteLoop,c.stepCount+1):(I.isCoincidentWithStartPoint(Y.point,d,e,f),new H(y,c.uv0,c.uv1,Y.uv0,Y.uv1,c.point,Y.point,T,c.stepCount+1))},I.isCoincidentWithStartPoint=function(a,b,c,d){if(0==b)return!1;for(var e=0;b>e;){var f=e++;X.distSquared(c[f].point,c[b].point)<d}return!1},I.completeMarch=function(a,b,c,d,e){var f=d[c],g=I.march(a,b,H.init(f),c,d,e);if(g.state==G.AtBoundary)return null;var h=[];for(h.push(f);g.state!=G.CoincidentStartPoint&&g.state!=G.AtBoundary&&g.state!=G.CompleteLoop;)h.push(new Ba(g.uv0,g.uv1,g.point,-1)),g=I.march(a,b,g,c,d,e);return g.state!=G.CoincidentStartPoint?null:(h.push(new Ba(g.uv0,g.uv1,g.point,-1)),h)},I.surfaces=function(a,b,c){for(var d=[],e=I.intersectBoundaryCurves(a,b,c),f=I.approxInnerCriticalPts(a,b),g=I.refineInnerCriticalPts(a,b,f,c),h=!0,i=0;i<g.length;){var j=g[i];++i;var k=J.curveAndSurface(O.surfaceIsocurve(a,j.item0[0],!1),b);if(0!=k.length&&h){h=!1;var l=new Ba([j.item0[0],k[0].u],k[0].uv,k[0].curvePoint,-1);e.push(l)}}for(var m=0,n=e.length;n>m;){var o=m++,p=I.completeMarch(a,b,o,e,c);null!=p&&d.push(p)}for(var q=[],r=0;r<d.length;){var s=d[r];++r,q.push(O.rationalInterpCurve(s.map(function(a){return a.point})))}return q},I.refineInnerCriticalPts=function(a,b,c,d){return c.map(function(c){return I.refineCriticalPt(a,b,c,d)})},I.refineCriticalPt=function(a,b,c,d){var e=function(c){var d=F.rationalSurfaceDerivatives(a,c[0],c[1],1),e=F.rationalSurfaceDerivatives(b,c[2],c[3],1),f=X.normalized(X.cross(d[1][0],d[0][1])),g=X.normalized(X.cross(e[1][0],e[0][1])),h=X.sub(d[0][0],e[0][0]),i=X.normSquared(h),j=X.dot(h,g),k=X.dot(f,g);return i-j*j+1-k*k},f=[c.item0[0],c.item0[1],c.item1[0],c.item1[1]],g=U.uncmin(e,f,d),h=g.solution;return new va([h[0],h[1]],[h[2],h[3]])},I.verifyInnerCriticalPts=function(a,b,c){return null},I.boundingBoxLeaves=function(a){if(a.indivisible(0))return[a["yield"]()];var b=a.split();return I.boundingBoxLeaves(b.item0).concat(I.boundingBoxLeaves(b.item1))},I.approxInnerCriticalPts=function(a,b){for(var c=new pa(a,!1,.6,.6),d=new pa(b,!1,.6,.6),e=J.boundingBoxTrees(c,d,0),f=4,g=[],h=0;h<e.length;){var i=e[h];++h;for(var j=I.approxSurfaceDelPhiField(i.item0,i.item1,f,f),k=j.delphi,l=j.uvs0,m=j.uvs1,n=1,o=k.length;o>n;)for(var p=n++,q=1,r=k[p].length;r>q;){var s=q++,t=I.approxRotationNumber([k[p][s-1],k[p][s],k[p-1][s],k[p-1][s-1]]);if(0!=t){var u=(l[p][s][1]+l[p][s-1][1])/2,v=(l[p][s][0]+l[p-1][s][0])/2,w=(m[p][s][1]+m[p][s-1][1])/2,x=(m[p][s][0]+m[p-1][s][0])/2;g.push(new va([u,v],[w,x]))}}}return g},I.approxRotationNumber=function(a){for(var b=0,c=a.length,d=1,e=c+1;e>d;){var f=d++,g=X.angleBetweenNormalized2d(a[f-1],a[f%c]);b+=Math.abs(g)}return Math.floor(Math.abs(b/(2*Math.PI)))},I.approxSurfaceDelPhiField=function(a,b,c,d){for(var e=I.sampleSurfaceRegular(a,c,d),f=I.sampleSurfaceRegular(b,c,d),g=[],h=0,i=e.uvs.length;i>h;){var j=h++,k=[];g.push(k);for(var l=0,m=e.uvs[j].length;m>l;){for(var n=l++,o=1/0,p=[1/0,1/0],q=0,r=f.uvs.length;r>q;)for(var s=q++,t=0,u=f.uvs[s].length;u>t;){var v=t++,w=X.distSquared(e.points[j][n],e.points[s][v]);o>w&&(o=w,p=e.uvs[s][v])}k.push(p)}}for(var x=[],y=0,z=g.length;z>y;){var A=y++,B=[];x.push(B);for(var C=0,D=g[A].length;D>C;){var E=C++,G=e.uvs[A][E],H=g[A][E],J=F.rationalSurfaceDerivatives(a,G[0],G[1]),K=F.rationalSurfaceDerivatives(b,H[0],H[1]),L=X.normalized(X.cross(K[1][0],K[0][1])),M=J[1][0],N=J[0][1],O=X.normalized([X.dot(L,M),X.dot(L,N)]);B.push(O)}}return{uvs0:e.uvs,uvs1:g,delphi:x}},I.sampleSurfaceRegular=function(a,b,c){1>b&&(b=1),1>c&&(c=1);for(var d=(a.degreeU,a.degreeV,a.controlPoints,a.knotsU),e=a.knotsV,f=.005,g=d[d.length-1]-d[0]-2*f,h=e[e.length-1]-e[0]-2*f,i=d[0]+f,j=e[0]+f,k=g/b,l=h/c,m=[],n=[],o=0,p=b+1;p>o;){var q=o++,r=[];n.push(r);var s=[];m.push(s);for(var t=i+q*k,u=0,v=c+1;v>u;){var w=u++,x=j+w*l;r.push([t,x]),s.push(F.rationalSurfacePoint(a,t,x))}}return{uvs:n,points:m}},I.intersectBoundaryCurves=function(a,b,c){for(var d=O.surfaceBoundaryCurves(a),e=O.surfaceBoundaryCurves(b),f=[],g=0,h=d.length;h>g;)for(var i=g++,j=d[i],k=J.curveAndSurface(j,b,c),l=0;l<k.length;){var m=k[l];++l;var n;switch(i){case 0:n=[a.knotsU[0],m.u];break;case 1:n=[A.last(a.knotsU),m.u];break;case 2:n=[m.u,a.knotsV[0]];break;default:n=[m.u,A.last(a.knotsV)]}var o=X.dist(m.curvePoint,m.surfacePoint);f.push(new Ba(n,m.uv,m.curvePoint,o))}for(var p=0,q=e.length;q>p;)for(var r=p++,s=e[r],t=J.curveAndSurface(s,a,c),u=0;u<t.length;){var v=t[u];++u;var w;switch(r){case 0:w=[b.knotsU[0],v.u];break;case 1:w=[A.last(b.knotsU),v.u];break;case 2:w=[v.u,b.knotsV[0]];break;default:w=[v.u,A.last(b.knotsV)]}var x=X.dist(v.curvePoint,v.surfacePoint);f.push(new Ba(v.uv,w,v.curvePoint,x))}return A.unique(f,function(a,b){return Math.abs(a.uv0[0]-b.uv0[0])<c&&Math.abs(a.uv0[1]-b.uv0[1])<c})};var J=b.core.Intersect=function(){};J.__name__=["verb","core","Intersect"],J.meshSlices=function(a,b,c,d){for(var e=new qa(a),f=e.boundingBox(),g=f.min[0],h=f.min[1],i=f.max[0],j=f.max[1],k=X.span(b,c,d),l=[],m=0;m<k.length;){var n=k[m];++m;var o=[[g,h,n],[i,h,n],[i,j,n],[g,j,n]],p=[[0,0],[1,0],[1,1],[0,1]],q=[[0,1,2],[0,2,3]],r=new ra(q,o,null,p);l.push(J.meshes(a,r,e)),n+=1}return l},J.surfaces=function(a,b,c){var d=V.rationalSurfaceAdaptive(a),e=V.rationalSurfaceAdaptive(b),f=J.meshes(d,e),g=f.map(function(d){return d.map(function(d){return J.surfacesAtPointWithEstimate(a,b,d.uv0,d.uv1,c)})});return g.map(function(a){return O.rationalInterpCurve(a.map(function(a){return a.point}),3)})},J.surfacesAtPointWithEstimate=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,p,q,r,s,t=5,u=0;do{if(f=F.rationalSurfaceDerivatives(a,c[0],c[1],1),g=f[0][0],i=f[1][0],j=f[0][1],h=X.normalized(X.cross(i,j)),k=X.dot(h,g),l=F.rationalSurfaceDerivatives(b,d[0],d[1],1),m=l[0][0],p=l[1][0],q=l[0][1],n=X.normalized(X.cross(p,q)),r=X.dot(n,m),s=X.distSquared(g,m),e*e>s)break;var v=X.normalized(X.cross(h,n)),w=X.dot(v,g),x=J.threePlanes(h,k,n,r,v,w);if(null==x)throw new o("panic!");var y=X.sub(x,g),z=X.sub(x,m),A=X.cross(i,h),B=X.cross(j,h),C=X.cross(p,n),D=X.cross(q,n),E=X.dot(B,y)/X.dot(B,i),G=X.dot(A,y)/X.dot(A,j),H=X.dot(D,z)/X.dot(D,p),I=X.dot(C,z)/X.dot(C,q);c=X.add([E,G],c),d=X.add([H,I],d),u++}while(t>u);return new Ba(c,d,g,s)},J.meshes=function(a,b,c,d){null==c&&(c=new na(a)),null==d&&(d=new na(b));var e=J.boundingBoxTrees(c,d,0),f=A.unique(e.map(function(c){return J.triangles(a,c.item0,b,c.item1)}).filter(function(a){return null!=a}).filter(function(a){return X.distSquared(a.min.point,a.max.point)>1e-10}),function(a,b){var c=X.sub(a.min.uv0,b.min.uv0),d=X.dot(c,c),e=X.sub(a.max.uv0,b.max.uv0),f=X.dot(e,e),g=X.sub(a.min.uv0,b.max.uv0),h=X.dot(g,g),i=X.sub(a.max.uv0,b.min.uv0),j=X.dot(i,i);return 1e-10>d&&1e-10>f||1e-10>h&&1e-10>j});return J.makeMeshIntersectionPolylines(f)},J.makeMeshIntersectionPolylines=function(a){if(0==a.length)return[];for(var b=0;b<a.length;){var c=a[b];++b,c.max.opp=c.min,c.min.opp=c.max}for(var d=J.kdTreeFromSegments(a),e=[],f=0;f<a.length;){var g=a[f];++f,e.push(g.min),e.push(g.max)}for(var h=0;h<e.length;){var i=e[h];if(++h,null==i.adj){var j=J.lookupAdjacentSegment(i,d,a.length);null!=j&&null==j.adj&&(i.adj=j,j.adj=i)}}var k=e.filter(function(a){return null==a.adj});0==k.length&&(k=e);for(var l=[],m=0,n=!1;0!=k.length;){var o=k.pop();if(!o.visited){for(var p=[],q=o;null!=q&&!q.visited&&(q.visited=!0,q.opp.visited=!0,p.push(q),m+=2,q=q.opp.adj,q!=o););p.length>0&&(p.push(p[p.length-1].opp),l.push(p))}if(0==k.length&&e.length>0&&(n||m<e.length)){n=!0;var r=e.pop();k.push(r)}}return l},J.kdTreeFromSegments=function(a){for(var b=[],c=0;c<a.length;){var d=a[c];++c,b.push(new K(d.min.point,d.min)),b.push(new K(d.max.point,d.max))}return new M(b,X.distSquared)},J.lookupAdjacentSegment=function(a,b,c){var d=b.nearest(a.point,c,1e-10).filter(function(b){return a!=b.item0.obj}).map(function(a){return a.item0.obj});return 1==d.length?d[0]:null},J.curveAndSurface=function(a,b,c,d,e){null==c&&(c=.001),d=null!=d?d:new ma(a),e=null!=e?e:new pa(b);var f=J.boundingBoxTrees(d,e,c);return A.unique(f.map(function(a){var b=a.item0,d=a.item1,e=b.knots[0],f=A.last(b.knots),g=(e+f)/2,h=d.knotsU[0],i=A.last(d.knotsU),j=d.knotsV[0],k=A.last(d.knotsV),l=[(h+i)/2,(j+k)/2];return J.curveAndSurfaceWithEstimate(b,d,[g].concat(l),c)}).filter(function(a){return X.distSquared(a.curvePoint,a.surfacePoint)<c*c}),function(a,b){return Math.abs(a.u-b.u)<.5*c})},J.curveAndSurfaceWithEstimate=function(a,b,c,d){null==d&&(d=.001);var e=function(c){var d=F.rationalCurvePoint(a,c[0]),e=F.rationalSurfacePoint(b,c[1],c[2]),f=X.sub(d,e);return X.dot(f,f)},f=function(c){var d=F.rationalCurveDerivatives(a,c[0],1),e=F.rationalSurfaceDerivatives(b,c[1],c[2],1),f=X.sub(e[0][0],d[0]),g=X.mul(-1,d[1]),h=e[1][0],i=e[0][1];return[2*X.dot(g,f),2*X.dot(h,f),2*X.dot(i,f)]},g=U.uncmin(e,c,d*d,f),h=g.solution;return new ea(h[0],[h[1],h[2]],F.rationalCurvePoint(a,h[0]),F.rationalSurfacePoint(b,h[1],h[2]))},J.polylineAndMesh=function(a,b,c){for(var d=J.boundingBoxTrees(new oa(a),new na(b),c),e=[],f=0;f<d.length;){var g=d[f];++f;var h=g.item0,i=g.item1,j=J.segmentWithTriangle(a.points[h],a.points[h+1],b.points,b.faces[i]);if(null!=j){var k=j.point,l=X.lerp(j.p,[a.params[h]],[a.params[h+1]])[0],m=R.triangleUVFromPoint(b,i,k);e.push(new xa(k,l,m,h,i))}}return e},J.boundingBoxTrees=function(a,b,c){if(null==c&&(c=1e-9),a.empty()||b.empty())return[];if(!a.boundingBox().intersects(b.boundingBox(),c))return[];var d=a.indivisible(c),e=b.indivisible(c);if(d&&e)return[new va(a["yield"](),b["yield"]())];if(d&&!e){var f=b.split();return J.boundingBoxTrees(a,f.item0,c).concat(J.boundingBoxTrees(a,f.item1,c))}if(!d&&e){var g=a.split();return J.boundingBoxTrees(g.item0,b,c).concat(J.boundingBoxTrees(g.item1,b,c))}var h=a.split(),i=b.split();return J.boundingBoxTrees(h.item0,i.item0,c).concat(J.boundingBoxTrees(h.item0,i.item1,c)).concat(J.boundingBoxTrees(h.item1,i.item0,c)).concat(J.boundingBoxTrees(h.item1,i.item1,c))},J.curves=function(a,b,c){var d=J.boundingBoxTrees(new ma(a),new ma(b),0);return A.unique(d.map(function(d){return J.curvesWithEstimate(a,b,d.item0.knots[0],d.item1.knots[0],c)}).filter(function(a){return X.distSquared(a.point0,a.point1)<c}),function(a,b){return Math.abs(a.u0-b.u0)<5*c})},J.curvesWithEstimate=function(a,b,c,d,e){var f=function(c){var d=F.rationalCurvePoint(a,c[0]),e=F.rationalCurvePoint(b,c[1]),f=X.sub(d,e);return X.dot(f,f)},g=function(c){var d=F.rationalCurveDerivatives(a,c[0],1),e=F.rationalCurveDerivatives(b,c[1],1),f=X.sub(d[0],e[0]),g=d[1],h=X.mul(-1,e[1]);return[2*X.dot(g,f),2*X.dot(h,f)]},h=U.uncmin(f,[c,d],e*e,g),i=h.solution[0],j=h.solution[1],k=F.rationalCurvePoint(a,i),l=F.rationalCurvePoint(b,j);return new ca(k,l,i,j)},J.triangles=function(a,b,c,d){var e=a.faces[b],f=c.faces[d],g=R.getTriangleNorm(a.points,e),h=R.getTriangleNorm(c.points,f),i=a.points[e[0]],j=c.points[f[0]],k=J.planes(i,g,j,h);if(null==k)return null;var l=J.clipRayInCoplanarTriangle(k,a,b);if(null==l)return null;var m=J.clipRayInCoplanarTriangle(k,c,d);if(null==m)return null;var n=J.mergeTriangleClipIntervals(l,m,a,b,c,d);return null==n?null:new la(new sa(n.min.uv0,n.min.uv1,n.min.point,b,d),new sa(n.max.uv0,n.max.uv1,n.max.point,b,d))},J.clipRayInCoplanarTriangle=function(a,b,c){for(var d=b.faces[c],e=[b.points[d[0]],b.points[d[1]],b.points[d[2]]],f=[b.uvs[d[0]],b.uvs[d[1]],b.uvs[d[2]]],g=[X.sub(f[1],f[0]),X.sub(f[2],f[1]),X.sub(f[0],f[2])],h=[X.sub(e[1],e[0]),X.sub(e[2],e[1]),X.sub(e[0],e[2])],i=h.map(X.normalized),j=h.map(X.norm),k=null,l=null,m=0;3>m;){var n=m++,o=e[n],p=i[n],q=J.rays(o,p,a.origin,a.dir);if(null!=q){var r=q.u0,s=q.u1;-1e-10>r||r>j[n]+1e-10||((null==k||s<k.u)&&(k=new fa(s,X.onRay(a.origin,a.dir,s),X.onRay(f[n],g[n],r/j[n]))),(null==l||s>l.u)&&(l=new fa(s,X.onRay(a.origin,a.dir,s),X.onRay(f[n],g[n],r/j[n]))))}}return null==l||null==k?null:new la(k,l)},J.mergeTriangleClipIntervals=function(a,b,c,d,e,f){if(b.min.u>a.max.u+1e-10||a.min.u>b.max.u+1e-10)return null;var g;g=a.min.u>b.min.u?new va(a.min,0):new va(b.min,1);var h;h=a.max.u<b.max.u?new va(a.max,0):new va(b.max,1);var i=new la(new sa(null,null,g.item0.point,d,f),new sa(null,null,h.item0.point,d,f));return 0==g.item1?(i.min.uv0=g.item0.uv,i.min.uv1=R.triangleUVFromPoint(e,f,g.item0.point)):(i.min.uv0=R.triangleUVFromPoint(c,d,g.item0.point),i.min.uv1=g.item0.uv),0==h.item1?(i.max.uv0=h.item0.uv,i.max.uv1=R.triangleUVFromPoint(e,f,h.item0.point)):(i.max.uv0=R.triangleUVFromPoint(c,d,h.item0.point),i.max.uv1=h.item0.uv),i},J.planes=function(a,b,c,d){var e=X.cross(b,d);if(X.dot(e,e)<1e-10)return null;var f=0,g=Math.abs(e[0]),h=Math.abs(e[1]),i=Math.abs(e[2]);h>g&&(f=1,g=h),i>g&&(f=2,g=i);var j,k,l,m;0==f?(j=b[1],k=b[2],l=d[1],m=d[2]):1==f?(j=b[0],k=b[2],l=d[0],m=d[2]):(j=b[0],k=b[1],l=d[0],m=d[1]);var n,o=-X.dot(a,b),p=-X.dot(c,d),q=j*m-k*l,r=(k*p-o*m)/q,s=(o*l-j*p)/q;return n=0==f?[0,r,s]:1==f?[r,0,s]:[r,s,0],new ya(n,X.normalized(e))},J.threePlanes=function(a,b,c,d,e,f){var g=X.cross(c,e),h=X.dot(a,g);if(Math.abs(h)<1e-10)return null;var i=X.sub(X.mul(f,c),X.mul(d,e)),j=X.add(X.mul(b,g),X.cross(a,i));return X.mul(1/h,j)},J.polylines=function(a,b,c){for(var d=J.boundingBoxTrees(new oa(a),new oa(b),c),e=[],f=0;f<d.length;){var g=d[f];++f;var h=g.item0,i=g.item1,j=J.segments(a.points[h],a.points[h+1],b.points[i],b.points[i+1],c);null!=j&&(j.u0=X.lerp(j.u0,[a.params[h]],[a.params[h+1]])[0],j.u1=X.lerp(j.u1,[b.params[i]],[b.params[i+1]])[0],e.push(j))}return e},J.segments=function(a,b,c,d,e){var f=X.sub(b,a),g=Math.sqrt(X.dot(f,f)),h=X.mul(1/g,f),i=X.sub(d,c),j=Math.sqrt(X.dot(i,i)),k=X.mul(1/j,i),l=J.rays(a,h,c,k);if(null!=l){var m=Math.min(Math.max(0,l.u0/g),1),n=Math.min(Math.max(0,l.u1/j),1),o=X.onRay(a,f,m),p=X.onRay(c,i,n),q=X.distSquared(o,p);if(e*e>q)return new ca(o,p,m,n)}return null},J.rays=function(a,b,c,d){var e=X.dot(b,d),f=X.dot(b,c),g=X.dot(b,a),h=X.dot(d,c),i=X.dot(d,a),j=X.dot(b,b),k=X.dot(d,d),l=j*k-e*e;if(Math.abs(l)<1e-10)return null;var m=e*(f-g)-j*(h-i),n=m/l,o=(f-g+n*e)/j,p=X.onRay(a,b,o),q=X.onRay(c,d,n);return new ca(p,q,o,n)},J.segmentWithTriangle=function(a,b,c,d){var e=c[d[0]],f=c[d[1]],g=c[d[2]],h=X.sub(f,e),i=X.sub(g,e),j=X.cross(h,i),k=X.sub(b,a),l=X.sub(a,e),m=-X.dot(j,l),n=X.dot(j,k);if(Math.abs(n)<1e-10)return null;var o=m/n;if(0>o||o>1)return null;var p=X.add(a,X.mul(o,k)),q=X.dot(h,i),r=X.dot(h,h),s=X.dot(i,i),t=X.sub(p,e),u=X.dot(t,h),v=X.dot(t,i),w=q*q-r*s;if(Math.abs(w)<1e-10)return null;var x=(q*v-s*u)/w,y=(q*u-r*v)/w;return x>1.0000000001||y>1.0000000001||-1e-10>y||-1e-10>x||x+y>1.0000000001?null:new Ca(p,x,y,o)},J.segmentAndPlane=function(a,b,c,d){var e=X.dot(d,X.sub(b,a));if(Math.abs(e)<1e-10)return null;var f=X.dot(d,X.sub(c,a)),g=f/e;return g>1.0000000001||-1e-10>g?null:{p:g}};var K=b.core.KdPoint=function(a,b){this.point=a,this.obj=b};K.__name__=["verb","core","KdPoint"];var L=b.core.KdNode=function(a,b,c){this.kdPoint=a,this.left=null,this.right=null,this.parent=c,this.dimension=b};L.__name__=["verb","core","KdNode"];var M=b.core.KdTree=function(a,b){this.dim=3,this.points=a,this.distanceFunction=b,this.dim=a[0].point.length,this.root=this.buildTree(a,0,null)};M.__name__=["verb","core","KdTree"],M.prototype={buildTree:function(a,b,c){var d,e,f=b%this.dim;return 0==a.length?null:1==a.length?new L(a[0],f,c):(a.sort(function(a,b){var c=a.point[f]-b.point[f];return 0==c?0:c>0?1:-1}),d=Math.floor(a.length/2),e=new L(a[d],f,c),e.left=this.buildTree(a.slice(0,d),b+1,e),e.right=this.buildTree(a.slice(d+1),b+1,e),e)},nearest:function(a,b,c){var d,e=this,f=new N(function(a){return-a.item1}),g=null;g=function(c){for(var d,h,i=c.dimension,j=e.distanceFunction(a,c.kdPoint.point),k=[],l=0,m=e.dim;m>l;){l++;k.push(0)}h=k;for(var n,o,p=function(a,c){f.push(new va(a,c)),f.size()>b&&f.pop()},q=0,r=e.dim;r>q;){var s=q++;s==c.dimension?h[s]=a[s]:h[s]=c.kdPoint.point[s]}return n=e.distanceFunction(h,c.kdPoint.point),null==c.right&&null==c.left?void((f.size()<b||j<f.peek().item1)&&p(c,j)):(d=null==c.right?c.left:null==c.left?c.right:a[i]<c.kdPoint.point[i]?c.left:c.right,g(d),(f.size()<b||j<f.peek().item1)&&p(c,j),void((f.size()<b||Math.abs(n)<f.peek().item1)&&(o=d==c.left?c.right:c.left,null!=o&&g(o))))},d=g;for(var h=0;b>h;){h++;f.push(new va(null,c))}d(this.root);for(var i=[],j=0;b>j;){var k=j++;null!=f.content[k].item0&&i.push(new va(f.content[k].item0.kdPoint,f.content[k].item1))}return i}};var N=function(a){this.content=[],this.scoreFunction=a};N.__name__=["verb","core","BinaryHeap"],N.prototype={push:function(a){this.content.push(a),this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.sinkDown(0)),a},peek:function(){return this.content[0]},remove:function(a){for(var b=this.content.length,c=0;b>c;){var d=c++;if(this.content[d]==a){var e=this.content.pop();return void(d!=b-1&&(this.content[d]=e,this.scoreFunction(e)<this.scoreFunction(a)?this.bubbleUp(d):this.sinkDown(d)))}}throw new o("Node not found.")},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a];a>0;){var c=Math.floor((a+1)/2)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},sinkDown:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=2*(a+1),f=e-1,g=-1,h=0;if(b>f){var i=this.content[f];h=this.scoreFunction(i),d>h&&(g=f)}if(b>e){var j=this.content[e],k=this.scoreFunction(j);(-1==g?d:h)>k&&(g=e)}if(-1==g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}}};var O=b.core.Make=function(){};O.__name__=["verb","core","Make"],O.rationalTranslationalSurface=function(a,b){for(var c=F.rationalCurvePoint(b,b.knots[0]),d=b.knots[0],e=A.last(b.knots),f=2*b.controlPoints.length,g=(e-d)/(f-1),h=[],i=0;f>i;){var j=i++,k=X.sub(F.rationalCurvePoint(b,d+j*g),c),l=S.rationalCurveTransform(a,[[1,0,0,k[0]],[0,1,0,k[1]],[0,0,1,k[2]],[0,0,0,1]]);h.push(l)}return O.loftedSurface(h)},O.surfaceBoundaryCurves=function(a){var b=O.surfaceIsocurve(a,a.knotsU[0],!1),c=O.surfaceIsocurve(a,A.last(a.knotsU),!1),d=O.surfaceIsocurve(a,a.knotsV[0],!0),e=O.surfaceIsocurve(a,A.last(a.knotsV),!0);return[b,c,d,e]},O.surfaceIsocurve=function(a,b,c){null==c&&(c=!1);var d;d=c?a.knotsV:a.knotsU;var e;e=c?a.degreeV:a.degreeU;for(var f=z.knotMultiplicities(d),g=-1,h=0,i=f.length;i>h;){var j=h++;if(Math.abs(b-f[j].knot)<1e-10){g=j;break}}var k=e+1;g>=0&&(k-=f[g].mult);var l;l=k>0?S.surfaceKnotRefine(a,X.rep(k,b),c):a;var m=F.knotSpan(e,b,d);return Math.abs(b-d[0])<1e-10?m=0:Math.abs(b-d[d.length-1])<1e-10&&(m=(c?l.controlPoints[0].length:l.controlPoints.length)-1),c?new ta(l.degreeU,l.knotsU,function(a){for(var b,c=[],d=0,e=l.controlPoints;d<e.length;){var f=e[d];++d,c.push(f[m])}return b=c}(this)):new ta(l.degreeV,l.knotsV,l.controlPoints[m])},O.loftedSurface=function(a,b){a=S.unifyCurveKnotVectors(a);var c=a[0].degree;null==b&&(b=3),b>a.length-1&&(b=a.length-1);for(var d=a[0].knots,e=[],f=[],g=0,h=a[0].controlPoints.length;h>g;){var i=[g++],j=a.map(function(a){return function(b){return b.controlPoints[a[0]]}}(i)),k=O.rationalInterpCurve(j,b,!0);f.push(k.controlPoints),e=k.knots}return new ua(c,b,d,e,f)},O.clonedCurve=function(a){return new ta(a.degree,a.knots.slice(),a.controlPoints.map(function(a){return a.slice()}))},O.rationalBezierCurve=function(a,b){for(var c=a.length-1,d=[],e=0,f=c+1;f>e;){e++;d.push(0)}for(var g=0,h=c+1;h>g;){g++;d.push(1)}return null==b&&(b=X.rep(a.length,1)),new ta(c,d,F.homogenize1d(a,b))},O.fourPointSurface=function(a,b,c,d,e){null==e&&(e=3);for(var f=e,g=[],h=0,i=e+1;i>h;){for(var j=h++,k=[],l=0,m=e+1;m>l;){var n=l++,o=1-j/f,p=X.lerp(o,a,b),q=X.lerp(o,d,c),r=X.lerp(1-n/f,p,q);r.push(1),k.push(r)}g.push(k)}var s=X.rep(e+1,0),t=X.rep(e+1,1);return new ua(e,e,s.concat(t),s.concat(t),g)},O.ellipseArc=function(a,b,c,d,e){var f=X.norm(b),g=X.norm(c);b=X.normalized(b),c=X.normalized(c),d>e&&(e=2*Math.PI+d);var h=e-d,i=0;i=h<=Math.PI/2?1:h<=Math.PI?2:h<=3*Math.PI/2?3:4;var j=h/i,k=Math.cos(j/2),l=X.add(a,X.add(X.mul(f*Math.cos(d),b),X.mul(g*Math.sin(d),c))),m=X.sub(X.mul(Math.cos(d),c),X.mul(Math.sin(d),b)),n=[],o=X.zeros1d(2*i+3),p=0,q=d,r=X.zeros1d(2*i);n[0]=l,r[0]=1;for(var s=1,t=i+1;t>s;){var u=s++;q+=j;var v=X.add(a,X.add(X.mul(f*Math.cos(q),b),X.mul(g*Math.sin(q),c)));r[p+2]=1,n[p+2]=v;var w=X.sub(X.mul(Math.cos(q),c),X.mul(Math.sin(q),b)),x=J.rays(l,X.mul(1/X.norm(m),m),v,X.mul(1/X.norm(w),w)),y=X.add(l,X.mul(x.u0,m));r[p+1]=k,n[p+1]=y,p+=2,i>u&&(l=v,m=w)}for(var z=2*i+1,A=0;3>A;){var B=A++;o[B]=0,o[B+z]=1}switch(i){case 2:o[3]=o[4]=.5;break;case 3:o[3]=o[4]=.3333333333333333,o[5]=o[6]=.6666666666666666;break;case 4:o[3]=o[4]=.25,o[5]=o[6]=.5,o[7]=o[8]=.75}return new ta(2,o,F.homogenize1d(n,r))},O.arc=function(a,b,c,d,e,f){return O.ellipseArc(a,X.mul(d,X.normalized(b)),X.mul(d,X.normalized(c)),e,f)},O.polyline=function(a){for(var b=[0,0],c=0,d=0,e=a.length-1;e>d;){var f=d++;c+=X.dist(a[f],a[f+1]),b.push(c)}b.push(c),b=X.mul(1/c,b);for(var g,h=[],i=0,j=a.length;j>i;){i++;h.push(1)}return g=h,new ta(1,b,F.homogenize1d(a.slice(0),g))},O.extrudedSurface=function(a,b,c){for(var d=[[],[],[]],e=[[],[],[]],f=F.dehomogenize1d(c.controlPoints),g=F.weight1d(c.controlPoints),h=X.mul(b,a),i=X.mul(.5*b,a),j=0,k=f.length;k>j;){var l=j++;d[2][l]=f[l],d[1][l]=X.add(i,f[l]),d[0][l]=X.add(h,f[l]),e[0][l]=g[l],e[1][l]=g[l],e[2][l]=g[l]}return new ua(2,c.degree,[0,0,0,1,1,1],c.knots,F.homogenize2d(d,e))},O.cylindricalSurface=function(a,b,c,d,e){var f=X.cross(a,b),g=(2*Math.PI,O.arc(c,b,f,e,0,2*Math.PI));return O.extrudedSurface(a,d,g)},O.revolvedSurface=function(a,b,c,d){var e,f,g=F.dehomogenize1d(a.controlPoints),h=F.weight1d(a.controlPoints);d<=Math.PI/2?(e=1,f=X.zeros1d(6+2*(e-1))):d<=Math.PI?(e=2,f=X.zeros1d(6+2*(e-1)),f[3]=f[4]=.5):d<=3*Math.PI/2?(e=3,f=X.zeros1d(6+2*(e-1)),f[3]=f[4]=.3333333333333333,f[5]=f[6]=.6666666666666666):(e=4,f=X.zeros1d(6+2*(e-1)),f[3]=f[4]=.25,f[5]=f[6]=.5,f[7]=f[8]=.75);for(var i=d/e,j=3+2*(e-1),k=0;3>k;){var l=k++;f[l]=0,f[j+l]=1}for(var m=Math.cos(i/2),n=0,o=X.zeros1d(e+1),p=X.zeros1d(e+1),q=X.zeros3d(2*e+1,g.length,3),r=X.zeros2d(2*e+1,g.length),s=1,t=e+1;t>s;){var u=s++;n+=i,p[u]=Math.cos(n),o[u]=Math.sin(n)}for(var v=0,w=g.length;w>v;){var x=v++,y=W.rayClosestPoint(g[x],b,c),z=X.sub(g[x],y),A=X.norm(z),B=X.cross(c,z);A>1e-10&&(z=X.mul(1/A,z),B=X.mul(1/A,B)),q[0][x]=g[x];var C=g[x];r[0][x]=h[x];for(var D=B,E=0,G=1,H=e+1;H>G;){var I,K=G++;I=0==A?y:X.add(y,X.add(X.mul(A*p[K],z),X.mul(A*o[K],B))),q[E+2][x]=I,r[E+2][x]=h[x];var L=X.sub(X.mul(p[K],B),X.mul(o[K],z));if(0==A)q[E+1][x]=y;else{var M=J.rays(C,X.mul(1/X.norm(D),D),I,X.mul(1/X.norm(L),L)),N=X.add(C,X.mul(M.u0,D));q[E+1][x]=N}r[E+1][x]=m*h[x],E+=2,e>K&&(C=I,D=L)}}return new ua(2,a.degree,f,a.knots,F.homogenize2d(q,r))},O.sphericalSurface=function(a,b,c,d){var e=O.arc(a,X.mul(-1,b),c,d,0,Math.PI);return O.revolvedSurface(e,a,b,2*Math.PI)},O.conicalSurface=function(a,b,c,d,e){var f=2*Math.PI,g=1,h=[X.add(c,X.mul(d,a)),X.add(c,X.mul(e,b))],i=[0,0,1,1],j=[1,1],k=new ta(g,i,F.homogenize1d(h,j));return O.revolvedSurface(k,c,a,f)},O.rationalInterpCurve=function(a,b,c,d,e){if(null==c&&(c=!1),null==b&&(b=3),a.length<b+1)throw new o("You need to supply at least degree + 1 points!");for(var f=[0],g=1,h=a.length;h>g;){var i=g++,j=X.norm(X.sub(a[i],a[i-1])),k=f[f.length-1];f.push(k+j)}for(var l=f[f.length-1],m=0,n=f.length;n>m;){var p=m++;f[p]=f[p]/l}var q,r=X.rep(b+1,0),s=null!=d&&null!=e;q=s?0:1;var t;t=s?f.length-b+1:f.length-b;for(var u=q;t>u;){for(var v=u++,w=0,x=0;b>x;){var y=x++;w+=f[v+y]}r.push(1/b*w)}var z,B=r.concat(X.rep(b+1,1)),C=[];z=s?a.length+1:a.length-1;var D;D=s?1:0;var E;E=s?a.length-(b-1):a.length-(b+1);for(var G=0;G<f.length;){var H=f[G];++G;var I=F.knotSpanGivenN(z,b,H,B),J=F.basisFunctionsGivenKnotSpanIndex(I,H,b,B),K=I-b,L=X.zeros1d(K),M=X.zeros1d(E-K);C.push(L.concat(J).concat(M))}if(s){var N=C[0].length-2,O=[-1,1].concat(X.zeros1d(N)),P=X.zeros1d(N).concat([-1,1]);A.spliceAndInsert(C,1,0,O),A.spliceAndInsert(C,C.length-1,0,P)}for(var R=a[0].length,S=[],T=(1-B[B.length-b-2])/b,U=B[b+1]/b,V=0;R>V;){var W,Y=[V++];if(s){W=[a[0][Y[0]]],W.push(U*d[Y[0]]);for(var Z=1,$=a.length-1;$>Z;){var _=Z++;W.push(a[_][Y[0]])}W.push(T*e[Y[0]]),W.push(a[a.length-1][Y[0]])}else W=a.map(function(a){return function(b){return b[a[0]]}}(Y));var aa=Q.solve(C,W);S.push(aa)}var ba=Q.transpose(S);if(!c){var ca=X.rep(ba.length,1);ba=F.homogenize1d(ba,ca)}return new ta(b,B,ba)};var P=function(a,b){this.LU=a,this.P=b};P.__name__=["verb","core","LUDecomp"];var Q=b.core.Mat=function(){};Q.__name__=["verb","core","Mat"],Q.mul=function(a,b){for(var c=[],d=0,e=b.length;e>d;){var f=d++;c.push(X.mul(a,b[f]))}return c},Q.mult=function(a,b){var c,d,e,f,g,h,i,j;c=a.length,d=b.length,e=b[0].length,f=[];for(var k=c-1,l=0,m=0;k>=0;){for(g=[],h=a[k],m=e-1;m>=0;){for(i=h[d-1]*b[d-1][m],l=d-2;l>=1;)j=l-1,i+=h[l]*b[l][m]+h[j]*b[j][m],l-=2;0==l&&(i+=h[0]*b[0][m]),g[m]=i,m--}f[k]=g,k--}return f},Q.add=function(a,b){for(var c=[],d=0,e=a.length;e>d;){var f=d++;c.push(X.add(a[f],b[f]))}return c},Q.div=function(a,b){for(var c=[],d=0,e=a.length;e>d;){var f=d++;c.push(X.div(a[f],b))}return c},Q.sub=function(a,b){for(var c=[],d=0,e=a.length;e>d;){var f=d++;c.push(X.sub(a[f],b[f]))}return c},Q.dot=function(a,b){for(var c=[],d=0,e=a.length;e>d;){var f=d++;c.push(X.dot(a[f],b))}return c},Q.identity=function(a){for(var b=X.zeros2d(a,a),c=0;a>c;){var d=c++;b[d][d]=1}return b},Q.transpose=function(a){if(0==a.length)return[];for(var b=[],c=0,d=a[0].length;d>c;){var e=c++;b.push(function(b){for(var c,d=[],f=0,g=a.length;g>f;){var h=f++;d.push(a[h][e])}return c=d}(this))}return b},Q.solve=function(a,b){return Q.LUsolve(Q.LU(a),b)},Q.LUsolve=function(a,b){var c,d,e,f,g,h=a.LU,i=h.length,j=b.slice(),k=a.P;for(c=i-1;-1!=c;)j[c]=b[c],--c;for(c=0;i>c;){for(e=k[c],k[c]!=c&&(g=j[c],j[c]=j[e],j[e]=g),f=h[c],d=0;c>d;)j[c]-=j[d]*f[d],++d;++c}for(c=i-1;c>=0;){for(f=h[c],d=c+1;i>d;)j[c]-=j[d]*f[d],++d;j[c]/=f[c],--c}return j},Q.LU=function(a){for(var b,c,d,e,f,g,h,i,j,k=(Math.abs,[]),l=0,m=a.length;m>l;){var n=l++;k.push(a[n].slice())}a=k;var o=a.length,p=o-1,q=[];for(d=0;o>d;){for(h=d,g=a[d],j=Math.abs(g[d]),c=d+1;o>c;)e=Math.abs(a[c][d]),e>j&&(j=e,h=c),++c;for(q[d]=h,h!=d&&(a[d]=a[h],a[h]=g,g=a[d]),f=g[d],b=d+1;o>b;)a[b][d]/=f,++b;for(b=d+1;o>b;){for(i=a[b],c=d+1;p>c;)i[c]-=i[d]*g[c],++c,i[c]-=i[d]*g[c],++c;c==p&&(i[c]-=i[d]*g[c]),++b}++d}return new P(a,q)};var R=b.core.Mesh=function(){};R.__name__=["verb","core","Mesh"],R.getTriangleNorm=function(a,b){var c=a[b[0]],d=a[b[1]],e=a[b[2]],f=X.sub(d,c),g=X.sub(e,c),h=X.cross(f,g);return X.mul(1/X.norm(h),h)},R.makeMeshAabb=function(a,b){for(var c=new $,d=0;d<b.length;){var e=b[d];++d,c.add(a.points[a.faces[e][0]]),c.add(a.points[a.faces[e][1]]),c.add(a.points[a.faces[e][2]])}return c},R.makeMeshAabbTree=function(a,b){var c=R.makeMeshAabb(a,b);if(1==b.length)return new ba(c,b[0]);var d=R.sortTrianglesOnLongestAxis(c,a,b),e=A.left(d),f=A.right(d);return new aa(c,[R.makeMeshAabbTree(a,e),R.makeMeshAabbTree(a,f)])},R.sortTrianglesOnLongestAxis=function(a,b,c){for(var d=a.getLongestAxis(),e=[],f=0;f<c.length;){var g=c[f];++f;var h=R.getMinCoordOnAxis(b.points,b.faces[g],d);e.push(new va(h,g))}e.sort(function(a,b){var c=a.item0,d=b.item0;return c==d?0:c>d?1:-1});for(var i=[],j=0,k=e.length;k>j;){var l=j++;i.push(e[l].item1)}return i},R.getMinCoordOnAxis=function(a,b,c){for(var d=1/0,e=0;3>e;){var f=e++,g=a[b[f]][c];d>g&&(d=g)}return d},R.getTriangleCentroid=function(a,b){for(var c=[0,0,0],d=0;3>d;)for(var e=d++,f=0;3>f;){var g=f++;c[g]+=a[b[e]][g]}for(var h=0;3>h;){var i=h++;c[i]/=3}return c},R.triangleUVFromPoint=function(a,b,c){var d=a.faces[b],e=a.points[d[0]],f=a.points[d[1]],g=a.points[d[2]],h=a.uvs[d[0]],i=a.uvs[d[1]],j=a.uvs[d[2]],k=X.sub(e,c),l=X.sub(f,c),m=X.sub(g,c),n=X.norm(X.cross(X.sub(e,f),X.sub(e,g))),o=X.norm(X.cross(l,m))/n,p=X.norm(X.cross(m,k))/n,q=X.norm(X.cross(k,l))/n;return X.add(X.mul(o,h),X.add(X.mul(p,i),X.mul(q,j)))};var S=b.core.Modify=function(){};S.__name__=["verb","core","Modify"],S.curveReverse=function(a){return new ta(a.degree,S.knotsReverse(a.knots),A.reversed(a.controlPoints))},S.surfaceReverse=function(a,b){return null==b&&(b=!1),b?new ua(a.degreeU,a.degreeV,a.knotsU,S.knotsReverse(a.knotsV),function(b){for(var c,d=[],e=0,f=a.controlPoints;e<f.length;){var g=f[e];++e,d.push(A.reversed(g))}return c=d}(this)):new ua(a.degreeU,a.degreeV,S.knotsReverse(a.knotsU),a.knotsV,A.reversed(a.controlPoints))},S.knotsReverse=function(a){for(var b=a[0],c=(a[a.length-1],[b]),d=a.length,e=1;d>e;){var f=e++;c.push(c[f-1]+(a[d-f]-a[d-f-1]))}return c},S.unifyCurveKnotVectors=function(a){a=a.map(O.clonedCurve);for(var b=h.fold(a,function(a,b){return S.imax(a.degree,b)},0),c=0,d=a.length;d>c;){var e=c++;a[e].degree<b&&(a[e]=S.curveElevateDegree(a[e],b))}for(var f,g=[],i=0;i<a.length;){var j=a[i];++i,g.push(new la(j.knots[0],A.last(j.knots)))}f=g;for(var k=0,l=a.length;l>k;){var m=k++,n=[f[m].min];a[m].knots=a[m].knots.map(function(a){return function(b){return b-a[0]}}(n))}for(var o=f.map(function(a){return a.max-a.min}),p=h.fold(o,function(a,b){return Math.max(a,b)},0),q=0,r=a.length;r>q;){var s=q++,t=[p/o[s]];a[s].knots=a[s].knots.map(function(a){return function(b){return b*a[0]}}(t))}for(var u=h.fold(a,function(a,b){return X.sortedSetUnion(a.knots,b)},[]),v=0,w=a.length;w>v;){var x=v++,y=X.sortedSetSub(u,a[x].knots);0==y.length&&(a[x]=a[x]),a[x]=S.curveKnotRefine(a[x],y)}return a},S.imin=function(a,b){return b>a?a:b},S.imax=function(a,b){return a>b?a:b},S.curveElevateDegree=function(a,b){if(b<=a.degree)return a;var c,d=a.knots.length-a.degree-2,e=a.degree,f=a.knots,g=a.controlPoints,h=b-a.degree,i=a.controlPoints[0].length,j=X.zeros2d(e+h+1,e+1),k=[],l=[],m=[],n=d+e+1,o=b,p=Math.floor(o/2),q=[],r=[];j[0][0]=1,j[o][e]=1;for(var s=1,t=p+1;t>s;){var u,v=s++,w=1/B.get(o,v);u=v>e?e:v;for(var x=S.imax(0,v-h),y=u+1;y>x;){var z=x++;j[v][z]=w*B.get(e,z)*B.get(h,v-z)}}for(var A=p+1;o>A;){var C,D=A++;C=D>e?e:D;for(var E=S.imax(0,D-h),F=C+1;F>E;){var G=E++;j[D][G]=j[o-D][e-G]}}var H=o,I=o+1,J=-1,K=e,L=e+1,M=1,N=f[0];q[0]=g[0];for(var O=0,P=o+1;P>O;){var Q=O++;r[Q]=N}for(var R=0,T=e+1;T>R;){var U=R++;k[U]=g[U]}for(;n>L;){for(var V=L;n>L&&f[L]==f[L+1];)L+=1;var W=L-V+1,Y=f[L],Z=J;J=e-W;var $;$=Z>0?Math.floor((Z+2)/2):1;var _;if(_=J>0?Math.floor(o-(J+1)/2):o,J>0){for(var aa=Y-N,ba=[],ca=e;ca>W;)ba[ca-W-1]=aa/(f[K+ca]-N),ca--;for(var da=1,ea=J+1;ea>da;){for(var fa=da++,ga=J-fa,ha=W+fa,ia=e;ia>=ha;)k[ia]=X.add(X.mul(ba[ia-ha],k[ia]),X.mul(1-ba[ia-ha],k[ia-1])),ia--;m[ga]=k[e]}}for(var ja=$,ka=o+1;ka>ja;){var la=ja++;l[la]=X.zeros1d(i);var ma;ma=la>e?e:la;for(var na=S.imax(0,la-h),oa=ma+1;oa>na;){var pa=na++;l[la]=X.add(l[la],X.mul(j[la][pa],k[pa]))}}if(Z>1)for(var qa=I-2,ra=I,sa=Y-N,ua=(Y-r[I-1])/sa,va=1;Z>va;){for(var wa=va++,xa=qa,ya=ra,za=ya-I+1;ya-xa>wa;){if(M>xa){var Aa=(Y-r[xa])/(N-r[xa]);q[xa]=X.lerp(Aa,q[xa],q[xa-1])}if(ya>=$){if(I-o+Z>=ya-wa){var Ba=(Y-r[ya-wa])/sa;l[za]=X.lerp(Ba,l[za],l[za+1])}}else l[za]=X.lerp(ua,l[za],l[za+1]);xa+=1,ya-=1,za-=1}qa-=1,ra+=1}if(K!=e)for(var Ca=0,Da=o-Z;Da>Ca;){Ca++;r[I]=N,I+=1}for(var Ea=$,Fa=_+1;Fa>Ea;){var Ga=Ea++;q[M]=l[Ga],M+=1}if(n>L){for(var Ha=0;J>Ha;){var Ia=Ha++;k[Ia]=m[Ia]}for(var Ja=J,Ka=e+1;Ka>Ja;){var La=Ja++;k[La]=g[L-e+La]}K=L,L+=1,N=Y}else for(var Ma=0,Na=o+1;Na>Ma;){var Oa=Ma++;r[I+Oa]=Y}}return c=H-o-1,new ta(b,r,q)},S.rationalSurfaceTransform=function(a,b){for(var c=F.dehomogenize2d(a.controlPoints),d=0,e=c.length;e>d;)for(var f=d++,g=0,h=c[f].length;h>g;){var i=g++,j=c[f][i];j.push(1),c[f][i]=Q.dot(b,j).slice(0,j.length-1)}return new ua(a.degreeU,a.degreeV,a.knotsU.slice(),a.knotsV.slice(),F.homogenize2d(c,F.weight2d(a.controlPoints)))},S.rationalCurveTransform=function(a,b){for(var c=F.dehomogenize1d(a.controlPoints),d=0,e=c.length;e>d;){var f=d++,g=c[f];g.push(1),c[f]=Q.dot(b,g).slice(0,g.length-1)}return new ta(a.degree,a.knots.slice(),F.homogenize1d(c,F.weight1d(a.controlPoints)));
},S.surfaceKnotRefine=function(a,b,c){var d,e,f,g=[];c?(f=a.controlPoints,d=a.knotsV,e=a.degreeV):(f=Q.transpose(a.controlPoints),d=a.knotsU,e=a.degreeU);for(var h=null,i=0;i<f.length;){var j=f[i];++i,h=S.curveKnotRefine(new ta(e,d,j),b),g.push(h.controlPoints)}var k=h.knots;return c?new ua(a.degreeU,a.degreeV,a.knotsU.slice(),k,g):(g=Q.transpose(g),new ua(a.degreeU,a.degreeV,k,a.knotsV.slice(),g))},S.surfaceSplit=function(a,b,c){null==c&&(c=!1);var d,e,f;c?(f=a.controlPoints,d=a.knotsV,e=a.degreeV):(f=Q.transpose(a.controlPoints),d=a.knotsU,e=a.degreeU);for(var g,h=[],i=0,j=e+1;j>i;){i++;h.push(b)}g=h;for(var k=[],l=[],m=F.knotSpan(e,b,d),n=null,o=0;o<f.length;){var p=f[o];++o,n=S.curveKnotRefine(new ta(e,d,p),g),k.push(n.controlPoints.slice(0,m+1)),l.push(n.controlPoints.slice(m+1))}var q=n.knots.slice(0,m+e+2),r=n.knots.slice(m+1);return c?[new ua(a.degreeU,e,a.knotsU.slice(),q,k),new ua(a.degreeU,e,a.knotsU.slice(),r,l)]:(k=Q.transpose(k),l=Q.transpose(l),[new ua(e,a.degreeV,q,a.knotsV.slice(),k),new ua(e,a.degreeV,r,a.knotsV.slice(),l)])},S.decomposeCurveIntoBeziers=function(a){for(var b=a.degree,c=a.controlPoints,d=a.knots,e=z.knotMultiplicities(d),f=b+1,g=0;g<e.length;){var h=e[g];if(++g,h.mult<f){var i=X.rep(f-h.mult,h.knot),j=S.curveKnotRefine(new ta(b,d,c),i);d=j.knots,c=j.controlPoints}}for(var k=(d.length/f-1,2*f),l=[],m=0;m<c.length;){var n=d.slice(m,m+k),o=c.slice(m,m+f);l.push(new ta(b,n,o)),m+=f}return l},S.curveSplit=function(a,b){for(var c,d=a.degree,e=(a.controlPoints,a.knots),f=[],g=0,h=d+1;h>g;){g++;f.push(b)}c=f;var i=S.curveKnotRefine(a,c),j=F.knotSpan(d,b,e),k=i.knots.slice(0,j+d+2),l=i.knots.slice(j+1),m=i.controlPoints.slice(0,j+1),n=i.controlPoints.slice(j+1);return[new ta(d,k,m),new ta(d,l,n)]},S.curveKnotRefine=function(a,b){if(0==b.length)return O.clonedCurve(a);for(var c=a.degree,d=a.controlPoints,e=a.knots,f=d.length-1,g=f+c+1,h=b.length-1,i=F.knotSpan(c,b[0],e),j=F.knotSpan(c,b[h],e),k=[],l=[],m=0,n=i-c+1;n>m;){var o=m++;k[o]=d[o]}for(var p=j-1,q=f+1;q>p;){var r=p++;k[r+h+1]=d[r]}for(var s=0,t=i+1;t>s;){var u=s++;l[u]=e[u]}for(var v=j+c,w=g+1;w>v;){var x=v++;l[x+h+1]=e[x]}for(var y=j+c-1,z=j+c+h,A=h;A>=0;){for(;b[A]<=e[y]&&y>i;)k[z-c-1]=d[y-c-1],l[z]=e[y],z-=1,y-=1;k[z-c-1]=k[z-c];for(var B=1,C=c+1;C>B;){var D=B++,E=z-c+D,G=l[z+D]-b[A];Math.abs(G)<1e-10?k[E-1]=k[E]:(G/=l[z+D]-e[y-c+D],k[E-1]=X.add(X.mul(G,k[E-1]),X.mul(1-G,k[E])))}l[z]=b[A],z-=1,A--}return new ta(c,l,k)},S.curveKnotInsert=function(a,b,c){for(var d=a.degree,e=a.controlPoints,f=a.knots,g=0,h=e.length,i=F.knotSpan(d,b,f),j=[],k=[],l=[],m=1,n=i+1;n>m;){var o=m++;k[o]=f[o]}for(var p=1,q=c+1;q>p;){var r=p++;k[i+r]=b}for(var s=i+1,t=f.length;t>s;){var u=s++;k[u+c]=f[u]}for(var v=0,w=i-d+1;w>v;){var x=v++;l[x]=e[x]}for(var y=i-g;h>y;){var z=y++;l[z+c]=e[z]}for(var A=0,B=d-g+1;B>A;){var C=A++;j[C]=e[i-d+C]}for(var D=0,E=0,G=1,H=c+1;H>G;){var I=G++;D=i-d+I;for(var J=0,K=d-I-g+1;K>J;){var L=J++;E=(b-f[D+L])/(f[L+i+1]-f[D+L]),j[L]=X.add(X.mul(E,j[L+1]),X.mul(1-E,j[L]))}l[D]=j[0],l[i+c-I-g]=j[d-I-g]}for(var M=D+1,N=i-g;N>M;){var O=M++;l[O]=j[O-D]}return new ta(d,k,l)};var T=function(a,b,c,d,e,f){this.solution=a,this.value=b,this.gradient=c,this.invHessian=d,this.iterations=e,this.message=f};T.__name__=["verb","core","MinimizationResult"];var U=function(){};U.__name__=["verb","core","Numeric"],U.numericalGradient=function(a,b){var c=b.length,d=a(b);if(NaN==d)throw new o("gradient: f(x) is a NaN!");for(var e,f,g,h,i,j,k,l,m,n=b.slice(0),p=[],q=.001,r=0,s=0;c>s;)for(var t=s++,u=Math.max(1e-6*d,1e-8);;){if(++r,r>20)throw new o("Numerical gradient fails");if(n[t]=b[t]+u,e=a(n),n[t]=b[t]-u,f=a(n),n[t]=b[t],isNaN(e)||isNaN(f))u/=16;else{if(p[t]=(e-f)/(2*u),h=b[t]-u,i=b[t],j=b[t]+u,k=(e-d)/u,l=(d-f)/u,m=X.max([Math.abs(p[t]),Math.abs(d),Math.abs(e),Math.abs(f),Math.abs(h),Math.abs(i),Math.abs(j),1e-8]),g=Math.min(X.max([Math.abs(k-p[t]),Math.abs(l-p[t]),Math.abs(k-l)])/m,u/m),!(g>q))break;u/=16}}return p},U.uncmin=function(a,b,c,d,e){null==c&&(c=1e-8),null==d&&(d=function(b){return U.numericalGradient(a,b)}),null==e&&(e=1e3),b=b.slice(0);var f,g=b.length,h=a(b),i=h;if(isNaN(h))throw new o("uncmin: f(x0) is a NaN!");c=Math.max(c,1e-10);var j,k,l,m,n,p,q,r,s,t=Q.identity(g),u=0,v=[],w="";for(k=d(b);e>u;){if(!X.all(X.finite(k))){w="Gradient has Infinity or NaN";break}if(j=X.neg(Q.dot(t,k)),!X.all(X.finite(j))){w="Search direction has Infinity or NaN";break}if(s=X.norm(j),c>s){w="Newton step smaller than tol";break}for(r=1,f=X.dot(k,j),m=b;e>u&&!(c>r*s)&&(v=X.mul(r,j),m=X.add(b,v),i=a(m),i-h>=.1*r*f||isNaN(i));)r*=.5,++u;if(c>r*s){w="Line search step size smaller than tol";break}if(u==e){w="maxit reached during line search";break}l=d(m),n=X.sub(l,k),q=X.dot(n,v),p=Q.dot(t,n),t=Q.sub(Q.add(t,Q.mul((q+X.dot(n,p))/(q*q),U.tensor(v,v))),Q.div(Q.add(U.tensor(p,v),U.tensor(v,p)),q)),b=m,h=i,k=l,++u}return new T(b,h,k,t,u,w)},U.tensor=function(a,b){for(var c,d,e=a.length,f=b.length,g=[],h=e-1;h>=0;){c=[],d=a[h];for(var i=f-1;i>=3;)c[i]=d*b[i],--i,c[i]=d*b[i],--i,c[i]=d*b[i],--i,c[i]=d*b[i],--i;for(;i>=0;)c[i]=d*b[i],--i;g[h]=c,h--}return g};var V=b.core.Tess=function(){};V.__name__=["verb","core","Tess"],V.rationalCurveRegularSample=function(a,b,c){return V.rationalCurveRegularSampleRange(a,a.knots[0],A.last(a.knots),b,c)},V.rationalCurveRegularSampleRange=function(a,b,c,d,e){1>d&&(d=2);for(var f=[],g=(c-b)/(d-1),h=0,i=0;d>i;){var j=i++;h=b+g*j,e?f.push([h].concat(F.rationalCurvePoint(a,h))):f.push(F.rationalCurvePoint(a,h))}return f},V.rationalCurveAdaptiveSample=function(a,b,c){if(null==c&&(c=!1),null==b&&(b=1e-6),1==a.degree){if(c){for(var d=[],e=0,f=a.controlPoints.length;f>e;){var g=e++;d.push([a.knots[g+1]].concat(F.dehomogenize(a.controlPoints[g])))}return d}return a.controlPoints.map(F.dehomogenize)}return V.rationalCurveAdaptiveSampleRange(a,a.knots[0],A.last(a.knots),b,c)},V.rationalCurveAdaptiveSampleRange=function(a,b,c,d,e){var f=F.rationalCurvePoint(a,b),g=F.rationalCurvePoint(a,c),h=.5+.2*Math.random(),i=b+(c-b)*h,j=F.rationalCurvePoint(a,i),k=X.sub(f,g),l=X.sub(f,j);if(X.dot(k,k)<d&&X.dot(l,l)>d||!W.threePointsAreFlat(f,j,g,d)){var m=b+.5*(c-b),n=V.rationalCurveAdaptiveSampleRange(a,b,m,d,e),o=V.rationalCurveAdaptiveSampleRange(a,m,c,d,e);return n.slice(0,-1).concat(o)}return e?[[b].concat(f),[c].concat(g)]:[f,g]},V.rationalSurfaceNaive=function(a,b,c){1>b&&(b=1),1>c&&(c=1);for(var d=(a.degreeU,a.degreeV,a.controlPoints,a.knotsU),e=a.knotsV,f=d[d.length-1]-d[0],g=e[e.length-1]-e[0],h=f/b,i=g/c,j=[],k=[],l=[],m=0,n=b+1;n>m;)for(var o=m++,p=0,q=c+1;q>p;){var r=p++,s=o*h,t=r*i;k.push([s,t]);var u=F.rationalSurfaceDerivatives(a,s,t,1),v=u[0][0];j.push(v);var w=X.normalized(X.cross(u[1][0],u[0][1]));l.push(w)}for(var x=[],y=0;b>y;)for(var z=y++,A=0;c>A;){var B=A++,C=z*(c+1)+B,D=(z+1)*(c+1)+B,E=D+1,G=C+1,H=[C,D,E],I=[C,E,G];x.push(H),x.push(I)}return new ra(x,j,l,k)},V.divideRationalSurfaceAdaptive=function(a,b){null==b&&(b=new Y),null!=b.minDivsU?b.minDivsU=b.minDivsU:b.minDivsU=1,null!=b.minDivsV?b.minDivsU=b.minDivsV:b.minDivsU=1,null!=b.refine?b.refine=b.refine:b.refine=!0;var c,d=2*(a.controlPoints.length-1),e=2*(a.controlPoints[0].length-1);c=b.minDivsU>d?b.minDivsU=b.minDivsU:b.minDivsU=d;var f;f=b.minDivsV>e?b.minDivsV=b.minDivsV:b.minDivsV=e;for(var g=A.last(a.knotsU),h=a.knotsU[0],i=A.last(a.knotsV),j=a.knotsV[0],k=(g-h)/c,l=(i-j)/f,m=[],n=[],o=0,p=f+1;p>o;){for(var q=o++,r=[],s=0,t=c+1;t>s;){var u=s++,v=h+k*u,w=j+l*q,x=F.rationalSurfaceDerivatives(a,v,w,1),y=X.normalized(X.cross(x[0][1],x[1][0]));r.push(new Aa(x[0][0],y,[v,w],-1,X.isZero(y)))}n.push(r)}for(var z=0;f>z;)for(var B=z++,C=0;c>C;){var D=C++,E=[n[f-B-1][D],n[f-B-1][D+1],n[f-B][D+1],n[f-B][D]];m.push(new Z(a,E))}if(!b.refine)return m;for(var G=0;f>G;)for(var H=G++,I=0;c>I;){var J=I++,K=H*c+J,L=V.north(K,H,J,c,f,m),M=V.east(K,H,J,c,f,m),N=V.south(K,H,J,c,f,m),O=V.west(K,H,J,c,f,m);m[K].neighbors=[N,M,L,O],m[K].divide(b)}return m},V.north=function(a,b,c,d,e,f){return 0==b?null:f[a-d]},V.south=function(a,b,c,d,e,f){return b==e-1?null:f[a+d]},V.east=function(a,b,c,d,e,f){return c==d-1?null:f[a+1]},V.west=function(a,b,c,d,e,f){return 0==c?null:f[a-1]},V.triangulateAdaptiveRefinementNodeTree=function(a){for(var b=ra.empty(),c=0;c<a.length;){var d=a[c];++c,d.triangulate(b)}return b},V.rationalSurfaceAdaptive=function(a,b){b=null!=b?b:new Y;var c=V.divideRationalSurfaceAdaptive(a,b);return V.triangulateAdaptiveRefinementNodeTree(c)};var W=b.core.Trig=function(){};W.__name__=["verb","core","Trig"],W.isPointInPlane=function(a,b,c){return Math.abs(X.dot(X.sub(a,b.o),b.n))<c},W.distToSegment=function(a,b,c){var d=W.segmentClosestPoint(b,a,c,0,1);return X.dist(b,d.pt)},W.rayClosestPoint=function(a,b,c){var d=X.sub(a,b),e=X.dot(d,c),f=X.add(b,X.mul(e,c));return f},W.distToRay=function(a,b,c){var d=W.rayClosestPoint(a,b,c),e=X.sub(d,a);return X.norm(e)},W.threePointsAreFlat=function(a,b,c,d){var e=X.sub(b,a),f=X.sub(c,a),g=X.cross(e,f),h=X.dot(g,g);return d>h},W.segmentClosestPoint=function(a,b,c,d,e){var f=X.sub(c,b),g=X.norm(f);if(1e-10>g)return{u:d,pt:b};var h=b,i=X.mul(1/g,f),j=X.sub(a,h),k=X.dot(j,i);return 0>k?{u:d,pt:b}:k>g?{u:e,pt:c}:{u:d+(e-d)*k/g,pt:X.add(h,X.mul(k,i))}};var X=b.core.Vec=function(){};X.__name__=["verb","core","Vec"],X.angleBetween=function(a,b){return Math.acos(X.dot(a,b)/(X.norm(a)*X.norm(b)))},X.positiveAngleBetween=function(a,b,c){var d=X.cross(a,b),e=X.norm(a),f=X.norm(b),g=e*f,h=X.dot(a,b),i=X.norm(d)/g,j=h/g,k=Math.atan2(i,j),l=X.dot(c,d);return Math.abs(l)<1e-10?k:l>0?k:-k},X.signedAngleBetween=function(a,b,c){var d=X.cross(a,b),e=X.norm(a),f=X.norm(b),g=e*f,h=X.dot(a,b),i=X.norm(d)/g,j=h/g,k=Math.atan2(i,j),l=X.dot(c,d);return l>0?k:2*Math.PI-k},X.angleBetweenNormalized2d=function(a,b){var c=a[0]*b[1]-a[1]*b[0];return Math.atan2(c,X.dot(a,b))},X.domain=function(a){return a[a.length-1]-a[0]},X.range=function(a){for(var b=[],c=0,d=0;a>d;){d++;b.push(c),c+=1}return b},X.span=function(a,b,c){if(null==c)return[];if(1e-10>c)return[];if(a>b&&c>0)return[];if(b>a&&0>c)return[];for(var d=[],e=a;b>=e;)d.push(e),e+=c;return d},X.neg=function(a){return a.map(function(a){return-a})},X.min=function(a){return h.fold(a,function(a,b){return Math.min(a,b)},1/0)},X.max=function(a){return h.fold(a,function(a,b){return Math.max(a,b)},-(1/0))},X.all=function(a){return h.fold(a,function(a,b){return b&&a},!0)},X.finite=function(a){return a.map(function(a){return isFinite(a)})},X.onRay=function(a,b,c){return X.add(a,X.mul(c,b))},X.lerp=function(a,b,c){return X.add(X.mul(a,b),X.mul(1-a,c))},X.normalized=function(a){return X.div(a,X.norm(a))},X.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]},X.dist=function(a,b){return X.norm(X.sub(a,b))},X.distSquared=function(a,b){return X.normSquared(X.sub(a,b))},X.sum=function(a){return h.fold(a,function(a,b){return b+a},0)},X.addAll=function(a){var b=d(a)();if(!b.hasNext())return null;var c=b.next().length;return h.fold(a,function(a,b){return X.add(b,a)},X.rep(c,0))},X.norm=function(a){var b=X.normSquared(a);return 0!=b?Math.sqrt(b):b},X.normSquared=function(a){return h.fold(a,function(a,b){return b+a*a},0)},X.rep=function(a,b){for(var c=[],d=0;a>d;){d++;c.push(b)}return c},X.zeros1d=function(a){for(var b=[],c=0;a>c;){c++;b.push(0)}return b},X.zeros2d=function(a,b){for(var c=[],d=0;a>d;){d++;c.push(X.zeros1d(b))}return c},X.zeros3d=function(a,b,c){for(var d=[],e=0;a>e;){e++;d.push(X.zeros2d(b,c))}return d},X.dot=function(a,b){for(var c=0,d=0,e=a.length;e>d;){var f=d++;c+=a[f]*b[f]}return c},X.add=function(a,b){for(var c=[],d=0,e=a.length;e>d;){var f=d++;c.push(a[f]+b[f])}return c},X.mul=function(a,b){for(var c=[],d=0,e=b.length;e>d;){var f=d++;c.push(a*b[f])}return c},X.div=function(a,b){for(var c=[],d=0,e=a.length;e>d;){var f=d++;c.push(a[f]/b)}return c},X.sub=function(a,b){for(var c=[],d=0,e=a.length;e>d;){var f=d++;c.push(a[f]-b[f])}return c},X.isZero=function(a){for(var b=0,c=a.length;c>b;){var d=b++;if(Math.abs(a[d])>1e-6)return!1}return!0},X.sortedSetUnion=function(a,b){for(var c=[],d=0,e=0;d<a.length||e<b.length;)if(d>=a.length)c.push(b[e]),e++;else if(e>=b.length)c.push(a[d]),d++;else{var f=a[d]-b[e];Math.abs(f)<1e-10?(c.push(a[d]),d++,e++):f>0?(c.push(b[e]),e++):(c.push(a[d]),d++)}return c},X.sortedSetSub=function(a,b){for(var c=[],d=0,e=0;d<a.length;)e>=b.length?(c.push(a[d]),d++):Math.abs(a[d]-b[e])<1e-10?(d++,e++):(c.push(a[d]),d++);return c};var Y=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025};Y.__name__=["verb","core","types","AdaptiveRefinementOptions"];var Z=b.core.AdaptiveRefinementNode=function(a,b,c){if(this.srf=a,null==c?this.neighbors=[null,null,null,null]:this.neighbors=c,this.corners=b,null==this.corners){var d=a.knotsU[0],e=A.last(a.knotsU),f=a.knotsV[0],g=A.last(a.knotsV);this.corners=[Aa.fromUv(d,f),Aa.fromUv(e,f),Aa.fromUv(e,g),Aa.fromUv(d,g)]}};Z.__name__=["verb","core","types","AdaptiveRefinementNode"],Z.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var a=0;4>a;){var b=a++;if(null==this.corners[b].point){var c=this.corners[b];this.evalSrf(c.uv[0],c.uv[1],c)}}},evalSrf:function(a,b,c){var d=F.rationalSurfaceDerivatives(this.srf,a,b,1),e=d[0][0],f=X.cross(d[0][1],d[1][0]),g=X.isZero(f);return g||(f=X.normalized(f)),null!=c?(c.degen=g,c.point=e,c.normal=f,c):new Aa(e,f,[a,b],-1,g)},getEdgeCorners:function(a){if(this.isLeaf())return[this.corners[a]];if(this.horizontal)switch(a){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(a){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(a){var b=[this.corners[a]];if(null==this.neighbors[a])return b;var c=this.neighbors[a].getEdgeCorners((a+2)%4),d=a%2,e=1e-10,f=this,g=[function(a){return a.uv[0]>f.corners[0].uv[0]+e&&a.uv[0]<f.corners[2].uv[0]-e},function(a){return a.uv[1]>f.corners[0].uv[1]+e&&a.uv[1]<f.corners[2].uv[1]-e}],h=c.filter(g[d]);return h.reverse(),b.concat(h)},midpoint:function(a){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[a])return this.midPoints[a];switch(a){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[a]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var a=this.corners.length,b=0;a>b;){var c=b++;this.corners[c];if(this.corners[c].degen){var d=this.corners[(c+1)%a],e=this.corners[(c+3)%a];d.degen?this.corners[c].normal=e.normal:this.corners[c].normal=d.normal}}},shouldDivide:function(a,b){if(b<a.minDepth)return!0;if(b>=a.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=X.normSquared(X.sub(this.corners[0].normal,this.corners[1].normal))>a.normTol||X.normSquared(X.sub(this.corners[2].normal,this.corners[3].normal))>a.normTol,this.splitHoriz=X.normSquared(X.sub(this.corners[1].normal,this.corners[2].normal))>a.normTol||X.normSquared(X.sub(this.corners[3].normal,this.corners[0].normal))>a.normTol,this.splitVert||this.splitHoriz)return!0;var c=this.center();return X.normSquared(X.sub(c.normal,this.corners[0].normal))>a.normTol||X.normSquared(X.sub(c.normal,this.corners[1].normal))>a.normTol||X.normSquared(X.sub(c.normal,this.corners[2].normal))>a.normTol||X.normSquared(X.sub(c.normal,this.corners[3].normal))>a.normTol},divide:function(a){null==a&&(a=new Y),null==a.normTol&&(a.normTol=.085),null==a.minDepth&&(a.minDepth=0),null==a.maxDepth&&(a.maxDepth=10),this._divide(a,0,!0)},_divide:function(a,b,c){if(this.evalCorners(),this.shouldDivide(a,b)){if(b++,this.splitVert&&!this.splitHoriz?c=!1:!this.splitVert&&this.splitHoriz&&(c=!0),this.horizontal=c,this.horizontal){var d=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],e=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new Z(this.srf,d),new Z(this.srf,e)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var f=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],g=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new Z(this.srf,f),new Z(this.srf,g)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var h=0,i=this.children;h<i.length;){var j=i[h];++h,j._divide(a,b,!c)}}},triangulate:function(a){if(null==a&&(a=ra.empty()),this.isLeaf())return this.triangulateLeaf(a);for(var b=0,c=this.children;b<c.length;){var d=c[b];if(++b,null==d)break;d.triangulate(a)}return a},triangulateLeaf:function(a){for(var b=a.points.length,c=[],d=[],e=0,f=0;4>f;){var g=f++,h=this.getAllCorners(g);2==h.length&&(e=g+1);for(var i=0,j=h.length;j>i;){var k=i++;c.push(h[k])}}for(var l=0;l<c.length;){var m=c[l];++l,-1==m.id?(a.uvs.push(m.uv),a.points.push(m.point),a.normals.push(m.normal),m.id=b,d.push(b),b++):d.push(m.id)}if(4==c.length)return a.faces.push([d[0],d[3],d[1]]),a.faces.push([d[3],d[2],d[1]]),a;if(5==c.length){var n=d.length;return a.faces.push([d[e],d[(e+2)%n],d[(e+1)%n]]),a.faces.push([d[(e+4)%n],d[(e+3)%n],d[e]]),a.faces.push([d[e],d[(e+3)%n],d[(e+2)%n]]),a}var o=this.center();a.uvs.push(o.uv),a.points.push(o.point),a.normals.push(o.normal);for(var p=a.points.length-1,q=0,r=c.length-1;q<c.length;)a.faces.push([p,d[q],d[r]]),r=q++;return a}};var $=b.core.BoundingBox=function(a){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=a&&this.addRange(a)};$.__name__=["verb","core","types","BoundingBox"],$.intervalsOverlap=function(a,b,c,d,e){null==e&&(e=-1);var f;f=-.5>e?$.TOLERANCE:e;var g=Math.min(a,b)-f,h=Math.max(a,b)+f,i=Math.min(c,d)-f,j=Math.max(c,d)+f;return g>=i&&j>=g||h>=i&&j>=h||i>=g&&h>=i||j>=g&&h>=j},$.prototype={fromPoint:function(a){return new $([a])},add:function(a){if(!this.initialized)return this.dim=a.length,this.min=a.slice(0),this.max=a.slice(0),this.initialized=!0,this;for(var b=0,c=this.dim;c>b;){var d=b++;a[d]>this.max[d]&&(this.max[d]=a[d]),a[d]<this.min[d]&&(this.min[d]=a[d])}return this},addRange:function(a){for(var b=a.length,c=0;b>c;){var d=c++;this.add(a[d])}return this},contains:function(a,b){return null==b&&(b=-1),this.initialized?this.intersects(new $([a]),b):!1},intersects:function(a,b){if(null==b&&(b=-1),!this.initialized||!a.initialized)return!1;for(var c=this.min,d=this.max,e=a.min,f=a.max,g=0,h=this.dim;h>g;){var i=g++;if(!$.intervalsOverlap(c[i],d[i],e[i],f[i],b))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var a=0,b=0,c=0,d=this.dim;d>c;){var e=c++,f=this.getAxisLength(e);f>a&&(a=f,b=e)}return b},getAxisLength:function(a){return 0>a||a>this.dim-1?0:Math.abs(this.min[a]-this.max[a])},intersect:function(a,b){if(!this.initialized)return null;var c=this.min,d=this.max,e=a.min,f=a.max;if(!this.intersects(a,b))return null;for(var g=[],h=[],i=0,j=this.dim;j>i;){var k=i++;g.push(Math.min(d[k],f[k])),h.push(Math.max(c[k],e[k]))}return new $([h,g])}};var _=b.core.BoundingBoxNode=function(a){this.boundingBox=a};_.__name__=["verb","core","types","BoundingBoxNode"];var aa=b.core.BoundingBoxInnerNode=function(a,b){_.call(this,a),this.children=b};aa.__name__=["verb","core","types","BoundingBoxInnerNode"],aa.__super__=_,aa.prototype=c(_.prototype,{});var ba=b.core.BoundingBoxLeaf=function(a,b){_.call(this,a),this.item=b};ba.__name__=["verb","core","types","BoundingBoxLeaf"],ba.__super__=_,ba.prototype=c(_.prototype,{});var ca=b.core.CurveCurveIntersection=function(a,b,c,d){this.point0=a,this.point1=b,this.u0=c,this.u1=d};ca.__name__=["verb","core","types","CurveCurveIntersection"];var da=b.core.CurveLengthSample=function(a,b){this.u=a,this.len=b};da.__name__=["verb","core","types","CurveLengthSample"];var ea=b.core.CurveSurfaceIntersection=function(a,b,c,d){this.u=a,this.uv=b,this.curvePoint=c,this.surfacePoint=d};ea.__name__=["verb","core","types","CurveSurfaceIntersection"];var fa=b.core.CurveTriPoint=function(a,b,c){this.u=a,this.point=b,this.uv=c};fa.__name__=["verb","core","types","CurveTriPoint"];var ga=function(){};ga.__name__=["verb","core","types","DoublyLinkedListExtensions"],ga.iter=function(a){return new ha(a)},ga.push=function(a,b){return null==a?ga.make(b):(a.prv.nxt=b,b.prv=a.prv,a.prv=b,b.nxt=a,b)},ga.kill=function(a,b){return null==a?null:a.nxt==a?null:(b.prv.nxt=b.nxt,b.nxt.prv=b.prv,a==b&&(a=a.nxt),b.nxt=null,b.prv=null,a)},ga.make=function(a){return a.nxt=a,a.prv=a,a};var ha=function(a){this.t=a,this.c=a};ha.__name__=["verb","core","types","DoublyLinkedListIterator"],ha.prototype={iterator:function(){return this},next:function(){var a=this.c;return this.c.nxt==this.t?this.c=null:this.c=this.c.nxt,a},hasNext:function(){return null!=this.c}};var ia=function(a){this.message=a};ia.__name__=["verb","core","types","Exception"];var ja=function(){};ja.__name__=["verb","core","types","IBoundingBoxTree"];var ka=function(){};ka.__name__=["verb","core","types","IDoublyLinkedList"];var la=b.core.Interval=function(a,b){this.min=a,this.max=b};la.__name__=["verb","core","types","Interval"];var ma=function(a,b){this._boundingBox=null,this._curve=a,null==b&&(b=X.domain(this._curve.knots)/64),this._knotTol=b};ma.__name__=["verb","core","types","LazyCurveBoundingBoxTree"],ma.__interfaces__=[ja],ma.prototype={split:function(){var a=this._curve.knots[0],b=A.last(this._curve.knots),c=b-a,d=S.curveSplit(this._curve,(b+a)/2+.1*c*Math.random());return new va(new ma(d[0],this._knotTol),new ma(d[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new $(F.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},"yield":function(){return this._curve},indivisible:function(a){return X.domain(this._curve.knots)<this._knotTol},empty:function(){return!1}};var na=function(a,b){if(this._boundingBox=null,this._mesh=a,null==b){for(var c=[],d=0,e=a.faces.length;e>d;){var f=d++;c.push(f)}b=c}this._faceIndices=b};na.__name__=["verb","core","types","LazyMeshBoundingBoxTree"],na.__interfaces__=[ja],na.prototype={split:function(){var a=R.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),b=A.left(a),c=A.right(a);return new va(new na(this._mesh,b),new na(this._mesh,c))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=R.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},"yield":function(){return this._faceIndices[0]},indivisible:function(a){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length}};var oa=function(a,b){this._boundingBox=null,this._polyline=a,null==b&&(b=new la(0,0!=a.points.length?a.points.length-1:0)),this._interval=b};oa.__name__=["verb","core","types","LazyPolylineBoundingBoxTree"],oa.__interfaces__=[ja],oa.prototype={split:function(){var a=this._interval.min,b=this._interval.max,c=a+Math.ceil((b-a)/2),d=new la(a,c),e=new la(c,b);return new va(new oa(this._polyline,d),new oa(this._polyline,e))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new $(this._polyline.points)),this._boundingBox},"yield":function(){return this._interval.min},indivisible:function(a){return this._interval.max-this._interval.min==1},empty:function(){return this._interval.max-this._interval.min==0}};var pa=b.core.LazySurfaceBoundingBoxTree=function(a,b,c,d){null==b&&(b=!1),this._boundingBox=null,this._surface=a,this._splitV=b,null==c&&(c=X.domain(a.knotsU)/16),null==d&&(d=X.domain(a.knotsV)/16),this._knotTolU=c,this._knotTolV=d};pa.__name__=["verb","core","types","LazySurfaceBoundingBoxTree"],pa.__interfaces__=[ja],pa.prototype={split:function(){var a,b;this._splitV?(a=this._surface.knotsV[0],b=A.last(this._surface.knotsV)):(a=this._surface.knotsU[0],b=A.last(this._surface.knotsU));var c=(a+b)/2,d=S.surfaceSplit(this._surface,c,this._splitV);return new va(new pa(d[0],!this._splitV,this._knotTolU,this._knotTolV),new pa(d[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new $;for(var a=0,b=this._surface.controlPoints;a<b.length;){var c=b[a];++a,this._boundingBox.addRange(F.dehomogenize1d(c))}}return this._boundingBox},"yield":function(){return this._surface},indivisible:function(a){return X.domain(this._surface.knotsV)<this._knotTolV&&X.domain(this._surface.knotsU)<this._knotTolU},empty:function(){return!1}};var qa=function(a,b){if(this._empty=!1,this._face=-1,null==b){for(var c=[],d=0,e=a.faces.length;e>d;){var f=d++;c.push(f)}b=c}if(this._boundingBox=R.makeMeshAabb(a,b),b.length<1)return void(this._empty=!0);if(b.length<2)return void(this._face=b[0]);var g=R.sortTrianglesOnLongestAxis(this._boundingBox,a,b),h=A.left(g),i=A.right(g);this._children=new va(new qa(a,h),new qa(a,i))};qa.__name__=["verb","core","types","MeshBoundingBoxTree"],qa.__interfaces__=[ja],qa.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},"yield":function(){return this._face},indivisible:function(a){return null==this._children},empty:function(){return this._empty}};var ra=b.core.MeshData=function(a,b,c,d){this.faces=a,this.points=b,this.normals=c,this.uvs=d};ra.__name__=["verb","core","types","MeshData"],ra.empty=function(){return new ra([],[],[],[])};var sa=b.core.MeshIntersectionPoint=function(a,b,c,d,e){this.visited=!1,this.adj=null,this.opp=null,this.uv0=a,this.uv1=b,this.point=c,this.faceIndex0,this.faceIndex1};sa.__name__=["verb","core","types","MeshIntersectionPoint"];var ta=b.core.NurbsCurveData=function(a,b,c,d){null==d&&(d=!1),this.degree=a,this.controlPoints=c,this.knots=b,this.closed=d};ta.__name__=["verb","core","types","NurbsCurveData"];var ua=b.core.NurbsSurfaceData=function(a,b,c,d,e,f,g){null==g&&(g=!1),null==f&&(f=!1),this.degreeU=a,this.degreeV=b,this.knotsU=c,this.knotsV=d,this.controlPoints=e,this.closedU=f,this.closedV=g};ua.__name__=["verb","core","types","NurbsSurfaceData"];var va=b.core.Pair=function(a,b){this.item0=a,this.item1=b};va.__name__=["verb","core","types","Pair"];var wa=b.core.PolylineData=function(a,b){this.points=a,this.params=b};wa.__name__=["verb","core","types","PolylineData"];var xa=b.core.PolylineMeshIntersection=function(a,b,c,d,e){this.point=a,this.u=b,this.uv=c,this.polylineIndex=d,this.faceIndex=e};xa.__name__=["verb","core","types","PolylineMeshIntersection"];var ya=b.core.Ray=function(a,b){this.origin=a,this.dir=b};ya.__name__=["verb","core","types","Ray"];var za=function(a,b,c,d){null==b&&(b=!1),this._boundingBox=null,this._surface=a,null==c&&(c=X.domain(a.knotsU)/16),null==d&&(d=X.domain(a.knotsV)/16);var e=!1;if(e=b?X.domain(this._surface.knotsV)>d:X.domain(this._surface.knotsU)>c){var f,g;b?(f=this._surface.knotsV[0],g=A.last(this._surface.knotsV)):(f=this._surface.knotsU[0],g=A.last(this._surface.knotsU));var h=g-f,i=(f+g)/2+.1*h*Math.random(),j=S.surfaceSplit(this._surface,i,b);this._children=new va(new za(j[0],!b,c,d),new za(j[1],!b,c,d))}};za.__name__=["verb","core","types","SurfaceBoundingBoxTree"],za.__interfaces__=[ja],za.prototype={split:function(){return this._children},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new $;for(var a=0,b=this._surface.controlPoints;a<b.length;){var c=b[a];++a,this._boundingBox.addRange(F.dehomogenize1d(c))}}return this._boundingBox},"yield":function(){return this._surface},indivisible:function(a){return null==this._children},empty:function(){return!1}};var Aa=function(a,b,c,d,e){null==e&&(e=!1),null==d&&(d=-1),this.uv=c,this.point=a,this.normal=b,this.id=d,this.degen=e};Aa.__name__=["verb","core","types","SurfacePoint"],Aa.fromUv=function(a,b){return new Aa(null,null,[a,b])};var Ba=b.core.SurfaceSurfaceIntersectionPoint=function(a,b,c,d){this.uv0=a,this.uv1=b,this.point=c,this.dist=d};Ba.__name__=["verb","core","types","SurfaceSurfaceIntersectionPoint"];var Ca=b.core.TriSegmentIntersection=function(a,b,c,d){this.point=a,this.s=b,this.t=c,this.p=d};Ca.__name__=["verb","core","types","TriSegmentIntersection"];var Da=b.core.VolumeData=function(a,b,c,d,e,f,g){this.degreeU=a,this.degreeV=b,this.degreeW=c,this.knotsU=d,this.knotsV=e,this.knotsW=f,this.controlPoints=g};Da.__name__=["verb","core","types","VolumeData"];var Ea=function(){};Ea.__name__=["verb","exe","AsyncObject"],Ea.prototype={defer:function(a,b,c){return Fa.dispatchMethod(a,b,c)}};var Fa=function(){};Fa.__name__=["verb","exe","Dispatcher"],Fa.init=function(){Fa._init||(Fa._workerPool=new Ha(Fa.THREADS),Fa._init=!0)},Fa.dispatchMethod=function(a,b,c){Fa.init();var d=new r,e=function(a){d.resolve(a)};return Fa._workerPool.addWork(j.getClassName(a),b,c,e),new s(d)};var Ga=function(a,b,c){this.className=a,this.methodName=b,this.args=c,this.id=Ga.uuid++};Ga.__name__=["verb","exe","Work"];var Ha=b.exe.WorkerPool=function(a,b){null==b&&(b="verb.js"),this._callbacks=new m,this._working=new m,this._pool=[],this._queue=[];for(var c=0;a>c;){c++;this._pool.push(new Worker(Ha.basePath+b))}};Ha.__name__=["verb","exe","WorkerPool"],Ha.prototype={addWork:function(a,b,c,d){var e=new Ga(a,b,c);this._callbacks.set(e.id,d),this._queue.push(e),this.processQueue()},processQueue:function(){for(var a=this;this._queue.length>0&&this._pool.length>0;){var b=this._queue.shift(),c=[b.id],d=[this._pool.shift()];this._working.h[c[0]]=d[0],d[0].onmessage=function(b,c){return function(d){a._working.remove(c[0]),a._pool.push(b[0]);try{a._callbacks.h.hasOwnProperty(c[0])&&(a._callbacks.h[c[0]](d.data.result),a._callbacks.remove(c[0]))}catch(e){e instanceof o&&(e=e.val),l.trace(e,{fileName:"WorkerPool.hx",lineNumber:77,className:"verb.exe.WorkerPool",methodName:"processQueue"})}a.processQueue()}}(d,c),d[0].postMessage(b)}}};var Ia=function(){};Ia.__name__=["verb","geom","ICurve"];var Ja=b.geom.NurbsCurve=function(a){this._data=C.nurbsCurveData(a)};Ja.__name__=["verb","geom","NurbsCurve"],Ja.__interfaces__=[Ia],Ja.byKnotsControlPointsWeights=function(a,b,c,d){return new Ja(new ta(a,b.slice(),F.homogenize1d(c,d)))},Ja.byPoints=function(a,b){return null==b&&(b=3),new Ja(O.rationalInterpCurve(a,b))},Ja.__super__=Ea,Ja.prototype=c(Ea.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return F.dehomogenize1d(this._data.controlPoints)},weights:function(){return F.weight1d(this._data.controlPoints)},asNurbs:function(){return new ta(this.degree(),this.knots(),F.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new Ja(this._data)},domain:function(){return new la(this._data.knots[0],A.last(this._data.knots))},transform:function(a){return new Ja(S.rationalCurveTransform(this._data,a))},transformAsync:function(a){return this.defer(S,"rationalCurveTransform",[this._data,a]).then(function(a){return new Ja(a)})},point:function(a){return F.rationalCurvePoint(this._data,a)},pointAsync:function(a){return this.defer(F,"rationalCurvePoint",[this._data,a])},tangent:function(a){
return F.rationalCurveTangent(this._data,a)},tangentAsync:function(a){return this.defer(F,"rationalCurveTangent",[this._data,a])},derivatives:function(a,b){return null==b&&(b=1),F.rationalCurveDerivatives(this._data,a,b)},derivativesAsync:function(a,b){return null==b&&(b=1),this.defer(F,"rationalCurveDerivatives",[this._data,a,b])},closestPoint:function(a){return z.rationalCurveClosestPoint(this._data,a)},closestPointAsync:function(a){return this.defer(z,"rationalCurveClosestPoint",[this._data,a])},closestParam:function(a){return z.rationalCurveClosestParam(this._data,a)},closestParamAsync:function(a){return this.defer(z,"rationalCurveClosestParam",[this._data,a])},length:function(){return z.rationalCurveArcLength(this._data)},lengthAsync:function(){return this.defer(z,"rationalCurveArcLength",[this._data])},lengthAtParam:function(a){return z.rationalCurveArcLength(this._data,a)},lengthAtParamAsync:function(){return this.defer(z,"rationalCurveArcLength",[this._data])},paramAtLength:function(a,b){return z.rationalCurveParamAtArcLength(this._data,a,b)},paramAtLengthAsync:function(a,b){return this.defer(z,"rationalCurveParamAtArcLength",[this._data,a,b])},divideByEqualArcLength:function(a){return E.rationalCurveByEqualArcLength(this._data,a)},divideByEqualArcLengthAsync:function(a){return this.defer(E,"rationalCurveByEqualArcLength",[this._data,a])},divideByArcLength:function(a){return E.rationalCurveByArcLength(this._data,a)},divideByArcLengthAsync:function(a){return this.defer(E,"rationalCurveByArcLength",[this._data,a])},split:function(a){return S.curveSplit(this._data,a).map(function(a){return new Ja(a)})},splitAsync:function(a){return this.defer(S,"curveSplit",[this._data,a]).then(function(a){return a.map(function(a){return new Ja(a)})})},reverse:function(){return new Ja(S.curveReverse(this._data))},reverseAsync:function(){return this.defer(S,"curveReverse",[this._data]).then(function(a){return new Ja(a)})},tessellate:function(a){return V.rationalCurveAdaptiveSample(this._data,a,!1)},tessellateAsync:function(a){return this.defer(V,"rationalCurveAdaptiveSample",[this._data,a,!1])}});var Ka=b.geom.Arc=function(a,b,c,d,e,f){Ja.call(this,O.arc(a,b,c,d,e,f)),this._center=a,this._xaxis=b,this._yaxis=c,this._radius=d,this._minAngle=e,this._maxAngle=f};Ka.__name__=["verb","geom","Arc"],Ka.__super__=Ja,Ka.prototype=c(Ja.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle}});var La=b.geom.BezierCurve=function(a,b){Ja.call(this,O.rationalBezierCurve(a,b))};La.__name__=["verb","geom","BezierCurve"],La.__super__=Ja,La.prototype=c(Ja.prototype,{});var Ma=b.geom.Circle=function(a,b,c,d){Ka.call(this,a,b,c,d,0,2*Math.PI)};Ma.__name__=["verb","geom","Circle"],Ma.__super__=Ka,Ma.prototype=c(Ka.prototype,{});var Na=function(){};Na.__name__=["verb","geom","ISurface"];var Oa=b.geom.NurbsSurface=function(a){this._data=C.nurbsSurfaceData(a)};Oa.__name__=["verb","geom","NurbsSurface"],Oa.__interfaces__=[Na],Oa.byKnotsControlPointsWeights=function(a,b,c,d,e,f){return new Oa(new ua(a,b,c,d,F.homogenize2d(e,f)))},Oa.byCorners=function(a,b,c,d){return new Oa(O.fourPointSurface(a,b,c,d))},Oa.byLoftingCurves=function(a,b){return new Oa(O.loftedSurface(function(b){for(var c,d=[],e=0;e<a.length;){var f=a[e];++e,d.push(f.asNurbs())}return c=d}(this),b))},Oa.__super__=Ea,Oa.prototype=c(Ea.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return F.dehomogenize2d(this._data.controlPoints)},weights:function(){return F.weight2d(this._data.controlPoints)},asNurbs:function(){return new ua(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),F.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new Oa(this.asNurbs())},domainU:function(){return new la(this._data.knotsU[0],A.last(this._data.knotsU))},domainV:function(){return new la(this._data.knotsV[0],A.last(this._data.knotsV))},point:function(a,b){return F.rationalSurfacePoint(this._data,a,b)},pointAsync:function(a,b){return this.defer(F,"rationalSurfacePoint",[this._data,a,b])},normal:function(a,b){return F.rationalSurfaceNormal(this._data,a,b)},normalAsync:function(a,b){return this.defer(F,"rationalSurfaceNormal",[this._data,a,b])},derivatives:function(a,b,c){return null==c&&(c=1),F.rationalSurfaceDerivatives(this._data,a,b,c)},derivativesAsync:function(a,b,c){return null==c&&(c=1),this.defer(F,"rationalSurfaceDerivatives",[this._data,a,b,c])},closestParam:function(a){return z.rationalSurfaceClosestParam(this._data,a)},closestParamAsync:function(a){return this.defer(z,"rationalSurfaceClosestParam",[this._data,a])},closestPoint:function(a){return z.rationalSurfaceClosestPoint(this._data,a)},closestPointAsync:function(a){return this.defer(z,"rationalSurfaceClosestPoint",[this._data,a])},split:function(a,b){return null==b&&(b=!1),S.surfaceSplit(this._data,a,b).map(function(a){return new Oa(a)})},splitAsync:function(a,b){return null==b&&(b=!1),this.defer(S,"surfaceSplit",[this._data,a,b]).then(function(a){return a.map(function(a){return new Oa(a)})})},reverse:function(a){return null==a&&(a=!1),new Oa(S.surfaceReverse(this._data,a))},reverseAsync:function(a){return null==a&&(a=!1),this.defer(S,"surfaceReverse",[this._data,a]).then(function(a){return new Oa(a)})},isocurve:function(a,b){return null==b&&(b=!1),new Ja(O.surfaceIsocurve(this._data,a,b))},isocurveAsync:function(a,b){return null==b&&(b=!1),this.defer(O,"surfaceIsocurve",[this._data,a,b]).then(function(a){return new Ja(a)})},boundaries:function(a){return O.surfaceBoundaryCurves(this._data).map(function(a){return new Ja(a)})},boundariesAsync:function(a){return this.defer(O,"surfaceBoundaryCurves",[this._data]).then(function(a){return a.map(function(a){return new Ja(a)})})},tessellate:function(a){return V.rationalSurfaceAdaptive(this._data,a)},tessellateAsync:function(a){return this.defer(V,"rationalSurfaceAdaptive",[this._data,a])},transform:function(a){return new Oa(S.rationalSurfaceTransform(this._data,a))},transformAsync:function(a){return this.defer(S,"rationalSurfaceTransform",[this._data,a]).then(function(a){return new Oa(a)})}});var Pa=b.geom.ConicalSurface=function(a,b,c,d,e){Oa.call(this,O.conicalSurface(a,b,c,d,e)),this._axis=a,this._xaxis=b,this._base=c,this._height=d,this._radius=e};Pa.__name__=["verb","geom","ConicalSurface"],Pa.__super__=Oa,Pa.prototype=c(Oa.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius}});var Qa=b.geom.CylindricalSurface=function(a,b,c,d,e){Oa.call(this,O.cylindricalSurface(a,b,c,d,e)),this._axis=a,this._xaxis=b,this._base=c,this._height=d,this._radius=e};Qa.__name__=["verb","geom","CylindricalSurface"],Qa.__super__=Oa,Qa.prototype=c(Oa.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius}});var Ra=b.geom.EllipseArc=function(a,b,c,d,e){Ja.call(this,O.ellipseArc(a,b,c,d,e)),this._center=a,this._xaxis=b,this._yaxis=c,this._minAngle=d,this._maxAngle=e};Ra.__name__=["verb","geom","EllipseArc"],Ra.__super__=Ja,Ra.prototype=c(Ja.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle}});var Sa=b.geom.Ellipse=function(a,b,c){Ra.call(this,a,b,c,0,2*Math.PI)};Sa.__name__=["verb","geom","Ellipse"],Sa.__super__=Ra,Sa.prototype=c(Ra.prototype,{});var Ta=b.geom.ExtrudedSurface=function(a,b){Oa.call(this,O.extrudedSurface(X.normalized(b),X.norm(b),a.asNurbs())),this._profile=a,this._direction=b};Ta.__name__=["verb","geom","ExtrudedSurface"],Ta.__super__=Oa,Ta.prototype=c(Oa.prototype,{profile:function(){return this._profile},direction:function(){return this._direction}});var Ua=b.geom.Intersect=function(){};Ua.__name__=["verb","geom","Intersect"],Ua.curves=function(a,b,c){return null==c&&(c=.001),J.curves(a.asNurbs(),b.asNurbs(),c)},Ua.curvesAsync=function(a,b,c){return null==c&&(c=.001),Fa.dispatchMethod(J,"curves",[a.asNurbs(),b.asNurbs(),c])},Ua.curveAndSurface=function(a,b,c){return null==c&&(c=.001),J.curveAndSurface(a.asNurbs(),b.asNurbs(),c)},Ua.curveAndSurfaceAsync=function(a,b,c){return null==c&&(c=.001),Fa.dispatchMethod(J,"curveAndSurface",[a.asNurbs(),b.asNurbs(),c])},Ua.surfaces=function(a,b,c){return null==c&&(c=.001),J.surfaces(a.asNurbs(),b.asNurbs(),c).map(function(a){return new Ja(a)})},Ua.surfacesAsync=function(a,b,c){return null==c&&(c=.001),Fa.dispatchMethod(J,"surfaces",[a.asNurbs(),b.asNurbs(),c]).then(function(a){return a.map(function(a){return new Ja(a)})})};var Va=b.geom.Line=function(a,b){Ja.call(this,O.polyline([a,b])),this._start=a,this._end=b};Va.__name__=["verb","geom","Line"],Va.__super__=Ja,Va.prototype=c(Ja.prototype,{start:function(){return this._start},end:function(){return this._end}});var Wa=b.geom.RevolvedSurface=function(a,b,c,d){Oa.call(this,O.revolvedSurface(a.asNurbs(),b,c,d)),this._profile=a,this._center=b,this._axis=c,this._angle=d};Wa.__name__=["verb","geom","RevolvedSurface"],Wa.__super__=Oa,Wa.prototype=c(Oa.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle}});var Xa=b.geom.SphericalSurface=function(a,b){Oa.call(this,O.sphericalSurface(a,[0,0,1],[1,0,0],b)),this._center=a,this._radius=b};Xa.__name__=["verb","geom","SphericalSurface"],Xa.__super__=Oa,Xa.prototype=c(Oa.prototype,{center:function(){return this._center},radius:function(){return this._radius}});var Ya=b.geom.SweptSurface=function(a,b){Oa.call(this,O.rationalTranslationalSurface(a.asNurbs(),b.asNurbs())),this._profile=a,this._rail=b};Ya.__name__=["verb","geom","SweptSurface"],Ya.__super__=Oa,Ya.prototype=c(Oa.prototype,{profile:function(){return this._profile},rail:function(){return this._rail}});var Za=b.topo.Analyze=function(){};Za.__name__=["verb","topo","Analyze"],Za.volume=function(a,b){null==b&&(b=[0,0,0]);for(var c=0,e=d(ga.iter(a.f))();e.hasNext();)for(var f=e.next(),g=d(ga.iter(f.l))();g.hasNext();){var h=g.next(),i=h.e,j=i.nxt;do c+=Za.tetravol(i.v.pt,j.v.pt,j.nxt.v.pt,b),j=j.nxt;while(j.nxt!=i)}return c/6},Za.tetravol=function(a,b,c,d){return X.dot(X.sub(a,d),X.cross(X.sub(b,d),X.sub(c,d)))},Za.area=function(a){return h.fold(ga.iter(a.f),function(a,b){return b+Za.faceArea(a)},0)},Za.faceArea=function(a){var b=a.normal();return h.fold(ga.iter(a.l),function(a,c){return c+Za.loopArea(a,b)},0)},Za.loopArea=function(a,b){var c=a.e;if(c==c.nxt||c==c.nxt.nxt)return 0;var d=0;null==b&&(b=a.f.normal());var e=a.e,f=a.e.v.pt,g=e.nxt;do{var h=g.v.pt,i=g.nxt.v.pt;d+=X.dot(b,X.cross(X.sub(h,f),X.sub(i,f))),g=g.nxt}while(g.nxt!=e);return d/2};var $a={__ename__:!0,__constructs__:["On","AonBp","AonBm","BonAp","BonAm","AoutB","AinB","BoutA","BinA"]};$a.On=["On",0],$a.On.toString=f,$a.On.__enum__=$a,$a.AonBp=["AonBp",1],$a.AonBp.toString=f,$a.AonBp.__enum__=$a,$a.AonBm=["AonBm",2],$a.AonBm.toString=f,$a.AonBm.__enum__=$a,$a.BonAp=["BonAp",3],$a.BonAp.toString=f,$a.BonAp.__enum__=$a,$a.BonAm=["BonAm",4],$a.BonAm.toString=f,$a.BonAm.__enum__=$a,$a.AoutB=["AoutB",5],$a.AoutB.toString=f,$a.AoutB.__enum__=$a,$a.AinB=["AinB",6],$a.AinB.toString=f,$a.AinB.__enum__=$a,$a.BoutA=["BoutA",7],$a.BoutA.toString=f,$a.BoutA.__enum__=$a,$a.BinA=["BinA",8],$a.BinA.toString=f,$a.BinA.__enum__=$a;var _a={__ename__:!0,__constructs__:["Union","Subtract","Intersect"]};_a.Union=["Union",0],_a.Union.toString=f,_a.Union.__enum__=_a,_a.Subtract=["Subtract",1],_a.Subtract.toString=f,_a.Subtract.__enum__=_a,_a.Intersect=["Intersect",2],_a.Intersect.toString=f,_a.Intersect.__enum__=_a;var ab=function(){this.intersect=!0};ab.__name__=["verb","topo","SectorIntersection"];var bb=function(a,b){this.i=a,this.list=b};bb.__name__=["verb","topo","SectorDescription"],bb.prototype={nxt:function(){var a=(this.i+1)%this.list.length;return this.list[a]},prv:function(){var a;return a=0==this.i?this.list.length-1:this.i-1,this.list[a]},updateNormal:function(){this.ref12=X.cross(this.ref1,this.ref2)}};var cb=b.topo.Boolean=function(){};cb.__name__=["verb","topo","Boolean"],cb.union=function(a,b,c){var d=_a.Union,e=cb.intersect(a,b,c),f=cb.classifyAllVertexFaceEvents(e.coplanarVerticesOfA,d,!0),g=cb.classifyAllVertexFaceEvents(e.coplanarVerticesOfB,d,!1),h=cb.classifyAllVertexVertexEvents(e.coincidentVertices,d),i=[],j=[];cb.insertAllVertexFaceEventNullEdges(e.coplanarVerticesOfA,f,d,!0,i,j),cb.insertAllVertexFaceEventNullEdges(e.coplanarVerticesOfB,g,d,!1,i,j),cb.insertAllVertexVertexEventNullEdges(h,i,j);var k=[],l=[];cb.connect(i,j,k,l)},cb.connect=function(a,b,c,d){kb.lexicographicalSort(a),kb.lexicographicalSort(b);for(var e,f,g=[],h=[],i=0,j=a.length;j>i;){var k=i++,m=a[k],n=b[k];if(null!=(e=cb.canJoin(m,n.opp,g,h))){l.trace("joining 1!",{fileName:"Boolean.hx",lineNumber:165,className:"verb.topo.Boolean",methodName:"connect"});var o=e.item0,p=e.item1;l.trace("connecting:",{fileName:"Boolean.hx",lineNumber:170,className:"verb.topo.Boolean",methodName:"connect",customParams:[o.id,m.id]}),kb.join(o,m),kb.isLoose(o.opp,g)||kb.cut(o,c),kb.join(p,n.opp),kb.isLoose(p.opp,h)||kb.cut(p,d)}if(null!=(f=cb.canJoin(m.opp,n,g,h))){l.trace("joining 2!",{fileName:"Boolean.hx",lineNumber:186,className:"verb.topo.Boolean",methodName:"connect"});var q=f.item0,r=f.item1;l.trace("connecting:",{fileName:"Boolean.hx",lineNumber:191,className:"verb.topo.Boolean",methodName:"connect",customParams:[q.id,r.id,n.id,m.opp.id]}),kb.join(q,m.opp),kb.isLoose(q.opp,g)||kb.cut(q,c),l.trace("alright",{fileName:"Boolean.hx",lineNumber:198,className:"verb.topo.Boolean",methodName:"connect"}),kb.join(r,n),kb.isLoose(r.opp,h)||kb.cut(r,d)}null!=e&&null!=f&&(l.trace("cutting",{fileName:"Boolean.hx",lineNumber:206,className:"verb.topo.Boolean",methodName:"connect"}),kb.cut(m,c),kb.cut(n,d))}},cb.canJoin=function(a,b,c,d){if(null!=a&&null!=b)for(var e=0,f=c.length;f>e;){var g=e++,h=kb.neighbor(a,c[g]),i=kb.neighbor(b,d[g]);if(h&&i){var j=c[g],k=d[g];return c.splice(g,1),d.splice(g,1),new va(j,k)}}return null!=a&&c.push(a),null!=b&&d.push(b),null},cb.insertAllVertexFaceEventNullEdges=function(a,b,c,d,e,f){for(var g=0,h=a.length;h>g;){var i=g++;cb.insertVertexFaceEventNullEdges(a[i].item0,a[i].item1,b[i],c,d,e,f)}},cb.insertVertexFaceEventNullEdges=function(a,b,c,d,e,f,g){cb.insertVertexFaceEventNullEdgesCore(a,b,c,e,e?f:g),cb.insertNullEdgeIntoFace(a.pt.slice(),b,e?g:f)},cb.insertVertexFaceEventNullEdgesCore=function(a,b,c,d,e){var f=a.e.l.f.s,g=cb.nextOfClass(cb.above(d),c,0);if(-1!=g&&-1!=cb.nextOfClass(cb.below(d),c,0))for(var h=c[g].edge,i=h,j=h,k=c.length;;){for(;c[g].pos==cb.above(d);)j=c[g].edge,g=(g+1)%k;if(f.lmev(i,j.opp.nxt,i.v.pt.slice()),e.push(i.prv),g=cb.nextOfClass(cb.above(d),c,g),-1==g)break;if(i=c[g].edge,i==h)break}},cb.nextOfClass=function(a,b,c){for(var d=c,e=null;d<b.length;){if(b[d].pos==a){e=b[d];break}d++}return null!=e?d:-1},cb.insertNullEdgeIntoFace=function(a,b,c){var d=b.s.lmev(b.ol.e,b.ol.e,a);b.s.lkemr(d.e.prv);c.push(d.e)},cb.insertAllVertexVertexEventNullEdges=function(a,b,c){for(var d=0;d<a.length;){var e=a[d];++d,cb.insertVertexVertexEventNullEdges(e,b,c)}},cb.classifyAllVertexVertexEvents=function(a,b){for(var c=[],d=0;d<a.length;){var e=a[d];++d,c.push(cb.classifyVertexVertexEvent(e.item0,e.item1,b))}return c},cb.classifyVertexVertexEvent=function(a,b,c){var d=cb.classifyVertexVertexCore(a,b);return cb.reclassifyCoplanarSectorPairs(d,c),cb.reclassifyCoplanarSectorEdge(d,c),d},cb.insertVertexVertexEventNullEdges=function(a,b,c){for(var d=0,e=a.length;;){for(;!a[d].intersect;)if(++d==e)return;var f=null,g=null,h=null,i=null;for(a[d].s1a==cb.OUT?f=a[d].SectorA.edge:g=a[d].SectorA.edge,a[d].s1b==cb.IN?h=a[d++].SectorB.edge:i=a[d++].SectorB.edge;!a[d].intersect;)if(++d==e)return;if(a[d].s1a==cb.OUT?f=a[d].SectorA.edge:g=a[d].SectorA.edge,a[d].s1b==cb.IN?h=a[d++].SectorB.edge:i=a[d++].SectorB.edge,f==g?(cb.insertNullEdge(f,f,0,b,c),cb.insertNullEdge(h,i,1,b,c)):h==i?(cb.insertNullEdge(h,h,1,b,c),cb.insertNullEdge(g,f,0,b,c)):(cb.insertNullEdge(g,f,0,b,c),cb.insertNullEdge(h,i,1,b,c)),d==e)return}},cb.insertNullEdge=function(a,b,c,d,e){a.l.f.s.lmev(b,a,b.v.pt.slice()),0==c?d.push(b.prv):e.push(b.prv)},cb.classifyAllVertexFaceEvents=function(a,b,c){for(var d=[],e=0;e<a.length;){var f=a[e];++e,d.push(cb.classifyVertexFaceEvent(f.item0,f.item1,b,c))}return d},cb.classifyVertexFaceEvent=function(a,b,c,d){for(var e=cb.planeFromFace(b),f=[],g=0,h=a.halfEdges();g<h.length;){var i=h[g];++g,f.push({edge:i,pos:cb.asFacePosition(kb.classify(i,e),d)}),kb.wideSector(i)&&f.push({edge:i,pos:cb.asFacePosition(kb.classifyBisector(i,e),d)})}for(var j=f.length,k=0;j>k;){var l=k++,m=f[l];if(m.pos==$a.On){var n=cb.reclassifyCoplanarEdge(m.edge,e,d);f[l].pos=n,f[(l+1)%j].pos=n}}for(var p=0;j>p;){var q=p++,r=f[q],s=r.pos[1];s>0&&5>s&&(r.pos=cb.reclassifyOnSector(r.pos,c))}for(var t=0;j>t;){var u=t++,v=f[u];if(v.pos==$a.On){var w;w=0==u?j-1:u-1;var x=(u+1)%j,y=f[w].pos,z=f[x].pos;if(cb.isAbove(y)&&cb.isAbove(z))v.pos=cb.below(d);else if(cb.isBelow(y)&&cb.isAbove(z))v.pos=cb.below(d);else if(cb.isAbove(y)&&cb.isBelow(z))v.pos=cb.below(d);else{if(!cb.isBelow(y)||!cb.isBelow(z))throw new o(new ia("Double On edge encountered!"));v.pos=cb.above(d)}}}return f},cb.reclassifyCoplanarSectorEdge=function(a,b){for(var c=0;c<a.length;){var d=a[c];if(++c,0==d.s1a||0==d.s1b||0==d.s2a||0==d.s2b)throw new o(new ia("Coplanar sector edge classification not yet implemented!"))}},cb.reclassifyCoplanarSectorPairs=function(a,b){for(var c=0;c<a.length;){var d=a[c];if(++c,0==d.s1a&&0==d.s1b&&0==d.s2a&&0==d.s2b){var e=d.SectorA,f=d.SectorB,g=e.prv(),h=e.nxt(),i=f.prv(),j=(f.nxt(),e.edge),k=f.edge,l=0,m=0,n=X.norm(X.sub(j.l.f.normal(),k.l.f.normal()))<1e-10;n?(l=b==_a.Union?-1:1,m=b==_a.Union?1:-1):(l=b==_a.Union?1:-1,m=b==_a.Union?1:-1);for(var o=0;o<a.length;){var p=a[o];++o,p.SectorA==g&&p.SectorB==f&&0!=p.s1a&&(p.s2a=l),p.SectorA==h&&p.SectorB==f&&0!=p.s2a&&(p.s1a=l),p.SectorA==e&&p.SectorB==i&&0!=p.s1b&&(p.s2b=m),p.s1a==p.s2a&&0!=p.s1a&&(p.intersect=!1),p.s1b==p.s2b&&0!=p.s1b&&(p.intersect=!1)}d.s1a=d.s2a=l,d.s1b=d.s2b=m,d.intersect=!1}}},cb.classifyVertexVertexCore=function(a,b){for(var c=[],d=cb.preprocessVertexSectors(a),e=cb.preprocessVertexSectors(b),f=0;f<d.length;){var g=d[f];++f;for(var h=0;h<e.length;){var i=e[h];if(++h,cb.sectorsIntersect(g,i)){var j=new ab;c.push(j),j.SectorA=g,j.SectorB=i;var k=g.edge.l.f.normal(),l=i.edge.l.f.normal();j.s1a=cb.comp(X.dot(l,g.ref1),0,1e-10),j.s2a=cb.comp(X.dot(l,g.ref2),0,1e-10),j.s1b=cb.comp(X.dot(k,i.ref1),0,1e-10),j.s2b=cb.comp(X.dot(k,i.ref2),0,1e-10)}}}return c},cb.sectorsIntersect=function(a,b){var c=a.edge.l.f.normal(),d=b.edge.l.f.normal(),e=X.cross(c,d);return X.norm(e)<1e-10?cb.sectorsOverlap(a,b):cb.withinSector(e,a)&&cb.withinSector(e,b)?!0:(e=X.neg(e),cb.withinSector(e,a)&&cb.withinSector(e,b))},cb.sectorsOverlap=function(a,b){throw new o(new ia("sectorsOverlap not implemented!"))},cb.withinSector=function(a,b){return X.positiveAngleBetween(a,b.ref1,b.ref12)<X.positiveAngleBetween(b.ref1,b.ref2,b.ref12)},cb.comp=function(a,b,c){return Math.abs(a-b)<c?0:a>b?1:-1},cb.preprocessVertexSectors=function(a,b){null==b&&(b=.001);for(var c=[],d=0,e=0,f=a.halfEdges();e<f.length;){var g=f[e];++e;var h=new bb(d++,c);if(c.push(h),h.edge=g,h.ref1=X.sub(g.prv.v.pt,g.v.pt),h.ref2=X.sub(g.nxt.v.pt,g.v.pt),h.updateNormal(),X.norm(h.ref12)<b||X.dot(g.l.f.normal(),h.ref12)>0){var i;if(X.norm(h.ref12)<b)throw new o(new ia("Coincident consecutive edges encountered!"));i=X.neg(X.add(h.ref1,h.ref2));var j=new bb(d++,c);c.push(j),j.edge=g,j.ref2=h.ref2.slice(),j.ref1=i,h.ref2=i,h.updateNormal(),j.updateNormal()}}return c},cb.above=function(a){return a?$a.AoutB:$a.BoutA},cb.below=function(a){return a?$a.AinB:$a.BinA},cb.isAbove=function(a){return a==$a.AoutB||a==$a.BoutA},cb.isBelow=function(a){return a==$a.AinB||a==$a.BinA},cb.planeFromFace=function(a){return{o:a.l.e.v.pt,n:a.normal()}},cb.reclassifyCoplanarEdge=function(a,b,c){var d=a.l.f.normal(),e=X.dot(d,b.n),f=1.0000000000000001e-20;return Math.abs(e-1)<f?c?$a.AonBp:$a.BonAp:Math.abs(e+1)<f?c?$a.AonBm:$a.BonAm:$a.On},cb.asFacePosition=function(a,b){return a==jb.Above?b?$a.AoutB:$a.BoutA:a==jb.Below?b?$a.AinB:$a.BinA:$a.On},cb.reclassifyOnSector=function(a,b){return cb.boolOnSectorMap[b[1]][a[1]]},cb.intersect=function(a,b,c){var d=cb.splitAllEdges(a,b,c),e=cb.splitEdgesByVertices(a,b,c),f=cb.splitEdgesByVertices(b,a,c),g=cb.splitEdgesWithFaces(a,b,c),h=cb.splitEdgesWithFaces(b,a,c);return{coincidentVertices:cb.getCoincidentVertices(a,b,d.concat(e).concat(f),c),coplanarVerticesOfA:cb.getCoplanarVertices(a,b,g,c),coplanarVerticesOfB:cb.getCoplanarVertices(b,a,h,c)}},cb.splitAllEdges=function(a,b,c){for(var d=[],e=0,f=a.edges();e<f.length;){var g=f[e];++e;for(var h=0,i=b.edges();h<i.length;){var j=i[h];++h;var k=cb.splitEdges(g.item0,j.item0,c);null!=k&&d.push(k)}}return d},cb.splitEdges=function(a,b,c){var d=J.segments(a.v.pt,a.nxt.v.pt,b.v.pt,b.nxt.v.pt,c);return null==d?null:d.u0>.9999999999||d.u0<1e-10||d.u1>.9999999999||d.u1<1e-10?null:new va(cb.splitEdge(a,d.point0),cb.splitEdge(b,d.point1))},cb.splitEdgeByVertex=function(a,b,c){var d=W.segmentClosestPoint(b.pt,a.v.pt,a.nxt.v.pt,0,1),e=X.distSquared(b.pt,d.pt);return e>c*c?null:d.u>.9999999999||d.u<1e-10?null:cb.splitEdge(a,d.pt)},cb.splitEdge=function(a,b){var c=a.l.f.s;return c.lmev(a,a.opp.nxt,b)},cb.isPointInFace=function(a,b,c){var d=b.normal(),e=b.l.e.v.pt;if(!W.isPointInPlane(a,{n:d,o:e},c))return!1;var f=cb.isPointInPolygon(a,b.ol.points(),d);if(!f)return f;for(var g=0,h=b.rings();g<h.length;){var i=h[g];if(++g,cb.isPointInPolygon(a,i.points(),d))return!1}return!0},cb.isPointInPolygon=function(a,b,c){for(var d=b.length,e=0,f=0;d>f;){var g=f++,h=X.sub(b[g],a),i=X.sub(b[(g+1)%d],a);e+=X.positiveAngleBetween(h,i,c)}return Math.abs(e)>Math.PI},cb.splitEdgesByVertices=function(a,b,c){for(var e=[],f=0,g=a.edges();f<g.length;){var h=g[f];++f;for(var i=d(ga.iter(b.v))();i.hasNext();){var j=i.next(),k=cb.splitEdgeByVertex(h.item0,j,c);null!=k&&e.push(new va(k,j))}}return e},cb.getCoincidentVertices=function(a,b,c,e){for(var f={},g=0;g<c.length;){var h=c[g];++g,f[h.item0.id]=h.item0,f[h.item1.id]=h.item1}for(var i=e*e,j=d(ga.iter(a.v))();j.hasNext();){var k=j.next();if(!f.hasOwnProperty(k.id))for(var l=d(ga.iter(b.v))();l.hasNext();){var m=l.next();f.hasOwnProperty(m.id)||X.distSquared(k.pt,m.pt)<i&&c.push(new va(k,m))}}return c},cb.splitEdgesWithFaces=function(a,b,c){for(var e=[],f=0,g=a.edges();f<g.length;){var h=g[f];++f;for(var i=d(ga.iter(b.f))();i.hasNext();){var j=i.next(),k=cb.splitEdgeWithFace(h.item0,j,c);null!=k&&e.push(new va(k,j))}}return e},cb.splitEdgeWithFace=function(a,b,c){var d=b.normal(),e=b.ol.e.v.pt,f=J.segmentAndPlane(a.v.pt,a.nxt.v.pt,e,d);if(null==f)return null;if(f.p>.9999999999||f.p<1e-10)return null;var g=X.lerp(f.p,a.nxt.v.pt,a.v.pt);return cb.isPointInFace(g,b,c)?cb.splitEdge(a,g):null},cb.getCoplanarVertices=function(a,b,c,e){for(var f={},g=0;g<c.length;){var h=c[g];++g,f[h.item0.id]=h.item0}for(var i=d(ga.iter(a.v))();i.hasNext();){var j=i.next();if(!f.hasOwnProperty(j.id))for(var k=d(ga.iter(b.f))();k.hasNext();){var l=k.next();cb.isPointInFace(j.pt,l,e)&&c.push(new va(j,l))}}return c};var db=function(){this.id=db.counter++};db.__name__=["verb","topo","Topo"];var eb=b.topo.Face=function(a){db.call(this),this.s=a};eb.__name__=["verb","topo","Face"],eb.__interfaces__=[ka],eb.__super__=db,eb.prototype=c(db.prototype,{loops:function(){return h.array(ga.iter(this.l))},rings:function(){for(var a=[],b=d(ga.iter(this.l))();b.hasNext();){var c=b.next();c!=this.ol&&a.push(c)}return a},addLoop:function(a){return null==a&&(a=new gb(this)),null==this.ol&&(this.ol=a),this.l=ga.push(this.l,a)},delLoop:function(a){if(a==this.ol)throw new o(new ia("Cannot delete outer loop!"));this.l=ga.kill(this.l,a)},neighbors:function(){var a={};a[this.id]=this;for(var b=[],c=this.halfEdges(),d=0;d<c.length;){var e=c[d];if(++d,null!=e.opp){var f=e.opp.l.f;a.hasOwnProperty(f.id)||(a[f.id]=f,b.push(f))}}return b},halfEdges:function(){return h.fold(this.loops(),function(a,b){return b.concat(a.halfEdges())},[])},tessellate:function(){var a=new lb;return a.contours=this.loops().map(function(a){return a.coords()}).filter(function(a){return a.length>3}),a.windingRule=nb.WINDING_POSITIVE,a.elementType=nb.POLYGONS,a.polySize=3,a.normal=this.normal(),a.vertexSize=3,nb.tessellate(a)},normal:function(){for(var a=[0,0,0],b=d(ga.iter(this.ol.e))();b.hasNext();){var c=b.next(),e=c.v.pt,f=c.nxt.v.pt,g=c.nxt.nxt.v.pt,h=X.sub(e,f),i=X.sub(g,f),j=X.cross(i,h);X.normSquared(j)>1e-10&&(a=X.add(a,j))}return X.normalized(a)}});var fb=b.topo.HalfEdge=function(a,b){db.call(this),this.v=b,this.v.e=this,this.l=a};fb.__name__=["verb","topo","HalfEdge"],fb.__interfaces__=[ka],fb.__super__=db,fb.prototype=c(db.prototype,{mate:function(a){return null==a?this:(this.opp=a,a.opp=this,this)}});var gb=b.topo.Loop=function(a){db.call(this),this.f=a};gb.__name__=["verb","topo","Loop"],gb.__interfaces__=[ka],gb.__super__=db,gb.prototype=c(db.prototype,{halfEdges:function(){return h.array(ga.iter(this.e))},vertices:function(){return this.halfEdges().map(function(a){return a.v})},coords:function(){return h.fold(this.vertices(),function(a,b){return b.concat(a.pt)},[])},points:function(){return this.vertices().map(function(a){return a.pt})},addHalfEdge:function(a,b,c){if(null!=b&&b.l!=this)throw new o(new ia("Next HalfEdge is not part of same Loop!"));if(null!=b&&null==b.opp&&null==c)return a.e=b,b.v=a,b;null!=b&&(this.e=b);var d=new fb(this,a);return d.mate(c),this.e=ga.push(this.e,d)},delHalfEdge:function(a){if(a.l!=this)throw new o(new ia("HalfEdge is not part of this Loop!"));return a.nxt==a?(a.opp=null,this.e=a,a.v.e=a,this):(null!=a.opp.nxt&&(a.v.e=a.opp.nxt),this.e=ga.kill(this.e,a),this)}});var hb=b.topo.Make=function(){};hb.__name__=["verb","topo","Make"],hb.lamina=function(a){for(var b=ib.mvfs(a[0]),c=a[0],d=b.f.l.e,e=b.f.l.e,f=0;f<a.length;){var g=a[f];if(++f,g!=c){var h=b.lmev(e,e,g);e=h.e}}return b.lmef(d.nxt,e),b},hb.extrusion=function(a,b){if(a.length<3)throw new o(new ia("More than three points are required to define a polygon!"));var c=hb.lamina(a),d=c.f.l.halfEdges().map(function(a){return c.lmev(a,a,X.add(a.v.pt,b))});return d.map(function(a){return a.e}).map(function(a){var b=c.lmef(a,a.nxt.nxt.nxt);return b}),c};var ib=b.topo.Solid=function(){db.call(this)};ib.__name__=["verb","topo","Solid"],ib.mvfs=function(a){var b=new ib,c=b.addFace(),d=c.addLoop();d.addHalfEdge(b.addVertex(a));return b},ib.__super__=db,ib.prototype=c(db.prototype,{lmev:function(a,b,c){for(var d=this.addVertex(c),e=a.v,f=a;f!=b;)f.v=d,f=f.opp.nxt;var g=b.l.addHalfEdge(d,b);a.l.addHalfEdge(e,a==b?g:a,g);return d},lmef:function(a,b){if(a.l!=b.l)throw new o(new ia("Both HalfEdge's must be part of the same loop!"));for(var c=this.addFace(),d=c.addLoop(),e=b.l,f=a;f!=b;)f.l=d,f=f.nxt;b.prv.nxt=a,a.prv.nxt=b;var g=b.prv;b.prv=a.prv,a.prv=g;var h=d.addHalfEdge(b.v,a);e.addHalfEdge(a.v,b,h);return c},lkemr:function(a){var b=a.opp,c=a.l,d=c.f.addLoop(),e=a.nxt,f=b.nxt;f.v.e=f,e.v.e=e,a.prv.nxt=b.nxt,b.nxt.prv=a.prv,c.e=b.nxt,b.nxt=a,a.prv=b;var g=a;do g.l=d,g=g.nxt;while(g!=a);return d.e=b,d.delHalfEdge(a),d.delHalfEdge(b),d},lkvfs:function(a){var b=a.v;return this.delVertex(b),this.delFace(a.l.f),this},lkev:function(a){if(a.nxt==a)throw new o(new ia("Cannot lkev the base case!"));var b=a.nxt.v,c=a.nxt;do c.v=a.v;while((c.opp.nxt=c)!=a.nxt);var d=a.opp;return a.l.delHalfEdge(a),d.l.delHalfEdge(d),this.delVertex(b)},lkef:function(a){if(null==a.opp)throw new o(new ia("Cannot kill base case!"));if(a.opp.l.f==a.l.f)throw new o(new ia("Edge does not traverse two distinct faces!"));var b=(a.l,a.l.f),c=a.opp,d=c.l,e=c.l.f,f=a;do f.l=d;while((f=f.nxt)!=a);var g=a.prv,h=a.nxt,i=c.prv,j=c.nxt;g.nxt=j,j.prv=g,i.nxt=h,h.prv=i,a.v.e=j,c.v.e=h,d.e==c&&(d.e=i);for(var k=0,l=b.rings();k<l.length;){var m=l[k];++k,m.f=e,ga.push(e.l,m)}return this.delFace(b),this},lmekr:function(a,b){if(a.l==b.l)throw new o(new ia("HalfEdges are not from different loops!"));if(a.l.f!=b.l.f)throw new o(new ia("HalfEdges must be part of the same face!"));var c=b.l;c.f.delLoop(c);for(var e=a.l,f=d(ga.iter(b))();f.hasNext();){var g=f.next();g.l=e}var h;h=a.nxt==a?a:new fb(e,a.v);var i;return i=b.nxt==b?b:new fb(e,b.v),h.mate(i),a.prv.nxt=h,b.prv.nxt=i,h.prv=a.prv,i.prv=b.prv,b.prv=h,a.prv=i,h.nxt=b,i.nxt=a,h},lkfmrh:function(a,b){if(a.rings().length>0)throw new o(new ia("Cannot insert a face with rings as a ring of another face!"));return this.delFace(a),a.ol.f=b,ga.push(b.l,a.ol),a.ol},lmfkrh:function(a){var b=a.f;b.delLoop(a);var c=this.addFace();return c.addLoop(a),a.f=c,c},addFace:function(){return this.f=ga.push(this.f,new eb(this))},delFace:function(a){if(a.s!=this)throw new o(new ia("Face is not part of this Solid!"));return this.f=ga.kill(this.f,a),this},addVertex:function(a){return this.v=ga.push(this.v,new Bb(a))},delVertex:function(a){if(a.e.l.f.s!=this)throw new o(new ia("Face is not part of this Solid!"));return this.v=ga.kill(this.v,a),this},vertices:function(){return h.array(ga.iter(this.v))},faces:function(){return h.array(ga.iter(this.f))},loops:function(){return h.fold(this.faces(),function(a,b){return b.concat(a.loops())},[])},halfEdges:function(){return h.fold(this.loops(),function(a,b){return b.concat(a.halfEdges())},[])},edges:function(){for(var a={},b=[],c=0,d=this.halfEdges();c<d.length;){var e=d[c];++c,null==e.opp||a.hasOwnProperty(e.id)||a.hasOwnProperty(e.opp.id)||(a[e.id]=e,a[e.opp.id]=e.opp,b.push(new va(e,e.opp)))}return b},print:function(){return"Solid ("+this.vertices().length+" Vertices, "+this.faces().length+" Faces, "+this.loops().length+" Loops, "+this.halfEdges().length+" HalfEdges)"}});var jb={__ename__:!0,__constructs__:["On","Above","Below"]};jb.On=["On",0],jb.On.toString=f,jb.On.__enum__=jb,jb.Above=["Above",1],jb.Above.toString=f,jb.Above.__enum__=jb,jb.Below=["Below",2],jb.Below.toString=f,jb.Below.__enum__=jb;var kb=b.topo.Split=function(){};kb.__name__=["verb","topo","Split"],kb.solidByPlane=function(a,b){for(var c,d=kb.intersect(a,b),e=[],f=0;f<d.length;){var g=d[f];++f,e.push(kb.isCrossingEdge(g.item1)?kb.splitEdge(g.item0,g.item1).v:g.item0.v)}c=e;for(var h=[],i=0;i<c.length;){var j=c[i];++i,kb.insertNullEdges(j,kb.classifyVertex(j,b),h)}if(0==h.length)return null;var k=[];kb.connect(h,k);var l=new ib,m=new ib;return kb.close(k,l,m),new va(m,l)},kb.close=function(a,b,c){for(var d,e=a[0].s,f=[],g=0;g<a.length;){var h=a[g];++g,f.push(e.lmfkrh(h.l))}d=f;for(var i=0;i<a.length;){var j=a[i];++i,kb.moveFace(j,b)}for(var k=0;k<d.length;){var l=d[k];++k,kb.moveFace(l,c)}kb.cleanup(b,e),kb.cleanup(c,e)},kb.connect=function(a,b){kb.lexicographicalSort(a);for(var c,d,e=[],f=0;f<a.length;){var g=a[f];++f,null!=(c=kb.canJoin(g,e))&&(kb.join(c,g),kb.isLoose(c.opp,e)||kb.cut(c,b)),null!=(d=kb.canJoin(g.opp,e))&&(kb.join(d,g.opp),kb.isLoose(d.opp,e)||kb.cut(d,b)),null!=c&&null!=d&&kb.cut(g,b)}},kb.insertNullEdges=function(a,b,c){var d=a.e.l.f.s,e=kb.nextOfClass(jb.Above,b,0);if(-1!=e&&-1!=kb.nextOfClass(jb.Below,b,0))for(var f=b[e].edge,g=f,h=f,i=b.length;;){for(;b[e].pos==jb.Above;)h=b[e].edge,e=(e+1)%i;if(d.lmev(g,h.opp.nxt,g.v.pt.slice()),c.push(g.prv),e=kb.nextOfClass(jb.Above,b,e),-1==e)break;if(g=b[e].edge,g==f)break}},kb.classifyVertex=function(a,b){for(var c=[],d=0,e=a.halfEdges();d<e.length;){var f=e[d];++d,c.push({edge:f,pos:kb.classify(f,b)}),kb.wideSector(f)&&c.push({
edge:f,pos:kb.classifyBisector(f,b)})}for(var g=c.length,h=0;g>h;){var i=h++,j=c[i];if(j.pos==jb.On){var k=kb.reclassifyCoplanarSector(j.edge,b);c[i].pos=k,c[(i+1)%g].pos=k}}for(var l=0;g>l;){var m=l++,n=c[m];if(n.pos==jb.On){var p;p=0==m?g-1:m-1;var q=(m+1)%g,r=c[p].pos,s=c[q].pos;if(r==jb.Above&&s==jb.Above)n.pos=jb.Below;else if(r==jb.Below&&s==jb.Above)n.pos=jb.Below;else if(r==jb.Above&&s==jb.Below)n.pos=jb.Below;else{if(r!=jb.Below||s!=jb.Below)throw new o(new ia("Double On edge encountered!"));n.pos=jb.Above}}}return c},kb.moveFace=function(a,b){if(a.s!=b){a.s.f=ga.kill(a.s.f,a),b.f=ga.push(b.f,a),a.s=b;for(var c=0,d=a.neighbors();c<d.length;){var e=d[c];++c,kb.moveFace(e,b)}}},kb.cleanup=function(a,b){for(var c={},e=d(ga.iter(a.f))();e.hasNext();)for(var f=e.next(),g=d(ga.iter(f.l))();g.hasNext();)for(var h=g.next(),i=0,j=h.vertices();i<j.length;){var k=j[i];++i,c.hasOwnProperty(k.id)||(c[k.id]=k,b.v=ga.kill(b.v,k),a.v=ga.push(a.v,k))}},kb.canJoin=function(a,b){for(var c=0,d=b.length;d>c;){var e=c++;if(kb.neighbor(a,b[e])){var f=b[e];return b.splice(e,1),f}}return b.push(a),null},kb.neighbor=function(a,b){return a.l.f==b.l.f},kb.isLoose=function(a,b){return-1!=g.indexOf(b,a,0)},kb.join=function(a,b){var c=a.l.f,d=null,e=a.l.f.s;a.l==b.l?a.prv.prv!=b&&(d=e.lmef(a,b.nxt)):e.lmekr(a,b.nxt),a.nxt.nxt!=b&&(e.lmef(b,a.nxt),null!=d&&c.l.nxt!=c.l&&l.trace("PANIC!",{fileName:"Split.hx",lineNumber:285,className:"verb.topo.Split",methodName:"join"}))},kb.cut=function(a,b){a.l==a.opp.l?(b.push(a.l.f),a.l.f.s.lkemr(a)):a.l.f.s.lkef(a)},kb.lexicographicalSort=function(a){a.sort(function(a,b){var c=a.v.pt,d=b.v.pt;return c[0]<d[0]?-1:c[0]>d[0]?1:c[1]<d[1]?-1:c[1]>d[1]?1:c[2]<d[2]?-1:c[2]>d[2]?1:0})},kb.nextOfClass=function(a,b,c){for(var d=c,e=null;d<b.length;){if(b[d].pos==a){e=b[d];break}d++}return null!=e?d:-1},kb.wideSector=function(a){var b=a.l.f.normal(),c=X.normalized(X.sub(a.nxt.v.pt,a.v.pt)),d=X.normalized(X.sub(a.prv.v.pt,a.v.pt));return X.signedAngleBetween(c,d,b)>Math.PI},kb.classifyBisector=function(a,b){return kb.classifyPoint(X.mul(.5,X.add(a.nxt.v.pt,a.prv.v.pt)),b)},kb.reclassifyCoplanarSector=function(a,b){var c=a.l.f.normal(),d=a.opp.l.f.normal(),e=X.dot(c,b.n),f=X.dot(d,b.n),g=1.0000000000000001e-20;return Math.abs(e-1)<g||Math.abs(f-1)<g?jb.Below:Math.abs(e+1)<g||Math.abs(f+1)<g?jb.Above:jb.On},kb.classify=function(a,b){return kb.classifyPoint(a.nxt.v.pt,b)},kb.classifyPoint=function(a,b){var c=X.dot(X.sub(a,b.o),b.n);return Math.abs(c)<1e-10?jb.On:c>0?jb.Above:jb.Below},kb.intersect=function(a,b){for(var c=[],d=0,e=a.edges();d<e.length;){var f=e[d];++d;var g=f.item0,h=J.segmentAndPlane(g.v.pt,g.nxt.v.pt,b.o,b.n);null!=h&&(h.p>.9999999999&&(h.p=0,g=g.nxt),c.push(new va(g,h.p)))}return c},kb.splitEdge=function(a,b){var c=a.l.f.s,d=kb.pointOnHalfEdge(a,b),e=d.slice(),f=c.lmev(a,a.opp.nxt,e);return f.e},kb.isCrossingEdge=function(a){return.9999999999>a&&a>1e-10},kb.pointOnHalfEdge=function(a,b){return X.lerp(b,a.nxt.v.pt,a.v.pt)},kb.intersectionPoints=function(a,b){for(var c=[],d=0,e=kb.intersect(a,b);d<e.length;){var f=e[d];++d,c.push(kb.pointOnHalfEdge(f.item0,f.item1))}return c};var lb=b.topo.Tess2Options=function(){this.contours=[],this.debug=!1,this.normal=[0,0,1],this.vertexSize=2,this.polySize=3,this.elementType=nb.POLYGONS,this.windingRule=nb.WINDING_ODD};lb.__name__=["verb","topo","Tess2Options"];var mb=b.topo.Tess2Result=function(a,b,c,d,e,f){this.vertices=a,this.vertexIndices=b,this.vertexCount=c,this.elements=d,this.elementCount=e,this.mesh=f};mb.__name__=["verb","topo","Tess2Result"];var nb=b.topo.Tess2=function(){};nb.__name__=["verb","topo","Tess2"],nb.tessellate=function(a){for(var b=new Ab,c=0,d=a.contours.length;d>c;){var e=c++;b.addContour(a.vertexSize,a.contours[e])}return b.tessellate(a.windingRule,a.elementType,a.polySize,a.vertexSize,a.normal),new mb(b.vertices,b.vertexIndices,b.vertexCount,b.elements,b.elementCount,a.debug?b.mesh:null)},nb.assert=function(a){if(!a)throw new o("Assertion Failed!")};var ob=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0};ob.__name__=["verb","topo","TESSvertex"];var pb=function(){this.next=null,this.prev=null,this.anEdge=null,this.n=0,this.marked=!1,this.inside=!1};pb.__name__=["verb","topo","TESSface"];var qb=function(a){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=a};qb.__name__=["verb","topo","TESShalfEdge"],qb.prototype={getRface:function(){return this.Sym.Lface},setRface:function(a){this.Sym.Lface=a},getDst:function(){return this.Sym.Org},setDst:function(a){this.Sym.Org=a},getOprev:function(){return this.Sym.Lnext},setOprev:function(a){this.Sym.Lnext=a},getLprev:function(){return this.Onext.Sym},setLprev:function(a){this.Onext.Sym=a},getDprev:function(){return this.Lnext.Sym},setDprev:function(a){this.Lnext.Sym=a},getRprev:function(){return this.Sym.Onext},setRprev:function(a){this.Sym.Onext=a},getDnext:function(){return this.Sym.Onext.Sym},setDnext:function(a){this.Sym.Onext.Sym=a},getRnext:function(){return this.Sym.Lnext.Sym},setRnext:function(a){this.Sym.Lnext.Sym=a}};var rb=function(){var a=new ob,b=new pb,c=new qb(0),d=new qb(1);a.next=a.prev=a,a.anEdge=null,b.next=b.prev=b,b.anEdge=null,b.marked=!1,b.inside=!1,c.next=c,c.Sym=d,c.Onext=null,c.Lnext=null,c.Org=null,c.Lface=null,c.winding=0,c.activeRegion=null,d.next=d,d.Sym=c,d.Onext=null,d.Lnext=null,d.Org=null,d.Lface=null,d.winding=0,d.activeRegion=null,this.vHead=a,this.fHead=b,this.eHead=c,this.eHeadSym=d};rb.__name__=["verb","topo","TESSmesh"],rb.prototype={makeEdge_:function(a){var b=new qb(0),c=new qb(1);a.Sym.side<a.side&&(a=a.Sym);var d=a.Sym.next;return c.next=d,d.Sym.next=b,b.next=a,a.Sym.next=c,b.Sym=c,b.Onext=b,b.Lnext=c,b.Org=null,b.Lface=null,b.winding=0,b.activeRegion=null,c.Sym=b,c.Onext=c,c.Lnext=b,c.Org=null,c.Lface=null,c.winding=0,c.activeRegion=null,b},splice_:function(a,b){var c=a.Onext,d=b.Onext;c.Sym.Lnext=b,d.Sym.Lnext=a,a.Onext=d,b.Onext=c},makeVertex_:function(a,b,c){var d=a;nb.assert(null!=d);var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b;var f=b;do f.Org=d,f=f.Onext;while(f!=b)},makeFace_:function(a,b,c){var d=a;nb.assert(null!=d);var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b,d.marked=!1,d.inside=c.inside;var f=b;do f.Lface=d,f=f.Lnext;while(f!=b)},killEdge_:function(a){a.Sym.side<a.side&&(a=a.Sym);var b=a.next,c=a.Sym.next;b.Sym.next=c,c.Sym.next=b},killVertex_:function(a,b){var c=a.anEdge,d=c;do d.Org=b,d=d.Onext;while(d!=c);var e=a.prev,f=a.next;f.prev=e,e.next=f},killFace_:function(a,b){var c=a.anEdge,d=c;do d.Lface=b,d=d.Lnext;while(d!=c);var e=a.prev,f=a.next;f.prev=e,e.next=f},makeEdge:function(){var a=new ob,b=new ob,c=new pb,d=this.makeEdge_(this.eHead);return this.makeVertex_(a,d,this.vHead),this.makeVertex_(b,d.Sym,this.vHead),this.makeFace_(c,d,this.fHead),d},splice:function(a,b){var c=!1,d=!1;if(a!=b){if(b.Org!=a.Org&&(d=!0,this.killVertex_(b.Org,a.Org)),b.Lface!=a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(b,a),!d){var e=new ob;this.makeVertex_(e,b,a.Org),a.Org.anEdge=a}if(!c){var f=new pb;this.makeFace_(f,b,a.Lface),a.Lface.anEdge=a}}},"delete":function(a){var b=a.Sym,c=!1;if(a.Lface!=a.getRface()&&(c=!0,this.killFace_(a.Lface,a.getRface())),a.Onext==a)this.killVertex_(a.Org,null);else if(a.getRface().anEdge=a.getOprev(),a.Org.anEdge=a.Onext,this.splice_(a,a.getOprev()),!c){var d=new pb;this.makeFace_(d,a,a.Lface)}b.Onext==b?(this.killVertex_(b.Org,null),this.killFace_(b.Lface,null)):(a.Lface.anEdge=b.getOprev(),b.Org.anEdge=b.Onext,this.splice_(b,b.getOprev())),this.killEdge_(a)},addEdgeVertex:function(a){var b=this.makeEdge_(a),c=b.Sym;this.splice_(b,a.Lnext),b.Org=a.getDst();var d=new ob;return this.makeVertex_(d,c,b.Org),b.Lface=c.Lface=a.Lface,b},splitEdge:function(a){var b=this.addEdgeVertex(a),c=b.Sym;return this.splice_(a.Sym,a.Sym.getOprev()),this.splice_(a.Sym,c),a.setDst(c.Org),c.getDst().anEdge=c.Sym,c.setRface(a.getRface()),c.winding=a.winding,c.Sym.winding=a.Sym.winding,c},connect:function(a,b){var c=!1,d=this.makeEdge_(a),e=d.Sym;if(b.Lface!=a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(d,a.Lnext),this.splice_(e,b),d.Org=a.getDst(),e.Org=b.Org,d.Lface=e.Lface=a.Lface,a.Lface.anEdge=e,!c){var f=new pb;this.makeFace_(f,d,a.Lface)}return d},zapFace:function(a){var b,c,d,e,f,g=a.anEdge;c=g.Lnext;do b=c,c=b.Lnext,b.Lface=null,null==b.getRface()&&(b.Onext==b?this.killVertex_(b.Org,null):(b.Org.anEdge=b.Onext,this.splice_(b,b.getOprev())),d=b.Sym,d.Onext==d?this.killVertex_(d.Org,null):(d.Org.anEdge=d.Onext,this.splice_(d,d.getOprev())),this.killEdge_(b));while(b!=g);e=a.prev,f=a.next,f.prev=e,e.next=f},countFaceVerts_:function(a){var b=a.anEdge,c=0;do c++,b=b.Lnext;while(b!=a.anEdge);return c},mergeConvexFaces:function(a){for(var b,c,d,e,f,g,h=this.fHead.next;h!=this.fHead;)if(h.inside){for(b=h.anEdge,e=b.Org;;){if(c=b.Lnext,d=b.Sym,null!=d&&null!=d.Lface&&d.Lface.inside&&(f=this.countFaceVerts_(h),g=this.countFaceVerts_(d.Lface),a>=f+g-2&&sb.vertCCW(b.getLprev().Org,b.Org,d.Lnext.Lnext.Org)&&sb.vertCCW(d.getLprev().Org,d.Org,b.Lnext.Lnext.Org)&&(c=d.Lnext,this["delete"](d),b=null,d=null)),null!=b&&b.Lnext.Org==e)break;b=c}h=h.next}else h=h.next;return!0},check:function(){for(var a,b,c,d,e,f=this.fHead,g=this.vHead,h=this.eHead,i=f;(a=i.next)!=f;){nb.assert(a.prev==i),d=a.anEdge;do nb.assert(d.Sym!=d),nb.assert(d.Sym.Sym==d),nb.assert(d.Lnext.Onext.Sym==d),nb.assert(d.Onext.Sym.Lnext==d),nb.assert(d.Lface==a),d=d.Lnext;while(d!=a.anEdge);i=a}for(nb.assert(a.prev==i&&null==a.anEdge),c=g;(b=c.next)!=g;){nb.assert(b.prev==c),d=b.anEdge;do nb.assert(d.Sym!=d),nb.assert(d.Sym.Sym==d),nb.assert(d.Lnext.Onext.Sym==d),nb.assert(d.Onext.Sym.Lnext==d),nb.assert(d.Org==b),d=d.Onext;while(d!=b.anEdge);c=b}for(nb.assert(b.prev==c&&null==b.anEdge),e=h;(d=e.next)!=h;)nb.assert(d.Sym.next==e.Sym),nb.assert(d.Sym!=d),nb.assert(d.Sym.Sym==d),nb.assert(null!=d.Org),nb.assert(null!=d.getDst()),nb.assert(d.Lnext.Onext.Sym==d),nb.assert(d.Onext.Sym.Lnext==d),e=d;nb.assert(d.Sym.next==e.Sym&&d.Sym==this.eHeadSym&&d.Sym.Sym==d&&null==d.Org&&null==d.getDst()&&null==d.Lface&&null==d.getRface())}};var sb=function(){};sb.__name__=["verb","topo","Geom"],sb.vertEq=function(a,b){return a.s==b.s&&a.t==b.t},sb.vertLeq=function(a,b){return a.s<b.s||a.s==b.s&&a.t<=b.t},sb.transLeq=function(a,b){return a.t<b.t||a.t==b.t&&a.s<=b.s},sb.edgeGoesLeft=function(a){return sb.vertLeq(a.getDst(),a.Org)},sb.edgeGoesRight=function(a){return sb.vertLeq(a.Org,a.getDst())},sb.vertL1dist=function(a,b){return Math.abs(a.s-b.s)+Math.abs(a.t-b.t)},sb.edgeEval=function(a,b,c){nb.assert(sb.vertLeq(a,b)&&sb.vertLeq(b,c));var d=b.s-a.s,e=c.s-b.s;return d+e>0?e>d?b.t-a.t+(a.t-c.t)*(d/(d+e)):b.t-c.t+(c.t-a.t)*(e/(d+e)):0},sb.edgeSign=function(a,b,c){nb.assert(sb.vertLeq(a,b)&&sb.vertLeq(b,c));var d=b.s-a.s,e=c.s-b.s;return d+e>0?(b.t-c.t)*d+(b.t-a.t)*e:0},sb.transEval=function(a,b,c){nb.assert(sb.transLeq(a,b)&&sb.transLeq(b,c));var d=b.t-a.t,e=c.t-b.t;return d+e>0?e>d?b.s-a.s+(a.s-c.s)*(d/(d+e)):b.s-c.s+(c.s-a.s)*(e/(d+e)):0},sb.transSign=function(a,b,c){nb.assert(sb.transLeq(a,b)&&sb.transLeq(b,c));var d=b.t-a.t,e=c.t-b.t;return d+e>0?(b.s-c.s)*d+(b.s-a.s)*e:0},sb.vertCCW=function(a,b,c){return a.s*(b.t-c.t)+b.s*(c.t-a.t)+c.s*(a.t-b.t)>=0},sb.interpolate=function(a,b,c,d){var e;e=0>a?0:a;var f;return f=0>c?0:c,f>=e?0==f?(b+d)/2:b+(d-b)*(e/(e+f)):d+(b-d)*(f/(e+f))},sb.intersect=function(a,b,c,d,e){var f,g,h;sb.vertLeq(a,b)||(h=a,a=b,b=h),sb.vertLeq(c,d)||(h=c,c=d,d=h),sb.vertLeq(a,c)||(h=a,a=c,c=h,h=b,b=d,d=h),sb.vertLeq(c,b)?sb.vertLeq(b,d)?(f=sb.edgeEval(a,c,b),g=sb.edgeEval(c,b,d),0>f+g&&(f=-f,g=-g),e.s=sb.interpolate(f,c.s,g,b.s)):(f=sb.edgeSign(a,c,b),g=-sb.edgeSign(a,d,b),0>f+g&&(f=-f,g=-g),e.s=sb.interpolate(f,c.s,g,d.s)):e.s=(c.s+b.s)/2,sb.transLeq(a,b)||(h=a,a=b,b=h),sb.transLeq(c,d)||(h=c,c=d,d=h),sb.transLeq(a,c)||(h=a,a=c,c=h,h=b,b=d,d=h),sb.transLeq(c,b)?sb.transLeq(b,d)?(f=sb.transEval(a,c,b),g=sb.transEval(c,b,d),0>f+g&&(f=-f,g=-g),e.t=sb.interpolate(f,c.t,g,b.t)):(f=sb.transSign(a,c,b),g=-sb.transSign(a,d,b),0>f+g&&(f=-f,g=-g),e.t=sb.interpolate(f,c.t,g,d.t)):e.t=(c.t+b.t)/2};var tb=function(){this.key=null,this.next=null,this.prev=null};tb.__name__=["verb","topo","DictNode"];var ub=function(a,b){this.head=new tb,this.head.next=this.head,this.head.prev=this.head,this.frame=a,this.leq=b};ub.__name__=["verb","topo","Dict"],ub.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(a){return this.insertBefore(this.head,a)},search:function(a){var b=this.head;do b=b.next;while(null!=b.key&&!this.leq(this.frame,a,b.key));return b},insertBefore:function(a,b){do a=a.prev;while(null!=a.key&&!this.leq(this.frame,a.key,b));var c=new tb;return c.key=b,c.next=a.next,a.next.prev=c,c.prev=a,a.next=c,c},"delete":function(a){a.next.prev=a.prev,a.prev.next=a.next}};var vb=function(){this.handle=null};vb.__name__=["verb","topo","PQnode"];var wb=function(){this.key=null,this.node=null};wb.__name__=["verb","topo","PQhandleElem"];var xb=function(a,b){this.size=0,this.max=a,this.nodes=[],A.alloc(this.nodes,a+1);for(var c=0,d=this.nodes.length;d>c;){var e=c++;this.nodes[e]=new vb}this.handles=[],A.alloc(this.handles,a+1);for(var f=0,g=this.handles.length;g>f;){var h=f++;this.handles[h]=new wb}this.initialized=!1,this.freeList=0,this.leq=b,this.nodes[1].handle=1,this.handles[1].key=null};xb.__name__=["verb","topo","PriorityQ"],xb.prototype={floatDown_:function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if(d=a<<1,d<this.size&&this.leq(f[e[d+1].handle].key,f[e[d].handle].key)&&++d,nb.assert(d<=this.max),c=e[d].handle,d>this.size||this.leq(f[b].key,f[c].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},floatUp_:function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if(d=a>>1,c=e[d].handle,0==d||this.leq(f[c].key,f[b].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},init:function(){for(var a=this.size;a>=1;)this.floatDown_(a),--a;this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){0==this.size},insert:function(a){var b,c;if(b=++this.size,2*b>this.max){this.max*=2;var d;d=this.nodes.length,A.alloc(this.nodes,this.max+1);for(var e=d,f=this.nodes.length;f>e;){var g=e++;this.nodes[g]=new vb}d=this.handles.length,A.alloc(this.handles,this.max+1);for(var h=d,i=this.handles.length;i>h;){var j=h++;this.handles[j]=new wb}}return 0==this.freeList?c=b:(c=this.freeList,this.freeList=this.handles[c].node),this.nodes[b].handle=c,this.handles[c].node=b,this.handles[c].key=a,this.initialized&&this.floatUp_(b),c},extractMin:function(){var a=this.nodes,b=this.handles,c=a[1].handle,d=b[c].key;return this.size>0&&(a[1].handle=a[this.size].handle,b[a[1].handle].node=1,b[c].key=null,b[c].node=this.freeList,this.freeList=c,--this.size,this.size>0&&this.floatDown_(1)),d},"delete":function(a){var b,c=this.nodes,d=this.handles;nb.assert(a>=1&&a<=this.max&&null!=d[a].key),b=d[a].node,c[b].handle=c[this.size].handle,d[c[b].handle].node=b,--this.size,b<=this.size&&(1>=b||this.leq(d[c[b>>1].handle].key,d[c[b].handle].key)?this.floatDown_(b):this.floatUp_(b)),d[a].key=null,d[a].node=this.freeList,this.freeList=a}};var yb=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1};yb.__name__=["verb","topo","ActiveRegion"];var zb=function(){};zb.__name__=["verb","topo","Sweep"],zb.regionBelow=function(a){return a.nodeUp.prev.key},zb.regionAbove=function(a){return a.nodeUp.next.key},zb.debugEvent=function(a){},zb.addWinding=function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},zb.edgeLeq=function(a,b,c){var d=a.event,e=b.eUp,f=c.eUp;if(e.getDst()==d)return f.getDst()==d?sb.vertLeq(e.Org,f.Org)?sb.edgeSign(f.getDst(),e.Org,f.Org)<=0:sb.edgeSign(e.getDst(),f.Org,e.Org)>=0:sb.edgeSign(f.getDst(),d,f.Org)<=0;if(f.getDst()==d)return sb.edgeSign(e.getDst(),d,e.Org)>=0;var g=sb.edgeEval(e.getDst(),d,e.Org),h=sb.edgeEval(f.getDst(),d,f.Org);return g>=h},zb.deleteRegion=function(a,b){b.fixUpperEdge&&nb.assert(0==b.eUp.winding),b.eUp.activeRegion=null,a.dict["delete"](b.nodeUp)},zb.fixUpperEdge=function(a,b,c){nb.assert(b.fixUpperEdge),a.mesh["delete"](b.eUp),b.fixUpperEdge=!1,b.eUp=c,c.activeRegion=b},zb.topLeftRegion=function(a,b){var c,d=b.eUp.Org;do b=zb.regionAbove(b);while(b.eUp.Org==d);if(b.fixUpperEdge){if(c=a.mesh.connect(zb.regionBelow(b).eUp.Sym,b.eUp.Lnext),null==c)return null;zb.fixUpperEdge(a,b,c),b=zb.regionAbove(b)}return b},zb.topRightRegion=function(a){var b=a.eUp.getDst(),c=null;do c=zb.regionAbove(c);while(c.eUp.getDst()==b);return c},zb.addRegionBelow=function(a,b,c){var d=new yb;return d.eUp=c,d.nodeUp=a.dict.insertBefore(b.nodeUp,d),d.fixUpperEdge=!1,d.sentinel=!1,d.dirty=!1,c.activeRegion=d,d},zb.isWindingInside=function(a,b){var c=a.windingRule;switch(c){case 0:return 0!=(1&b);case 1:return 0!=b;case 2:return b>0;case 3:return 0>b;case 4:return b>=2||-2>=b}return nb.assert(!1),!1},zb.computeWinding=function(a,b){b.windingNumber=zb.regionAbove(b).windingNumber+b.eUp.winding,b.inside=zb.isWindingInside(a,b.windingNumber)},zb.finishRegion=function(a,b){var c=b.eUp,d=c.Lface;d.inside=b.inside,d.anEdge=c,zb.deleteRegion(a,b)},zb.finishLeftRegions=function(a,b,c){for(var d,e=null,f=b,g=b.eUp;f!=c;){if(f.fixUpperEdge=!1,e=zb.regionBelow(f),d=e.eUp,d.Org!=g.Org){if(!e.fixUpperEdge){zb.finishRegion(a,f);break}d=a.mesh.connect(g.getLprev(),d.Sym),zb.fixUpperEdge(a,e,d)}g.Onext!=d&&(a.mesh.splice(d.getOprev(),d),a.mesh.splice(g,d)),zb.finishRegion(a,f),g=e.eUp,f=e}return g},zb.addRightEdges=function(a,b,c,d,e,f){var g,h,i,j=null,k=!0;h=c;do nb.assert(sb.vertLeq(h.Org,h.getDst())),zb.addRegionBelow(a,b,h.Sym),h=h.Onext;while(h!=d);for(null==e&&(e=zb.regionBelow(b).eUp.getRprev()),g=b,i=e;;){if(j=zb.regionBelow(g),h=j.eUp.Sym,h.Org!=i.Org)break;h.Onext!=i&&(a.mesh.splice(h.getOprev(),h),a.mesh.splice(i.getOprev(),h)),j.windingNumber=g.windingNumber-h.winding,j.inside=zb.isWindingInside(a,j.windingNumber),g.dirty=!0,!k&&zb.checkForRightSplice(a,g)&&(zb.addWinding(h,i),zb.deleteRegion(a,g),a.mesh["delete"](i)),k=!1,g=j,i=h}g.dirty=!0,nb.assert(g.windingNumber-h.winding==j.windingNumber),f&&zb.walkDirtyRegions(a,g)},zb.spliceMergeVertices=function(a,b,c){a.mesh.splice(b,c)},zb.vertexWeights=function(a,b,c){var d=sb.vertL1dist(b,a),e=sb.vertL1dist(c,a),f=.5*e/(d+e),g=.5*d/(d+e);a.coords[0]+=f*b.coords[0]+g*c.coords[0],a.coords[1]+=f*b.coords[1]+g*c.coords[1],a.coords[2]+=f*b.coords[2]+g*c.coords[2]},zb.getIntersectData=function(a,b,c,d,e,f){b.coords[0]=b.coords[1]=b.coords[2]=0,b.idx=-1,zb.vertexWeights(b,c,d),zb.vertexWeights(b,e,f)},zb.checkForRightSplice=function(a,b){var c=zb.regionBelow(b),d=b.eUp,e=c.eUp;if(sb.vertLeq(d.Org,e.Org)){if(sb.edgeSign(e.getDst(),d.Org,e.Org)>0)return!1;sb.vertEq(d.Org,e.Org)?d.Org!=e.Org&&(a.pq["delete"](d.Org.pqHandle),zb.spliceMergeVertices(a,e.getOprev(),d)):(a.mesh.splitEdge(e.Sym),a.mesh.splice(d,e.getOprev()),b.dirty=c.dirty=!0)}else{if(sb.edgeSign(d.getDst(),e.Org,d.Org)<0)return!1;zb.regionAbove(b).dirty=b.dirty=!0,a.mesh.splitEdge(d.Sym),a.mesh.splice(e.getOprev(),d)}return!0},zb.checkForLeftSplice=function(a,b){var c,d=zb.regionBelow(b),e=b.eUp,f=d.eUp;if(nb.assert(!sb.vertEq(e.getDst(),f.getDst())),sb.vertLeq(e.getDst(),f.getDst())){if(sb.edgeSign(e.getDst(),f.getDst(),e.Org)<0)return!1;zb.regionAbove(b).dirty=b.dirty=!0,c=a.mesh.splitEdge(e),a.mesh.splice(f.Sym,c),c.Lface.inside=b.inside}else{if(sb.edgeSign(f.getDst(),e.getDst(),f.Org)>0)return!1;b.dirty=d.dirty=!0,c=a.mesh.splitEdge(f),a.mesh.splice(e.Lnext,f.Sym),c.getRface().inside=b.inside}return!0},zb.checkForIntersect=function(a,b){var c,d,e,f,g=zb.regionBelow(b),h=b.eUp,i=g.eUp,j=h.Org,k=i.Org,l=h.getDst(),m=i.getDst(),n=new ob;if(nb.assert(!sb.vertEq(m,l)),nb.assert(sb.edgeSign(l,a.event,j)<=0),nb.assert(sb.edgeSign(m,a.event,k)>=0),nb.assert(j!=a.event&&k!=a.event),nb.assert(!b.fixUpperEdge&&!g.fixUpperEdge),j==k)return!1;if(c=Math.min(j.t,l.t),d=Math.max(k.t,m.t),c>d)return!1;if(sb.vertLeq(j,k)){if(sb.edgeSign(m,j,k)>0)return!1}else if(sb.edgeSign(l,k,j)<0)return!1;return zb.debugEvent(a),sb.intersect(l,j,m,k,n),nb.assert(Math.min(j.t,l.t)<=n.t),nb.assert(n.t<=Math.max(k.t,m.t)),nb.assert(Math.min(m.s,l.s)<=n.s),nb.assert(n.s<=Math.max(k.s,j.s)),sb.vertLeq(n,a.event)&&(n.s=a.event.s,n.t=a.event.t),e=sb.vertLeq(j,k)?j:k,sb.vertLeq(e,n)&&(n.s=e.s,n.t=e.t),sb.vertEq(n,j)||sb.vertEq(n,k)?(zb.checkForRightSplice(a,b),!1):!sb.vertEq(l,a.event)&&sb.edgeSign(l,a.event,n)>=0||!sb.vertEq(m,a.event)&&sb.edgeSign(m,a.event,n)<=0?m==a.event?(a.mesh.splitEdge(h.Sym),a.mesh.splice(i.Sym,h),b=zb.topLeftRegion(a,b),h=zb.regionBelow(b).eUp,zb.finishLeftRegions(a,zb.regionBelow(b),g),zb.addRightEdges(a,b,h.getOprev(),h,h,!0),!0):l==a.event?(a.mesh.splitEdge(i.Sym),a.mesh.splice(h.Lnext,i.getOprev()),g=b,b=zb.topRightRegion(b),f=zb.regionBelow(b).eUp.getRprev(),g.eUp=i.getOprev(),i=zb.finishLeftRegions(a,g,null),zb.addRightEdges(a,b,i.Onext,h.getRprev(),f,!0),!0):(sb.edgeSign(l,a.event,n)>=0&&(zb.regionAbove(b).dirty=b.dirty=!0,a.mesh.splitEdge(h.Sym),h.Org.s=a.event.s,h.Org.t=a.event.t),sb.edgeSign(m,a.event,n)<=0&&(b.dirty=g.dirty=!0,a.mesh.splitEdge(i.Sym),i.Org.s=a.event.s,i.Org.t=a.event.t),!1):(a.mesh.splitEdge(h.Sym),a.mesh.splitEdge(i.Sym),a.mesh.splice(i.getOprev(),h),h.Org.s=n.s,h.Org.t=n.t,h.Org.pqHandle=a.pq.insert(h.Org),zb.getIntersectData(a,h.Org,j,l,k,m),zb.regionAbove(b).dirty=b.dirty=g.dirty=!0,!1)},zb.walkDirtyRegions=function(a,b){for(var c,d,e=zb.regionBelow(b);;){for(;e.dirty;)b=e,e=zb.regionBelow(e);if(!b.dirty&&(e=b,b=zb.regionAbove(b),null==b||!b.dirty))return;if(b.dirty=!1,c=b.eUp,d=e.eUp,c.getDst()!=d.getDst()&&zb.checkForLeftSplice(a,b)&&(e.fixUpperEdge?(zb.deleteRegion(a,e),a.mesh["delete"](d),e=zb.regionBelow(b),d=e.eUp):b.fixUpperEdge&&(zb.deleteRegion(a,b),a.mesh["delete"](c),b=zb.regionAbove(e),c=b.eUp)),c.Org!=d.Org)if(c.getDst()==d.getDst()||b.fixUpperEdge||e.fixUpperEdge||c.getDst()!=a.event&&d.getDst()!=a.event)zb.checkForRightSplice(a,b);else if(zb.checkForIntersect(a,b))return;c.Org==d.Org&&c.getDst()==d.getDst()&&(zb.addWinding(d,c),zb.deleteRegion(a,b),a.mesh["delete"](c),b=zb.regionAbove(e))}},zb.connectRightVertex=function(a,b,c){var d,e=c.Onext,f=zb.regionBelow(b),g=b.eUp,h=f.eUp,i=!1;return g.getDst()!=h.getDst()&&zb.checkForIntersect(a,b),sb.vertEq(g.Org,a.event)&&(a.mesh.splice(e.getOprev(),g),b=zb.topLeftRegion(a,b),e=zb.regionBelow(b).eUp,zb.finishLeftRegions(a,zb.regionBelow(b),f),i=!0),sb.vertEq(h.Org,a.event)&&(a.mesh.splice(c,h.getOprev()),c=zb.finishLeftRegions(a,f,null),i=!0),i?void zb.addRightEdges(a,b,c.Onext,e,e,!0):(d=sb.vertLeq(h.Org,g.Org)?h.getOprev():g,d=a.mesh.connect(c.getLprev(),d),zb.addRightEdges(a,b,d,d.Onext,d.Onext,!1),d.Sym.activeRegion.fixUpperEdge=!0,void zb.walkDirtyRegions(a,b))},zb.connectLeftDegenerate=function(a,b,c){var d,e,f,g,h;return d=b.eUp,sb.vertEq(d.Org,c)?(nb.assert(!1),void zb.spliceMergeVertices(a,d,c.anEdge)):sb.vertEq(d.getDst(),c)?(nb.assert(!1),b=zb.topRightRegion(b),h=zb.regionBelow(b),f=h.eUp.Sym,e=g=f.Onext,h.fixUpperEdge&&(nb.assert(e!=f),zb.deleteRegion(a,h),a.mesh["delete"](f),f=e.getOprev()),a.mesh.splice(c.anEdge,f),sb.edgeGoesLeft(e)||(e=null),void zb.addRightEdges(a,b,f.Onext,g,e,!0)):(a.mesh.splitEdge(d.Sym),b.fixUpperEdge&&(a.mesh["delete"](d.Onext),b.fixUpperEdge=!1),a.mesh.splice(c.anEdge,d),void zb.sweepEvent(a,c))},zb.connectLeftVertex=function(a,b){var c,d,e,f,g,h,i=new yb;if(i.eUp=b.anEdge.Sym,c=a.dict.search(i).key,d=zb.regionBelow(c),null!=d){if(f=c.eUp,g=d.eUp,0==sb.edgeSign(f.getDst(),b,f.Org))return void zb.connectLeftDegenerate(a,c,b);if(e=sb.vertLeq(g.getDst(),f.getDst())?c:d,c.inside||e.fixUpperEdge){if(e==c)h=a.mesh.connect(b.anEdge.Sym,f.Lnext);else{var j=a.mesh.connect(g.getDnext(),b.anEdge);h=j.Sym}e.fixUpperEdge?zb.fixUpperEdge(a,e,h):zb.computeWinding(a,zb.addRegionBelow(a,c,h)),zb.sweepEvent(a,b)}else zb.addRightEdges(a,c,b.anEdge,b.anEdge,null,!0)}},zb.sweepEvent=function(a,b){a.event=b,zb.debugEvent(a);for(var c=b.anEdge;null==c.activeRegion;)if(c=c.Onext,c==b.anEdge)return void zb.connectLeftVertex(a,b);var d=zb.topLeftRegion(a,c.activeRegion);nb.assert(null!=d);var e=zb.regionBelow(d),f=e.eUp,g=zb.finishLeftRegions(a,e,null);g.Onext==f?zb.connectRightVertex(a,d,g):zb.addRightEdges(a,d,g.Onext,f,f,!0)},zb.addSentinel=function(a,b,c,d){var e=new yb,f=a.mesh.makeEdge();f.Org.s=c,f.Org.t=d,f.getDst().s=b,f.getDst().t=d,a.event=f.getDst(),e.eUp=f,e.windingNumber=0,e.inside=!1,e.fixUpperEdge=!1,e.sentinel=!0,e.dirty=!1,e.nodeUp=a.dict.insert(e)},zb.initEdgeDict=function(a){a.dict=new ub(a,zb.edgeLeq);var b=a.bmax[0]-a.bmin[0],c=a.bmax[1]-a.bmin[1],d=a.bmin[0]-b,e=a.bmax[0]+b,f=a.bmin[1]-c,g=a.bmax[1]+c;zb.addSentinel(a,d,e,f),zb.addSentinel(a,d,e,g)},zb.doneEdgeDict=function(a){for(var b,c=0;null!=(b=a.dict.min().key);)b.sentinel||(nb.assert(b.fixUpperEdge),nb.assert(1==++c)),nb.assert(0==b.windingNumber),zb.deleteRegion(a,b)},zb.removeDegenerateEdges=function(a){for(var b,c,d=a.mesh.eHead,e=d.next;e!=d;)b=e.next,c=e.Lnext,sb.vertEq(e.Org,e.getDst())&&e.Lnext.Lnext!=e&&(zb.spliceMergeVertices(a,c,e),a.mesh["delete"](e),e=c,c=e.Lnext),c.Lnext==e&&(c!=e&&((c==b||c==b.Sym)&&(b=b.next),a.mesh["delete"](c)),(e==b||e==b.Sym)&&(b=b.next),a.mesh["delete"](e)),e=b},zb.initPriorityQ=function(a){var b,c,d=0;c=a.mesh.vHead;for(var e=c.next;e!=c;)d++,e=e.next;for(d+=8,b=a.pq=new xb(d,sb.vertLeq),c=a.mesh.vHead,e=c.next;e!=c;)e.pqHandle=b.insert(e),e=e.next;return e!=c?!1:(b.init(),!0)},zb.donePriorityQ=function(a){a.pq=null},zb.removeDegenerateFaces=function(a,b){for(var c,d,e=b.fHead.next;e!=b.fHead;)c=e.next,d=e.anEdge,nb.assert(d.Lnext!=d),d.Lnext.Lnext==d&&(zb.addWinding(d.Onext,d),a.mesh["delete"](d)),e=c;return!0},zb.computeInterior=function(a){var b,c;if(zb.removeDegenerateEdges(a),!zb.initPriorityQ(a))return!1;for(zb.initEdgeDict(a);null!=(b=a.pq.extractMin());){for(;;){if(c=a.pq.min(),null==c||!sb.vertEq(c,b))break;c=a.pq.extractMin(),zb.spliceMergeVertices(a,b.anEdge,c.anEdge)}zb.sweepEvent(a,b)}return a.event=a.dict.min().key.eUp.Org,zb.debugEvent(a),zb.doneEdgeDict(a),zb.donePriorityQ(a),zb.removeDegenerateFaces(a,a.mesh)?(a.mesh.check(),!0):!1};var Ab=function(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=nb.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0};Ab.__name__=["verb","topo","Tessellator"],Ab.prototype={dot_:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},normalize_:function(a){var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];nb.assert(b>0),b=Math.sqrt(b),a[0]/=b,a[1]/=b,a[2]/=b},longAxis_:function(a){var b=0;return Math.abs(a[1])>Math.abs(a[0])&&(b=1),Math.abs(a[2])>Math.abs(a[b])&&(b=2),b},computeNormal_:function(a){var b,c,d,e,f,g,h=[0,0,0],i=[0,0,0],j=[0,0,0],k=0,l=0,m=0,n=0,o=0,p=0,q=[null,null,null],r=[null,null,null],s=this.mesh.vHead;b=s.next;for(var t=0;3>t;){var u=t++;e=b.coords[u],i[u]=e,r[u]=b,h[u]=e,q[u]=b}for(b=s.next;b!=s;){for(var v=0;3>v;){var w=v++;e=b.coords[w],e<i[w]&&(i[w]=e,r[w]=b),e>h[w]&&(h[w]=e,q[w]=b)}b=b.next}var x=0;if(h[1]-i[1]>h[0]-i[0]&&(x=1),h[2]-i[2]>h[x]-i[x]&&(x=2),i[x]>=h[x])return a[0]=0,a[1]=0,void(a[2]=1);for(g=0,c=r[x],d=q[x],j[0]=c.coords[0]-d.coords[0],j[1]=c.coords[1]-d.coords[1],j[2]=c.coords[2]-d.coords[2],b=s.next;b!=s;)k=b.coords[0]-d.coords[0],l=b.coords[1]-d.coords[1],m=b.coords[2]-d.coords[2],n=j[1]*m-j[2]*l,o=j[2]*k-j[0]*m,p=j[0]*l-j[1]*k,f=n*n+o*o+p*p,f>g&&(g=f,a[0]=n,a[1]=o,a[2]=p),b=b.next;0>=g&&(a[0]=a[1]=a[2]=0,a[this.longAxis_(j)]=1)},checkOrientation_:function(){var a,b,c,d,e=this.mesh.fHead,f=this.mesh.vHead;for(a=0,b=e.next;b!=e;)if(d=b.anEdge,!(d.winding<=0)){do a+=(d.Org.s-d.getDst().s)*(d.Org.t+d.getDst().t),d=d.Lnext;while(d!=b.anEdge);b=b.next}if(0>a){for(c=f.next;c!=f;)c.t=-c.t,c=c.next;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var a,b,c,d,e,f=this.mesh.vHead,g=[0,0,0],h=!1;for(g[0]=this.normal[0],g[1]=this.normal[1],g[2]=this.normal[2],0==g[0]&&0==g[1]&&0==g[2]&&(this.computeNormal_(g),h=!0),b=this.sUnit,c=this.tUnit,d=this.longAxis_(g),b[d]=0,b[(d+1)%3]=1,b[(d+2)%3]=0,c[d]=0,c[(d+1)%3]=0,g[d]>0?c[(d+2)%3]=1:c[(d+2)%3]=-1,a=f.next;a!=f;)a.s=this.dot_(a.coords,b),a.t=this.dot_(a.coords,c),a=a.next;for(h&&this.checkOrientation_(),e=!0,a=f.next;a!=f;)e?(this.bmin[0]=this.bmax[0]=a.s,this.bmin[1]=this.bmax[1]=a.t,e=!1):(a.s<this.bmin[0]&&(this.bmin[0]=a.s),a.s>this.bmax[0]&&(this.bmax[0]=a.s),a.t<this.bmin[1]&&(this.bmin[1]=a.t),a.t>this.bmax[1]&&(this.bmax[1]=a.t)),a=a.next},addWinding_:function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},tessellateMonoRegion_:function(a,b){var c,d;for(c=b.anEdge,nb.assert(c.Lnext!=c&&c.Lnext.Lnext!=c);sb.vertLeq(c.getDst(),c.Org);)c=c.getLprev();for(;sb.vertLeq(c.Org,c.getDst());)c=c.Lnext;for(d=c.getLprev();c.Lnext!=d;)if(sb.vertLeq(c.getDst(),d.Org)){for(;d.Lnext!=c&&(sb.edgeGoesLeft(d.Lnext)||sb.edgeSign(d.Org,d.getDst(),d.Lnext.getDst())<=0);){var e=a.connect(d.Lnext,d);d=e.Sym}d=d.getLprev()}else{for(;d.Lnext!=c&&(sb.edgeGoesRight(c.getLprev())||sb.edgeSign(c.getDst(),c.Org,c.getLprev().Org)>=0);){var f=a.connect(c,c.getLprev());c=f.Sym}c=c.Lnext}for(nb.assert(d.Lnext!=c);d.Lnext.Lnext!=c;){var g=a.connect(d.Lnext,d);d=g.Sym}return!0},tessellateInterior_:function(a){for(var b,c=a.fHead.next;c!=a.fHead;){if(b=c.next,c.inside&&!this.tessellateMonoRegion_(a,c))return!1;c=b}return!0},discardExterior_:function(a){for(var b,c=a.fHead.next;c!=a.fHead;)b=c.next,c.inside||a.zapFace(c),c=b},setWindingNumber_:function(a,b,c){for(var d,e=a.eHead.next;e!=a.eHead;)d=e.next,e.getRface().inside!=e.Lface.inside?e.Lface.inside?e.winding=b:e.winding=-b:c?a["delete"](e):e.winding=0,e=d},getNeighbourFace_:function(a){return null==a.getRface()?-1:a.getRface().inside?a.getRface().n:-1},outputPolymesh_:function(a,b,c,d){var e,f,g,h,i=0,j=0;for(c>3&&a.mergeConvexFaces(c),e=a.vHead.next;e!=a.vHead;)e.n=-1,e=e.next;for(f=a.fHead.next;f!=a.fHead;)if(f.n=-1,f.inside){g=f.anEdge,h=0;do e=g.Org,-1==e.n&&(e.n=j,j++),h++,g=g.Lnext;while(g!=f.anEdge);nb.assert(c>=h),f.n=i,++i,f=f.next}else f=f.next;for(this.elementCount=i,b==nb.CONNECTED_POLYGONS&&(i*=2),this.elements=[],A.alloc(this.elements,i*c),this.vertexCount=j,this.vertices=[],A.alloc(this.vertices,j*d),this.vertexIndices=[],A.alloc(this.vertexIndices,j),e=a.vHead.next;e!=a.vHead;){if(-1!=e.n){var k=e.n*d;this.vertices[k]=e.coords[0],this.vertices[k+1]=e.coords[1],d>2&&(this.vertices[k+2]=e.coords[2]),this.vertexIndices[e.n]=e.idx}e=e.next}var l=0;for(f=a.fHead.next;f!=a.fHead;)if(f.inside){g=f.anEdge,h=0;do e=g.Org,this.elements[l++]=e.n,h++,g=g.Lnext;while(g!=f.anEdge);for(var m=h;c>m;){m++;this.elements[l++]=-1}if(b==nb.CONNECTED_POLYGONS){g=f.anEdge;do this.elements[l++]=this.getNeighbourFace_(g),g=g.Lnext;while(g!=f.anEdge);for(var n=h;c>n;){n++;this.elements[l++]=-1}}f=f.next}else f=f.next},outputContours_:function(a,b){var c,d,e,f=0,g=0;for(this.vertexCount=0,this.elementCount=0,c=a.fHead.next;c!=a.fHead;)if(c.inside){e=d=c.anEdge;do this.vertexCount++,d=d.Lnext;while(d!=e);this.elementCount++,c=c.next}else c=c.next;this.elements=[],A.alloc(this.elements,2*this.elementCount),this.vertices=[],A.alloc(this.vertices,this.vertexCount*b),this.vertexIndices=[],A.alloc(this.vertexIndices,this.vertexCount);var h=0,i=0,j=0;for(f=0,c=a.fHead.next;c!=a.fHead;)if(c.inside){g=0,e=d=c.anEdge;do this.vertices[h++]=d.Org.coords[0],this.vertices[h++]=d.Org.coords[1],b>2&&(this.vertices[h++]=d.Org.coords[2]),this.vertexIndices[i++]=d.Org.idx,g++,d=d.Lnext;while(d!=e);this.elements[j++]=f,this.elements[j++]=g,f+=g,c=c.next;
}else c=c.next},addContour:function(a,b){var c,d;for(null==this.mesh&&(this.mesh=new rb),2>a&&(a=2),a>3&&(a=3),c=null,d=0;d<b.length;)null==c?(c=this.mesh.makeEdge(),this.mesh.splice(c,c.Sym)):(this.mesh.splitEdge(c),c=c.Lnext),c.Org.coords[0]=b[d],c.Org.coords[1]=b[d+1],a>2?c.Org.coords[2]=b[d+2]:c.Org.coords[2]=0,c.Org.idx=this.vertexIndexCounter++,c.winding=1,c.Sym.winding=-1,d+=a},tessellate:function(a,b,c,d,e){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,null!=e&&(this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2]),this.windingRule=a,2>d&&(d=2),d>3&&(d=3),null==this.mesh)return!1;this.projectPolygon_(),zb.computeInterior(this);var f=this.mesh;return b==nb.BOUNDARY_CONTOURS?this.setWindingNumber_(f,1,!0):this.tessellateInterior_(f),f.check(),b==nb.BOUNDARY_CONTOURS?this.outputContours_(f,d):this.outputPolymesh_(f,b,c,d),!0}};var Bb=b.topo.Vertex=function(a){db.call(this),this.pt=a};Bb.__name__=["verb","topo","Vertex"],Bb.__interfaces__=[ka],Bb.__super__=db,Bb.prototype=c(db.prototype,{neighbors:function(){var a={};a[this.id]=this;for(var b=[],c=(this.e,0),d=this.halfEdges();c<d.length;){var e=d[c];++c;var f=e.nxt.v;a.hasOwnProperty(f.id)||b.push(f)}return b},halfEdges:function(){var a=[],b=this.e;do{if(a.push(b),null==b.opp)break;b=b.opp.nxt}while(b!=this.e);return a}});var Cb,Db=0;Array.prototype.indexOf&&(g.indexOf=function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}),String.__name__=["String"],Array.__name__=["Array"],null==Array.prototype.map&&(Array.prototype.map=function(a){for(var b=[],c=0,d=this.length;d>c;){var e=c++;b[e]=a(this[e])}return b}),null==Array.prototype.filter&&(Array.prototype.filter=function(a){for(var b=[],c=0,d=this.length;d>c;){var e=c++,f=this[e];a(f)&&b.push(f)}return b});!function(a,b){function c(a){return o[n]=d.apply(b,a),n++}function d(a){var c=[].slice.call(arguments,1);return function(){"function"==typeof a?a.apply(b,c):new Function(""+a)()}}function e(a){if(p)setTimeout(d(e,a),0);else{var b=o[a];if(b){p=!0;try{b()}finally{f(a),p=!1}}}}function f(a){delete o[a]}function g(){m=function(){var a=c(arguments);return process.nextTick(d(e,a)),a}}function h(){if(a.postMessage&&!a.importScripts){var b=!0,c=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=c,b}}function i(){var b="setImmediate$"+Math.random()+"$",d=function(c){c.source===a&&"string"==typeof c.data&&0===c.data.indexOf(b)&&e(+c.data.slice(b.length))};a.addEventListener?a.addEventListener("message",d,!1):a.attachEvent("onmessage",d),m=function(){var d=c(arguments);return a.postMessage(b+d,"*"),d}}function j(){var a=new MessageChannel;a.port1.onmessage=function(a){var b=a.data;e(b)},m=function(){var b=c(arguments);return a.port2.postMessage(b),b}}function k(){var a=q.documentElement;m=function(){var b=c(arguments),d=q.createElement("script");return d.onreadystatechange=function(){e(b),d.onreadystatechange=null,a.removeChild(d),d=null},a.appendChild(d),b}}function l(){m=function(){var a=c(arguments);return setTimeout(d(e,a),0),a}}if(!a.setImmediate){var m,n=1,o={},p=!1,q=a.document,r=Object.getPrototypeOf&&Object.getPrototypeOf(a);r=r&&r.setTimeout?r:a,"[object process]"==={}.toString.call(a.process)?g():h()?i():a.MessageChannel?j():q&&"onreadystatechange"in q.createElement("script")?k():l(),r.setImmediate=m,r.clearImmediate=f}}(new Function("return this")()),v.queue=new i,z.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],z.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],B.memo=new m,D.TOLERANCE=1e-6,D.EPSILON=1e-10,I.INIT_STEP_LENGTH=.001,I.LINEAR_STEP_LENGTH=.1,$.TOLERANCE=1e-4,Fa.THREADS=1,Fa._init=!1,Ga.uuid=0,Ha.basePath="",cb.IN=1,cb.ON=0,cb.OUT=-1,cb.boolOnSectorMap=[[$a.AoutB,$a.AinB,$a.BinA,$a.BinA],[$a.AinB,$a.AoutB,$a.BoutA,$a.BoutA],[$a.AinB,$a.AoutB,$a.BoutA,$a.BoutA]],db.counter=0,nb.WINDING_ODD=0,nb.WINDING_NONZERO=1,nb.WINDING_POSITIVE=2,nb.WINDING_NEGATIVE=3,nb.WINDING_ABS_GEQ_TWO=4,nb.POLYGONS=0,nb.CONNECTED_POLYGONS=1,nb.BOUNDARY_CONTOURS=2,x.main()}("undefined"!=typeof console?console:{log:function(){}},"undefined"!=typeof verb?verb:exports);